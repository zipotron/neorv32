<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="description" content="A size-optimized, customizable and open-source full-scale 32-bit RISC-V soft-core CPU and SoC written in platform-independent VHDL.">
<meta name="keywords" content="neorv32, risc-v, riscv, fpga, soft-core, vhdl, microcontroller, cpu, soc, processor, gcc, openocd, gdb">
<meta name="author" content="Dipl.-Ing. Stephan Nolting">
<link rel="icon" type="image/png" href="img/icon.png">
<title>[Datasheet] The NEORV32 RISC-V Processor</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The NEORV32 RISC-V Processor: Datasheet</h1>
<div class="details">
<span id="author" class="author">Dipl.-Ing. Stephan Nolting</span><br>
<span id="email" class="email"><a href="mailto:stnolting@gmail.com">stnolting@gmail.com</a></span><br>
<span id="revnumber">version v1.6.3-r74-g2aed6dcb</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#_rationale">1.1. Rationale</a></li>
<li><a href="#_project_key_features">1.2. Project Key Features</a></li>
<li><a href="#_project_folder_structure">1.3. Project Folder Structure</a></li>
<li><a href="#_vhdl_file_hierarchy">1.4. VHDL File Hierarchy</a></li>
<li><a href="#_fpga_implementation_results">1.5. FPGA Implementation Results</a>
<ul class="sectlevel3">
<li><a href="#_cpu">1.5.1. CPU</a></li>
<li><a href="#_processor_modules">1.5.2. Processor Modules</a></li>
<li><a href="#_exemplary_setups">1.5.3. Exemplary Setups</a></li>
</ul>
</li>
<li><a href="#_cpu_performance">1.6. CPU Performance</a></li>
</ul>
</li>
<li><a href="#_neorv32_processor_soc">2. NEORV32 Processor (SoC)</a>
<ul class="sectlevel2">
<li><a href="#_processor_top_entity_signals">2.1. Processor Top Entity - Signals</a></li>
<li><a href="#_processor_top_entity_generics">2.2. Processor Top Entity - Generics</a>
<ul class="sectlevel3">
<li><a href="#_general">2.2.1. General</a>
<ul class="sectlevel4">
<li><a href="#_clock_frequency"><em>CLOCK_FREQUENCY</em></a></li>
<li><a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a></li>
<li><a href="#_hw_thread_id"><em>HW_THREAD_ID</em></a></li>
<li><a href="#_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></a></li>
</ul>
</li>
<li><a href="#_risc_v_cpu_extensions">2.2.2. RISC-V CPU Extensions</a>
<ul class="sectlevel4">
<li><a href="#_cpu_extension_riscv_a"><em>CPU_EXTENSION_RISCV_A</em></a></li>
<li><a href="#_cpu_extension_riscv_b"><em>CPU_EXTENSION_RISCV_B</em></a></li>
<li><a href="#_cpu_extension_riscv_c"><em>CPU_EXTENSION_RISCV_C</em></a></li>
<li><a href="#_cpu_extension_riscv_e"><em>CPU_EXTENSION_RISCV_E</em></a></li>
<li><a href="#_cpu_extension_riscv_m"><em>CPU_EXTENSION_RISCV_M</em></a></li>
<li><a href="#_cpu_extension_riscv_u"><em>CPU_EXTENSION_RISCV_U</em></a></li>
<li><a href="#_cpu_extension_riscv_zfinx"><em>CPU_EXTENSION_RISCV_Zfinx</em></a></li>
<li><a href="#_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></a></li>
<li><a href="#_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></a></li>
<li><a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a></li>
<li><a href="#_cpu_extension_riscv_zifencei"><em>CPU_EXTENSION_RISCV_Zifencei</em></a></li>
<li><a href="#_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></a></li>
</ul>
</li>
<li><a href="#_extension_options">2.2.3. Extension Options</a>
<ul class="sectlevel4">
<li><a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a></li>
<li><a href="#_fast_shift_en"><em>FAST_SHIFT_EN</em></a></li>
<li><a href="#_cpu_cnt_width"><em>CPU_CNT_WIDTH</em></a></li>
<li><a href="#_cpu_ipb_entries"><em>CPU_IPB_ENTRIES</em></a></li>
</ul>
</li>
<li><a href="#_physical_memory_protection_pmp">2.2.4. Physical Memory Protection (PMP)</a>
<ul class="sectlevel4">
<li><a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a></li>
<li><a href="#_pmp_min_granularity"><em>PMP_MIN_GRANULARITY</em></a></li>
</ul>
</li>
<li><a href="#_hardware_performance_monitors_hpm">2.2.5. Hardware Performance Monitors (HPM)</a>
<ul class="sectlevel4">
<li><a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a></li>
<li><a href="#_hpm_cnt_width"><em>HPM_CNT_WIDTH</em></a></li>
</ul>
</li>
<li><a href="#_internal_instruction_memory">2.2.6. Internal Instruction Memory</a>
<ul class="sectlevel4">
<li><a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a></li>
<li><a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a></li>
</ul>
</li>
<li><a href="#_internal_data_memory">2.2.7. Internal Data Memory</a>
<ul class="sectlevel4">
<li><a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a></li>
<li><a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a></li>
</ul>
</li>
<li><a href="#_internal_cache_memory">2.2.8. Internal Cache Memory</a>
<ul class="sectlevel4">
<li><a href="#_icache_en"><em>ICACHE_EN</em></a></li>
<li><a href="#_icache_num_block"><em>ICACHE_NUM_BLOCK</em></a></li>
<li><a href="#_icache_block_size"><em>ICACHE_BLOCK_SIZE</em></a></li>
<li><a href="#_icache_associativity"><em>ICACHE_ASSOCIATIVITY</em></a></li>
</ul>
</li>
<li><a href="#_external_memory_interface">2.2.9. External Memory Interface</a>
<ul class="sectlevel4">
<li><a href="#_mem_ext_en"><em>MEM_EXT_EN</em></a></li>
<li><a href="#_mem_ext_timeout"><em>MEM_EXT_TIMEOUT</em></a></li>
<li><a href="#_mem_ext_pipe_mode"><em>MEM_EXT_PIPE_MODE</em></a></li>
<li><a href="#_mem_ext_big_endian"><em>MEM_EXT_BIG_ENDIAN</em></a></li>
<li><a href="#_mem_ext_async_rx"><em>MEM_EXT_ASYNC_RX</em></a></li>
</ul>
</li>
<li><a href="#_stream_link_interface">2.2.10. Stream Link Interface</a>
<ul class="sectlevel4">
<li><a href="#_slink_num_tx"><em>SLINK_NUM_TX</em></a></li>
<li><a href="#_slink_num_rx"><em>SLINK_NUM_RX</em></a></li>
<li><a href="#_slink_tx_fifo"><em>SLINK_TX_FIFO</em></a></li>
<li><a href="#_slink_rx_fifo"><em>SLINK_RX_FIFO</em></a></li>
</ul>
</li>
<li><a href="#_external_interrupt_controller">2.2.11. External Interrupt Controller</a>
<ul class="sectlevel4">
<li><a href="#_xirq_num_ch"><em>XIRQ_NUM_CH</em></a></li>
<li><a href="#_xirq_trigger_type"><em>XIRQ_TRIGGER_TYPE</em></a></li>
<li><a href="#_xirq_trigger_polarity"><em>XIRQ_TRIGGER_POLARITY</em></a></li>
</ul>
</li>
<li><a href="#_processor_peripheralio_modules">2.2.12. Processor Peripheral/IO Modules</a>
<ul class="sectlevel4">
<li><a href="#_io_gpio_en"><em>IO_GPIO_EN</em></a></li>
<li><a href="#_io_mtime_en"><em>IO_MTIME_EN</em></a></li>
<li><a href="#_io_uart0_en"><em>IO_UART0_EN</em></a></li>
<li><a href="#_io_uart0_rx_fifo"><em>IO_UART0_RX_FIFO</em></a></li>
<li><a href="#_io_uart0_tx_fifo"><em>IO_UART0_TX_FIFO</em></a></li>
<li><a href="#_io_uart1_en"><em>IO_UART1_EN</em></a></li>
<li><a href="#_io_uart1_rx_fifo"><em>IO_UART1_RX_FIFO</em></a></li>
<li><a href="#_io_uart1_tx_fifo"><em>IO_UART1_TX_FIFO</em></a></li>
<li><a href="#_io_spi_en"><em>IO_SPI_EN</em></a></li>
<li><a href="#_io_twi_en"><em>IO_TWI_EN</em></a></li>
<li><a href="#_io_pwm_num_ch"><em>IO_PWM_NUM_CH</em></a></li>
<li><a href="#_io_wdt_en"><em>IO_WDT_EN</em></a></li>
<li><a href="#_io_trng_en"><em>IO_TRNG_EN</em></a></li>
<li><a href="#_io_cfs_en"><em>IO_CFS_EN</em></a></li>
<li><a href="#_io_cfs_config"><em>IO_CFS_CONFIG</em></a></li>
<li><a href="#_io_cfs_in_size"><em>IO_CFS_IN_SIZE</em></a></li>
<li><a href="#_io_cfs_out_size"><em>IO_CFS_OUT_SIZE</em></a></li>
<li><a href="#_io_neoled_en"><em>IO_NEOLED_EN</em></a></li>
<li><a href="#_io_neoled_tx_fifo"><em>IO_NEOLED_TX_FIFO</em></a></li>
<li><a href="#_io_gptmr_en"><em>IO_GPTMR_EN</em></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_processor_interrupts">2.3. Processor Interrupts</a>
<ul class="sectlevel3">
<li><a href="#_risc_v_standard_interrupts">2.3.1. RISC-V Standard Interrupts</a></li>
<li><a href="#_platform_external_interrupts">2.3.2. Platform External Interrupts</a></li>
<li><a href="#_neorv32_specific_fast_interrupt_requests">2.3.3. NEORV32-Specific Fast Interrupt Requests</a></li>
</ul>
</li>
<li><a href="#_address_space">2.4. Address Space</a>
<ul class="sectlevel3">
<li><a href="#_cpu_data_and_instruction_access">2.4.1. CPU Data and Instruction Access</a></li>
<li><a href="#_address_space_layout">2.4.2. Address Space Layout</a></li>
<li><a href="#_physical_memory_attributes">2.4.3. Physical Memory Attributes</a></li>
<li><a href="#_memory_configuration">2.4.4. Memory Configuration</a>
<ul class="sectlevel4">
<li><a href="#_internal_memories">Internal Memories</a></li>
<li><a href="#_external_memories">External Memories</a></li>
</ul>
</li>
<li><a href="#_boot_configuration">2.4.5. Boot Configuration</a>
<ul class="sectlevel4">
<li><a href="#_indirect_boot">Indirect Boot</a></li>
<li><a href="#_direct_boot">Direct Boot</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_processor_internal_modules">2.5. Processor-Internal Modules</a>
<ul class="sectlevel3">
<li><a href="#_instruction_memory_imem">2.5.1. Instruction Memory (IMEM)</a></li>
<li><a href="#_data_memory_dmem">2.5.2. Data Memory (DMEM)</a></li>
<li><a href="#_bootloader_rom_bootrom">2.5.3. Bootloader ROM (BOOTROM)</a></li>
<li><a href="#_processor_internal_instruction_cache_icache">2.5.4. Processor-Internal Instruction Cache (iCACHE)</a></li>
<li><a href="#_processor_external_memory_interface_wishbone_axi4_lite">2.5.5. Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a></li>
<li><a href="#_internal_bus_monitor_buskeeper">2.5.6. Internal Bus Monitor (BUSKEEPER)</a></li>
<li><a href="#_stream_link_interface_slink">2.5.7. Stream Link Interface (SLINK)</a></li>
<li><a href="#_general_purpose_input_and_output_port_gpio">2.5.8. General Purpose Input and Output Port (GPIO)</a></li>
<li><a href="#_watchdog_timer_wdt">2.5.9. Watchdog Timer (WDT)</a></li>
<li><a href="#_machine_system_timer_mtime">2.5.10. Machine System Timer (MTIME)</a></li>
<li><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">2.5.11. Primary Universal Asynchronous Receiver and Transmitter (UART0)</a></li>
<li><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">2.5.12. Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a></li>
<li><a href="#_serial_peripheral_interface_controller_spi">2.5.13. Serial Peripheral Interface Controller (SPI)</a></li>
<li><a href="#_two_wire_serial_interface_controller_twi">2.5.14. Two-Wire Serial Interface Controller (TWI)</a></li>
<li><a href="#_pulse_width_modulation_controller_pwm">2.5.15. Pulse-Width Modulation Controller (PWM)</a></li>
<li><a href="#_true_random_number_generator_trng">2.5.16. True Random-Number Generator (TRNG)</a></li>
<li><a href="#_custom_functions_subsystem_cfs">2.5.17. Custom Functions Subsystem (CFS)</a></li>
<li><a href="#_smart_led_interface_neoled">2.5.18. Smart LED Interface (NEOLED)</a></li>
<li><a href="#_external_interrupt_controller_xirq">2.5.19. External Interrupt Controller (XIRQ)</a></li>
<li><a href="#_general_purpose_timer_gptmr">2.5.20. General Purpose Timer (GPTMR)</a></li>
<li><a href="#_system_configuration_information_memory_sysinfo">2.5.21. System Configuration Information Memory (SYSINFO)</a>
<ul class="sectlevel4">
<li><a href="#_sysinfo_cpu_configuration">SYSINFO - CPU Configuration</a></li>
<li><a href="#_sysinfo_soc_configuration">SYSINFO - SoC Configuration</a></li>
<li><a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_neorv32_central_processing_unit_cpu">3. NEORV32 Central Processing Unit (CPU)</a>
<ul class="sectlevel2">
<li><a href="#_architecture">3.1. Architecture</a></li>
<li><a href="#_full_virtualization">3.2. Full Virtualization</a></li>
<li><a href="#_risc_v_compatibility">3.3. RISC-V Compatibility</a>
<ul class="sectlevel3">
<li><a href="#_risc_v_incompatibility_issues_and_limitations">3.3.1. RISC-V Incompatibility Issues and Limitations</a></li>
</ul>
</li>
<li><a href="#_cpu_top_entity_signals">3.4. CPU Top Entity - Signals</a></li>
<li><a href="#_cpu_top_entity_generics">3.5. CPU Top Entity - Generics</a></li>
<li><a href="#_instruction_sets_and_extensions">3.6. Instruction Sets and Extensions</a>
<ul class="sectlevel3">
<li><a href="#_a_atomic_memory_access">3.6.1. <strong><code>A</code></strong> - Atomic Memory Access</a></li>
<li><a href="#_b_bit_manipulation_operations">3.6.2. <strong><code>B</code></strong> - Bit-Manipulation Operations</a></li>
<li><a href="#_c_compressed_instructions">3.6.3. <strong><code>C</code></strong> - Compressed Instructions</a></li>
<li><a href="#_e_embedded_cpu">3.6.4. <strong><code>E</code></strong> - Embedded CPU</a></li>
<li><a href="#_i_base_integer_isa">3.6.5. <strong><code>I</code></strong> - Base Integer ISA</a></li>
<li><a href="#_m_integer_multiplication_and_division">3.6.6. <strong><code>M</code></strong> - Integer Multiplication and Division</a></li>
<li><a href="#_zmmul_integer_multiplication">3.6.7. <strong><code>Zmmul</code></strong> - Integer Multiplication</a></li>
<li><a href="#_u_less_privileged_user_mode">3.6.8. <strong><code>U</code></strong> - Less-Privileged User Mode</a></li>
<li><a href="#_x_neorv32_specific_custom_extensions">3.6.9. <strong><code>X</code></strong> - NEORV32-Specific (Custom) Extensions</a></li>
<li><a href="#_zfinx_single_precision_floating_point_operations">3.6.10. <strong><code>Zfinx</code></strong> Single-Precision Floating-Point Operations</a></li>
<li><a href="#_zicsr_control_and_status_register_access_privileged_architecture">3.6.11. <strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</a></li>
<li><a href="#_zicntr_cpu_base_counters">3.6.12. <strong><code>Zicntr</code></strong> CPU Base Counters</a></li>
<li><a href="#_zihpm_hardware_performance_monitors">3.6.13. <strong><code>Zihpm</code></strong> Hardware Performance Monitors</a></li>
<li><a href="#_zifencei_instruction_stream_synchronization">3.6.14. <strong><code>Zifencei</code></strong> Instruction Stream Synchronization</a></li>
<li><a href="#_pmp_physical_memory_protection">3.6.15. <strong><code>PMP</code></strong> Physical Memory Protection</a></li>
</ul>
</li>
<li><a href="#_instruction_timing">3.7. Instruction Timing</a></li>
<li><a href="#_control_and_status_registers_csrs">3.8. Control and Status Registers (CSRs)</a>
<ul class="sectlevel3">
<li><a href="#_floating_point_csrs">3.8.1. Floating-Point CSRs</a>
<ul class="sectlevel4">
<li><a href="#_fflags"><strong><code>fflags</code></strong></a></li>
<li><a href="#_frm"><strong><code>frm</code></strong></a></li>
<li><a href="#_fcsr"><strong><code>fcsr</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_configuration_csrs">3.8.2. Machine Configuration CSRs</a>
<ul class="sectlevel4">
<li><a href="#_menvcfg"><strong><code>menvcfg</code></strong></a></li>
<li><a href="#_menvcfgh"><strong><code>menvcfgh</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_trap_setup_csrs">3.8.3. Machine Trap Setup CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mstatus"><strong><code>mstatus</code></strong></a></li>
<li><a href="#_misa"><strong><code>misa</code></strong></a></li>
<li><a href="#_mie"><strong><code>mie</code></strong></a></li>
<li><a href="#_mtvec"><strong><code>mtvec</code></strong></a></li>
<li><a href="#_mcounteren"><strong><code>mcounteren</code></strong></a></li>
<li><a href="#_mstatush"><strong><code>mstatush</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_trap_handling_csrs">3.8.4. Machine Trap Handling CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mscratch"><strong><code>mscratch</code></strong></a></li>
<li><a href="#_mepc"><strong><code>mepc</code></strong></a></li>
<li><a href="#_mcause"><strong><code>mcause</code></strong></a></li>
<li><a href="#_mtval"><strong><code>mtval</code></strong></a></li>
<li><a href="#_mip"><strong><code>mip</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_physical_memory_protection_csrs">3.8.5. Machine Physical Memory Protection CSRs</a>
<ul class="sectlevel4">
<li><a href="#_pmpcfg"><strong><code>pmpcfg</code></strong></a></li>
<li><a href="#_pmpaddr"><strong><code>pmpaddr</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_counter_and_timer_csrs">3.8.6. (Machine) Counter and Timer CSRs</a>
<ul class="sectlevel4">
<li><a href="#_cycleh"><strong><code>cycle[h]</code></strong></a></li>
<li><a href="#_timeh"><strong><code>time[h]</code></strong></a></li>
<li><a href="#_instreth"><strong><code>instret[h]</code></strong></a></li>
<li><a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a></li>
<li><a href="#_minstreth"><strong><code>minstret[h]</code></strong></a></li>
</ul>
</li>
<li><a href="#_hardware_performance_monitors_hpm_csrs">3.8.7. Hardware Performance Monitors (HPM) CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mhpmevent"><strong><code>mhpmevent</code></strong></a></li>
<li><a href="#_mhpmcounterh"><strong><code>mhpmcounter[h]</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_counter_setup_csrs">3.8.8. Machine Counter Setup CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_information_csrs">3.8.9. Machine Information CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mvendorid"><strong><code>mvendorid</code></strong></a></li>
<li><a href="#_marchid"><strong><code>marchid</code></strong></a></li>
<li><a href="#_mimpid"><strong><code>mimpid</code></strong></a></li>
<li><a href="#_mhartid"><strong><code>mhartid</code></strong></a></li>
<li><a href="#_mconfigptr"><strong><code>mconfigptr</code></strong></a></li>
</ul>
</li>
<li><a href="#_traps_exceptions_and_interrupts">3.8.10. Traps, Exceptions and Interrupts</a></li>
<li><a href="#_memory_access_exceptions">3.8.11. Memory Access Exceptions**</a></li>
<li><a href="#_custom_fast_interrupt_request_lines">3.8.12. Custom Fast Interrupt Request Lines</a>
<ul class="sectlevel4">
<li><a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a></li>
</ul>
</li>
<li><a href="#_bus_interface">3.8.13. Bus Interface</a>
<ul class="sectlevel4">
<li><a href="#_address_space_2">Address Space</a></li>
<li><a href="#_interface_signals">Interface Signals</a></li>
<li><a href="#_protocol">Protocol</a></li>
</ul>
</li>
<li><a href="#_cpu_hardware_reset">3.8.14. CPU Hardware Reset</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_software_framework">4. Software Framework</a>
<ul class="sectlevel2">
<li><a href="#_compiler_toolchain">4.1. Compiler Toolchain</a></li>
<li><a href="#_core_libraries">4.2. Core Libraries</a></li>
<li><a href="#_application_makefile">4.3. Application Makefile</a>
<ul class="sectlevel3">
<li><a href="#_targets">4.3.1. Targets</a></li>
<li><a href="#_configuration">4.3.2. Configuration</a></li>
<li><a href="#_default_compiler_flags">4.3.3. Default Compiler Flags</a></li>
</ul>
</li>
<li><a href="#_executable_image_format">4.4. Executable Image Format</a>
<ul class="sectlevel3">
<li><a href="#_linker_script">4.4.1. Linker Script</a></li>
<li><a href="#_executable_image_generator">4.4.2. Executable Image Generator</a></li>
<li><a href="#_start_up_code_crt0">4.4.3. Start-Up Code (crt0)</a>
<ul class="sectlevel4">
<li><a href="#_after_main_handler">After-Main Handler</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_bootloader">4.5. Bootloader</a>
<ul class="sectlevel3">
<li><a href="#_auto_boot_sequence">4.5.1. Auto Boot Sequence</a></li>
<li><a href="#_bootloader_error_codes">4.5.2. Bootloader Error Codes</a></li>
</ul>
</li>
<li><a href="#_neorv32_runtime_environment">4.6. NEORV32 Runtime Environment</a></li>
</ul>
</li>
<li><a href="#_on_chip_debugger_ocd">5. On-Chip Debugger (OCD)</a>
<ul class="sectlevel2">
<li><a href="#_debug_transport_module_dtm">5.1. Debug Transport Module (DTM)</a></li>
<li><a href="#_debug_module_dm">5.2. Debug Module (DM)</a>
<ul class="sectlevel3">
<li><a href="#_dm_registers">5.2.1. DM Registers</a>
<ul class="sectlevel4">
<li><a href="#_data"><strong><code>data</code></strong></a></li>
<li><a href="#_dmcontrol"><strong><code>dmcontrol</code></strong></a></li>
<li><a href="#_dmstatus"><strong><code>dmstatus</code></strong></a></li>
<li><a href="#_hartinfo"><strong><code>hartinfo</code></strong></a></li>
<li><a href="#_abstracts"><strong><code>abstracts</code></strong></a></li>
<li><a href="#_command"><strong><code>command</code></strong></a></li>
<li><a href="#_abstractauto"><strong><code>abstractauto</code></strong></a></li>
<li><a href="#_progbuf"><strong><code>progbuf</code></strong></a></li>
<li><a href="#_haltsum0"><strong><code>haltsum0</code></strong></a></li>
</ul>
</li>
<li><a href="#_dm_cpu_access">5.2.2. DM CPU Access</a></li>
</ul>
</li>
<li><a href="#_cpu_debug_mode">5.3. CPU Debug Mode</a>
<ul class="sectlevel3">
<li><a href="#_cpu_debug_mode_csrs">5.3.1. CPU Debug Mode CSRs</a>
<ul class="sectlevel4">
<li><a href="#_dcsr"><strong><code>dcsr</code></strong></a></li>
<li><a href="#_dpc"><strong><code>dpc</code></strong></a></li>
<li><a href="#_dscratch0"><strong><code>dscratch0</code></strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_legal">6. Legal</a>
<ul class="sectlevel2">
<li><a href="#_license">License</a></li>
<li><a href="#_proprietary_notice">Proprietary Notice</a></li>
<li><a href="#_disclaimer">Disclaimer</a></li>
<li><a href="#_limitation_of_liability_for_external_links">Limitation of Liability for External Links</a></li>
<li><a href="#_citing">Citing</a></li>
<li><a href="#_acknowledgments">Acknowledgments</a></li>
<li><a href="#_impressum_imprint">Impressum (Imprint)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_logo_transparent.png" alt="neorv32 logo transparent">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/riscv_logo.png" alt="riscv logo" width="350">
</div>
</div>
<div class="paragraph text-center">
<p><a href="https://github.com/stnolting/neorv32"><span class="image"><img src="https://img.shields.io/badge/GitHub-stnolting%2Fneorv32-ffbd00?style=flat-square&amp;logo=github&amp;" alt="GitHub stnolting%2Fneorv32 ffbd00?style=flat square&amp;logo=github&amp;" title="homepage"></span></a>
<a href="https://github.com/stnolting/neorv32/blob/master/LICENSE"><span class="image"><img src="https://img.shields.io/github/license/stnolting/neorv32?longCache=true&amp;style=flat-square" alt="neorv32?longCache=true&amp;style=flat square" title="license"></span></a>
<a href="https://gitter.im/neorv32/community"><span class="image"><img src="https://img.shields.io/badge/Chat-on%20gitter-4db797.svg?longCache=true&amp;style=flat-square&amp;logo=gitter&amp;logoColor=e8ecef" alt="Chat on%20gitter 4db797" title="chat on gitter"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/data%20sheet-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="data%20sheet PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="datasheet (pdf)"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/user%20guide-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="user%20guide PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="userguide (pdf)"></span></a>
<a href="https://stnolting.github.io/neorv32/ug"><span class="image"><img src="https://img.shields.io/badge/-HTML-ffbd00?longCache=true&amp;style=flat-square" alt=" HTML ffbd00?longCache=true&amp;style=flat square" title="userguide (html)"></span></a>
<a href="https://stnolting.github.io/neorv32/sw/files.html"><span class="image"><img src="https://img.shields.io/badge/doxygen-HTML-ffbd00?longCache=true&amp;style=flat-square&amp;logo=Doxygen" alt="doxygen HTML ffbd00?longCache=true&amp;style=flat square&amp;logo=Doxygen" title="doxygen"></span></a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> is an open-source
RISC-V compatible processor system that is intended as <strong>ready-to-go</strong> auxiliary processor within a larger SoC
designs or as stand-alone custom / customizable microcontroller.</p>
</div>
<div class="paragraph">
<p>The system is highly configurable and provides optional common peripherals like embedded memories,
timers, serial interfaces, general purpose IO ports and an external bus interface to connect custom IP like
memories, NoCs and other peripherals. On-line and in-system debugging is supported by an OpenOCD/gdb
compatible on-chip debugger accessible via JTAG.</p>
</div>
<div class="paragraph">
<p>Special focus is paid on <strong>execution safety</strong> to provide defined and predictable behavior at any time.
Therefore, the CPU ensures that all memory access are acknowledged and no invalid/malformed instructions
are executed. Whenever an unexpected situation occurs, the application code is informed via hardware exceptions.</p>
</div>
<div class="paragraph">
<p>The software framework of the processor comes with application makefiles, software libraries for all CPU
and processor features, a bootloader, a runtime environment and several example programs - including a port
of the CoreMark MCU benchmark and the official RISC-V architecture test suite. RISC-V GCC is used as
default toolchain (<a href="https://github.com/stnolting/riscv-gcc-prebuilt">prebuilt toolchains are also provided</a>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Check out the processor&#8217;s <strong><a href="https://stnolting.github.io/neorv32/ug">online User Guide</a></strong>
that provides hands-on tutorial to get you started.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The project&#8217;s change log is available in <a href="https://github.com/stnolting/neorv32/blob/master/CHANGELOG.md">CHANGELOG.md</a>
in the root directory of the NEORV32 repository. Please also check out the <a href="#_legal">Legal</a> section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Structure</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><a href="#_neorv32_processor_soc">NEORV32 Processor (SoC)</a></p>
</li>
<li>
<p><a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a></p>
</li>
<li>
<p><a href="#_software_framework">Software Framework</a></p>
</li>
<li>
<p><a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Links in this document are <a href="#_overview">highlighted</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_rationale">1.1. Rationale</h3>
<div class="paragraph">
<p><strong>Why did you make this?</strong></p>
</div>
<div class="paragraph">
<p>I am fascinated by processor and CPU architecture design: it is the magic frontier where software meets hardware.
This project has started as something like a <em>journey</em> into this magic realm to understand how things actually work
down on this very low level.</p>
</div>
<div class="paragraph">
<p>But there is more! When I started to dive into the emerging RISC-V ecosystem I felt overwhelmed by the complexity.
As a beginner it is hard to get an overview - especially when you want to setup a minimal platform to tinker with:
Which core to use? How to get the right toolchain? What features do I need? How does the booting work? How do I
create an actual executable? How to get that into the hardware? How to customize things? <strong><em>Where to start???</em></strong></p>
</div>
<div class="paragraph">
<p>So this project aims to provides a <em>simple to understand</em> and <em>easy to use</em> yet <em>powerful</em> and <em>flexible</em> platform
that targets FPGA and RISC-V beginners as well as advanced users. Join me and us on this journey! 🙃</p>
</div>
<div class="paragraph">
<p><strong>Why a <em>soft</em>-core processor?</strong></p>
</div>
<div class="paragraph">
<p>As a matter of fact soft-core processors <em>cannot</em> compete with discrete or FPGA hard-macro processors in terms
of performance, energy and size. But they do fill a niche in FPGA design space. For example, soft-core processors
allow to implement the <em>control flow part</em> of certain applications (like communication protocol handling) using
software like plain C. This provides high flexibility as software can be easily changed, re-compiled and
re-uploaded again.</p>
</div>
<div class="paragraph">
<p>Furthermore, the concept of flexibility applies to all aspects of a soft-core processor. The user can add
<em>exactly</em> the features that are required by the application: additional memories, custom interfaces, specialized
IP and even user-defined instructions.</p>
</div>
<div class="paragraph">
<p><strong>Why RISC-V?</strong></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>RISC-V is a free and open ISA enabling a new era of processor innovation through open standard collaboration.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; RISC-V International<br>
<cite>https://riscv.org/about/</cite>
</div>
</div>
<div class="paragraph">
<p>I love the idea of open-source. <strong>Knowledge can help best if it is freely available.</strong>
While open-source has already become quite popular in <em>software</em>, hardware projects still need to catch up.
Admittedly, there has been quite a development, but mainly in terms of <em>platforms</em> and <em>applications</em> (so
schematics, PCBs, etc.). Although processors and CPUs are the heart of almost every digital system, having a true
open-source silicon is still a rarity. RISC-V aims to change that. Even it is <em>just one approach</em>, it helps paving
the road for future development.</p>
</div>
<div class="paragraph">
<p>Furthermore, I welcome the community aspect of RISC-V. The ISA and everything beyond is developed with direct
contact to the community: this includes businesses and professionals but also hobbyist, amateurs and people
that are just curious. Everyone can join discussions and contribute to RISC-V in their very own way.</p>
</div>
<div class="paragraph">
<p>Finally, I really like the RISC-V ISA itself. It aims to be a clean, orthogonal and "intuitive" ISA that
resembles with the basic concepts of <em>RISC</em>: simple yet effective.</p>
</div>
<div class="paragraph">
<p><strong>Yet another RISC-V core? What makes it special?</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 is not based on another RISC-V core. It was build entirely from ground up (just following the official
ISA specs) having a different design goal in mind. The project does not intend to replace certain RISC-V cores or
just beat existing ones like <a href="https://github.com/SpinalHDL/VexRiscv">VexRISC</a> in terms of performance or
<a href="https://github.com/olofk/serv">SERV</a> in terms of size.</p>
</div>
<div class="paragraph">
<p>The project aims to provide <em>another option</em> in the RISC-V / soft-core design space with a different performance
vs. size trade-off and a different focus: <em>embrace</em> concepts like documentation, platform-independence / portability,
RISC-V compatibility, <em>customization</em> and <em>ease of use</em>. See the <a href="#_project_key_features">Project Key Features</a> below.</p>
</div>
<div class="paragraph">
<p>Furthermore, the NEORV32 pays special focus on <em>execution safety</em> using <a href="#_full_virtualization">Full Virtualization</a>. The CPU aims to
provide fall-backs for <em>everything that could go wrong</em>. This includes malformed instruction words, privilege escalations
and even memory accesses that are checked for address space holes and deterministic response times from memory-mapped
devices. Precise exceptions allow a defined and fully-synchronized state of the CPU at every time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_project_key_features">1.2. Project Key Features</h3>
<div class="ulist">
<ul>
<li>
<p>open-source and documented; including user guides to get started</p>
</li>
<li>
<p>completely described in behavioral, platform-independent VHDL (yet platform-optimized modules are provided)</p>
</li>
<li>
<p>fully synchronous design, no latches, no gated clocks</p>
</li>
<li>
<p>small hardware footprint and high operating frequency for easy integration</p>
</li>
<li>
<p><strong>NEORV32 CPU</strong>: 32-bit <code>rv32i</code> RISC-V CPU</p>
<div class="ulist">
<ul>
<li>
<p>RISC-V compatibility: passes the official architecture tests</p>
</li>
<li>
<p>base architecture + privileged architecture (optional) + ISA extensions (optional)</p>
</li>
<li>
<p>rich set of customization options (ISA extensions, design goal: performance / area (/ energy), &#8230;&#8203;)</p>
</li>
<li>
<p>aims to support <a href="#_full_virtualization">Full Virtualization</a> capabilities (CPU <em>and</em> SoC) to increase execution safety</p>
</li>
<li>
<p>official <a href="https://github.com/riscv/riscv-isa-manual/blob/master/marchid.md">RISC-V open source architecture ID</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>NEORV32 Processor (SoC)</strong>: highly-configurable full-scale microcontroller-like processor system</p>
<div class="ulist">
<ul>
<li>
<p>based on the NEORV32 CPU</p>
</li>
<li>
<p>optional serial interfaces (UARTs, TWI, SPI)</p>
</li>
<li>
<p>optional timers and counters (WDT, MTIME)</p>
</li>
<li>
<p>optional general purpose IO and PWM and native NeoPixel (c) compatible smart LED interface</p>
</li>
<li>
<p>optional embedded memories / caches for data, instructions and bootloader</p>
</li>
<li>
<p>optional external memory interface (Wishbone / AXI4-Lite) and stream link interface (AXI4-Stream) for custom connectivity</p>
</li>
<li>
<p>on-chip debugger compatible with OpenOCD and gdb</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Software framework</strong></p>
<div class="ulist">
<ul>
<li>
<p>GCC-based toolchain - prebuilt toolchains available; application compilation based on GNU makefiles</p>
</li>
<li>
<p>internal bootloader with serial user interface</p>
</li>
<li>
<p>core libraries for high-level usage of the provided functions and peripherals</p>
</li>
<li>
<p>runtime environment and several example programs</p>
</li>
<li>
<p>doxygen-based documentation of the software framework; a deployed version is available at <a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a></p>
</li>
<li>
<p>FreeRTOS port + demos available</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more in-depth details regarding the feature provided by he hardware see the according sections:
<a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a> and <a href="#_neorv32_processor_soc">NEORV32 Processor (SoC)</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_project_folder_structure">1.3. Project Folder Structure</h3>
<div class="literalblock">
<div class="content">
<pre>neorv32                - Project home folder
│
├docs                  - Project documentation
│├datasheet            - AsciiDoc sources for the NEORV32 data sheet
│├figures              - Figures and logos
│├icons                - Misc. symbols
│├references           - Data sheets and RISC-V specs.
│└userguide            - AsciiDoc sources for the NEORV32 user guide
│
├rtl                   - VHDL sources
│├core                 - Core sources of the CPU &amp; SoC
││└mem                 - SoC-internal memories (default architectures)
│├processor_templates  - Pre-configured SoC wrappers
│├system_integration   - System wrappers for advanced connectivity
│└test_setups          - Minimal test setup "SoCs" used in the User Guide
│
├setups                - Example setups for various FPGAs, boards and toolchains
│└...
│
├sim                   - Simulation files (see User Guide)
│
└sw                    - Software framework
 ├bootloader           - Sources of the processor-internal bootloader
 ├common               - Linker script, crt0.S start-up code and central makefile
 ├example              - Various example programs
 │└...
 ├isa-test
 │├riscv-arch-test     - RISC-V spec. compatibility test framework (submodule)
 │└port-neorv32        - Port files for the official RISC-V architecture tests
 ├ocd_firmware         - Source code for on-chip debugger's "park loop"
 ├openocd              - OpenOCD on-chip debugger configuration files
 ├image_gen            - Helper program to generate NEORV32 executables
 └lib                  - Processor core library
  ├include             - Header files (*.h)
  └source              - Source files (*.c)</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_vhdl_file_hierarchy">1.4. VHDL File Hierarchy</h3>
<div class="paragraph">
<p>All necessary VHDL hardware description files are located in the project&#8217;s <code>rtl/core</code> folder. The top entity
of the entire processor including all the required configuration generics is <strong><code>neorv32_top.vhd</code></strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All core VHDL files from the list below have to be assigned to a new design library named <strong><code>neorv32</code></strong>. Additional
files, like alternative top entities, can be assigned to any library.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>neorv32_top.vhd                  - NEORV32 Processor top entity
│
├neorv32_fifo.vhd                - General purpose FIFO component
├neorv32_package.vhd             - Processor/CPU main VHDL package file
│
├neorv32_cpu.vhd                 - NEORV32 CPU top entity
│├neorv32_cpu_alu.vhd            - Arithmetic/logic unit
││├neorv32_cpu_cp_bitmanip.vhd   - Bit-manipulation co-processor (B ext.)
││├neorv32_cpu_cp_fpu.vhd        - Floating-point co-processor (Zfinx ext.)
││├neorv32_cpu_cp_muldiv.vhd     - Mul/Div co-processor (M extension)
││└neorv32_cpu_cp_shifter.vhd    - Bit-shift co-processor
│├neorv32_cpu_bus.vhd            - Bus interface + physical memory protection
│├neorv32_cpu_control.vhd        - CPU control, exception/IRQ system and CSRs
││└neorv32_cpu_decompressor.vhd  - Compressed instructions decoder
│└neorv32_cpu_regfile.vhd        - Data register file
│
├neorv32_boot_rom.vhd            - Bootloader ROM
│└neorv32_bootloader_image.vhd   - Bootloader boot ROM memory image
├neorv32_busswitch.vhd           - Processor bus switch for CPU buses (I&amp;D)
├neorv32_bus_keeper.vhd          - Processor-internal bus monitor
├neorv32_cfs.vhd                 - Custom functions subsystem
├neorv32_debug_dm.vhd            - on-chip debugger: debug module
├neorv32_debug_dtm.vhd           - on-chip debugger: debug transfer module
├neorv32_dmem.entity.vhd         - Processor-internal data memory (entity-only!)
├neorv32_gpio.vhd                - General purpose input/output port unit
├neorv32_gptmr.vhd               - General purpose 32-bit timer
├neorv32_icache.vhd              - Processor-internal instruction cache
├neorv32_imem.entity.vhd         - Processor-internal instruction memory (entity-only!)
│└neor32_application_image.vhd   - IMEM application initialization image
├neorv32_mtime.vhd               - Machine system timer
├neorv32_neoled.vhd              - NeoPixel (TM) compatible smart LED interface
├neorv32_pwm.vhd                 - Pulse-width modulation controller
├neorv32_slink.vhd               - Stream link controller
├neorv32_spi.vhd                 - Serial peripheral interface controller
├neorv32_sysinfo.vhd             - System configuration information memory
├neorv32_trng.vhd                - True random number generator
├neorv32_twi.vhd                 - Two wire serial interface controller
├neorv32_uart.vhd                - Universal async. receiver/transmitter
├neorv32_wdt.vhd                 - Watchdog timer
├neorv32_wishbone.vhd            - External (Wishbone) bus interface
├neorv32_xirq.vhd                - External interrupt controller
│
├mem/neorv32_dmem.default.vhd    - _Default_ data memory (architecture-only)
└mem/neorv32_imem.default.vhd    - _Default_ instruction memory (architecture-only)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The processor-internal instruction and data memories (IMEM and DMEM) are split into two design files each:
a plain entity definition (<code>neorv32_*mem.entity.vhd</code>) and the actual architecture definition
(<code>mem/neorv32_*mem.default.vhd</code>). The <code>*.default.vhd</code> architecture definitions from <code>rtl/core/mem</code> provide a <em>generic</em> and
<em>platform independent</em> memory design that (should) infers embedded memory blocks. You can replace/modify the architecture
source file in order to use platform-specific features (like advanced memory resources) or to improve technology mapping
and/or timing.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_fpga_implementation_results">1.5. FPGA Implementation Results</h3>
<div class="paragraph">
<p>This chapter shows <em>exemplary</em> implementation results of the NEORV32 CPU and NEORV32 Processor.</p>
</div>
<div class="sect3">
<h4 id="_cpu">1.5.1. CPU</h4>
<table class="tableblock frame-all grid-topbot stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5.7.10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rtl/core/neorv32_cpu.vhd</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CPU</th>
<th class="tableblock halign-right valign-top">LEs</th>
<th class="tableblock halign-right valign-top">FFs</th>
<th class="tableblock halign-right valign-top">MEM bits</th>
<th class="tableblock halign-right valign-top">DSPs</th>
<th class="tableblock halign-right valign-top"><em>f<sub>max</sub></em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32i</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">806</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">359</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">125 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32i_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1729</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">813</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">124 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32im_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2269</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1055</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">124 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imc_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2501</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1070</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">124 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imac_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2511</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1074</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">124 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imacu_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2521</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1079</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">124 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imacu_Zicsr_Zicntr_Zifencei</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2522</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1079</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">122 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imacu_Zicsr_Zicntr_Zifencei_Zfinx</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3807</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1731</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">116 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imacu_Zicsr_Zicntr_Zifencei_Zfinx_DebugMode</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3974</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1815</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">116 MHz</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
No HPM counters and no PMP regions were implemented for generating these results.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The CPU provides further options to reduce the area footprint (for example by constraining the CPU-internal
counter sizes) or to increase performance (for example by using a barrel-shifter; at cost of extra hardware).
See section <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a> for more information. Also, take a look at the User Guide section
<a href="https://stnolting.github.io/neorv32/ug/#_application_specific_processor_configuration">Application-Specific Processor Configuration</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_processor_modules">1.5.2. Processor Modules</h4>
<table class="tableblock frame-all grid-topbot stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5.7.15</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rtl/core/neorv32_top.vhd</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 1. Hardware utilization by the processor modules (mandatory core modules in <strong>bold</strong>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 53.3333%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 6.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-right valign-top">LEs</th>
<th class="tableblock halign-right valign-top">FFs</th>
<th class="tableblock halign-right valign-top">MEM bits</th>
<th class="tableblock halign-right valign-top">DSPs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boot ROM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootloader ROM (4kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">32768</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BUSKEEPER</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal bus monitor</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BUSSWITCH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus mux for CPU instr. and data interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">63</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom functions subsystem<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal data memory (8kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">65536</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-chip debugger - debug module</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">493</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">240</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DTM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-chip debugger - debug transfer module (JTAG)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">254</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">218</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPIO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General purpose input/output ports</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">134</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">161</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iCACHE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction cache (1x4 blocks, 256 bytes per block)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2 21</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">156</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8192</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal instruction memory (16kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">131072</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine system timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">319</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">167</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart LED Interface (NeoPixel/WS28128) [FIFO_depth=1]</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">226</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">182</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream link interface (2xRX, 2xTX, FIFO_depth=1)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">208</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">181</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pulse_width modulation controller (4 channels)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">71</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial peripheral interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">148</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">127</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SYSINFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System configuration information memory</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True random number generator</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">76</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two-wire interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">77</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0/1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Universal asynchronous receiver/transmitter 0/1</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">183</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">132</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WDT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Watchdog timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WISHBONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External memory interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">114</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">110</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIRQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupt controller (32 channels)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">241</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPTMR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General Purpose Timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">153</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">107</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_exemplary_setups">1.5.3. Exemplary Setups</h4>
<div class="paragraph">
<p>Check out the <code>setups</code> folder (@GitHub: <a href="https://github.com/stnolting/neorv32/tree/master/setups" class="bare">https://github.com/stnolting/neorv32/tree/master/setups</a>),
which provides several demo setups for various FPGA boards and toolchains.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_cpu_performance">1.6. CPU Performance</h3>
<div class="paragraph">
<p>The performance of the NEORV32 was tested and evaluated using the <a href="https://www.eembc.org/coremark/">Core Mark CPU benchmark</a>.
This benchmark focuses on testing the capabilities of the CPU core itself rather than the performance of the whole
system. The according sources can be found in the <code>sw/example/coremark</code> folder.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Dhrystone</div>
A <em>simple</em> port of the Dhrystone benchmark is also available in <code>sw/example/dhrystone</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The resulting CoreMark score is defined as CoreMark iterations per second.
The execution time is determined via the RISC-V <code>[m]cycle[h]</code> CSRs. The relative CoreMark score is
defined as CoreMark score divided by the CPU&#8217;s clock frequency in MHz.</p>
</div>
<table class="tableblock frame-all grid-topbot stretch">
<caption class="title">Table 2. Configuration</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5.7.10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32kB int. IMEM, 16kB int. DMEM, no caches, 100MHz clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CoreMark:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000 iterations, MEM_METHOD is MEM_STACK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compiler:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISCV32-GCC 10.2.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compiler flags:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default, see makefile</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 3. CoreMark results</caption>
<colgroup>
<col style="width: 57.1428%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CPU</th>
<th class="tableblock halign-center valign-top">CoreMark Score</th>
<th class="tableblock halign-center valign-top">CoreMarks/MHz</th>
<th class="tableblock halign-center valign-top">Average CPI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>small</em> (<code>rv32i_Zicsr</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">33.89</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.3389</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>4.04</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>medium</em> (<code>rv32imc_Zicsr</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">62.50</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.6250</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>5.34</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>performance</em> (<code>rv32imc_Zicsr</code> + perf. options)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">95.23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.9523</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>3.54</strong></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The "<em>performance</em>" CPU configuration uses the <a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a> and <a href="#_fast_shift_en"><em>FAST_SHIFT_EN</em></a> options.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 CPU is based on a multi-cycle architecture. Each instruction is executed in a sequence of
several consecutive micro operations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The average CPI (cycles per instruction) depends on the instruction mix of a specific applications and also on
the available CPU extensions. The average CPI is computed by dividing the total number of required clock cycles
(only the timed core to avoid distortion due to IO wait cycles) by the number of executed instructions
(<code>[m]instret[h]</code> CSRs).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information regarding the execution time of each implemented instruction can be found in
chapter <a href="#_instruction_timing">Instruction Timing</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neorv32_processor_soc">2. NEORV32 Processor (SoC)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor is based on the NEORV32 CPU. Together with common peripheral
interfaces and embedded memories it provides a RISC-V-based full-scale microcontroller-like SoC platform.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_processor.png" alt="neorv32 processor">
</div>
</div>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>optional</em> processor-internal data and instruction memories (<a href="#_data_memory_dmem"><strong>DMEM</strong></a>/<a href="#_instruction_memory_imem"><strong>IMEM</strong></a>) + cache (<a href="#_processor_internal_instruction_cache_icache"><strong>iCACHE</strong></a>)</p>
</li>
<li>
<p><em>optional</em> internal bootloader (<a href="#_bootloader_rom_bootrom"><strong>BOOTROM</strong></a>) with UART console &amp; SPI flash boot option</p>
</li>
<li>
<p><em>optional</em> machine system timer (<a href="#_machine_system_timer_mtime"><strong>MTIME</strong></a>), RISC-V-compatible</p>
</li>
<li>
<p><em>optional</em> two independent universal asynchronous receivers and transmitters (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0"><strong>UART0</strong></a>, <a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1"><strong>UART1</strong></a>) with optional hardware flow control (RTS/CTS) and optional RX/TX FIFOs</p>
</li>
<li>
<p><em>optional</em> 8/16/24/32-bit serial peripheral interface controller (<a href="#_serial_peripheral_interface_controller_spi"><strong>SPI</strong></a>) with 8 dedicated CS lines</p>
</li>
<li>
<p><em>optional</em> two wire serial interface controller (<a href="#_two_wire_serial_interface_controller_twi"><strong>TWI</strong></a>), compatible to the I²C standard</p>
</li>
<li>
<p><em>optional</em> general purpose parallel IO port (<a href="#_general_purpose_input_and_output_port_gpio"><strong>GPIO</strong></a>), 64xOut, 64xIn</p>
</li>
<li>
<p><em>optional</em> 32-bit external bus interface, Wishbone b4 / AXI4-Lite compatible (<a href="#_processor_external_memory_interface_wishbone_axi4_lite"><strong>WISHBONE</strong></a>)</p>
</li>
<li>
<p><em>optional</em> 32-bit stream link interface with up to 8 independent links, AXI4-Stream compatible (<a href="#_stream_link_interface_slink"><strong>SLINK</strong></a>)</p>
</li>
<li>
<p><em>optional</em> watchdog timer (<a href="#_watchdog_timer_wdt"><strong>WDT</strong></a>)</p>
</li>
<li>
<p><em>optional</em> PWM controller with up to 60 channels &amp; 8-bit duty cycle resolution (<a href="#_pulse_width_modulation_controller_pwm"><strong>PWM</strong></a>)</p>
</li>
<li>
<p><em>optional</em> ring-oscillator-based true random number generator (<a href="#_true_random_number_generator_trng"><strong>TRNG</strong></a>)</p>
</li>
<li>
<p><em>optional</em> custom functions subsystem for custom co-processor extensions (<a href="#_custom_functions_subsystem_cfs"><strong>CFS</strong></a>)</p>
</li>
<li>
<p><em>optional</em> NeoPixel&#8482;/WS2812-compatible smart LED interface (<a href="#_smart_led_interface_neoled"><strong>NEOLED</strong></a>)</p>
</li>
<li>
<p><em>optional</em> external interrupt controller with up to 32 channels (<a href="#_external_interrupt_controller_xirq"><strong>XIRQ</strong></a>)</p>
</li>
<li>
<p><em>optional</em> general purpose 32-bit timer (<a href="#_general_purpose_timer_gptmr"><strong>GPTMR</strong></a>)</p>
</li>
<li>
<p><em>optional</em> on-chip debugger with JTAG TAP (<a href="#_on_chip_debugger_ocd"><strong>OCD</strong></a>)</p>
</li>
<li>
<p>bus keeper to monitor processor-internal bus transactions (<a href="#_internal_bus_monitor_buskeeper"><strong>BUSKEEPER</strong></a>)</p>
</li>
<li>
<p>system configuration information memory to check HW configuration via software (<a href="#_system_configuration_information_memory_sysinfo"><strong>SYSINFO</strong></a>)</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_processor_top_entity_signals">2.1. Processor Top Entity - Signals</h3>
<div class="paragraph">
<p>The following table shows signals of the processor top entity (<code>rtl/core/neorv32_top.vhd</code>).
The type of all signals is <code>std_ulogic</code> or <code>std_ulogic_vector</code>, respectively.</p>
</div>
<div class="paragraph">
<p>All <em>input signals</em> provide default values in case they are not explicitly assigned during instantiation.
For control signals the value <code>L</code> (weak pull-down) is used. For serial and parallel data signals
the value <code>U</code> (unknown) is used. Pulled-down signals will not cause "accidental" system crashes
since all control signals have defined level.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 61.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Dir.</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Global Control</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global clock line, all registers triggering on rising edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global reset, asynchronous, <strong>low-active</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>JTAG Access Port for <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_trst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TAP reset, low-active (optional<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode select</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>External Bus Interface (<a href="#_processor_external_memory_interface_wishbone_axi4_lite">WISHBONE</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_tag_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tag (access type identifier)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_adr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write enable ('0' = read transfer)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_sel_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_stb_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strobe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_cyc_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid cycle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_lock_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclusive access request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer acknowledge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer error</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Advanced Memory Control Signals</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates an executed <em>fence</em> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fencei_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates an executed <em>fencei</em> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Stream Link Interface (<a href="#_stream_link_interface_slink">SLINK</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8x32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>n</em> data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_val_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>n</em> data valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_rdy_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>n</em> allowed to send</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8x32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>n</em> data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_val_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>n</em> data valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_rdy_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>n</em> ready to receive</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>General Purpose Inputs &amp; Outputs (<a href="#_general_purpose_input_and_output_port_gpio">GPIO</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general purpose parallel output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general purpose parallel input</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Primary Universal Asynchronous Receiver/Transmitter (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_txd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 serial transmitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rxd_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 serial receiver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rts_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 RX ready to receive new char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_cts_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 TX allowed to start sending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Primary Universal Asynchronous Receiver/Transmitter (<a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_txd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 serial transmitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rxd_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 serial receiver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rts_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 RX ready to receive new char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_cts_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 TX allowed to start sending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Serial Peripheral Interface Controller (<a href="#_serial_peripheral_interface_controller_spi">SPI</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sck_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI controller clock line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_csn_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI dedicated chip select (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Two-Wire Interface Controller (<a href="#_two_wire_serial_interface_controller_twi">TWI</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_io</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">inout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI serial data line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_io</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">inout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI serial clock line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Pulse-Width Modulation Channels (<a href="#_pulse_width_modulation_controller_pwm">PWM</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pwm_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0..60</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulse-width modulated channels</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Custom Functions Subsystem (<a href="#_custom_functions_subsystem_cfs">CFS</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_in_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS input signal conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_out_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS output signal conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Smart LED Interface - NeoPixel&#8482; compatible (<a href="#_smart_led_interface_neoled">NEOLED</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neoled_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asynchronous serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>System time (<a href="#_machine_system_timer_mtime">MTIME</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer time (to <code>time[h]</code> CSRs) from <em>external MTIME</em> unit if the processor-internal <em>MTIME</em> unit is NOT implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer time from <em>internal MTIME</em> unit if processor-internal <em>MTIME</em> unit IS implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>External Interrupts (<a href="#_processor_interrupts">XIRQ</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xirq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external interrupt requests (up to 32 channels)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>RISC-V Machine-Level <a href="#_processor_interrupts">CPU Interrupts</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt13 (RISC-V), high-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msw_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (RISC-V), high-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mext_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (RISC-V), high-active</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_top_entity_generics">2.2. Processor Top Entity - Generics</h3>
<div class="paragraph">
<p>This is a list of all configuration generics of the NEORV32 processor top entity rtl/neorv32_top.vhd.
The generic name is shown in orange, followed by the type in printed in black and concluded by the default
value printed in light gray.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The NEORV32 generics allow to configure the system according to your needs. The generics are
used to control implementation of certain CPU extensions and peripheral modules and even allow to
optimize the system for certain design goals like minimal area or maximum performance.<br>
<strong>More information can be found in the user guides' section
<a href="https://stnolting.github.io/neorv32/ug/#_application_specific_processor_configuration">Application-Specific Processor Configuration</a></strong>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Privileged software can determine the actual CPU and processor configuration via the <code>misa</code> and the
<a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> registers.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If optional modules (like CPU extensions or peripheral devices) are <strong>not enabled</strong> the according circuitry
<strong>will not be synthesized at all</strong>. Hence, the disabled modules do not increase area and power requirements
and do not impact the timing.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Not all configuration combinations are valid. The processor RTL code provides sanity checks to inform the user
during synthesis/simulation if an invalid combination has been detected.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Generic Description</strong></p>
</div>
<div class="paragraph">
<p>The description of each generic provides the following summary:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 4. Generic description</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Generic name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>type</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>default value</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><em>Description</em></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_general">2.2.1. General</h4>
<div class="paragraph">
<p>See section <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_clock_frequency"><em>CLOCK_FREQUENCY</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CLOCK_FREQUENCY</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The clock frequency of the processor&#8217;s <code>clk_i</code> input port in Hertz (Hz). This value can be retrieved by software
from the <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> module.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>INT_BOOTLOADER_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the processor-internal boot ROM, pre-initialized with the default bootloader image when <em>true</em>.
This will also change the processor&#8217;s boot address from the beginning of the instruction memory address space (default =
0x00000000) to the base address of the boot ROM. See section <a href="#_boot_configuration">Boot Configuration</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_hw_thread_id"><em>HW_THREAD_ID</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HW_THREAD_ID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The hart ID of the CPU. Software can retrieve this value from the <code>mhartid</code> CSR.
Note that hart IDs must be unique within a system.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ON_CHIP_DEBUGGER_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the on-chip debugger (OCD) and the CPU debug mode.
See chapter <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_risc_v_cpu_extensions">2.2.2. RISC-V CPU Extensions</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See section <a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a> for more information. The configuration of the RISC-V <em>main</em> ISA extensions
(like <code>M</code>) can be determined via the <a href="#_misa"><strong><code>misa</code></strong></a> CSR. The configuration of ISA <em>sub-extensions</em> (like <code>Zicsr</code>) and <em>extension options</em>
can be determined via memory-mapped registers of the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> module.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_a"><em>CPU_EXTENSION_RISCV_A</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_A</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement atomic memory access operations when <em>true</em>.
See section <a href="#_a_atomic_memory_access"><strong><code>A</code></strong> - Atomic Memory Access</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_b"><em>CPU_EXTENSION_RISCV_B</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_B</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>B</code> bit-manipulation sub-extension when <em>true</em>.
See section <a href="#_b_bit_manipulation_operations"><strong><code>B</code></strong> - Bit-Manipulation Operations</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_c"><em>CPU_EXTENSION_RISCV_C</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_C</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement compressed instructions (16-bit) when <em>true</em>. Compressed instructions can reduce program code
size by approx. 30%. See section <a href="#_c_compressed_instructions"><strong><code>C</code></strong> - Compressed Instructions</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_e"><em>CPU_EXTENSION_RISCV_E</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_E</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the embedded CPU extension (only implement the first 16 data registers) when <em>true</em>. This reduces embedded memory
requirements for the register file. See section <a href="#_e_embedded_cpu"><strong><code>E</code></strong> - Embedded CPU</a> for more information. Note that this RISC-V extensions
requires a different application binary interface (ABI).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_m"><em>CPU_EXTENSION_RISCV_M</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_M</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement hardware accelerators for integer multiplication and division instructions when <em>true</em>.
If this extensions is not enabled, multiplication and division operations (<em>not</em> instructions) will be computed entirely in software.
If only a hardware multiplier is required use the <a href="#_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></a> extension. Multiplication can also be mapped
to DSP slices via the <a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a> generic.
See section <a href="#_m_integer_multiplication_and_division"><strong><code>M</code></strong> - Integer Multiplication and Division</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_u"><em>CPU_EXTENSION_RISCV_U</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_U</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement less-privileged user mode when <em>true</em>.
See section <a href="#_u_less_privileged_user_mode"><strong><code>U</code></strong> - Less-Privileged User Mode</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zfinx"><em>CPU_EXTENSION_RISCV_Zfinx</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zfinx</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the 32-bit single-precision floating-point extension (using integer registers) when <em>true</em>.
See section <a href="#_zfinx_single_precision_floating_point_operations"><strong><code>Zfinx</code></strong> Single-Precision Floating-Point Operations</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zicsr</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the control and status register (CSR) access instructions when true. Note: When this option is
disabled, the complete privileged architecture / trap system will be excluded from synthesis. Hence, no interrupts, no exceptions and
no machine information will be available.
See section <a href="#_zicsr_control_and_status_register_access_privileged_architecture"><strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zicntr</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the basic CPU counter CSRs (<code>time[h]</code>, <code>[m]cycle[h]</code>, <code>[m]instret[h]</code>) when true.
Enabling this extension will set the  <em>SYSINFO_CPU_ZICNTR</em> flag in the <code>CPU</code> <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> register.
See section <a href="#_zicntr_cpu_base_counters"><strong><code>Zicntr</code></strong> CPU Base Counters</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zihpm</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement hardware performance monitor CSRs when true.
Enabling this extension will set the  <em>SYSINFO_CPU_ZIHPM</em> flag in the <code>CPU</code> <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> register.
See section <a href="#_zihpm_hardware_performance_monitors"><strong><code>Zihpm</code></strong> Hardware Performance Monitors</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zifencei"><em>CPU_EXTENSION_RISCV_Zifencei</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zifencei</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the instruction fetch synchronization instruction <code>fence.i</code>. For example, this option is required
for self-modifying code (and/or for instruction cache and CPU prefetch buffer flushes).
See section <a href="#_zifencei_instruction_stream_synchronization"><strong><code>Zifencei</code></strong> Instruction Stream Synchronization</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zmmul</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement integer multiplication-only instructions when <em>true</em>. This is a sub-extension of the <code>M</code> extension, which
cannot be used together with the <code>M</code> extension. See section <a href="#_zmmul_integer_multiplication"><strong><code>Zmmul</code></strong> - Integer Multiplication</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_extension_options">2.2.3. Extension Options</h4>
<div class="paragraph">
<p>See section <a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_fast_mul_en"><em>FAST_MUL_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FAST_MUL_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">When this generic is enabled, the multiplier of the <code>M</code> extension is implemented using DSPs blocks instead of an
iterative bit-serial approach. Performance will be increased and LUT utilization will be reduced at the cost of DSP slice
utilization. This generic is only relevant when a hardware multiplier CPU extension is
enabled (<a href="#_cpu_extension_riscv_m"><em>CPU_EXTENSION_RISCV_M</em></a> or <a href="#_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></a> is <em>true</em>). <strong>Note that the multipliers of the
<a href="#_zfinx_single_precision_floating_point_operations"><strong><code>Zfinx</code></strong> Single-Precision Floating-Point Operations</a> extension are always mapped to DSP block (if available).</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_fast_shift_en"><em>FAST_SHIFT_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FAST_SHIFT_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">If this generic is set <em>true</em> the shifter unit of the CPU&#8217;s ALU is implemented as fast barrel shifter (requiring
more hardware resources but completing within two clock cycles). If it is set <em>false</em>, the CPU uses a serial shifter
that only performs a single bit shift per cycle (requiring less hardware resources, but requires up to 32 clock
cycles to complete - depending on shift amount). <strong>Note that this option also implements barrel shifters for <em>all</em>
shift-related operations of the <a href="#_b_bit_manipulation_operations"><strong><code>B</code></strong> - Bit-Manipulation Operations</a> extension.</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_cnt_width"><em>CPU_CNT_WIDTH</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_CNT_WIDTH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This generic configures the total size of the CPU&#8217;s <code>[m]cycle</code> and <code>[m]instret</code> CSRs (low word + high word).
The maximum value is 64, the minimum value is 0. See section <a href="#_machine_counters_and_timers">[_machine_counters_and_timers]</a> for more information.
This generic is only relevant if the <code>Zicntr</code> ISa extension is enabled (<a href="#_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></a>).
Note: configurations with <a href="#_cpu_cnt_width"><em>CPU_CNT_WIDTH</em></a> less than 64 bits do not comply to the RISC-V specs.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_ipb_entries"><em>CPU_IPB_ENTRIES</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_IPB_ENTRIES</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This generic configures the number of entries in the CPU&#8217;s instruction prefetch buffer (a FIFO).
The value has to be a power of two and has to be greater than zero.
Long linear sequences of code can benefit from an increased IPB size.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_physical_memory_protection_pmp">2.2.4. Physical Memory Protection (PMP)</h4>
<div class="paragraph">
<p>See section <a href="#_pmp_physical_memory_protection"><strong><code>PMP</code></strong> Physical Memory Protection</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_pmp_num_regions"><em>PMP_NUM_REGIONS</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PMP_NUM_REGIONS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Total number of implemented protections regions (0..64). If this generics is zero no physical memory
protection logic will be implemented at all. Setting <a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a>_ &gt; 0 will set the <em>SYSINFO_CPU_PMP</em> flag
in the <code>CPU</code> <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> register.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_pmp_min_granularity"><em>PMP_MIN_GRANULARITY</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PMP_MIN_GRANULARITY</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64*1024</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Minimal region granularity in bytes. Has to be a power of two. Has to be at least 8 bytes.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_hardware_performance_monitors_hpm">2.2.5. Hardware Performance Monitors (HPM)</h4>
<div class="paragraph">
<p>These generics allow to customize the <code>Zihpm</code> ISA extension. Note that the following generics are ignored if the
<a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a> generic is <em>false</em>. See section <a href="#_zihpm_hardware_performance_monitors"><strong><code>Zihpm</code></strong> Hardware Performance Monitors</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_hpm_num_cnts"><em>HPM_NUM_CNTS</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPM_NUM_CNTS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Total number of implemented hardware performance monitor counters (0..29). If this generics is zero, no
hardware performance monitor logic will be implemented at all.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_hpm_cnt_width"><em>HPM_CNT_WIDTH</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPM_CNT_WIDTH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This generic defines the total LSB-aligned size of each HPM counter (<code>size([m]hpmcounter*h)</code><br>
<code>size([m]hpmcounter*)</code>). The maximum value is 64, the minimal is 0. If the size is less than 64-bit, the
unused MSB-aligned counter bits are hardwired to zero.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_internal_instruction_memory">2.2.6. Internal Instruction Memory</h4>
<div class="paragraph">
<p>See sections <a href="#_address_space">Address Space</a> and <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_INT_IMEM_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement processor internal instruction memory (IMEM) when <em>true</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_INT_IMEM_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16*1024</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Size in bytes of the processor internal instruction memory (IMEM). Has no effect when <a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> is <em>false</em>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_internal_data_memory">2.2.7. Internal Data Memory</h4>
<div class="paragraph">
<p>See sections <a href="#_address_space">Address Space</a> and <a href="#_data_memory_dmem">Data Memory (DMEM)</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_INT_DMEM_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement processor internal data memory (DMEM) when <em>true</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_INT_DMEM_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8*1024</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Size in bytes of the processor-internal data memory (DMEM). Has no effect when <a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> is <em>false</em>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_internal_cache_memory">2.2.8. Internal Cache Memory</h4>
<div class="paragraph">
<p>See section <a href="#_processor_internal_instruction_cache_icache">Processor-Internal Instruction Cache (iCACHE)</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_icache_en"><em>ICACHE_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ICACHE_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement processor internal instruction cache when <em>true</em>. Note: if the setup only uses processor-internal data
and instruction memories there is not point of implementing the i-cache.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_icache_num_block"><em>ICACHE_NUM_BLOCK</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ICACHE_NUM_BLOCKS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of blocks (cache "pages" or "lines") in the instruction cache. Has to be a power of two. Has no
effect when <a href="#_icache_dmem_en">[_icache_dmem_en]</a> is false.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_icache_block_size"><em>ICACHE_BLOCK_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ICACHE_BLOCK_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Size in bytes of each block in the instruction cache. Has to be a power of two. Has no effect when
<a href="#_icache_dmem_en">[_icache_dmem_en]</a> is <em>false</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_icache_associativity"><em>ICACHE_ASSOCIATIVITY</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ICACHE_ASSOCIATIVITY</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Associativity (= number of sets) of the instruction cache. Has to be a power of two. Allowed configurations:
<code>1</code> = 1 set, direct mapped; <code>2</code> = 2-way set-associative. Has no effect when <a href="#_icache_dmem_en">[_icache_dmem_en]</a> is <em>false</em>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_external_memory_interface">2.2.9. External Memory Interface</h4>
<div class="paragraph">
<p>See sections <a href="#_address_space">Address Space</a> and <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_mem_ext_en"><em>MEM_EXT_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement external bus interface (WISHBONE) when <em>true</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_timeout"><em>MEM_EXT_TIMEOUT</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_TIMEOUT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">255</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Clock cycles after which a pending external bus access will auto-terminate and raise a bus fault exception.
If set to zero, there will be no auto-timeout and no bus fault exception (might permanently stall system!).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_pipe_mode"><em>MEM_EXT_PIPE_MODE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_PIPE_MODE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Use <em>standard</em> ("classic") Wishbone protocol for external bus when <em>false</em>.
Use <em>pipelined</em> Wishbone protocol when <em>true</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_big_endian"><em>MEM_EXT_BIG_ENDIAN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_BIG_ENDIAN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Use BIG endian interface for external bus when <em>true</em>. Use little endian interface when <em>false</em>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_async_rx"><em>MEM_EXT_ASYNC_RX</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_ASYNC_RX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolen</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">By default, <em>MEM_EXT_ASYNC_RX</em> = <em>false</em> implements a registered read-back path (RX) for incoming data in the bus interface
in order to shorten the critical path. By setting <em>MEM_EXT_ASYNC_RX</em> = <em>true</em> an <em>asynchronous</em> ("direct") read-back path is
implemented reducing access latency by one cycle but eventually increasing the critical path.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_stream_link_interface">2.2.10. Stream Link Interface</h4>
<div class="paragraph">
<p>See section <a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_slink_num_tx"><em>SLINK_NUM_TX</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SLINK_NUM_TX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of TX (send) links to implement. Valid values are 0..8.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_slink_num_rx"><em>SLINK_NUM_RX</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SLINK_NUM_RX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of RX (receive) links to implement. Valid values are 0..8.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_slink_tx_fifo"><em>SLINK_TX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SLINK_TX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Internal FIFO depth for <em>all</em> implemented TX links. Valid values are 1..32k and have to be a power of two.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_slink_rx_fifo"><em>SLINK_RX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SLINK_RX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Internal FIFO depth for <em>all</em> implemented RX links. Valid values are 1..32k and have to be a power of two.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_external_interrupt_controller">2.2.11. External Interrupt Controller</h4>
<div class="paragraph">
<p>See section <a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_xirq_num_ch"><em>XIRQ_NUM_CH</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>XIRQ_NUM_CH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of external interrupt channels o implement. Valid values are 0..32.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_xirq_trigger_type"><em>XIRQ_TRIGGER_TYPE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>XIRQ_TRIGGER_TYPE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xFFFFFFFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Interrupt trigger type configuration (one bit for each IRQ channel): <code>0</code> = level-triggered, '1' = edge triggered.
<a href="#_xirq_trigger_polarity"><em>XIRQ_TRIGGER_POLARITY</em></a> generic is used to specify the actual level (high/low) or edge (falling/rising).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_xirq_trigger_polarity"><em>XIRQ_TRIGGER_POLARITY</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>XIRQ_TRIGGER_POLARITY</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xFFFFFFFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Interrupt trigger polarity configuration (one bit for each IRQ channel): <code>0</code> = low-level/falling-edge,
'1' = high-level/rising-edge. <a href="#_xirq_trigger_type"><em>XIRQ_TRIGGER_TYPE</em></a> generic is used to specify the actual type (level or edge).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_processor_peripheralio_modules">2.2.12. Processor Peripheral/IO Modules</h4>
<div class="paragraph">
<p>See section <a href="#_processor_internal_modules">Processor-Internal Modules</a> for more information.</p>
</div>
<div class="sect4">
<h5 id="_io_gpio_en"><em>IO_GPIO_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_GPIO_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement general purpose input/output port unit (GPIO) when <em>true</em>.
See section <a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_mtime_en"><em>IO_MTIME_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_MTIME_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement machine system timer (MTIME) when <em>true</em>.
See section <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart0_en"><em>IO_UART0_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART0_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement primary universal asynchronous receiver/transmitter (UART0) when <em>true</em>.
See section <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> for
more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart0_rx_fifo"><em>IO_UART0_RX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART0_RX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">UART0 receiver FIFO depth, has to be a power of two, minimum value is 1 (implementing simple double-buffering).
See section <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> for
more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart0_tx_fifo"><em>IO_UART0_TX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART0_TX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">UART0 transmitter FIFO depth, has to be a power of two, minimum value is 1 (implementing simple double-buffering).
See section <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> for
more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart1_en"><em>IO_UART1_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART1_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement secondary universal asynchronous receiver/transmitter (UART1) when <em>true</em>.
See section <a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart1_rx_fifo"><em>IO_UART1_RX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART1_RX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">UART1 receiver FIFO depth, has to be a power of two, minimum value is 1 (implementing simple double-buffering).
See section <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> for
more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart1_tx_fifo"><em>IO_UART1_TX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART1_TX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">UART1 transmitter FIFO depth, has to be a power of two, minimum value is 1 (implementing simple double-buffering).
See section <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> for
more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_spi_en"><em>IO_SPI_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_SPI_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement serial peripheral interface controller (SPI) when <em>true</em>.
See section <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_twi_en"><em>IO_TWI_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_TWI_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement two-wire interface controller (TWI) when <em>true</em>.
See section <a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a> for
more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_pwm_num_ch"><em>IO_PWM_NUM_CH</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_PWM_NUM_CH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of pulse-width modulation (PWM) channels (0..60) to implement. The PWM controller is <em>not</em> implemented if zero.
See section <a href="#_pulse_width_modulation_controller_pwm">Pulse-Width Modulation Controller (PWM)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_wdt_en"><em>IO_WDT_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_WDT_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement watchdog timer (WDT) when <em>true</em>. See section <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a> for more
information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_trng_en"><em>IO_TRNG_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_TRNG_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement true-random number generator (TRNG) when <em>true</em>. See section <a href="#_true_random_number_generator_trng">True Random-Number Generator (TRNG)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_cfs_en"><em>IO_CFS_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_CFS_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement custom functions subsystem (CFS) when <em>true</em>. See section <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_cfs_config"><em>IO_CFS_CONFIG</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_CFS_CONFIG</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x"00000000"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This is a "conduit" generic that can be used to pass user-defined CFS implementation flags to the custom
functions subsystem entity. See section <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_cfs_in_size"><em>IO_CFS_IN_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_CFS_IN_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>positive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Defines the size of the CFS input signal conduit (<code>cfs_in_i</code>). See section <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_cfs_out_size"><em>IO_CFS_OUT_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_CFS_OUT_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>positive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Defines the size of the CFS output signal conduit (<code>cfs_out_o</code>). See section <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_neoled_en"><em>IO_NEOLED_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_NEOLED_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement smart LED interface (WS2812 / NeoPixel&#8482;-compatible) (NEOLED) when <em>true</em>.
See section <a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_neoled_tx_fifo"><em>IO_NEOLED_TX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_NEOLED_TX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">TX FIFO depth of the the NEOLED module. Minimal value is 1, maximal value is 32k, has to be a power of two.
See section <a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_gptmr_en"><em>IO_GPTMR_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_GPTMR_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement general purpose 32-bit timer (GPTMR) when <em>true</em>.
See section <a href="#_general_purpose_timer_gptmr">General Purpose Timer (GPTMR)</a> for more information.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_interrupts">2.3. Processor Interrupts</h3>
<div class="paragraph">
<p>The NEORV32 Processor provides several interrupt request signals (IRQs) for custom platform use.</p>
</div>
<div class="sect3">
<h4 id="_risc_v_standard_interrupts">2.3.1. RISC-V Standard Interrupts</h4>
<div class="paragraph">
<p>The processor setup features the standard machine-level RISC-V interrupt lines for "machine timer interrupt", "machine
software interrupt" and "machine external interrupt". Their usage is defined by the RISC-V privileged architecture
specifications. However, bare-metal system can also repurpose these interrupts. See CPU section
<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 18.75%;">
<col style="width: 12.5%;">
<col style="width: 68.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Top signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine timer interrupt from <em>processor-external</em> MTIME unit. This IRQ is only available if the processor-internal MTIME unit is not used (<a href="#_io_mtime_en"><em>IO_MTIME_EN</em></a> = false).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msw_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine software interrupt. This interrupt is used for inter-processor interrupts in multi-core systems. However, it can also be used for any custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mext_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine external interrupt. This interrupt is used for any processor-external interrupt source (like a platform interrupt controller).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger type</div>
The fast interrupt request channel trigger on <strong>high-level</strong> and have to stay asserted until explicitly acknowledged
by the software (for example by writing to a specific memory-mapped register). Hence, pending interrupts remain pending
as long as the interrupt-causing device&#8217;s state fulfills it&#8217;s interrupt condition(s).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_platform_external_interrupts">2.3.2. Platform External Interrupts</h4>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 18.75%;">
<col style="width: 12.5%;">
<col style="width: 68.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Top signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xirq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">up to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External platform interrupts (user-defined).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The processor provides an optional interrupt controller for up to 32 user-defined external interrupts
(see section <a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a>). These external IRQs are mapped to a <em>single</em> CPU
fast interrupt request so a software handler is required to differentiate / prioritize these interrupts.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger type</div>
The trigger for these interrupt can be defined via generics. See section
<a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a> for more information. Depending on the trigger type, users can
implement custom acknowledge mechanisms. All <em>external interrupts</em> are mapped to a single processor-internal
<em>fast interrupt request</em> (see below).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_neorv32_specific_fast_interrupt_requests">2.3.3. NEORV32-Specific Fast Interrupt Requests</h4>
<div class="paragraph">
<p>As part of the custom/NEORV32-specific CPU extensions, the CPU features 16 fast interrupt request signals
(<code>FIRQ0</code> - <code>FIRQ15</code>). These are reserved for <em>processor-internal</em> modules only (for example for the communication
interfaces to signal "available incoming data" or "ready to send new data").</p>
</div>
<div class="paragraph">
<p>The mapping of the 16 FIRQ channels is shown in the following table (the channel number also corresponds to
the according FIRQ priority; 0 = highest, 15 = lowest):</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 5. NEORV32 fast interrupt channel mapping</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Channel</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_watchdog_timer_wdt">WDT</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog timeout interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_functions_subsystem_cfs">CFS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom functions subsystem (CFS) interrupt (user-defined)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 data received interrupt (RX complete)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 sending done interrupt (TX complete)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 data received interrupt (RX complete)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 sending done interrupt (TX complete)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_peripheral_interface_controller_spi">SPI</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI transmission done interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_two_wire_serial_interface_controller_twi">TWI</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI transmission done interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_external_interrupt_controller_xirq">XIRQ</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupt controller interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smart_led_interface_neoled">NEOLED</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED TX buffer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stream_link_interface_slink">SLINK</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data buffer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stream_link_interface_slink">SLINK</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data buffer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_timer_gptmr">GPTMR</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General purpose timer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13:15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, will never fire</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger type</div>
The fast interrupt request channel trigger on <strong>high-level</strong> and have to stay asserted until explicitly acknowledged
by the software (for example by writing to a specific memory-mapped register). Hence, pending interrupts remain pending
as long as the interrupt-causing device&#8217;s state fulfills it&#8217;s interrupt condition(s).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_address_space">2.4. Address Space</h3>
<div class="paragraph">
<p>The NEORV32 Processor provides a 32-bit / 4GB (physical) address space
By default, this address space is divided into five main regions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Instruction address space</strong> - memory address space for instructions (=code) and constants.
A configurable section of this address space is used by the internal/external <em>instruction memory</em> (<a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a> for the internal IMEM).</p>
</li>
<li>
<p><strong>Data address space</strong> - memory address space for application runtime data (heap, stack, etc.).
A configurable section of this address space is used by the internal/external <em>data memory</em> (<a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a> for the internal DMEM).</p>
</li>
<li>
<p><strong>Bootloader address space</strong>. A <em>fixed</em> section of this address space is used by the
internal <em>bootloader memory</em> (BOOTLDROM).</p>
</li>
<li>
<p><strong>On-Chip Debugger address space</strong>. This <em>fixed</em> section is entirely used by the processor&#8217;s <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>.</p>
</li>
<li>
<p><strong>IO/peripheral address space</strong>. Also a <em>fixed</em> section used for the processor-internal memory-mapped IO/peripheral devices (e.g., UART).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="img/address_space.png" alt="900">
</div>
<div class="title">Figure 1. NEORV32 processor - address space (default configuration)</div>
</div>
<div class="sect3">
<h4 id="_cpu_data_and_instruction_access">2.4.1. CPU Data and Instruction Access</h4>
<div class="paragraph">
<p>The CPU can access all of the 4GB address space from the instruction fetch interface (<strong>I</strong>) and also from the
data access interface (<strong>D</strong>). These two CPU interfaces are multiplexed by a simple bus switch
(<code>rtl/core/neorv32_busswitch.vhd</code>) into a <em>single</em> processor-internal bus. All processor-internal
memories, peripherals and also the external memory interface are connected to this bus. Hence, both CPU
interfaces (instruction fetch &amp; data access) have access to the same (<strong>identical</strong>) address space making the
setup a modified von-Neumann architecture.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_bus.png" alt="1300">
</div>
<div class="title">Figure 2. Processor-internal bus architecture</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The internal processor bus might appear as bottleneck. In order to reduce traffic jam on this bus
(when instruction fetch and data interface access the bus at the same time) the instruction fetch of
the CPU is equipped with a prefetch buffer. Instruction fetches can be further buffered using the i-cache.
Furthermore, data accesses (loads and stores) have higher priority than instruction fetch
accesses.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Please note that all processor-internal components including the peripheral/IO devices can also be
accessed from programs running in less-privileged user mode. For example, if the system relies on
a periodic interrupt from the <em>MTIME</em> timer unit, user-level programs could alter the <em>MTIME</em>
configuration corrupting this interrupt. This kind of security issues can be compensated using the
PMP system (see <a href="#_machine_physical_memory_protection">[_machine_physical_memory_protection]</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_address_space_layout">2.4.2. Address Space Layout</h4>
<div class="paragraph">
<p>The general address space layout consists of two main configuration constants: <code>ispace_base_c</code> defining
the base address of the <em>instruction memory address space</em> and <code>dspace_base_c</code> defining the base address of
the <em>data memory address space</em>. Both constants are defined in the NEORV32 VHDL package file
<code>rtl/core/neorv32_package.vhd</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">-- Architecture Configuration ----------------------------------------------------
-- ----------------------------------------------------------------------------------
constant ispace_base_c : std_ulogic_vector(31 downto 0) := x"00000000";
constant dspace_base_c : std_ulogic_vector(31 downto 0) := x"80000000";</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default configuration assumes the <em>instruction memory address space</em> starting at address <em>0x00000000</em>
and the <em>data memory address space</em> starting at <em>0x80000000</em>. Both values can be modified for a specific
setup and the address space may overlap or can be completely identical. Make sure that both base addresses
are <em>aligned</em> to a 4-byte boundary.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The base address of the internal bootloader (at <em>0xFFFF0000</em>) and the internal IO region (at <em>0xFFFFFE00</em>) for
peripheral devices are also defined in the package and are fixed. These address regions cannot not be used for other
applications - even if the bootloader or all IO devices are not implemented - without modifying the core&#8217;s
hardware sources.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_physical_memory_attributes">2.4.3. Physical Memory Attributes</h4>
<div class="paragraph">
<p>The processor setup defines fixed attributes for the four processor-internal address space regions.
Accessing a memory region in a way that violates any of these attributes will raise an according
access exception..</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>r</code> - read access (from CPU data access interface, "loads")</p>
</li>
<li>
<p><code>w</code> - write access (from CPU data access interface, "stores")</p>
</li>
<li>
<p><code>x</code> - execute access (from CPU instruction fetch interface)</p>
</li>
<li>
<p><code>a</code> - atomic access (from CPU data access interface)</p>
</li>
<li>
<p><code>8</code> - byte (8-bit)-accessible (when writing)</p>
</li>
<li>
<p><code>16</code> - half-word (16-bit)-accessible (when writing)</p>
</li>
<li>
<p><code>32</code> - word (32-bit)-accessible (when writing)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Read accesses (loads and instruction fetches) can always access data in
word, half-word (for instruction fetch only if <code>C</code> extension is enabled)
and byte (not for instruction fetch) quantities (requiring an accordingly aligned address).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The following table shows the <em>default hardware-defined</em> physical memory attributes of each main address space region.
Additional user-defined attributes (for example certain read/write/execute rights for specific address space regions) can be
provided using the RISC-V <a href="#_machine_physical_memory_protection">[_machine_physical_memory_protection]</a>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">#</th>
<th class="tableblock halign-center valign-top">Region</th>
<th class="tableblock halign-center valign-top">Base address</th>
<th class="tableblock halign-center valign-top">Size</th>
<th class="tableblock halign-center valign-top">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IO/peripheral devices</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0xfffffe00</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">512 bytes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/a/32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">On-chip debugger</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0xfffff800</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">512 bytes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/x/32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Bootloader ROM</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0xffff0000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">up to 32kB</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/x/a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">DMEM</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x80000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">up to "2GB"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/x/a/8/16/32</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IMEM</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x00000000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">up to 2GB</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/x/a/8/16/32</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_memory_configuration">2.4.4. Memory Configuration</h4>
<div class="paragraph">
<p>The NEORV32 Processor was designed to provide maximum flexibility for the memory configuration.
The processor can populate the <em>instruction address space</em> and/or the <em>data address space</em> with <strong>internal memories</strong>
for instructions (IMEM) and data (DMEM). Processor <strong>external memories</strong> can be used as an <em>alternative</em> or even <em>in combination</em> with
the internal ones. The figure below show some exemplary memory configurations.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_memory_configurations.png" alt="800">
</div>
<div class="title">Figure 3. Exemplary memory configurations</div>
</div>
<div class="sect4">
<h5 id="_internal_memories">Internal Memories</h5>
<div class="paragraph">
<p>The processor-internal memories (<a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> and <a href="#_data_memory_dmem">Data Memory (DMEM)</a>) are enabled (=implemented)
via the <a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> and <a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> generics. Their sizes are configures via the according
<a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a> and <a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a> generics.</p>
</div>
<div class="paragraph">
<p>If the processor-internal IMEM is implemented, it is located right at the base address of the instruction
address space (default <code>ispace_base_c</code> = <em>0x00000000</em>). Vice versa, the processor-internal data memory is
located right at the beginning of the data address space (default <code>dspace_base_c</code> = <em>0x80000000</em>) when
implemented.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The default processor setup uses only <em>internal</em> memories.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the IMEM (internal or external) is less than the (default) maximum size (2GB), there is
a "dead address space" between it and the DMEM. This provides an additional safety feature
since data corrupting scenarios like stack overflow cannot directly corrupt the content of the IMEM:
any access to the "dead address space" in between will raise an exception that can be caught
by the runtime environment.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_external_memories">External Memories</h5>
<div class="paragraph">
<p>If external memories (or further IP modules) shall be connected via the <em>processor&#8217;s external bus interface</em>,
the interface has to be enabled via <a href="#_mem_ext_en"><em>MEM_EXT_EN</em></a> generic (=<em>true</em>). More information regarding this interface can be
found in section <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a>.</p>
</div>
<div class="paragraph">
<p>Any CPU access (data or instructions), which does not fulfill <em>at least one</em> of the following conditions, is forwarded
via the processor&#8217;s bus interface to external components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>access to the processor-internal IMEM and processor-internal IMEM is implemented</p>
</li>
<li>
<p>access to the processor-internal DMEM and processor-internal DMEM is implemented</p>
</li>
<li>
<p>access to the bootloader ROM and beyond → addresses &gt;= <em>BOOTROM_BASE</em> (default 0xFFFF0000) will never be forwarded to the external memory interface</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If no (or not all) processor-internal memories are implemented, the according base addresses are mapped to external memories.
For example, if the processor-internal IMEM is not implemented (<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>false</em>), the processor will forward
any access to the instruction address space (starting at <code>ispace_base_c</code>) via the external bus interface to the external
memory system.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the external interface is deactivated, any access exceeding the internal memory address space (instruction, data, bootloader) or
the internal peripheral address space will trigger a bus access fault exception.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_boot_configuration">2.4.5. Boot Configuration</h4>
<div class="paragraph">
<p>Due to the flexible memory configuration concept, the NEORV32 Processor provides several different boot concepts.
The figure below shows the exemplary concepts for the two most common boot scenarios.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_boot_configurations.png" alt="800">
</div>
<div class="title">Figure 4. NEORV32 boot configurations</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration of internal or external data memory (DMEM; <a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> = <em>true</em> / <em>false</em>) is not further
relevant for the boot configuration itself. Hence, it is not further illustrated here.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are two general boot scenarios: <em>Indirect Boot</em> (1a and 1b) and <em>Direct Boot</em> (2a and 2b) configured via the
<a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic  If this generic is set <strong>true</strong> the <em>indirect</em> boot scenario is used. This is also the
default boot configuration of the processor. If <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> is set <strong>false</strong> the <em>direct</em> boot scenario is used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that the provided boot scenarios are just exemplary setups that (should) fit most common requirements.
Much more sophisticated boot scenarios are possible by combining internal and external memories. For example, the default
internal bootloader could be used as first-level bootloader that loads (from extern SPI flash) a second-level bootloader
that is placed and execute in internal IMEM. This second-level bootloader could then fetch the actual application and
store it to external <em>data</em> memory and transfers CPU control to that.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_indirect_boot">Indirect Boot</h5>
<div class="paragraph">
<p>The <em>indirect</em> boot scenarios <strong>1a</strong> and <strong>1b</strong> use the processor-internal <a href="#_bootloader">Bootloader</a>. This general setup is enabled
by setting the <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic to true, which will implement the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a>.
This read-only memory is pre-initialized during synthesis with the default bootloader firmware.</p>
</div>
<div class="paragraph">
<p>The bootloader provides several options to upload an executable (via UART or from external SPI flash) and store it to
the <em>instruction address space</em> so the CPU can execute it. Boot scenario <strong>1a</strong> uses the processor-internal IMEM
(<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>true</em>). This scenario implements the internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> as non-initialized
RAM so the bootloader can write the actual executable to it.</p>
</div>
<div class="paragraph">
<p>Boot scenario <strong>1b</strong> uses a processor-external IMEM (<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>false</em>) that is connected via the processor&#8217;s
bus interface. In this scenario the internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> is not implemented at all and the bootloader will
write the executable to the processor-external memory.</p>
</div>
</div>
<div class="sect4">
<h5 id="_direct_boot">Direct Boot</h5>
<div class="paragraph">
<p>The <em>direct</em> boot scenarios <strong>2a</strong> and <strong>2b</strong> do not use the processor-internal bootloader. Hence, the <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a>
generic is set <em>false</em>. In this configuration the <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> is not implemented at all and the CPU will
directly begin executing code from the instruction address space after reset. A "pre-initialization mechanism is required
in order to provide an executable <em>in</em> memory.</p>
</div>
<div class="paragraph">
<p>Boot scenario <strong>2a</strong> uses the processor-internal IMEM (<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>true</em>) that is implemented as <em>read-only memory</em>
in this scenario. It is pre-initialized (by the bitstream) with the actual application executable.</p>
</div>
<div class="paragraph">
<p>In contrast, boot scenario <strong>2b</strong> uses a processor-external IMEM (<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>false</em>). In this scenario the
system designer is responsible for providing a initialized external memory that contains the actual application to be executed.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_internal_modules">2.5. Processor-Internal Modules</h3>
<div class="paragraph">
<p>Basically, the processor is a SoC consisting of the NEORV32 CPU, peripheral/IO devices, embedded
memories, an external memory interface and a bus infrastructure to interconnect all units. Additionally, the
system implements an internal reset generator and a global clock generator/divider.</p>
</div>
<div class="paragraph">
<p><strong>Internal Reset Generator</strong></p>
</div>
<div class="paragraph">
<p>Most processor-internal modules - except for the CPU and the watchdog timer - do not have a dedicated
reset signal. However, all devices can be reset by software by clearing the corresponding unit&#8217;s control
register. The automatically included application start-up code (<code>crt0.S</code>) will perform a software-reset of all
modules to ensure a clean system reset state.</p>
</div>
<div class="paragraph">
<p>The hardware reset signal of the processor can either be
triggered via the external reset pin (<code>rstn_i</code>, low-active) or by the internal watchdog timer (if implemented).
Before the external reset signal is applied to the system, it is extended to have a minimal duration of eight
clock cycles.</p>
</div>
<div class="paragraph">
<p><strong>Internal Clock Divider</strong></p>
</div>
<div class="paragraph">
<p>An internal clock divider generates 8 clock signals derived from the processor&#8217;s main clock input <code>clk_i</code>.
These derived clock signals are not actual <em>clock signals</em>. Instead, they are derived from a simple counter and
are used as "clock enable" signal by the different processor modules. Thus, the whole design operates using
only the main clock signal (single clock domain). Some of the processor peripherals like the Watchdog or the
UARTs can select one of the derived clock enabled signals for their internal operation. If none of the
connected modules require a clock signal from the divider, it is automatically deactivated to reduce dynamic
power.</p>
</div>
<div class="paragraph">
<p>The peripheral devices, which feature a time-based configuration, provide a three-bit prescaler select in their
according control register to select one out of the eight available clocks. The mapping of the prescaler select
bits to the actually obtained clock are shown in the table below. Here, f represents the processor main clock
from the top entity&#8217;s <code>clk_i</code> signal.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prescaler bits:</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b010</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b011</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b100</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b101</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b110</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b111</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting clock:</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/8</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/64</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/128</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/1024</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/2048</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/4096</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Peripheral / IO Devices</strong></p>
</div>
<div class="paragraph">
<p>The processor-internal peripheral/IO devices are located at the end of the 32-bit address space at base
address <em>0xFFFFFE00</em>. A region of 512 bytes is reserved for this devices. Hence, all peripheral/IO devices are
accessed using a memory-mapped scheme. A special linker script as well as the NEORV32 core software
library abstract the specific memory layout for the user.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The base address of each component/module has to be aligned to the
total size of the module&#8217;s occupied address space! The occupied address space
has to be a power of two (minimum 4 bytes)! Address spaces must not overlap!
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When accessing an IO device that hast not been implemented (via the according <em>IO_x_EN</em> generic), a
load/store access fault exception is triggered.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The peripheral/IO devices can only be written in full-word mode (i.e. 32-bit). Byte or half-word
(8/16-bit) writes will trigger a store access fault exception. Read accesses are not size constrained.
Processor-internal memories as well as modules connected to the external memory interface can still
be written with a byte-wide granularity.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You should use the provided core software library to interact with the peripheral devices. This
prevents incompatibilities with future versions, since the hardware driver functions handle all the
register and register bit accesses.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Most of the IO devices do not have a hardware reset. Instead, the devices are reset via software by
writing zero to the unit&#8217;s control register. A general software-based reset of all devices is done by the
application start-up code <code>crt0.S</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interrupts of Processor-Internal Modules</strong></p>
</div>
<div class="paragraph">
<p>Most peripheral/IO devices provide some kind of interrupt (for example to signal available incoming data). These
interrupts are entirely mapped to the CPU&#8217;s <a href="#_custom_fast_interrupt_request_lines">Custom Fast Interrupt Request Lines</a>. Note that all these
interrupt lines are high-active and are permanently triggered until the IRQ-causing condition is resolved.</p>
</div>
<div class="paragraph">
<p><strong>Nomenclature for the Peripheral / IO Devices Listing</strong></p>
</div>
<div class="paragraph">
<p>Each peripheral device chapter features a register map showing accessible control and data registers of the
according device including the implemented control and status bits. C-language code can directly interact with these
registers via pre-defined <code>struct</code>. Each IO/peripheral module provides a unique <code>struct</code>. All accessible
interface registers of this module are defined as members of this <code>struct</code>. The pre-defined <code>struct</code> are defined int the
main processor core library include file <code>sw/lib/include/neorv32.h</code>.</p>
</div>
<div class="paragraph">
<p>The naming scheme of these low-level hardware access structs is <code>NEORV32_&lt;module_name&gt;.&lt;register_name&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. Low-level hardware access example in C using the pre-defined <code>struct</code></div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// Read from SYSINFO "CLK" register
uint32_t temp = NEORV32_SYSINFO.CLK;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The registers and/or register bits, which can be accessed directly using plain C-code, are marked with a "[C]".
Not all registers or register bits can be arbitrarily read/written. The following read/write access types are
available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>r/w</code> registers / bits can be read and written</p>
</li>
<li>
<p><code>r/-</code> registers / bits are read-only; any write access to them has no effect</p>
</li>
<li>
<p><code>-/w</code> these registers / bits are write-only; they auto-clear in the next cycle and are always read as zero</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Bits / registers that are not listed in the register map tables are not (yet) implemented. These registers
/ bits are always read as zero. A write access to them has no effect, but user programs should only
write zero to them to keep compatible with future extension.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When writing to read-only registers, the access is nevertheless acknowledged, but no actual data is
written. When reading data from a write-only register the result is undefined.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_instruction_memory_imem">2.5.1. Instruction Memory (IMEM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_imem.entity.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity-only definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem/neorv32_imem.default.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default <em>platform-agnostic</em> memory architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_INT_IMEM_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal IMEM when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_INT_IMEM_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM size in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>INT_BOOTLOADER_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use internal bootloader when <em>true</em> (implements IMEM as <em>uninitialized</em> RAM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The actual IMEM is split into two design files: a plain entity definition (<code>neorv32_imem.entity.vhd</code>) and the actual
architecture definition (<code>mem/neorv32_imem.default.vhd</code>). This <strong>default architecture</strong> provides a <em>generic</em> and
<em>platform independent</em> memory design that (should) infers embedded memory block. You can replace/modify the architecture
source file in order to use platform-specific features (like advanced memory resources) or to improve technology mapping
and/or timing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Implementation of the processor-internal instruction memory is enabled via the processor&#8217;s
<em>MEM_INT_IMEM_EN</em> generic. The size in bytes is defined via the <em>MEM_INT_IMEM_SIZE</em> generic. If the
IMEM is implemented, the memory is mapped into the instruction memory space and located right at the
beginning of the instruction memory space (default <code>ispace_base_c</code> = 0x00000000).</p>
</div>
<div class="paragraph">
<p>By default, the IMEM is implemented as RAM, so the content can be modified during run time. This is
required when using a bootloader that can update the content of the IMEM at any time. If you do not need
the bootloader anymore - since your application development has completed and you want the program to
permanently reside in the internal instruction memory - the IMEM is automatically implemented as <em>pre-intialized</em>
ROM when the processor-internal bootloader is disabled (<em>INT_BOOTLOADER_EN</em> = <em>false</em>).</p>
</div>
<div class="paragraph">
<p>When the IMEM is implemented as ROM, it will be initialized during synthesis with the actual application
program image. The compiler toolchain will generate a VHDL initialization
file <code>rtl/core/neorv32_application_image.vhd</code>, which is automatically inserted into the IMEM. If
the IMEM is implemented as RAM (default), the memory will <strong>not be initialized</strong> at all.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_data_memory_dmem">2.5.2. Data Memory (DMEM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dmem.entity.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity-only definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem/neorv32_dmem.default.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default <em>platform-agnostic</em> memory architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_INT_DMEM_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal DMEM when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_INT_DMEM_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM size in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The actual DMEM is split into two design files: a plain entity definition (<code>neorv32_dmem.entity.vhd</code>) and the actual
architecture definition (<code>mem/neorv32_dmem.default.vhd</code>). This <strong>default architecture</strong> provides a <em>generic</em> and
<em>platform independent</em> memory design that (should) infers embedded memory block. You can replace/modify the architecture
source file in order to use platform-specific features (like advanced memory resources) or to improve technology mapping
and/or timing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Implementation of the processor-internal data memory is enabled via the processor&#8217;s <em>MEM_INT_DMEM_EN</em>
generic. The size in bytes is defined via the <em>MEM_INT_DMEM_SIZE</em> generic. If the DMEM is implemented,
the memory is mapped into the data memory space and located right at the beginning of the data memory
space (default <code>dspace_base_c</code> = 0x80000000). The DMEM is always implemented as RAM.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_bootloader_rom_bootrom">2.5.3. Bootloader ROM (BOOTROM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_boot_rom.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>INT_BOOTLOADER_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal bootloader when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default <code>neorv32_boot_rom.vhd</code> HDL source file provides a <em>generic</em> memory design that infers embedded
memory for <em>larger</em> memory configurations. You might need to replace/modify the source file in order to use
platform-specific features (like advanced memory resources) or to improve technology mapping and/or timing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This HDL modules provides a read-only memory that contain the executable code image of the bootloader.
If the <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic is <em>true</em> this module will be implemented and the CPU boot address
is modified to directly execute the code from the bootloader ROM after reset.</p>
</div>
<div class="paragraph">
<p>The bootloader ROM is located at address <code>0xFFFF0000</code> and can occupy a address space of up to 32kB. The base
address as well as the maximum address space size are fixed and cannot (should not!) be modified as this
might address collision with other processor modules.</p>
</div>
<div class="paragraph">
<p>The bootloader memory is <em>read-only</em> and is automatically initialized with the bootloader executable image
<code>rtl/core/neorv32_bootloader_image.vhd</code> during synthesis. The actual <em>physical</em> size of the ROM is also
determined via synthesis and expanded to the next power of two. For example, if the bootloader code requires
10kB of storage, a ROM with 16kB will be generated. The maximum size must not exceed 32kB.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bootloader - Software</div>
See section <a href="#_bootloader">Bootloader</a> for more information regarding the actual bootloader software/executable itself.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Boot Configuration</div>
See section <a href="#_boot_configuration">Boot Configuration</a> for more information regarding the processor&#8217;s different boot scenarios.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_processor_internal_instruction_cache_icache">2.5.4. Processor-Internal Instruction Cache (iCACHE)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_icache.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ICACHE_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal instruction cache when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ICACHE_NUM_BLOCKS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of cache blocks (pages/lines)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ICACHE_BLOCK_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of a cache block in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ICACHE_ASSOCIATIVITY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">associativity / number of sets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default <code>neorv32_icache.vhd</code> HDL source file provides a <em>generic</em> memory design that infers embedded
memory. You might need to replace/modify the source file in order to use platform-specific features
(like advanced memory resources) or to improve technology mapping and/or timing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The processor features an optional cache for instructions to compensate memories with high latency. The
cache is directly connected to the CPU&#8217;s instruction fetch interface and provides a full-transparent buffering
of instruction fetch accesses to the entire 4GB address space.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The instruction cache is intended to accelerate instruction fetch via the external memory interface.
Since all processor-internal memories provide an access latency of one cycle (by default), caching
internal memories does not bring any performance gain. However, it <em>might</em> reduce traffic on the
processor-internal bus.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The cache is implemented if the <em>ICACHE_EN</em> generic is true. The size of the cache memory is defined via
<em>ICACHE_BLOCK_SIZE</em> (the size of a single cache block/page/line in bytes; has to be a power of two and &gt;=
4 bytes), <em>ICACHE_NUM_BLOCKS</em> (the total amount of cache blocks; has to be a power of two and &gt;= 1) and
the actual cache associativity <em>ICACHE_ASSOCIATIVITY</em> (number of sets; 1 = direct-mapped, 2 = 2-way set-associative,
has to be a power of two and &gt;= 1).</p>
</div>
<div class="paragraph">
<p>If the cache associativity (<em>ICACHE_ASSOCIATIVITY</em>) is &gt; 1 the LRU replacement policy (least recently
used) is used.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Keep the features of the targeted FPGA&#8217;s memory resources (block RAM) in mind when configuring
the cache size/layout to maximize and optimize resource utilization.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By executing the <code>ifence.i</code> instruction (<code>Zifencei</code> CPU extension) the cache is cleared and a reload from
main memory is forced. Among other things, this allows to implement self-modifying code.</p>
</div>
<div class="paragraph">
<p><strong>Bus Access Fault Handling</strong></p>
</div>
<div class="paragraph">
<p>The cache always loads a complete cache block (<em>ICACHE_BLOCK_SIZE</em> bytes) aligned to the size of a cache
block if a miss is detected. If any of the accessed addresses within a single block do not successfully
acknowledge (i.e. issuing an error signal or timing out) the whole cache block is invalidate and any access to
an address within this cache block will also raise an instruction fetch bus error fault exception.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_processor_external_memory_interface_wishbone_axi4_lite">2.5.5. Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wishbone.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_tag_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request tag output (3-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_adr_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address output (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data input (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data output (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_we_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write enable (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_sel_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable (4-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_stb_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strobe (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_cyc_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid cycle (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_lock_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclusive access request (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_ack_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acknowledge (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_err_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus error (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an executed <code>fence</code> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fencei_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an executed <code>fence.i</code> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable external memory interface when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_TIMEOUT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of clock cycles after which an unacknowledged external bus access will auto-terminate (0 = disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_PIPE_MODE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when <em>false</em> (default): classic/standard Wishbone protocol; when <em>true</em>: pipelined Wishbone protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_BIG_ENDIAN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte-order (Endianness) of external memory interface; true=BIG, false=little (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_ASYNC_RX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use registered RX path when <em>false</em> (default); use async/direct RX path when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The external memory interface uses the Wishbone interface protocol. The external interface port is available
when the <em>MEM_EXT_EN</em> generic is <em>true</em>. This interface can be used to attach external memories, custom
hardware accelerators additional IO devices or all other kinds of IP blocks. All memory accesses from the
CPU, that do not target the internal bootloader ROM, the internal IO region or the internal data/instruction
memories (if implemented at all) are forwarded to the Wishbone gateway and thus to the external memory
interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When using the default processor setup, all access addresses between 0x00000000 and
0xffff0000 (= beginning of processor-internal BOOT ROM) are delegated to the external memory
/ bus interface if they are not targeting the (actually enabled/implemented) processor-internal
instruction memory (IMEM) or the (actually enabled/implemented) processor-internal data memory
(DMEM). See section <a href="#_address_space">Address Space</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Wishbone Bus Protocol</strong></p>
</div>
<div class="paragraph">
<p>The external memory interface either uses <strong>standard</strong> ("classic") Wishbone transactions (default) or
<strong>pipelined</strong> Wishbone transactions. The transaction protocol is configured via the <em>MEM_EXT_PIPE_MODE</em> generic:</p>
</div>
<div class="paragraph">
<p>When <em>MEM_EXT_PIPE_MODE</em> is <em>false</em>, all bus control signals including <em>STB</em> are active (and stable) until the
transfer is acknowledged/terminated. If <em>MEM_EXT_PIPE_MODE</em> is <em>true</em>, all bus control except <em>STB</em> are active
(and stable) until the transfer is acknowledged/terminated. In this case, <em>STB</em> is active only during the very
first bus clock cycle.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 6. Exemplary Wishbone bus accesses using "classic" and "pipelined" protocol</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/wishbone_classic_read.png" alt="700" width="300">
</div>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/wishbone_pipelined_write.png" alt="700" width="300">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Classic</strong> Wishbone read access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Pipelined</strong> Wishbone write access</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A detailed description of the implemented Wishbone bus protocol and the according interface signals
can be found in the data sheet "Wishbone B4 - WISHBONE System-on-Chip (SoC) Interconnection
Architecture for Portable IP Cores". A copy of this document can be found in the docs folder of this
project.</p>
</div>
<div class="paragraph">
<p><strong>Interface Latency</strong></p>
</div>
<div class="paragraph">
<p>By default, the Wishbone gateway introduces two additional latency cycles: processor-outgoing ("TX") and
processor-incoming ("RX") signals are fully registered. Thus, any access from the CPU to a processor-external devices
via Wishbone requires 2 additional clock cycles (at least; depending on device&#8217;s latency).</p>
</div>
<div class="paragraph">
<p>If the attached Wishbone network / peripheral already provides output registers or if the Wishbone network is not relevant
for timing closure, the default buffering of incoming ("RX") data within the gateway can be disabled by implementing an
"asynchronous" RX path. The configuration is done via the <em>MEM_EXT_ASYNC_RX</em> generic.</p>
</div>
<div class="paragraph">
<p><strong>Bus Access Timeout</strong></p>
</div>
<div class="paragraph">
<p>The Wishbone bus interface provides an option to configure a bus access timeout counter. The <em>MEM_EXT_TIMEOUT</em>
top generic is used to specify the <em>maximum</em> time (in clock cycles) a bus access can be pending before it is automatically
terminated. If <em>MEM_EXT_TIMEOUT</em> is set to zero, the timeout disabled an a bus access can take an arbitrary number of cycles to complete.</p>
</div>
<div class="paragraph">
<p>When <em>MEM_EXT_TIMEOUT</em> is greater than zero, the WIshbone adapter starts an internal countdown whenever the CPU
accesses a memory address via the external memory interface. If the accessed memory / device does not acknowledge (via <code>wb_ack_i</code>)
or terminate (via <code>wb_err_i</code>) the transfer within <em>MEM_EXT_TIMEOUT</em> clock cycles, the bus access is automatically canceled
(setting <code>wb_cyc_o</code> low again) and a load/store/instruction fetch bus access fault exception is raised.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This feature can be used as <strong>safety guard</strong> if the external memory system does not check for "address space holes". That means that addresses, which
do not belong to a certain memory or device, do not permanently stall the processor due to an unacknowledged/unterminated bus access. If the external
memory system can guarantee to access <strong>any</strong> bus access (even it targets an unimplemented address) the timeout feature should be disabled
(<em>MEM_EXT_TIMEOUT</em> = 0).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Wishbone Tag</strong></p>
</div>
<div class="paragraph">
<p>The 3-bit wishbone <code>wb_tag_o</code> signal provides additional information regarding the access type. This signal
is compatible to the AXI4 <em>AxPROT</em> signal.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wb_tag_o(0)</code> 1: privileged access (CPU is in machine mode); 0: unprivileged access</p>
</li>
<li>
<p><code>wb_tag_o(1)</code> always zero (indicating "secure access")</p>
</li>
<li>
<p><code>wb_tag_o(2)</code> 1: instruction fetch access, 0: data access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Exclusive / Atomic Bus Access</strong></p>
</div>
<div class="paragraph">
<p>If the atomic memory access CPU extension (via <em>CPU_EXTENSION_RISCV_A</em>) is enabled, the CPU can
request an atomic/exclusive bus access via the external memory interface.</p>
</div>
<div class="paragraph">
<p>The load-reservate instruction (<code>lr.w</code>) will set the <code>wb_lock_o</code> signal telling the bus interconnect to establish a
reservation for the current accessed address (start of an exclusive access). This signal will stay asserted until
another memory access instruction is executed (for example a <code>sc.w</code>).</p>
</div>
<div class="paragraph">
<p>The memory system has to make sure that no other entity can access the reservated address until <code>wb_lock_o</code>
is released again. If this attempt fails, the memory system has to assert <code>wb_err_i</code> in order to indicate that the
reservation was broken.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See section <a href="#_bus_interface">Bus Interface</a> for the CPU bus interface protocol.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Endianness</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 CPU and the Processor setup are <strong>little-endian</strong> architectures. To allow direct connection
to a big-endian memory system the external bus interface provides an <em>Endianness configuration</em>. The
Endianness (of the external memory interface) can be configured via the <em>MEM_EXT_BIG_ENDIAN</em> generic.
By default, the external memory interface uses little-endian byte-order (like the rest of the processor / CPU).</p>
</div>
<div class="paragraph">
<p>Application software can check the Endianness configuration of the external bus interface via the
SYSINFO module (see section <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> for more information).</p>
</div>
<div class="paragraph">
<p><strong>AXI4-Lite Connectivity</strong></p>
</div>
<div class="paragraph">
<p>The AXI4-Lite wrapper (<code>rtl/system_integration/neorv32_SystemTop_axi4lite.vhd</code>) provides a Wishbone-to-
AXI4-Lite bridge, compatible with Xilinx Vivado (IP packager and block design editor). All entity signals of
this wrapper are of type <em>std_logic</em> or <em>std_logic_vector</em>, respectively.</p>
</div>
<div class="paragraph">
<p>The AXI Interface has been verified using Xilinx Vivado IP Packager and Block Designer. The AXI
interface port signals are automatically detected when packaging the core.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_axi_soc.png" alt="neorv32 axi soc">
</div>
<div class="title">Figure 5. Example AXI SoC using Xilinx Vivado</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using the auto-termination timeout feature (<em>MEM_EXT_TIMEOUT</em> greater than zero) is <strong>not AXI4 compliant</strong> as the AXI protocol does not support canceling of
bus transactions. Therefore, the NEORV32 top wrapper with AXI4-Lite interface (<code>rtl/system_integration/neorv32_SystemTop_axi4lite</code>) configures <em>MEM_EXT_TIMEOUT</em> = 0 by default.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_internal_bus_monitor_buskeeper">2.5.6. Internal Bus Monitor (BUSKEEPER)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_buskeeper.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">explicitly used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Package constants:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max_proc_int_response_time_c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access time window (#cycles)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The Bus Keeper is a fundamental component of the processor&#8217;s internal bus system that ensures correct bus operations
to maintain execution safety. The Bus Keeper monitors every single bus transactions that is intimated by the CPU.
If an accessed device responds with an error condition or do not respond within a specific <em>access time window</em>,
the according bus access fault exception is raised. The following exceptions can be raised by the Bus Keeper
(see section <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a> for all CPU exceptions):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TRAP_CODE_I_ACCESS</code>: error during instruction fetch bus access</p>
</li>
<li>
<p><code>TRAP_CODE_S_ACCESS</code>: error during data store bus access</p>
</li>
<li>
<p><code>TRAP_CODE_L_ACCESS</code>: error during data load bus access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>access time window</strong>, in which an accessed device has to respond, is defined by the <code>max_proc_int_response_time_c</code>
constant from the processor&#8217;s VHDL package file (<code>rtl/neorv32_package.vhd</code>). The default value is <strong>15 clock cycles</strong>.</p>
</div>
<div class="paragraph">
<p>In case of a bus access fault exception application software can evaluate the Bus Keeper&#8217;s control register
<code>NEORV32_BUSKEEPER.CTRL</code> to retrieve further details of the bus exception. The <em>BUSKEEPER_ERR_FLAG</em> bit indicates
that an actual bus access fault has occurred. The bit is sticky once set and is automatically cleared when reading or
writing the <code>NEORV32_BUSKEEPER.CTRL</code> register. The <em>BUSKEEPER_ERR_TYPE</em> indicated the tape of the bus fault:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>BUSKEEPER_ERR_TYPE</em> = <code>0</code> - "Device Error": The bus access exception was cause by the memory-mapped device that
has been accessed (the device asserted it&#8217;s <code>err_o</code>).</p>
</li>
<li>
<p><em>BUSKEEPER_ERR_TYPE</em> = <code>1</code> - "Timeout Error": The bus access exception was caused by the Bus Keeper because the
accessed memory-mapped device did not respond within the access time window. Note that this error type can also be raised
by the optional timeout feature of the <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bus access fault exceptions are also raised if a physical memory protection rule is violated. In this case
the <em>BUSKEEPER_ERR_FLAG</em> bit remains zero.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. BUSKEEPER register map (<code>struct NEORV32_BUSKEEPER</code>)</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 15.3846%;">
<col style="width: 30.7692%;">
<col style="width: 7.6923%;">
<col style="width: 30.7693%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xffffff7C</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>NEORV32_BUSKEEPER.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>  <em>BUSKEEPER_ERR_TYPE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus error type, valid if <em>BUSKEEPER_ERR_FLAG</em> is set: <code>0</code>=device error, <code>1</code>=access timeout</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>BUSKEEPER_ERR_FLAG</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sticky error flag, clears after read or write access</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_stream_link_interface_slink">2.5.7. Stream Link Interface (SLINK)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link data (8x32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_val_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link data valid (8-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_rdy_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link allowed to send (8-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link data (8x32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_val_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link data valid (8-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_rdy_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link ready to receive (8-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SLINK_NUM_TX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of TX links to implement (0..8)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SLINK_NUM_RX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of RX links to implement (0..8)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SLINK_TX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth (1..32k) of TX links, has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SLINK_RX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth (1..32k) of RX links, has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK RX IRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK TX IRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The SLINK component provides up to 8 independent RX (receiving) and TX (sending) links for transmitting
stream data. The interface provides higher bandwidth (and less latency) than the external memory bus
interface, which makes it ideally suited to couple custom stream processing units (like CORDIC, FFTs or
cryptographic accelerators).</p>
</div>
<div class="paragraph">
<p>Each individual link provides an internal FIFO for data buffering. The FIFO depth is globally defined
for all TX links via the <em>SLINK_TX_FIFO</em> generic and for all RX links via the <em>SLINK_RX_FIFO</em> generic.
The FIFO depth has to be at least 1, which will implement a simple input/output register. The maximum
value is limited to 32768 entries. Note that the FIFO depth has to be a power of two (for optimal
logic mapping).</p>
</div>
<div class="paragraph">
<p>The actual number of implemented RX/TX links is configured by the <em>SLINK_NUM_RX</em> and <em>SLINK_NUM_TX</em>
generics. The SLINK module will be synthesized only if at least one of these generics is greater than
zero. All unimplemented links are internally terminated and their according output signals are pulled
to low level.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The SLINK interface does not provide any additional tag signals (for example to define a "stream destination
address" or to indicate the last data word of a "package"). Use a custom controller connected
via the external memory bus interface or use some of the processor&#8217;s GPIO ports to implement custom data
tag signals.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SLINK provides eight data registers (<code>DATA[i]</code>) to access the links (read accesses will access the RX links, write
accesses will access the TX links), one control register (<code>CTRL</code>) and one status register (<code>STATUS</code>).</p>
</div>
<div class="paragraph">
<p>The SLINK is globally activated by setting the control register&#8217;s enable bit <em>SLINK_CTRL_EN</em>.
The actual data links are accessed by reading or writing the according link data registers <code>DATA[0]</code>
to <code>DATA[7]</code>. For example, writing the <code>DATA[0]</code> will put the according data into the FIFO of TX link 0.
Accordingly, reading from <code>DATA[0]</code> will return one data word from the FIFO of RX link 0.</p>
</div>
<div class="paragraph">
<p>The configuration (done via the SLINK generics) can be checked by software by evaluating bit fields in the
control register. The <em>SLINK_CTRL_TX_FIFO_Sx</em> and <em>SLINK_CTRL_RX_FIFO_Sx</em> indicate the TX &amp; RX FIFO sizes.
The <em>SLINK_CTRL_TX_NUMx</em> and <em>SLINK_CTRL_RX_NUMx</em> bits represent the absolute number of implemented TX and RX links.</p>
</div>
<div class="paragraph">
<p>The status register shows the FIFO status flags of each RX and TX link. The <em>SLINK_CTRL_RXx_AVAIL</em> flags indicate
that there is <em>at least</em> one data word in the according RX link&#8217;s FIFO. The <em>SLINK_CTRL_TXx_FREE</em> flags indicate
there is <em>at least</em> one free entry in the according TX link&#8217;s FIFO. The <em>SLINK_STATUS_RXx_HALF</em> and
<em>SLINK_STATUS_RXx_HALF</em> flags show if a certain FIFO&#8217;s fill level has exceeded half of its capacity.</p>
</div>
<div class="paragraph">
<p><strong>Blocking Link Access</strong></p>
</div>
<div class="paragraph">
<p>When directly accessing the link data registers (without checking the according FIFO status flags) the access
is as <em>blocking</em>. That means the CPU access will stall until the accessed link responds. For
example, when reading RX link 0 (via <code>DATA[0]</code> register) the CPU will stall, if there is not data
available in the according FIFO yet. The CPU access will complete as soon as RX link 0 receives new data.</p>
</div>
<div class="paragraph">
<p>Vice versa, writing data to TX link 0 (via <code>DATA[0]</code> register) will stall the CPU access until there is
at least one free entry in the link&#8217;s FIFO.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The NEORV32 processor ensures that <em>any</em> CPU access to memory-mapped devices (including the SLINK module)
will <strong>time out</strong> after a certain number of cycles (see section <a href="#_bus_interface">Bus Interface</a>).
Hence, blocking access to a stream link that does not complete within a certain amount of cycles will
raise a <em>store bus access exception</em> when writing to a <em>full</em> TX link&#8217;s FIFO or a <em>load bus access exception</em>
when reading from an <em>empty</em> RX 's FIFO. Hence, this concept should only be used when evaluating the half-full
FIFO condition (for example via the SLINK interrupts) before actual accessing links.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is no RX FIFO overflow mechanism available yet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Non-Blocking Link Access</strong></p>
</div>
<div class="paragraph">
<p>For a non-blocking link access concept, the FIFO status flags in <code>STATUS</code> need to be checked <em>before</em>
reading/writing the actual link data register. For example, a non-blocking write access to a TX link 0 has
to check <em>SLINK_STATUS_TX0_FREE</em> first. If the bit is set, the FIFO of TX link 0 can take another data word
and the actual data can be written to <code>DATA[0]</code>. If the bit is cleared, the link&#8217;s FIFO is full
and the status flag can be polled until it there is free space in the available.</p>
</div>
<div class="paragraph">
<p>This concept will not raise any exception as there is no "direct" access to the link data registers.
However, non-blocking accesses require additional instructions to check the according status flags prior
to the actual link access, which will reduce performance for high-bandwidth data streams.</p>
</div>
<div class="paragraph">
<p><strong>Stream Link Interface &amp; Protocol</strong></p>
</div>
<div class="paragraph">
<p>The SLINK interface consists of three signals <code>dat</code>, <code>val</code> and <code>rdy</code> for each RX and TX link.
Each signal is an "array" with eight entires (one for each link). Note that an entry in <code>slink_*x_dat</code> is 32-bit
wide while entries in <code>slink_*x_val</code> and <code>slink_*x_rdy</code> are are just 1-bit wide.</p>
</div>
<div class="paragraph">
<p>The stream link protocol is based on a simple FIFO-like interface between a source (sender) and a sink (receiver).
Each link provides two signals for implementing a simple FIFO-style handshake. The <code>slink_*x_val</code> signal is set by
the source if the according <code>slink_*x_dat</code> (also set by the source) contains valid data. The stream source has to
ensure that both signals remain stable until the according <code>slink_*x_rdy</code> signal is set by the stream sink to
indicate it can accept another data word.</p>
</div>
<div class="paragraph">
<p>In summary, a data word is transferred if both <code>slink_*x_val(i)</code> and <code>slink_*x_rdy(i)</code> are high.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/stream_link_interface.png" alt="stream link interface" width="560">
</div>
<div class="title">Figure 6. Exemplary stream link transfer</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The SLINK handshake protocol is compatible with the <a href="https://developer.arm.com/documentation/ihi0051/a/Introduction/About-the-AXI4-Stream-protocol">AXI4-Stream</a> base protocol.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>SLINK Interrupts</strong></p>
</div>
<div class="paragraph">
<p>The stream interface provides two independent interrupts that are <em>globally</em> driven by the RX and TX link&#8217;s
FIFO fill level status. Each RX and TX link provides an individual interrupt enable flag and an individual
interrupt type flag that allows to configure interrupts only for certain (or all) links and for application-
specific FIFO conditions. The interrupt configuration is done using the <code>NEORV32_SLINK.IRQ</code> register.
Any interrupt can only become pending if the SLINK module is enabled at all.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is no RX FIFO overflow mechanism available yet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The current FIFO fill-level of a specific <strong>RX link</strong> can only raise an interrupt request if it&#8217;s interrupt enable flag
<em>SLINK_IRQ_RX_EN</em> is set. Vice versa, the current FIFO fill-level of a specific <strong>TX link</strong> can only raise an interrupt
request if it&#8217;s interrupt enable flag <em>SLINK_IRQ_TX_EN</em> is set.</p>
</div>
<div class="paragraph">
<p>The <strong>RX link&#8217;s</strong> <em>SLINK_IRQ_RX_MODE</em> flags define the FIFO fill-level condition for raising an RX interrupt request:
* If a link&#8217;s interrupt mode flag is <code>1</code> an IRQ is generated when the link&#8217;s FIFO <em>becomes</em> not empty ("RX data available").
* If a link&#8217;s interrupt mode flag is <code>0</code> an IRQ is generated when the link&#8217;s FIFO <em>becomes</em> at least half-full ("time to get data from RX FIFO to prevent overflow").</p>
</div>
<div class="paragraph">
<p>The <strong>TX link&#8217;s</strong> <em>SLINK_IRQ_TX_MODE</em> flags define the FIFO fill-level condition for raising an TX interrupt request:
* If a link&#8217;s interrupt mode flag is <code>1</code> an IRQ is generated when the link&#8217;s FIFO <em>becomes</em> not full ("space left in FIFO for new TX data").
* If a link&#8217;s interrupt mode flag is <code>0</code> an IRQ is generated when the link&#8217;s FIFO <em>becomes</em> less than half-full ("SW can send <em>SLINK_TX_FIFO</em>/2 data words without checking any flags").</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The interrupt configuration register <code>NEORV32_SLINK.IRQ</code> should we written <em>before</em> the SLINK
module is actually enabled.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <em>SLINK_RX_FIFO</em> is 1 all <em>SLINK_IRQ_RX_MODE</em> bits are hardwired to one.
If <em>SLINK_TX_FIFO</em> is 1 all <em>SLINK_IRQ_TX_MODE</em> bits are hardwired to one.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <strong>pending RX interrupt</strong> request is cleared by any of the following operations:
* read access to any <code>NEORV32_SLINK.DATA</code> (for example to read incoming data)
* write access to <code>NEORV32_SLINK.CTRL</code>
* disabling the SLINK module</p>
</div>
<div class="paragraph">
<p>A <strong>pending TX interrupt</strong> request is cleared by any of the following operations:
* write access any <code>NEORV32_SLINK.DATA</code> (for example to send more data)
* write access to <code>NEORV32_SLINK.CTRL</code>
* disabling the SLINK module</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A dummy write to to the control register (i.e. <code>NEORV32_SLINK.DATA = NEORV32_SLINK.DATA</code>)
can be executed to acknowledge any interrupt.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. SLINK register map (<code>struct NEORV32_SLINK</code>)</caption>
<colgroup>
<col style="width: 14.8148%;">
<col style="width: 18.5185%;">
<col style="width: 7.4074%;">
<col style="width: 7.4074%;">
<col style="width: 51.8519%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>0xfffffec0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>NEORV32_SLINK.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>SLINK_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK global enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30:16</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:12</code> <em>SLINK_CTRL_TX_FIFO_S3</em> : <em>SLINK_CTRL_TX_FIFO_S0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX links FIFO depth, log2 of_SLINK_TX_FIFO_ generic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:8</code> <em>SLINK_CTRL_RX_FIFO_S3</em> : <em>SLINK_CTRL_RX_FIFO_S0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX links FIFO depth, log2 of_SLINK_RX_FIFO_ generic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:4</code> <em>SLINK_CTRL_TX_NUM3</em> : <em>SLINK_CTRL_TX_NUM0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of implemented TX links</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3:0</code> <em>SLINK_CTRL_RX_NUM3</em> : <em>SLINK_CTRL_RX_NUM0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of implemented RX links</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffec4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffec8</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_SLINK.IRQ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code> <em>SLINK_IRQ_RX_EN_MSB</em> : <em>SLINK_IRQ_RX_EN_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX interrupt enable for link 7..0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code> <em>SLINK_IRQ_RX_MODE_MSB</em> : <em>SLINK_IRQ_RX_MODE_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX IRQ mode for link 7..0: <code>0</code> = FIFO rises above half-full; <code>1</code> = FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code>  <em>SLINK_IRQ_TX_EN_MSB</em> : <em>SLINK_IRQ_TX_EN_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX interrupt enable for link 7..0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <em>SLINK_IRQ_TX_MODE_MSB</em> : <em>SLINK_IRQ_TX_MODE_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX IRQ mode for link 7..0: <code>0</code> = FIFO falls below half-full; <code>1</code> = FIFO not full</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffeec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffed0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_SLINK.STATUS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code> <em>SLINK_STATUS_TX7_HALF</em> : <em>SLINK_STATUS_TX0_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link 7..0 FIFO fill level is &gt;= half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code> <em>SLINK_STATUS_RX7_HALF</em> : <em>SLINK_STATUS_RX0_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link 7..0 FIFO fill level is &gt;= half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code>  <em>SLINK_STATUS_TX7_FREE</em>  : <em>SLINK_STATUS_TX0_FREE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one free TX FIFO entry available for link 7..0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <em>SLINK_STATUS_RX7_AVAIL</em> : <em>SLINK_STATUS_RX0_AVAIL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one data word in RX FIFO available for link 7..0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffed4</code> : <code>0xfffffedc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffee0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 0 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffee4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 1 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffee8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[2]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 2 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffeec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[3]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 3 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffef0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[4]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 4 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffef4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[5]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 5 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffef8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[6]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 6 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffefc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[7]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 7 RX/TX data</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_general_purpose_input_and_output_port_gpio">2.5.8. General Purpose Input and Output Port (GPIO)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit parallel output port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit parallel input port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_GPIO_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement GPIO port when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The general purpose parallel IO port unit provides a simple 64-bit parallel input port and a 64-bit parallel
output port. These ports can be used chip-externally (for example to drive status LEDs, connect buttons, etc.)
or system-internally to provide control signals for other IP modules. The component is disabled for
implementation when the <em>IO_GPIO_EN</em> generic is set <em>false</em>. In this case GPIO output port is tied to all-zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access atomicity</div>
The GPIO modules uses two memory-mapped registers (each 32-bit) each for accessing the input and
output signals. Since the CPU can only process 32-bit "at once" updating the entire output cannot
be performed within a single clock cycle.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 9. GPIO unit register map (<code>struct NEORV32_GPIO</code>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffc0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPIO.INPUT_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel input port pins 31:0 (write accesses are ignored)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffc4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPIO.INPUT_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel input port pins 63:32 (write accesses are ignored)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffc8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPIO.OUTPUT_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel output port pins 31:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffcc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPIO.OUTPUT_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel output port pins 63:32</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_watchdog_timer_wdt">2.5.9. Watchdog Timer (WDT)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_WDT_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement GPIO port when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog timer overflow (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The watchdog (WDT) provides a last resort for safety-critical applications. The WDT has an internal 20-bit
wide counter that needs to be reset every now and then by the user program. If the counter overflows, either
a system reset or an interrupt is generated (depending on the configured operation mode).</p>
</div>
<div class="paragraph">
<p>Configuration of the watchdog is done by a single control register <code>CTRL</code>. The watchdog is enabled by
setting the <em>WDT_CTRL_EN</em> bit. The clock used to increment the internal counter is selected via the 3-bit
<em>WDT_CTRL_CLK_SELx</em> prescaler:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top"><strong><code>WDT_CTRL_CLK_SELx</code></strong></th>
<th class="tableblock halign-center valign-top">Main clock prescaler</th>
<th class="tableblock halign-right valign-top">Timeout period in clock cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2 097 152</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4 194 304</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b010</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8 388 608</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b011</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">67 108 864</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b100</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">134 217 728</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b101</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1 073 741 824</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b110</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2 147 483 648</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b111</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4 294 967 296</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Whenever the internal timer overflows the watchdog executes one of two possible actions: Either a hard
processor reset is triggered or an interrupt is requested at CPU&#8217;s fast interrupt channel #0. The
WDT_CTRL_MODE bit defines the action to be taken on an overflow: When cleared, the Watchdog will assert an
IRQ, when set the WDT will cause a system reset. The configured action can also be triggered manually at
any time by setting the <em>WDT_CTRL_FORCE</em> bit. The watchdog is reset by setting the <em>WDT_CTRL_RESET</em> bit.</p>
</div>
<div class="paragraph">
<p>A watchdog interrupt can only occur if the watchdog is enabled and interrupt mode is enabled.
A pending interrupt is cleared by either disabling the watchdog or by resetting the watchdog.</p>
</div>
<div class="paragraph">
<p>The cause of the last action of the watchdog can be determined via the <em>WDT_CTRL_RCAUSE</em> flag. If this flag is
zero, the processor has been reset via the external reset signal. If this flag is set the last system reset was
initiated by the watchdog.</p>
</div>
<div class="paragraph">
<p>The Watchdog control register can be locked in order to protect the current configuration. The lock is
activated by setting bit <em>WDT_CTRL_LOCK</em>. In the locked state any write access to the configuration flags is
ignored (see table below, "accessible if locked"). Read accesses to the control register are not effected. The
lock can only be removed by a system reset (via external reset signal or via a watchdog reset action).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. WDT register map (<code>struct NEORV32_WDT</code>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 13.3333%;">
<col style="width: 26.6666%;">
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 26.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-center valign-top">Writable if locked</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="9"><p class="tableblock"><code>0xffffffbc</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="9"><p class="tableblock"><code>NEORV32_WDT.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>WDT_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>WDT_CTRL_CLK_SEL0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>WDT_CTRL_CLK_SEL1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>WDT_CTRL_CLK_SEL2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <em>WDT_CTRL_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">overflow action: <code>1</code>=reset, <code>0</code>=IRQ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code> <em>WDT_CTRL_RCAUSE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cause of last system reset: <code>0</code>=caused by external reset signal, <code>1</code>=caused by watchdog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code> <em>WDT_CTRL_RESET</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog reset when set, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code> <em>WDT_CTRL_FORCE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">force configured watchdog action when set, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code> <em>WDT_CTRL_LOCK</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lock access to configuration when set, clears only on system reset (via external reset signal OR watchdog reset action = reset)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_system_timer_mtime">2.5.10. Machine System Timer (MTIME)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System time input from external MTIME</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System time output (64-bit) for SoC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_MTIME_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement MTIME when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The MTIME machine system timer implements the memory-mapped MTIME timer from the official RISC-V
specifications. This unit features a 64-bit system timer incremented with the primary processor clock.
The current system time can also be obtained using the <code>time[h]</code> CSRs and is made available for processor-external
use via the top&#8217;s <code>mtime_o</code> signal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the processor-internal <strong>MTIME unit is NOT implemented</strong>, the top&#8217;s <code>mtime_i</code> input signal is used to update the <code>time[h]</code> CSRs
and the <code>MTI</code> machine timer CPU interrupt (<code>MTI</code>) is directly connected to the top&#8217;s <code>mtime_irq_i</code> input.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The 64-bit system time can be accessed via the <code>TIME_LO</code> and <code>TIME_HI</code> memory-mapped registers (read/write) and also via
the CPU&#8217;s <code>time[h]</code> CSRs (read-only). A 64-bit time compare register - accessible via memory-mapped <code>TIMECMP_LO</code> and <code>TIMECMP_HI</code>
registers - is used to configure an interrupt to the CPU. The interrupt is triggered
whenever <code>TIME</code> (high &amp; low part) &gt;= <code>TIMECMP</code> (high &amp; low part) and is directly forwarded to the CPU&#8217;s <code>MTI</code> interrupt.
The interrupt remain active (=pending) until <code>TIME</code> &lt; <code>TIMECMP</code> (either by modifying <code>TIME</code> or <code>TIMECMP</code>).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. MTIME register map (<code>struct NEORV32_MTIME</code>)</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 42.8574%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff90</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_MTIME.TIME_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine system time, low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff94</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_MTIME.TIME_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine system time, high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff98</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_MTIME.TIMECMP_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time compare, low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff9c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_MTIME.TIMECMP_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time compare, high word</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_primary_universal_asynchronous_receiver_and_transmitter_uart0">2.5.11. Primary Universal Asynchronous Receiver and Transmitter (UART0)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_txd_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter output UART0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rxd_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver input UART0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rts_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_cts_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: TX allowed to send</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_UART0_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement UART0 when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UART0_RX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UART0_TX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The UART is a standard serial interface mainly used to establish a communication channel between a host computer
computer/user and an application running on the embedded processor.</p>
</div>
<div class="paragraph">
<p>The NEORV32 UARTs feature independent transmitter and receiver with a fixed frame configuration of 8 data bits,
an optional parity bit (even or odd) and a fixed stop bit. The actual transmission rate - the Baudrate - is
programmable via software. Optional FIFOs with custom sizes can be configured for the transmitter and receiver
independently.</p>
</div>
<div class="paragraph">
<p>The UART features two memory-mapped registers <code>CTRL</code> and <code>DATA</code>, which are used for configuration, status
check and data transfer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that ALL default example programs and software libraries of the NEORV32 software
framework (including the bootloader and the runtime environment) use the primary UART
(<em>UART0</em>) as default user console interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>UART0 is enabled by setting the <em>UART_CTRL_EN</em> bit in the UART0 control register <code>CTRL</code>. The Baud rate
is configured via a 12-bit <em>UART_CTRL_BAUDxx</em> baud prescaler (<code>baud_prsc</code>) and a 3-bit <em>UART_CTRL_PRSCx</em>
clock prescaler (<code>clock_prescaler</code>) that scales the processor&#8217;s primary clock (<em>f<sub>main</sub></em>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 12. UART0 prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>UART_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em><strong>Baud rate</strong></em> = (<em>f<sub>main</sub>[Hz]</em> / <code>clock_prescaler</code>) / (<code>baud_prsc</code> + 1)</p>
</div>
<div class="paragraph">
<p>A new transmission is started by writing the data byte to be send to the lowest byte of the <code>DATA</code> register. The
transfer is completed when the <em>UART_CTRL_TX_BUSY</em> control register flag returns to zero. A new received byte
is available when the <em>UART_DATA_AVAIL</em> flag of the <code>DATA</code> register is set. A "frame error" in a received byte
(invalid stop bit) is indicated via the <em>UART_DATA_FERR</em> flag in the <code>DATA</code> register. The flag is cleared by
reading the <code>DATA</code> register.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A transmission (RX or TX) can be terminated at any time by disabling the UART module
by clearing the <em>UART_CTRL_EN</em> control register bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>RX and TX FIFOs</strong></p>
</div>
<div class="paragraph">
<p>UART0 provides optional FIFO buffers for the transmitter and the receiver. The <em>UART0_RX_FIFO</em> generic defines
the depth of the RX FIFO (for receiving data) while the <em>UART0_TX_FIFO</em> defines the depth of the TX FIFO
(for sending data). Both generics have to be a power of two with a minimal allowed value of 1. This minimal
value will implement simple "double-buffering" instead of full-featured FIFOs.
Both FIFOs are cleared whenever UART0 is disabled (clearing <em>UART_CTRL_EN</em> in <code>CTRL</code>).</p>
</div>
<div class="paragraph">
<p>The state of both FIFO (<em>empty</em>, <em>at lest half-full</em>, <em>full</em>) is available via the <em>UART_CTRL</em>?X_EMPTY_,
 <em>UART_CTRL</em>?X_HALF_ and <em>UART_CTRL</em>*X_FULL_ flags in the <code>CTRL</code> register.</p>
</div>
<div class="paragraph">
<p>If the RX FIFO is already full and new data is received by the receiver unit, the <em>UART_DATA_OVERR</em> flag
in the <code>DATA</code> register is set indicating an "overrun". This flag is cleared by reading the <code>DATA</code> register.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In contrast to other FIFO-equipped peripherals, software <strong>cannot</strong> determine the UART&#8217;s FIFO size configuration
by reading specific control register bits (simply because there are no bits left in the control register).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Hardware Flow Control - RTS/CTS</strong></p>
</div>
<div class="paragraph">
<p>UART0 supports optional hardware flow control using the standard CTS (clear to send) and/or RTS (ready to send
/ ready to receive "RTR") signals. Both hardware control flow mechanisms can be enabled individually.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <strong>RTS hardware flow control</strong> is enabled by setting the <em>UART_CTRL_RTS_EN</em> control register flag, the UART
will pull the <code>uart0_rts_o</code> signal low if the UART&#8217;s receiver is ready to receive new data.
As long as this signal is low the connected device can send new data. <code>uart0_rts_o</code> is always LOW if the UART is disabled.
The RTS line is de-asserted (going high) as soon as the start bit of a new incoming char has been
detected.</p>
</li>
<li>
<p>If <strong>CTS hardware flow control</strong> is enabled by setting the <em>UART_CTRL_CTS_EN</em> control register flag, the UART&#8217;s
transmitter will not start sending a new data until the <code>uart0_cts_i</code> signal goes low. During this time, the UART busy flag
<em>UART_CTRL_TX_BUSY</em> remains set. If <code>uart0_cts_i</code> is asserted, no new data transmission will be started by the UART.
The state of the <code>uart0_cts_i</code> signal has no effect on a transmission being already in progress. Application software can check
the current state of the <code>uart0_cts_o</code> input signal via the <em>UART_CTRL_CTS</em> control register flag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Parity Modes</strong></p>
</div>
<div class="paragraph">
<p>An optional parity bit can be added to the data stream if the <em>UART_CTRL_PMODE1</em> flag is set.
When <em>UART_CTRL_PMODE0</em> is zero, the UART operates in "even parity" mode. If this flag is set, the UART operates in "odd parity" mode.
Parity errors in received data are indicated via the <em>UART_DATA_PERR</em> flag in the <code>DATA</code> register. This flag is updated with each new
received character and is cleared by reading the <code>DATA</code> register.</p>
</div>
<div class="paragraph">
<p><strong>UART Interrupts</strong></p>
</div>
<div class="paragraph">
<p>UART0 features two independent interrupt for signaling certain RX and TX conditions. The behavior of these conditions differs
based on the configured FIFO sizes. If the according FIFO size is greater than 1, the <em>UART_CTRL_RX_IRQ</em> and <em>UART_CTRL_TX_IRQ</em>
<code>CTRL</code> flags allow a more fine-grained IRQ configuration. An interrupt can only become pending if the according interrupt
condition is fulfilled and the UART is enabled at all.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <em>UART0_RX_FIFO</em> is exactly 1, the RX interrupt goes pending when data <em>becomes</em> available in the RX FIFO
(&#8594; <em>UART_CTRL_RX_EMPTY</em> clears). <em>UART_CTRL_RX_IRQ</em> is hardwired to <code>0</code> in this case.</p>
</li>
<li>
<p>If <em>UART0_TX_FIFO</em> is exactly 1, the TX interrupt goes pending when at least one entry in the TX FIFO <em>becomes</em> free
(&#8594; <em>UART_CTRL_TX_FULL</em> clears). <em>UART_CTRL_TX_IRQ</em> is hardwired to <code>0</code> in this case.</p>
</li>
<li>
<p>If <em>UART0_RX_FIFO</em> is greater than 1: If <em>UART_CTRL_RX_IRQ</em> is <code>0</code> the RX interrupt goes pending when data <em>becomes</em>
available in the RX FIFO (&#8594; <em>UART_CTRL_RX_EMPTY</em> clears). If <em>UART_CTRL_RX_IRQ</em> is <code>1</code> the RX interrupt becomes pending
the RX FIFO <em>becomes</em> at least half-full (&#8594; <em>UART_CTRL_RX_HALF</em> sets).</p>
</li>
<li>
<p>If <em>UART0_TX_FIFO</em> is greater than 1: If <em>UART_CTRL_TX_IRQ</em> is <code>0</code> the TX interrupt goes pending when at least one entry
in the TX FIFO <em>becomes</em> free (&#8594; <em>UART_CTRL_TX_FULL</em> clears). If <em>UART_CTRL_TX_IRQ</em> is <code>1</code> the TX interrupt goes pending
when the RX FIFO <em>becomes</em> less than half-full (&#8594; <em>UART_CTRL_TX_HALF</em> clears).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <strong>pending RX interrupt</strong> request is cleared by any of the following operations:
* read access to <code>NEORV32_UART0.DATA</code> (for example to read incoming data)
* write access to <code>NEORV32_UART0.CTRL</code>
* disabling the UART module</p>
</div>
<div class="paragraph">
<p>A <strong>pending TX interrupt</strong> request is cleared by any of the following operations:
* write access to <code>NEORV32_UART0.DATA</code> (for example to send more data)
* write access to <code>NEORV32_UART0.CTRL</code>
* disabling the UART module</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A dummy write to to the control register (i.e. <code>NEORV32_UART0.DATA = NEORV32_UART0.DATA</code>)
can be executed to acknowledge any interrupt.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Simulation Mode</strong></p>
</div>
<div class="paragraph">
<p>The default UART0 operation will transmit any data written to the <code>DATA</code> register via the serial TX line at
the defined baud rate via the physical link. To accelerate UART0 output during simulation
(and also to dump large amounts of data) the UART0 features a <em>simulation mode</em>.</p>
</div>
<div class="paragraph">
<p>Simulation mode is enabled by setting the <em>UART_CTRL_SIM_MODE</em> bit in the UART0&#8217;s control register
<code>CTRL</code>. Any other UART0 configuration bits are irrelevant for this mode but UART0 has to be enabled via the
<em>UART_CTRL_EN</em> bit. There will be no physical UART0 transmissions via <code>uart0_txd_o</code> at all when
simulation mode is enabled. Furthermore, no interrupts (RX &amp; TX) will be triggered.</p>
</div>
<div class="paragraph">
<p>When the simulation mode is enabled any data written to <code>DATA[7:0]</code> is
directly output as ASCII char to the simulator console. Additionally, all chars are also stored to a text file
<code>neorv32.uart0.sim_mode.text.out</code> in the simulation home folder.</p>
</div>
<div class="paragraph">
<p>Furthermore, the whole 32-bit word written to <code>DATA[31:0]</code> is stored as plain 8-char hexadecimal value to a
second text file <code>neorv32.uart0.sim_mode.data.out</code> also located in the simulation home folder.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information regarding the simulation-mode of the UART0 can be found in the User Guide
section <a href="https://stnolting.github.io/neorv32/ug/#_simulating_the_processor">Simulating the Processor</a>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. UART0 register map (<code>struct NEORV32_UART0</code>)</caption>
<colgroup>
<col style="width: 13.9534%;">
<col style="width: 16.279%;">
<col style="width: 23.2558%;">
<col style="width: 4.6511%;">
<col style="width: 41.8607%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="21"><p class="tableblock"><code>0xffffffa0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="21"><p class="tableblock"><code>NEORV32_UART0.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:0</code> <em>UART_CTRL_BAUDxx</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bit BAUD value configuration value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code> <em>UART_CTRL_SIM_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable <strong>simulation mode</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code> <em>UART_CTRL_RX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code> <em>UART_CTRL_RX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code> <em>UART_CTRL_RX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code> <em>UART_CTRL_TX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code> <em>UART_CTRL_TX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code> <em>UART_CTRL_TX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code> <em>UART_CTRL_RTS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable RTS hardware flow control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code> <em>UART_CTRL_CTS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable CTS hardware flow control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code> <em>UART_CTRL_PMODE0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">parity bit enable and configuration (<code>00</code>/<code>01</code>= no parity; <code>10</code>=even parity; <code>11</code>=odd parity)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code> <em>UART_CTRL_PMODE1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code> <em>UART_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit baudrate clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code> <em>UART_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code> <em>UART_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code> <em>UART_CTRL_CTS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of UART&#8217;s CTS input signal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>UART_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>UART_CTRL_RX_IRQ</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX IRQ mode: <code>1</code>=FIFO at least half-full; <code>0</code>=FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>UART_CTRL_TX_IRQ</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX IRQ mode: <code>1</code>=FIFO less than half-full; <code>0</code>=FIFO not full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>UART_CTRL_TX_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmitter busy flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>0xffffffa4</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>NEORV32_UART0.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <em>UART_DATA_MSB</em> : <em>UART_DATA_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (8-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>simulation data output</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>UART_DATA_PERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX parity error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>UART_DATA_FERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data frame error (stop bit nt set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>UART_DATA_OVERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data overrun</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>UART_DATA_AVAIL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data available when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_secondary_universal_asynchronous_receiver_and_transmitter_uart1">2.5.12. Secondary Universal Asynchronous Receiver and Transmitter (UART1)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_txd_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter output UART1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rxd_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver input UART1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rts_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_cts_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: TX allowed to send</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_UART1_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement UART1 when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UART1_RX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UART1_TX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The secondary UART (UART1) is functional identical to the primary UART (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>).
Obviously, UART1 has different addresses for the control register (<code>CTRL</code>) and the data register (<code>DATA</code>) - see the register map below.
The register&#8217;s bits/flags use the same bit positions and naming as for the primary UART. The RX and TX interrupts of UART1 are
mapped to different CPU fast interrupt (FIRQ) channels.</p>
</div>
<div class="paragraph">
<p><strong>Simulation Mode</strong></p>
</div>
<div class="paragraph">
<p>The secondary UART (UART1) provides the same simulation options as the primary UART. However,
output data is written to UART1-specific files: <code>neorv32.uart1.sim_mode.text.out</code> is used to store
plain ASCII text and <code>neorv32.uart1.sim_mode.data.out</code> is used to store full 32-bit hexadecimal
data words.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. UART1 register map (<code>struct NEORV32_UART1</code>)</caption>
<colgroup>
<col style="width: 13.9534%;">
<col style="width: 16.279%;">
<col style="width: 23.2558%;">
<col style="width: 4.6511%;">
<col style="width: 41.8607%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="21"><p class="tableblock"><code>0xffffffd0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="21"><p class="tableblock"><code>NEORV32_UART1.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:0</code> <em>UART_CTRL_BAUDxx</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bit BAUD value configuration value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code> <em>UART_CTRL_SIM_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable <strong>simulation mode</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code> <em>UART_CTRL_RX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code> <em>UART_CTRL_RX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code> <em>UART_CTRL_RX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code> <em>UART_CTRL_TX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code> <em>UART_CTRL_TX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code> <em>UART_CTRL_TX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code> <em>UART_CTRL_RTS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable RTS hardware flow control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code> <em>UART_CTRL_CTS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable CTS hardware flow control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code> <em>UART_CTRL_PMODE0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">parity bit enable and configuration (<code>00</code>/<code>01</code>= no parity; <code>10</code>=even parity; <code>11</code>=odd parity)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code> <em>UART_CTRL_PMODE1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code> <em>UART_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit baudrate clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code> <em>UART_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code> <em>UART_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code> <em>UART_CTRL_CTS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of UART&#8217;s CTS input signal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>UART_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>UART_CTRL_RX_IRQ</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX IRQ mode: <code>1</code>=FIFO at least half-full; <code>0</code>=FIFO not empty; hardwired to zero if <em>UART0_RX_FIFO</em> = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>UART_CTRL_TX_IRQ</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX IRQ mode: <code>1</code>=FIFO less than half-full; <code>0</code>=FIFO not full; hardwired to zero if <em>UART0_TX_FIFO</em> = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>UART_CTRL_TX_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmitter busy flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>0xffffffd4</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>NEORV32_UART1.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <em>UART_DATA_MSB</em> : <em>UART_DATA_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (8-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>simulation data output</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>UART_DATA_PERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX parity error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>UART_DATA_FERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data frame error (stop bit nt set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>UART_DATA_OVERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data overrun</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>UART_DATA_AVAIL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data available when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_serial_peripheral_interface_controller_spi">2.5.13. Serial Peripheral Interface Controller (SPI)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sck_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sdo_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sdi_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_csn_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit dedicated chip select (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_SPI_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement SPI controller when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmission done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>SPI is a synchronous serial transmission interface for fast on-board communications.
The NEORV32 SPI transceiver supports 8-, 16-, 24- and 32-bit wide transmissions.
The unit provides 8 dedicated chip select signals via the top entity&#8217;s <code>spi_csn_o</code> signal, which are
directly controlled by the SPI module (no additional GPIO required).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 SPI module only supports <em>host mode</em>. Transmission are initiated only by the processor&#8217;s SPI module
(and not by an external SPI module).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SPI unit is enabled by setting the <em>SPI_CTRL_EN</em> bit in the <code>CTRL</code> control register. No transfer can be initiated
and no interrupt request will be triggered if this bit is cleared. Furthermore, a transfer being in process
can be terminated at any time by clearing this bit.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Changes to the <code>CTRL</code> control register should be made only when the SPI module is idle as they directly effect
transmissions being in-progress.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A transmission can be terminated at any time by disabling the SPI module
by clearing the <em>SPI_CTRL_EN</em> control register bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The data quantity to be transferred within a single transmission is defined via the <em>SPI_CTRL_SIZEx</em> bits.
The SPI module supports 8-bit (<code>00</code>), 16-bit (<code>01</code>), 24-bit (<code>10</code>) and 32-bit (<code>11</code>) transfers.</p>
</div>
<div class="paragraph">
<p>A transmission is started when writing data to the <code>DATA</code> register. The data must be LSB-aligned. So if
the SPI transceiver is configured for less than 32-bit transfers data quantity, the transmit data must be placed
into the lowest 8/16/24 bit of <code>DATA</code>. Vice versa, the received data is also always LSB-aligned. Application
software should only actually process the amount of bits that were configured using <em>SPI_CTRL_SIZEx</em> when
reading <code>DATA</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 SPI module only support MSB-first mode. Data can be reversed before writing <code>DATA</code> (for TX) / after
reading <code>DATA</code> (for RX) to implement LSB-first transmissions. Note that in both cases data in ` DATA` still
needs to be LSB-aligned.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The actual transmission length is left to the user: after asserting chip-select an arbitrary amount of
transmission with arbitrary data quantity (<em>SPI_CTRL_SIZEx</em>) can be made before de-asserting chip-select again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SPI controller features 8 dedicated chip-select lines. These lines are controlled via the control register&#8217;s
<em>SPI_CTRL_CSx</em> bits. When a specific <em>SPI_CTRL_CSx</em> bit is <strong>set</strong>, the according chip-select line <code>spi_csn_o(x)</code>
goes <strong>low</strong> (low-active chip-select lines).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The dedicated SPI chip-select signals can be seen as <em>general purpose</em> outputs. These are intended to control
the accessed device&#8217;s chip-select signal but can also be use for controlling other shift register signals
(like data strobe or output-enables).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>SPI Clock Configuration</strong></p>
</div>
<div class="paragraph">
<p>The SPI module supports all <em>standard SPI clock modes</em> (0, 1, 2, 3), which is via the two control register bits
<em>SPI_CTRL_CPHA</em> and <em>SPI_CTRL_CPOL</em>. The <em>SPI_CTRL_CPHA</em> bit defines the <em>clock phase</em> and the <em>SPI_CTRL_CPOL</em>
bit defines the <em>clock polarity</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/SPI_timing_diagram2.wikimedia.png" alt="SPI timing diagram2.wikimedia">
</div>
<div class="title">Figure 7. SPI clock modes; image from <a href="https://en.wikipedia.org/wiki/File:SPI_timing_diagram2.svg" class="bare">https://en.wikipedia.org/wiki/File:SPI_timing_diagram2.svg</a> (license: (Wikimedia) <a href="https://en.wikipedia.org/wiki/Creative_Commons">Creative Commons</a> <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">Attribution-Share Alike 3.0 Unported</a>)</div>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 15. SPI standard clock modes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">Mode 0</th>
<th class="tableblock halign-center valign-top">Mode 1</th>
<th class="tableblock halign-center valign-top">Mode 2</th>
<th class="tableblock halign-center valign-top">Mode 4</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SPI_CTRL_CPOL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SPI_CTRL_CPHA</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The SPI clock frequency (<code>spi_sck_o</code>) is programmed by the 3-bit <em>SPI_CTRL_PRSCx</em> clock prescaler.
The following prescalers are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 16. SPI prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>SPI_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the <em>SPI_CTRL_PRSCx</em> configuration, the actual SPI clock frequency f<sub>SPI</sub> is derived from the processor&#8217;s
main clock f<sub>main</sub> and is determined by:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SPI</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2 * <code>clock_prescaler</code>)</p>
</div>
<div class="paragraph">
<p>Hence, the maximum SPI clock is f<sub>main</sub> / 4.</p>
</div>
<div class="paragraph">
<p><strong>SPI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The SPI module provides a single interrupt to signal "transmission done" to the CPU. Whenever the SPI
module completes the current transfer operation, the interrupt request is set. A pending interrupt request
is cleared by any of the following operations:
* read or write access to <code>NEORV32_SPI.DATA</code> (for example to trigger a new transmission)
* write access to <code>NEORV32_SPI.CTRL</code>
* disabling the SPI module</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A dummy read from <code>NEORV32_SPI.DATA</code> can be executed to acknowledge the interrupt without affecting data
or the state of the SPI module.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. SPI register map (<code>struct NEORV32_SPI</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="18"><p class="tableblock"><code>0xffffffa8</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="18"><p class="tableblock"><code>NEORV32_SPI.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>SPI_CTRL_CS0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="8"><p class="tableblock">Direct chip-select 0..7; setting <code>spi_csn_o(x)</code> low when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>SPI_CTRL_CS1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>SPI_CTRL_CS2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>SPI_CTRL_CS3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <em>SPI_CTRL_CS4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code> <em>SPI_CTRL_CS5</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code> <em>SPI_CTRL_CS6</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code> <em>SPI_CTRL_CS7</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code> <em>SPI_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9</code> <em>SPI_CTRL_CPHA</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock phase (<code>0</code>=sample RX on rising edge &amp; update TX on falling edge; <code>1</code>=sample RX on falling edge &amp; update TX on rising edge)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code> <em>SPI_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code> <em>SPI_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code> <em>SPI_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code> <em>SPI_CTRL_SIZE0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">transfer size (<code>00</code>=8-bit, <code>01</code>=16-bit, <code>10</code>=24-bit, <code>11</code>=32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code> <em>SPI_CTRL_SIZE1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code> <em>SPI_CTRL_CPOL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock polarity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code> .. <code>30</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>SPI_CTRL_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmission in progress when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffac</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SPI.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data, LSB-aligned</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_two_wire_serial_interface_controller_twi">2.5.14. Two-Wire Serial Interface Controller (TWI)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit bi-directional serial data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit bi-directional serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_TWI_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TWI controller when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmission done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The two wire interface - also called "I²C" - is a quite famous interface for connecting several on-board
components. Since this interface only needs two signals (the serial data line <code>twi_sda_io</code> and the serial
clock line <code>twi_scl_io</code>) - despite of the number of connected devices - it allows easy interconnections of
several peripheral nodes.</p>
</div>
<div class="paragraph">
<p>The NEORV32 TWI implements a <strong>TWI controller</strong>. It supports "clock so a slow peripheral can halt
the transmission by pulling the SCL line low. Currently, <strong>no multi-controller
support</strong> is available. Also, the NEORV32 TWI unit cannot operate in peripheral mode.</p>
</div>
<div class="paragraph">
<p>The TWI is enabled via the <em>TWI_CTRL_EN</em> bit in the <code>CTRL</code> control register. The user program can start / stop a
transmission by issuing a START or STOP condition. These conditions are generated by setting the
according bits (<em>TWI_CTRL_START</em> or <em>TWI_CTRL_STOP</em>) in the control register.</p>
</div>
<div class="paragraph">
<p>Data is send by writing a byte to the <code>DATA</code> register. Received data can also be read from this
register. The TWI controller is busy (transmitting data or performing a START or STOP condition) as long as the
<em>TWI_CTRL_BUSY</em> bit in the control register is set.</p>
</div>
<div class="paragraph">
<p>An accessed peripheral has to acknowledge each transferred byte. When the <em>TWI_CTRL_ACK</em> bit is set after a
completed transmission, the accessed peripheral has send an acknowledge. If it is cleared after a
transmission, the peripheral has send a not-acknowledge (NACK). The NEORV32 TWI controller can also
send an ACK by itself ("controller acknowledge <em>MACK</em>") after a transmission by pulling SDA low during the
ACK time slot. Set the <em>TWI_CTRL_MACK</em> bit to activate this feature. If this bit is cleared, the ACK/NACK of the
peripheral is sampled in this time slot instead (normal mode).</p>
</div>
<div class="paragraph">
<p>In summary, the following independent TWI operations can be triggered by the application program:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>send START condition (also as REPEATED START condition)</p>
</li>
<li>
<p>send STOP condition</p>
</li>
<li>
<p>send (at least) one byte while also sampling one byte from the bus</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A transmission can be terminated at any time by disabling the TWI module
by clearing the <em>TWI_CTRL_EN</em> control register bit.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The serial clock (SCL) and the serial data (SDA) lines can only be actively driven low by the
controller. Hence, external pull-up resistors are required for these lines.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The TWI clock frequency is defined via the 3-bit <em>TWI_CTRL_PRSCx</em> clock prescaler. The following prescalers
are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 18. TWI prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>TWI_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the <em>TWI_CTRL_PRSCx</em> configuration, the actual TWI clock frequency f<sub>SCL</sub> is derived from the processor main clock f<sub>main</sub> and is determined by:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SCL</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (4 * <code>clock_prescaler</code>)</p>
</div>
<div class="paragraph">
<p><strong>TWI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The SPI module provides a single interrupt to signal "operation done" to the CPU. Whenever the TWI
module completes the current operation (generate stop condition, generate start conditions or transfer byte),
the interrupt request is set. A pending interrupt request is cleared is cleared by any of
the following operations:
* read or write access to <code>NEORV32_TWI.DATA</code> (for example to trigger a new transmission)
* write access to <code>NEORV32_TWI.CTRL</code>
* disabling the TWI module</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A dummy read from <code>NEORV32_TWI.DATA</code> can be executed to acknowledge the interrupt without affecting data
or the state of the TWI module.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. TWI register map (<code>struct NEORV32_TWI</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="9"><p class="tableblock"><code>0xffffffb0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="9"><p class="tableblock"><code>NEORV32_TWI.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>TWI_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>TWI_CTRL_START</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate START condition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>TWI_CTRL_STOP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate STOP condition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>TWI_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <em>TWI_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code> <em>TWI_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code> <em>TWI_CTRL_MACK</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate controller ACK for each transmission ("MACK")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>TWI_CTRL_ACK</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACK received when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>TWI_CTRL_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer/START/STOP in progress when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffb4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_TWI.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <em>TWI_DATA_MSB</em> : TWI_DATA_LSB_</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_pulse_width_modulation_controller_pwm">2.5.15. Pulse-Width Modulation Controller (PWM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pwm_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">up to 60 PWM output channels (1-bit per channel)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_PWM_NUM_CH</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of PWM channels to implement (0..60)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The PWM controller implements a pulse-width modulation controller with up to 60 independent channels and 8-
bit resolution per channel. The actual number of implemented channels is defined by the <em>IO_PWM_NUM_CH</em> generic.
Setting this generic to zero will completely remove the PWM controller from the design.</p>
</div>
<div class="paragraph">
<p>The PWM controller is based on an 8-bit base counter with a programmable threshold comparators for each channel
that defines the actual duty cycle. The controller can be used to drive fancy RGB-LEDs with 24-
bit true color, to dim LCD back-lights or even for "analog" control. An external integrator (RC low-pass filter)
can be used to smooth the generated "analog" signals.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The PWM controller is activated by setting the <em>PWM_CTRL_EN</em> bit in the module&#8217;s control register <code>CTRL</code>. When this
bit is cleared, the unit is reset and all PWM output channels are set to zero.
The 8-bit duty cycle for each channel, which represents the channel&#8217;s "intensity", is defined via an 8-bit value. The module
provides up to 15 duty cycle registers <code>DUTY[0]</code> to <code>DUTY[14]</code> (depending on the number of implemented channels).
Each register contains the duty cycle configuration for 4 consecutive channels. For example, the duty cycle of channel 0
is defined via bits 7:0 in <code>DUTY[0]</code>. The duty cycle of channel 2 is defined via bits 15:0 in <code>DUTY[0]</code>.
Channel 4&#8217;s duty cycle is defined via bits 7:0 in <code>DUTY[1]</code> and so on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Regardless of the configuration of <em>IO_PWM_NUM_CH</em> all module registers can be accessed without raising an exception.
Software can discover the number of available channels by writing 0xff to all duty cycle configuration bytes and
reading those values back. The duty-cycle of channels that were not implemented always reads as zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Based on the configured duty cycle the according intensity of the channel can be computed by the following formula:</p>
</div>
<div class="paragraph">
<p><em><strong>Intensity<sub>x</sub></strong></em> = <code>DUTY[y](i*8+7 downto i*8)</code> / (2<sup>8</sup>)</p>
</div>
<div class="paragraph">
<p>The base frequency of the generated PWM signals is defined by the PWM core clock. This clock is derived
from the main processor clock and divided by a prescaler via the 3-bit PWM_CTRL_PRSCx in the unit&#8217;s control
register. The following pre-scalers are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 20. PWM prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>PWM_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The resulting PWM base frequency is defined by:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>PWM</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2<sup>8</sup> * <code>clock_prescaler</code>)</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. PWM register map (<code>struct neorv32_pwm_t</code>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 25%;">
<col style="width: 8.3333%;">
<col style="width: 33.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffe80</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_PWM.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>PWM_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>PWM_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>PWM_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>PWM_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffe84</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_PWM.DUTY[0]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffebc</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_PWM.DUTY[14]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 56</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 57</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 58</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 59</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_true_random_number_generator_trng">2.5.16. True Random-Number Generator (TRNG)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_TRNG_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TRNG when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 true random number generator provides <em>physical true random numbers</em> for your application.
Instead of using a pseudo RNG like a LFSR, the TRNG of the processor uses a simple, straight-forward ring
oscillator as physical entropy source. Hence, voltage and thermal fluctuations are used to provide true
physical random data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The TRNG features a platform independent architecture without FPGA-specific primitives, macros or
attributes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Architecture</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 TRNG is based on simple ring oscillators, which are implemented as an inverter chain with
an odd number of inverters. A <strong>latch</strong> is used to decouple each individual inverter. Basically, this architecture
is some king of asynchronous LFSR.</p>
</div>
<div class="paragraph">
<p>The output of several ring oscillators are synchronized using two registers and are XORed together. The
resulting output is de-biased using a von-Neumann randomness extractor. This de-biased output is further
processed by a simple 8-bit Fibonacci LFSR to improve whitening. After at least 8 clock cycles the state of
the LFSR is sampled and provided as final data output.</p>
</div>
<div class="paragraph">
<p>To prevent the synthesis tool from doing logic optimization and thus, removing all but one inverter, the
TRNG uses simple latches to decouple an inverter and its actual output. The latches are reset when the
TRNG is disabled and are enabled one by one by a "real" shift register when the TRNG is activated. This
construct can be synthesized for any FPGA platform. Thus, the NEORV32 TRNG provides a platform
independent architecture.</p>
</div>
<div class="paragraph">
<p><strong>TRNG Configuration</strong></p>
</div>
<div class="paragraph">
<p>The TRNG uses several ring-oscillators, where the next oscillator provides a slightly longer chain (more
inverters) than the one before. This increment is constant for all implemented oscillators. This setup can be
customized by modifying the "Advanced Configuration" constants in the TRNG&#8217;s VHDL file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>num_roscs_c</code> constant defines the total number of ring oscillators in the system. num_inv_start_c
defines the number of inverters used by the first ring oscillators (has to be an odd number). Each additional
ring oscillator provides <code>num_inv_inc_c</code> more inverters that the one before (has to be an even number).</p>
</li>
<li>
<p>The LFSR-based post-processing can be deactivated using the <code>lfsr_en_c</code> constant. The polynomial tap
mask of the LFSR can be customized using <code>lfsr_taps_c</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Using the TRNG</strong></p>
</div>
<div class="paragraph">
<p>The TRNG features a single register for status and data access. When the <em>TRNG_CTRL_EN</em> control register (<code>CTRL</code>)
bit is set, the TRNG is enabled and starts operation. As soon as the <em>TRNG_CTRL_VALID</em> bit is set, the currently
sampled 8-bit random data byte can be obtained from the lowest 8 bits of the <code>CTRL</code> register
(<em>TRNG_CTRL_DATA_MSB</em> : <em>TRNG_CTRL_DATA_LSB</em>). The <em>TRNG_CTRL_VALID</em> bit is automatically cleared
when reading the control register.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The TRNG needs at least 8 clock cycles to generate a new random byte. During this sampling time
the current output random data is kept stable in the output register until a valid sampling of the new byte has
completed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Randomness "Quality"
I have not verified the quality of the generated random numbers (for example using NIST test suites). The
quality is highly effected by the actual configuration of the TRNG and the resulting FPGA mapping/routing.
However, generating larger histograms of the generated random number shows an equal distribution (binary
average of the random numbers = 127). A simple evaluation test/demo program can be found in
<code>sw/example/demo_trng</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. TRNG register map (<code>struct NEORV32_TRNG</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code>0xffffffb8</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code>NEORV32_TRNG.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <em>TRNG_CTRL_DATA_MSB</em> : <em>TRNG_CTRL_DATA_MSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit random data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>TRNG_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>TRNG_CTRL_VALID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random data output is valid when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_custom_functions_subsystem_cfs">2.5.17. Custom Functions Subsystem (CFS)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gfs.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gfs.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gfs.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_in_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom input conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_out_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom output conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_CFS_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement CFS when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_CFS_CONFIG</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom generic conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_CFS_IN_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of <code>cfs_in_i</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_CFS_OUT_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of <code>cfs_out_o</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CFS interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The custom functions subsystem is meant for implementing application-specific user-defined co-processors
IP <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> blocks. The CFS provides up to 32x 32-bit memory-mapped
registers (<code>REG</code>, see register map table below) that can be accessed by the CPU via normal load/store operations.
The actual functionality of these register has to be defined by the hardware designer. Furthermore, the CFS
provides two IO conduits to implement custom module- or chip-external interfaces.</p>
</div>
<div class="paragraph">
<p>In contrast to connecting custom hardware accelerators via external memory interfaces (like SPI or the processor&#8217;s
external bus interface), the CFS provide a convenient, low-latency and tightly-coupled extension and
customization option.</p>
</div>
<div class="paragraph">
<p>Just like any other externally-connected IP, logic implemented within the custom functions subsystem can operate
<em>independently</em> of the CPU providing true parallel processing capabilities. Potential use cases might include
dedicated hardware accelerators for en-/decryption (AES), signal processing (FFT) or AI applications
(CNNs) as well as custom IO systems like fast memory interfaces (DDR) and mass storage (SDIO), networking (CAN)
or real-time data transport (I2S).</p>
</div>
<div class="paragraph">
<p>Take a look at the template CFS VHDL source file (<code>rtl/core/neorv32_cfs.vhd</code>). The file is highly
commented to illustrate all aspects that are relevant for implementing custom CFS-based co-processor designs.</p>
</div>
<div class="paragraph">
<p><strong>CFS Software Access</strong></p>
</div>
<div class="paragraph">
<p>The CFS memory-mapped registers can be accessed by software using the provided C-language aliases (see
register map table below). Note that all interface registers provide 32-bit access data of type <code>uint32_t</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// C-code CFS usage example
NEORV32_CFS.REG[0] = (uint32_t)some_data_array(i); // write to CFS register 0
uint32_t temp = NEORV32_CFS.REG[20]; // read from CFS register 20</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CFS Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The CFS provides a single high-level-triggered interrupt request signal mapped to the CPU&#8217;s fast interrupt channel 1.
Once set, the interrupt has to stay asserted until explicitly acknowledged by the software (for example by
writing to a specific CFS register). See section <a href="#_processor_interrupts">Processor Interrupts</a> for more information.</p>
</div>
<div class="paragraph">
<p><strong>CFS Configuration Generic</strong></p>
</div>
<div class="paragraph">
<p>By default, the CFS provides a single 32-bit <code>std_(u)logic_vector</code> configuration generic <em>IO_CFS_CONFIG</em>
that is available in the processor&#8217;s top entity. This generic can be used to pass custom configuration options
from the top entity directly down to the CFS. The actual definition of the generics and it&#8217;S usage inside the
CFS is left to the hardware designer.</p>
</div>
<div class="paragraph">
<p><strong>CFS Custom IOs</strong></p>
</div>
<div class="paragraph">
<p>By default, the CFS also provides two unidirectional input and output conduits <code>cfs_in_i</code> and <code>cfs_out_o</code>.
These signals are directly propagated to the processor&#8217;s top entity. These conduits can be used to implement
application-specific interfaces like memory or network connections. The actual use case of these signals
has to be defined by the hardware designer.</p>
</div>
<div class="paragraph">
<p>The size of the input signal conduit <code>cfs_in_i</code> is defined via the top&#8217;s <em>IO_CFS_IN_SIZE</em> configuration
generic (default = 32-bit). The size of the output signal conduit <code>cfs_out_o</code> is defined via the top&#8217;s
<em>IO_CFS_OUT_SIZE</em> configuration generic (default = 32-bit). If the custom function subsystem is not implemented
(<em>IO_CFS_EN</em> = false) the <code>cfs_out_o</code> signal is tied to all-zero.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. CFS register map (<code>struct NEORV32_CFS</code>)</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 17.8571%;">
<col style="width: 7.1428%;">
<col style="width: 10.7142%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffe00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_CFS.REG[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS interface register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffe04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_CFS.REG[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS interface register 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffe78</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_CFS.REG[30]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS interface register 30</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffe7c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_CFS.REG[31]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS interface register 31</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_smart_led_interface_neoled">2.5.18. Smart LED Interface (NEOLED)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neoled_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_NEOLED_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement NEOLED when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_NEOLED_TX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (1..32k, has to be a power of two)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED module provides a dedicated interface for "smart RGB LEDs" like the WS2812 or WS2811.
These LEDs provide a single interface wire that uses an asynchronous serial protocol for transmitting color
data. Basically, data is transferred via LED-internal shift registers, which allows to cascade an unlimited
number of smart LEDs. The protocol provides a RESET command to strobe the transmitted data into the
LED PWM driver registers after data has shifted throughout all LEDs in a chain.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEOLED interface is compatible to the "Adafruit Industries NeoPixel" products, which feature
WS2812 (or older WS2811) smart LEDs (see link:https://learn.adafruit.com/adafruit-neopixel-uberguide).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The interface provides a single 1-bit output <code>neoled_o</code> to drive an arbitrary number of cascaded LEDs. Since the
NEOLED module provides 24-bit and 32-bit operating modes, a mixed setup with RGB LEDs (24-bit color)
and RGBW LEDs (32-bit color including a dedicated white LED chip) is possible.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation - NEOLED Module</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED modules provides two accessible interface registers: the control register <code>CTRL</code> and the
TX data register <code>DATA</code>. The NEOLED module is globally enabled via the control register&#8217;s
<em>NEOLED_CTRL_EN</em> bit. Clearing this bit will terminate any current operation, clear the TX buffer, reset the module
and set the <code>neoled_o</code> output to zero. The precise timing (implementing the <strong>WS2812</strong> protocol) and transmission
mode are fully programmable via the <code>CTRL</code> register to provide maximum flexibility.</p>
</div>
<div class="paragraph">
<p><strong>RGB / RGBW Configuration</strong></p>
</div>
<div class="paragraph">
<p>NeoPixel are available in two "color" version: LEDs with three chips providing RGB color and LEDs with
four chips providing RGB color plus a dedicated white LED chip (= RGBW). Since the intensity of every
LED chip is defined via an 8-bit value the RGB LEDs require a frame of 24-bit per module and the RGBW
LEDs require a frame of 32-bit per module.</p>
</div>
<div class="paragraph">
<p>The data transfer quantity of the NEOLED module can be configured via the <em>NEOLED_MODE_EN</em> control
register bit. If this bit is cleared, the NEOLED interface operates in 24-bit mode and will transmit bits <code>23:0</code> of
the data written to <code>DATA</code> to the LEDs. If <em>NEOLED_MODE_EN</em> is set, the NEOLED interface operates in 32-bit
mode and will transmit bits <code>31:0</code> of the data written to <code>DATA</code> to the LEDs.</p>
</div>
<div class="paragraph">
<p>The mode bit can be configured before writing each new data word in order to support
an arbitrary setup of RGB and RGBW LEDs.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation - Protocol</strong></p>
</div>
<div class="paragraph">
<p>The interface of the WS2812 LEDs uses an 800kHz carrier signal. Data is transmitted in a serial manner
starting with LSB-first. The intensity for each R, G &amp; B (&amp; W) LED chip (= color code) is defined via an 8-bit
value. The actual data bits are transferred by modifying the duty cycle of the signal (the timings for the
WS2812 are shown below). A RESET command is "send" by pulling the data line LOW for at least 50μs.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neopixel.png" alt="neopixel">
</div>
<div class="title">Figure 8. WS2812 bit-level protocol - taken from the "Adafruit NeoPixel Überguide"</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. WS2812 interface timing</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>total</sub> (T<sub>carrier</sub>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25μs +/- 300ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">period for a single bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>0H</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4μs +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-time for sending a <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>0L</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8μs +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>1H</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.85μs +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-time for sending a <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>1L</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.45μs +/- 150 ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Above 50μs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a RESET command</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Timing Configuration</strong></p>
</div>
<div class="paragraph">
<p>The basic carrier frequency (800kHz for the WS2812 LEDs) is configured via a 3-bit main clock prescaler (<em>NEOLED_CTRL_PRSCx</em>, see table below)
that scales the main processor clock f<sub>main</sub> and a 5-bit cycle multiplier <em>NEOLED_CTRL_T_TOT_x</em>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 25. NEOLED prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>NEOLED_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The duty-cycles (or more precisely: the high- and low-times for sending either a '1' bit or a '0' bit) are
defined via the 5-bit <em>NEOLED_CTRL_T_ONE_H_x</em> and <em>NEOLED_CTRL_T_ZERO_H_x</em> values, respectively. These programmable
timing constants allow to adapt the interface for a wide variety of smart LED protocol (for example WS2812 vs.
WS2811).</p>
</div>
<div class="paragraph">
<p><strong>Timing Configuration - Example (WS2812)</strong></p>
</div>
<div class="paragraph">
<p>Generate the base clock f<sub>TX</sub> for the NEOLED TX engine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>processor clock f<sub>main</sub> = 100 MHz</p>
</li>
<li>
<p><em>NEOLED_CTRL_PRSCx</em> = <code>0b001</code> = f<sub>main</sub> / 4</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em><strong>f<sub>TX</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / <code>clock_prescaler</code> = 100MHz / 4 = 25MHz</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>TX</sub></strong></em> = 1 / <em><strong>f<sub>TX</sub></strong></em> = 40ns</p>
</div>
<div class="paragraph">
<p>Generate carrier period (T<sub>carrier</sub>) and <strong>high-times</strong> (duty cycle) for sending <code>0</code> (T<sub>0H</sub>) and <code>1</code> (T<sub>1H</sub>) bits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>NEOLED_CTRL_T_TOT</em> = <code>0b11110</code> (= decimal 30)</p>
</li>
<li>
<p><em>NEOLED_CTRL_T_ZERO_H</em> = <code>0b01010</code> (= decimal 10)</p>
</li>
<li>
<p><em>NEOLED_CTRL_T_ONE_H</em> = <code>0b10100</code> (= decimal 20)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em><strong>T<sub>carrier</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <em>NEOLED_CTRL_T_TOT</em> = 40ns * 30 = 1.4µs</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>0H</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <em>NEOLED_CTRL_T_ZERO_H</em> = 40ns * 10 = 0.4µs</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>1H</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <em>NEOLED_CTRL_T_ONE_H</em> = 40ns * 20 = 0.8µs</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The NEOLED SW driver library (<code>neorv32_neoled.h</code>) provides a simplified configuration
function that configures all timing parameters for driving WS2812 LEDs based on the processor
clock frequency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>TX Data FIFO</strong></p>
</div>
<div class="paragraph">
<p>The interface features a TX data buffer (a FIFO) to allow more CPU-independent operation. The buffer depth
is configured via the <em>IO_NEOLED_TX_FIFO</em> top generic (default = 1 entry).
The FIFO size configuration can be read via the <em>NEOLED_CTRL_BUFS_x</em>
control register bits, which result log2(<em>IO_NEOLED_TX_FIFO</em>).</p>
</div>
<div class="paragraph">
<p>When writing data to the <code>DATA</code> register the data is automatically written to the TX buffer. Whenever
data is available in the buffer the serial transmission engine will take it and transmit it to the LEDs.
The data transfer size (<em>NEOLED_MODE_EN</em>) can be modified at every time since this control register bit is also buffered
in the FIFO. This allows to arbitrarily mixing RGB and RGBW LEDs in the chain.</p>
</div>
<div class="paragraph">
<p>Software can check the FIFO fill level via the control register&#8217;s <em>NEOLED_CTRL_TX_EMPTY</em>, <em>NEOLED_CTRL_TX_HALF</em>
and <em>NEOLED_CTRL_TX_FULL</em> flags. The <em>NEOLED_CTRL_TX_BUSY</em> flags provides additional information if the the TX unit is
still busy sending data.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please note that the timing configurations (<em>NEOLED_CTRL_PRSCx</em>, <em>NEOLED_CTRL_T_TOT_x</em>,
<em>NEOLED_CTRL_T_ONE_H_x</em> and <em>NEOLED_CTRL_T_ZERO_H_x</em>) are <strong>NOT</strong> stored to the buffer. Changing
these value while the buffer is not empty or the TX engine is still busy will cause data corruption.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Strobe Command ("RESET") **</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>According to the WS2812 specs the data written to the LED&#8217;s shift registers is strobed to the actual PWM driver
registers when the data line is low for 50μs ("RESET" command, see table above). This can be implemented
using busy-wait for at least 50μs. Obviously, this concept wastes a lot of processing power.</p>
</div>
<div class="paragraph">
<p>To circumvent this, the NEOLED module provides an option to automatically issue an idle time for creating the RESET
command. If the <em>NEOLED_CTRL_STROBE</em> control register bit is set, <em>all</em> data written to the data FIFO (via <code>DATA</code>,
the actually written data is irrelevant) will trigger an idle phase (<code>neoled_o</code> = zero) of 127 periods (= <em><strong>T<sub>carrier</sub></strong></em>).
This idle time will cause the LEDs to strobe the color data into the PWM driver registers.</p>
</div>
<div class="paragraph">
<p>Since the <em>NEOLED_CTRL_STROBE</em> flag is also buffered in the TX buffer, the RESET command is treated just as another
data word being written to the TX buffer making busy wait concepts obsolete and allowing maximum refresh rates.</p>
</div>
<div class="paragraph">
<p><strong>NEOLED Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED modules features a single interrupt that becomes pending based on the current TX buffer fill level.
The interrupt can only become pending if the NEOLED module is enabled. The specific interrupt condition
is configured via the <em>NEOLED_CTRL_IRQ_CONF</em> bit in the unit&#8217;s control register.</p>
</div>
<div class="paragraph">
<p>If <em>NEOLED_CTRL_IRQ_CONF</em> is cleared, an interrupt is generated whenever the TX FIFO <em>becomes</em> less than half-full.
In this case software can write up to <em>IO_NEOLED_TX_FIFO</em>/2 new data words to <code>DATA</code> without checking the FIFO
status flags. If <em>NEOLED_CTRL_IRQ_CONF</em> is set, an interrupt is generated whenever the TX FIFO <em>becomes</em> empty.</p>
</div>
<div class="paragraph">
<p>A pending interrupt request is cleared is cleared by any of the following operations:
* write access to <code>NEORV32_NEOLED.DATA</code> (for example to send more LED data)
* write access to <code>NEORV32_NEOLED.CTRL</code>
* disabling the NEOLED module</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>NEOLED_CTRL_IRQ_CONF</em> is hardwired to one if <em>IO_NEOLED_TX_FIFO</em> = 1 (&#8594; IRQ if FIFO is empty).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the FIFO is configured to contain only a single entry (<em>IO_NEOLED_TX_FIFO</em> = 1) the interrupt
will become pending if the FIFO (which is just a single register providing simple <em>double-buffering</em>) is empty.</p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. NEOLED register map (<code>struct NEORV32_NEOLED</code>)</caption>
<colgroup>
<col style="width: 13.7931%;">
<col style="width: 17.2413%;">
<col style="width: 31.0344%;">
<col style="width: 6.8965%;">
<col style="width: 31.0347%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="30"><p class="tableblock"><code>0xffffffd8</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="30"><p class="tableblock"><code>NEORV32_NEOLED.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>NEOLED_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>NEOLED_CTRL_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data transfer size; <code>0</code>=24-bit; <code>1</code>=32-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>NEOLED_CTRL_STROBE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>=send normal color data; <code>1</code>=send RESET command on data write access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>NEOLED_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler, bit 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <em>NEOLED_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler, bit 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code> <em>NEOLED_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler, bit 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code> <em>NEOLED_CTRL_BUFS0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">4-bit log2(<em>IO_NEOLED_TX_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code> <em>NEOLED_CTRL_BUFS1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code> <em>NEOLED_CTRL_BUFS2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9</code> <em>NEOLED_CTRL_BUFS3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code> <em>NEOLED_CTRL_T_TOT_0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">5-bit pulse clock ticks per total single-bit period (T<sub>total</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code> <em>NEOLED_CTRL_T_TOT_1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code> <em>NEOLED_CTRL_T_TOT_2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code> <em>NEOLED_CTRL_T_TOT_3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code> <em>NEOLED_CTRL_T_TOT_4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code> <em>NEOLED_CTRL_T_ZERO_H_0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">5-bit pulse clock ticks per high-time for sending a zero-bit (T<sub>0H</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code> <em>NEOLED_CTRL_T_ZERO_H_1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code> <em>NEOLED_CTRL_T_ZERO_H_2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code> <em>NEOLED_CTRL_T_ZERO_H_3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code> <em>NEOLED_CTRL_T_ZERO_H_4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code> <em>NEOLED_CTRL_T_ONE_H_0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">5-bit pulse clock ticks per high-time for sending a one-bit (T<sub>1H</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code> <em>NEOLED_CTRL_T_ONE_H_1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code> <em>NEOLED_CTRL_T_ONE_H_2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code> <em>NEOLED_CTRL_T_ONE_H_3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code> <em>NEOLED_CTRL_T_ONE_H_4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code> <em>NEOLED_CTRL_IRQ_CONF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO interrupt configuration: <code>0</code>=IRQ if FIFO is less than half-full, <code>1</code>=IRQ if FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>NEOLED_CTRL_TX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>NEOLED_CTRL_TX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is <em>at least</em> half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>NEOLED_CTRL_TX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>NEOLED_CTRL_TX_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX serial engine is busy when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffdc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_NEOLED.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code> / <code>23:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data (32-/24-bit)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_external_interrupt_controller_xirq">2.5.19. External Interrupt Controller (XIRQ)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xirq_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ input (up to 32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XIRQ_NUM_CH</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of IRQs to implement (0..32)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XIRQ_TRIGGER_TYPE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ trigger type configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XIRQ_TRIGGER_POLARITY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ trigger polarity configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The eXternal interrupt controller provides a simple mechanism to implement up to 32 processor-external interrupt
request signals. The external IRQ requests are prioritized, queued and signaled to the CPU via a
single <em>CPU fast interrupt request</em>.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The XIRQ provides up to 32 interrupt <em>channels</em> (configured via the <em>XIRQ_NUM_CH</em> generic). Each bit in the <code>xirq_i</code>
input signal vector represents one interrupt channel. An interrupt channel is enabled by setting the according bit in the
interrupt enable register <code>IER</code>.</p>
</div>
<div class="paragraph">
<p>If the configured trigger (see below) of an enabled channel fires, the request is stored into an internal buffer.
This buffer is available via the interrupt pending register <code>IPR</code>. A <code>1</code> in this register indicates that the
corresponding interrupt channel has fired but has not yet been serviced (so it is pending). An interrupt channel can
become pending if the according <code>IER</code> bit is set. Pending IRQs can be cleared by writing <code>0</code> to the according <code>IPR</code>
bit. As soon as there is a least one pending interrupt in the buffer, an interrupt request is send to the CPU.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A disabled interrupt channel can still be pending if it has been triggered before clearing the according <code>IER</code> bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The CPU can determine active external interrupt request either by checking the bits in the <code>IPR</code> register, which show all
pending interrupt channels, or by reading the interrupt source register <code>SCR</code>.
This register provides a 5-bit wide ID (0..31) that shows the interrupt request with <em>highest priority</em>.
Interrupt channel <code>xirq_i(0)</code> has highest priority and <code>xirq_i(<em>XIRQ_NUM_CH</em>-1)</code> has lowest priority.
This priority assignment is fixed and cannot be altered by software.
The CPU can use the ID from <code>SCR</code> to service IRQ according to their priority. To acknowledge the according
interrupt the CPU can write <code>1 &lt;&lt; SCR</code> to <code>IPR</code>.</p>
</div>
<div class="paragraph">
<p>In order to clear a pending FIRQ interrupt from the external interrupt controller, the CPU has to write <em>any</em>
value to the interrupt source register <code>SRC</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An interrupt handler should clear the interrupt pending bit that caused the interrupt first before
acknowledging the interrupt by writing the <code>SCR</code> register.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>IRQ Trigger Configuration</strong></p>
</div>
<div class="paragraph">
<p>The controller does not provide a configuration option to define the IRQ triggers <em>during runtime</em>. Instead, two
generics are provided to configure the trigger of each interrupt channel before synthesis: the <em>XIRQ_TRIGGER_TYPE</em>
and <em>XIRQ_TRIGGER_POLARITY</em> generic. Both generics are 32 bit wide representing one bit per interrupt channel. If
less than 32 interrupt channels are implemented the remaining configuration bits are ignored.</p>
</div>
<div class="paragraph">
<p><em>XIRQ_TRIGGER_TYPE</em> is used to define the general trigger type. This can be either <em>level-triggered</em> (<code>0</code>) or
<em>edge-triggered</em> (<code>1</code>). <em>XIRQ_TRIGGER_POLARITY</em> is used to configure the polarity of the trigger: a <code>0</code> defines
low-level or falling-edge and a <code>1</code> defines high-level or rising-edge.</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Example trigger configuration: channel 0 for rising-edge, IRQ channels 1 to 31 for high-level</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">XIRQ_TRIGGER_TYPE     =&gt; x"00000001";
XIRQ_TRIGGER_POLARITY =&gt; x"ffffffff";</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. XIRQ register map (<code>struct NEORV32_XIRQ</code>)</caption>
<colgroup>
<col style="width: 14.8148%;">
<col style="width: 18.5185%;">
<col style="width: 7.4074%;">
<col style="width: 7.4074%;">
<col style="width: 51.8519%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_XIRQ.IER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt enable register (one bit per channel, LSB-aligned)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff84</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_XIRQ.IPR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt pending register (one bit per channel, LSB-aligned); writing 0 to a bit clears according pending interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff88</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_XIRQ.SCR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>4:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel id (0..31) of firing IRQ (prioritized!); writing <em>any</em> value will acknowledge the current interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff8c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_general_purpose_timer_gptmr">2.5.20. General Purpose Timer (GPTMR)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_GPTMR_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement timer when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmission done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The general purpose timer module provides a simple yet universal 32-bit timer. The timer is implemented if
<em>IO_GPTMR_EN</em> top generic is set <em>true</em>. It provides a 32-bit counter register (<code>COUNT</code>) and a 32-bit threshold
register (<code>THRES</code>). An interrupt is generated whenever the value of the counter registers matches the one from
threshold register.</p>
</div>
<div class="paragraph">
<p>The timer is enabled by setting the <em>GPTMR_CTRL_EN</em> bit in the device&#8217;s control register <code>CTRL</code>. The <code>COUNT</code>
register will start incrementing at a programmable rate, which scales the main processor clock. The
pre-scaler value is configured via the three <em>GPTMR_CTRL_PRSCx</em> control register bits:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 28. GPTMR prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>GPTMR_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The timer provides two operation modes that are configured by the <em>GPTMR_CTRL_MODE</em> control register bit:
if <em>GPTMR_CTRL_MODE</em> is cleared (<code>0</code>) the timer operates in <em>single-shot mode</em>. As soon as <code>COUNT</code> matches
<code>THRES</code> an interrupt request is generated and the timer stops operation (i.e. it stops incrementing). If
<em>GPTMR_CTRL_MODE</em> is set (<code>1</code>) the timer operates in <em>continuous mode</em>. When <code>COUNT</code> matches <code>THRES</code> an interrupt
request is generated and <code>COUNT</code> is automatically reset to all-zero before continuing to increment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Disabling the timer will not clear the <code>COUNT</code> register. However, it can be manually reset at any time by
writing zero to it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Timer Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The timer interrupt gets pending when the timer is enabled and <code>COUNT</code> matches <code>THRES</code>. The interrupt
request is indicated via the <em>GPTMR_CTRL_ALARM</em> control register bit. This bit as well as the actual
interrupt keeps pending until the bit is explicitly cleared by application software or if the
timer is disabled.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. GPTMR register map (<code>struct NEORV32_GPTMR</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>0xffffff60</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>NEORV32_GPTMR.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>GPTMR_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timer enable flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>GPTMR_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>GPTMR_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>GPTMR_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <em>GPTMR_CTRL_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter mode: <code>0</code>=single-shot, <code>1</code>=continuous</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code> <em>GPTMR_CTRL_ALARM</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pending interrupt/alarm, cleared by setting bit to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff64</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPTMR.THRES</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threshold value register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff68</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPTMR.COUNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter register</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_system_configuration_information_memory_sysinfo">2.5.21. System Configuration Information Memory (SYSINFO)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sysinfo.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">most of the top&#8217;s configuration generics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SYSINFO allows the application software to determine the setting of most of the processor&#8217;s top entity
generics that are related to processor/SoC configuration. All registers of this unit are read-only.</p>
</div>
<div class="paragraph">
<p>This device is always implemented - regardless of the actual hardware configuration. The bootloader as well
as the NEORV32 software runtime environment require information from this device (like memory layout
and default clock speed) for correct operation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. SYSINFO register map (<code>struct NEORV32_SYSINFO</code>)</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 30.7692%;">
<col style="width: 53.8462%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffe0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.CLK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock speed in Hz (via top&#8217;s <a href="#_clock_frequency"><em>CLOCK_FREQUENCY</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffe4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.CPU</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specific CPU configuration (see <a href="#_sysinfo_cpu_configuration">SYSINFO - CPU Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffe8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.SOC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specific SoC configuration (see <a href="#_sysinfo_soc_configuration">SYSINFO - SoC Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.CACHE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache configuration information (see <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffff0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.ISPACE_BASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction address space base (via package&#8217;s <code>ispace_base_c</code> constant)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffff4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.IMEM_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal IMEM size in bytes (via top&#8217;s <a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffff8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.DSPACE_BASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data address space base (via package&#8217;s <code>sdspace_base_c</code> constant)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffffc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.DMEM_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal DMEM size in bytes (via top&#8217;s <a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a> generic)</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_sysinfo_cpu_configuration">SYSINFO - CPU Configuration</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. <em>SYSINFO_CPU</em> bits</caption>
<colgroup>
<col style="width: 4.5454%;">
<col style="width: 45.4545%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_ZICSR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> extension (<code>I</code> sub-extension) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_ZIFENCEI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zifencei</code> extension (<code>I</code> sub-extension) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zifencei"><em>CPU_EXTENSION_RISCV_Zifencei</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_ZMMUL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zmmul</code> extension (<code>M</code> sub-extension) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_ZFINX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zfinx</code> extension (<code>F</code> sub-/alternative-extension) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zfinx"><em>CPU_EXTENSION_RISCV_Zfinx</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_ZXSCNT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom extension - <em>Small</em> CPU counters: <code>[m]cycle</code> &amp; <code>[m]instret</code> CSRs have less than 64-bit when set (via top&#8217;s <a href="#_cpu_cnt_width"><em>CPU_CNT_WIDTH</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_ZXNOCNT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom extension - <em>NO</em> CPU counters: <code>[m]cycle</code> &amp; <code>[m]instret</code> CSRs are NOT available at all when set (via top&#8217;s <a href="#_cpu_cnt_width"><em>CPU_CNT_WIDTH</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_PMP</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP</code> (physical memory protection) extension available when set (via top&#8217;s <a href="#_">[_]</a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_HPM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HPM</code> (hardware performance monitors) extension available when set (via top&#8217;s <a href="#_">[_]</a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_DEBUGMODE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V CPU <code>debug_mode</code> available when set (via top&#8217;s <a href="#_">[_]</a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">`30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_FASTMUL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast multiplication available when set (via top&#8217;s <a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CPU_FASTSHIFT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast shifts available when set (via top&#8217;s <a href="#_fast_shift_en"><em>FAST_SHIFT_EN</em></a> generic)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sysinfo_soc_configuration">SYSINFO - SoC Configuration</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. <em>SYSINFO_SOC</em> bits</caption>
<colgroup>
<col style="width: 4.5454%;">
<col style="width: 45.4545%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_BOOTLOADER</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal bootloader is implemented (via top&#8217;s <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_MEM_EXT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the external Wishbone bus interface is implemented (via top&#8217;s <a href="#_mem_ext_en"><em>MEM_EXT_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_MEM_INT_IMEM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal DMEM implemented (via top&#8217;s <a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_MEM_INT_DMEM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal IMEM is implemented (via top&#8217;s <a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_MEM_EXT_ENDIAN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if external bus interface uses BIG-endian byte-order (via top&#8217;s <a href="#_mem_ext_big_endian"><em>MEM_EXT_BIG_ENDIAN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_ICACHE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal instruction cache is implemented (via top&#8217;s <a href="#_icache_en"><em>ICACHE_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_OCD</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if on-chip debugger implemented (via top&#8217;s <a href="#_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_HW_RESET</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if a dedicated hardware reset of all core registers is implemented (via package&#8217;s <code>dedicated_reset_c</code> constant)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_GPIO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the GPIO is implemented (via top&#8217;s <a href="#_io_gpio_en"><em>IO_GPIO_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_MTIME</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the MTIME is implemented (via top&#8217;s <a href="#_io_mtime_en"><em>IO_MTIME_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>18</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_UART0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the primary UART0 is implemented (via top&#8217;s <a href="#_io_uart0_en"><em>IO_UART0_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>19</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_SPI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the SPI is implemented (via top&#8217;s <a href="#_io_spi_en"><em>IO_SPI_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_TWI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TWI is implemented (via top&#8217;s <a href="#_io_twi_en"><em>IO_TWI_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>21</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_PWM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the PWM is implemented (via top&#8217;s <a href="#_io_pwm_en">[_io_pwm_en]</a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>22</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_WDT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the WDT is implemented (via top&#8217;s <a href="#_io_wdt_en"><em>IO_WDT_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>23</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_CFS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the custom functions subsystem is implemented (via top&#8217;s <a href="#_io_cfs_en"><em>IO_CFS_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_TRNG</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TRNG is implemented (via top&#8217;s <em>IO_TRNG_EN</em> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>25</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_SLINK</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the SLINK is implemented (via top&#8217;s <a href="#_slink_num_tx"><em>SLINK_NUM_TX</em></a> and/or <a href="#_slink_num_rx"><em>SLINK_NUM_RX</em></a> generics)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>26</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_UART1</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the secondary UART1 is implemented (via top&#8217;s <a href="#_io_uart1_en"><em>IO_UART1_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>27</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_NEOLED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the NEOLED is implemented (via top&#8217;s <a href="#_io_neoled_en"><em>IO_NEOLED_EN</em></a> generic)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sysinfo_cache_configuration">SYSINFO - Cache Configuration</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bit fields in this register are set to all-zero if the according cache is not implemented.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. <em>SYSINFO_CACHE</em> bits</caption>
<colgroup>
<col style="width: 4.5454%;">
<col style="width: 45.4545%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CACHE_IC_BLOCK_SIZE_3</em> : <em>SYSINFO_CACHE_IC_BLOCK_SIZE_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache block size in bytes), via top&#8217;s <a href="#_icache_block_size"><em>ICACHE_BLOCK_SIZE</em></a> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7:4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CACHE_IC_NUM_BLOCKS_3</em> : <em>SYSINFO_CACHE_IC_NUM_BLOCKS_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache number of cache blocks), via top&#8217;s <a href="#_icache_num_blocks">[_icache_num_blocks]</a> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>11:9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CACHE_IC_ASSOCIATIVITY_3</em> : <em>SYSINFO_CACHE_IC_ASSOCIATIVITY_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache associativity), via top&#8217;s <a href="#_icache_associativity"><em>ICACHE_ASSOCIATIVITY</em></a> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CACHE_IC_REPLACEMENT_3</em> : <em>SYSINFO_CACHE_IC_REPLACEMENT_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-cache replacement policy (<code>0001</code> = LRU if associativity &gt; 0)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>32:16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero, reserved for d-cache</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neorv32_central_processing_unit_cpu">3. NEORV32 Central Processing Unit (CPU)</h2>
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="img/riscv_logo.png" alt="riscv logo" width="350">
</div>
</div>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>32-bit multi-cycle in-order <code>rv32</code> RISC-V CPU</p>
</li>
<li>
<p>Optional RISC-V extensions:</p>
<div class="ulist">
<ul>
<li>
<p><code>A</code> - atomic memory access operations</p>
</li>
<li>
<p><code>B</code> - bit-manipulation instructions</p>
</li>
<li>
<p><code>C</code> - 16-bit compressed instructions</p>
</li>
<li>
<p><code>I</code> - integer base ISA (always enabled)</p>
</li>
<li>
<p><code>E</code> - embedded CPU version (reduced register file size)</p>
</li>
<li>
<p><code>M</code> - integer multiplication and division hardware</p>
</li>
<li>
<p><code>U</code> - less-privileged <em>user</em> mode</p>
</li>
<li>
<p><code>Zfinx</code> - single-precision floating-point unit</p>
</li>
<li>
<p><code>Zicsr</code> - control and status register access (privileged architecture)</p>
</li>
<li>
<p><code>Zicntr</code> - CPU base counters</p>
</li>
<li>
<p><code>Zihpm</code> - hardware performance monitors</p>
</li>
<li>
<p><code>Zifencei</code> - instruction stream synchronization</p>
</li>
<li>
<p><code>Zmmul</code> - integer multiplication hardware</p>
</li>
<li>
<p><code>PMP</code> - physical memory protection</p>
</li>
<li>
<p><code>Debug</code> - debug mode</p>
</li>
</ul>
</div>
</li>
<li>
<p>Compatible to the RISC-V user specifications and a subset of the RISC-V privileged architecture specifications - passes the official RISC-V Architecture Tests (v2+)</p>
</li>
<li>
<p>Official RISC-V open-source architecture ID</p>
</li>
<li>
<p>Standard RISC-V interrupts (<em>external</em>, <em>timer</em>, <em>software</em>) plus 16 <em>fast</em> interrupts</p>
</li>
<li>
<p>Supports <em>all</em> of the machine-level traps from the RISC-V specifications (including bus access exceptions and all unimplemented/illegal/malformed instructions)</p>
<div class="ulist">
<ul>
<li>
<p>This is a special aspect on <em>execution safety</em> by <a href="#_full_virtualization">Full Virtualization</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional physical memory configuration (PMP), compatible to the RISC-V specifications</p>
</li>
<li>
<p>Optional hardware performance monitors (HPM) for application benchmarking</p>
</li>
<li>
<p>Separated interfaces for instruction fetch and data access (merged into a single processor bus))</p>
</li>
<li>
<p>little-endian byte order</p>
</li>
<li>
<p>Configurable hardware reset</p>
</li>
<li>
<p>No hardware support of unaligned data/instruction accesses - they will trigger an exception.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended to use the <strong>NEORV32 Processor</strong> as default top instance even if you only want to use the actual
CPU. Simply disable all the processor-internal modules via the generics and you will get a "CPU
wrapper" that provides a minimal CPU environment and an external bus interface (like AXI4). This
setup also allows to further use the default bootloader and software framework. From this base you
can start building your own SoC. Of course you can also use the CPU in it’s true stand-alone mode.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This documentation assumes the reader is familiar with the official RISC-V "User" and "Privileged Architecture" specifications.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_architecture">3.1. Architecture</h3>
<div class="paragraph">
<p>The NEORV32 CPU was designed from scratch based only on the official ISA / privileged architecture
specifications. The following figure shows the simplified architecture of the CPU.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_cpu.png" alt="neorv32 cpu">
</div>
</div>
<div class="paragraph">
<p>The CPU implements a <em>multi-cycle</em> architecture. Hence, each instruction is executed as a series of consecutive
micro-operations. In order to increase performance, the CPU&#8217;s <strong>front-end</strong> (instruction fetch) and <strong>back-end</strong>
(instruction execution) are de-couples via a FIFO (the "instruction prefetch buffer"). Therefore, the
front-end can already fetch new instructions while the back-end is still processing previously-fetched instructions.</p>
</div>
<div class="paragraph">
<p>The front-end is responsible for fetching 32-bit chunks of instruction words (one aligned 32-bit instruction,
two 16-bit instructions or a mixture if 32-bit instructions are not aligned to 32-bit boundaries). The instruction
data is stored to a FIFO queue - the instruction prefetch buffer.</p>
</div>
<div class="paragraph">
<p>The back-end is responsible for the actual execution of the instruction. It includes an "issue engine",
which takes data from the instruction prefetch buffer and assembles 32-bit instruction words (plain 32-bit
instruction or decompressed 16-bit instructions) for execution.</p>
</div>
<div class="paragraph">
<p>Front-end and back-end operate in parallel and with overlapping operations. Hence, the optimal CPI
(cycles per instructions) is 2, but it can be significantly higher: for instance when executing loads/stores
(accessing memory-mapped devices with high latency), executing multi-cycle ALU operations (like divisions) or
when the CPU front-end has to reload the prefetch buffer due to a taken branch.</p>
</div>
<div class="paragraph">
<p>Basically, the NEORV32 CPU is somewhere between a classical pipelined architecture, where each stage
requires exactly one processing cycle (if not stalled) and a classical multi-cycle architecture, which executes
every single instruction (<em>including</em> fetch) in a series of consecutive micro-operations. The combination of
these two classical design paradigms allows an increased instruction execution in contrast to a pure multi-cycle
approach (due to overlapping operation of fetch and execute) at a reduced hardware footprint (due to the
multi-cycle concept).</p>
</div>
<div class="paragraph">
<p>As a Von-Neumann machine, the CPU provides independent interfaces for instruction fetch and data access.
These two bus interfaces are merged into a single processor-internal bus via a prioritizing bus switch (data accesses
have higher priority). Hence, ALL memory locations including peripheral devices are mapped to a single unified 32-bit
address space.</p>
</div>
</div>
<div class="sect2">
<h3 id="_full_virtualization">3.2. Full Virtualization</h3>
<div class="paragraph">
<p>Just like the RISC-V ISA the NEORV32 aims to provide <em>maximum virtualization</em> capabilities on CPU <em>and</em> SoC level to
allow a high standard of <strong>execution safety</strong>. The CPU supports <strong>all</strong> traps specified by the official RISC-V specifications.
<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>
Thus, the CPU provides defined hardware fall-backs via traps for any expected and unexpected situation (e.g. executing an
malformed instruction word or accessing a not-allocated memory address). For any kind of trap the core is always in a
defined and fully synchronized state throughout the whole architecture (i.e. there are no out-of-order operations that
might have to reverted). This allows predictable execution behavior at any time improving overall <em>execution safety</em>.</p>
</div>
<div class="paragraph">
<p><strong>Execution Safety - NEORV32 Virtualization Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Due to the acknowledged memory accesses the CPU is <em>always</em> sync with the memory system
(i.e. there is no speculative execution / no out-of-order states).</p>
</li>
<li>
<p>The CPU supports <em>all</em> RISC-V compatible bus exceptions including access exceptions, which are triggered if an
accessed address does not respond or encounters an internal error during access.</p>
</li>
<li>
<p>Accessed memory addresses (plain memory, but also memory-mapped devices) need to respond within a fixed time
window. Otherwise a bus access exception is raised.</p>
</li>
<li>
<p>The RISC-V specs. state that executing an malformed instruction results in unpredictable behavior. As an additional
execution safety feature the NEORV32 CPU ensures that <em>all</em> unimplemented/malformed/illegal instructions do raise an
illegal instruction exceptions and do not commit any state-changing operation (like writing registers or triggering
memory operations).</p>
</li>
<li>
<p>To be continued&#8230;&#8203;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_risc_v_compatibility">3.3. RISC-V Compatibility</h3>
<div class="paragraph">
<p>The NEORV32 CPU passes the rv32_m/I, rv32_m/M, rv32_m/C, rv32_m/privilege, and
rv32_m/Zifencei tests of the official RISC-V Architecture Tests (GitHub). The port files for the
NEORV32 processor are located in the repository&#8217;s <code>sw/isa-test</code> folder.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See section <a href="https://stnolting.github.io/neorv32/ug/#_risc_v_architecture_test_framework">User Guide: RISC-V Architecture Test Framework</a>
for information how to run the tests on the NEORV32.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="title"><strong>RISC-V <code>rv32_m/C</code> Tests</strong></div>
<div class="content">
<pre>Check cadd-01           ... OK
Check caddi-01          ... OK
Check caddi16sp-01      ... OK
Check caddi4spn-01      ... OK
Check cand-01           ... OK
Check candi-01          ... OK
Check cbeqz-01          ... OK
Check cbnez-01          ... OK
Check cebreak-01        ... OK
Check cj-01             ... OK
Check cjal-01           ... OK
Check cjalr-01          ... OK
Check cjr-01            ... OK
Check cli-01            ... OK
Check clui-01           ... OK
Check clw-01            ... OK
Check clwsp-01          ... OK
Check cmv-01            ... OK
Check cnop-01           ... OK
Check cor-01            ... OK
Check cslli-01          ... OK
Check csrai-01          ... OK
Check csrli-01          ... OK
Check csub-01           ... OK
Check csw-01            ... OK
Check cswsp-01          ... OK
Check cxor-01           ... OK
--------------------------------
OK: 27/27 RISCV_TARGET=neorv32 RISCV_DEVICE=C XLEN=32</pre>
</div>
</div>
<div class="literalblock">
<div class="title"><strong>RISC-V <code>rv32_m/I</code> Tests</strong></div>
<div class="content">
<pre>Check add-01            ... OK
Check addi-01           ... OK
Check and-01            ... OK
Check andi-01           ... OK
Check auipc-01          ... OK
Check beq-01            ... OK
Check bge-01            ... OK
Check bgeu-01           ... OK
Check blt-01            ... OK
Check bltu-01           ... OK
Check bne-01            ... OK
Check fence-01          ... OK
Check jal-01            ... OK
Check jalr-01           ... OK
Check lb-align-01       ... OK
Check lbu-align-01      ... OK
Check lh-align-01       ... OK
Check lhu-align-01      ... OK
Check lui-01            ... OK
Check lw-align-01       ... OK
Check or-01             ... OK
Check ori-01            ... OK
Check sb-align-01       ... OK
Check sh-align-01       ... OK
Check sll-01            ... OK
Check slli-01           ... OK
Check slt-01            ... OK
Check slti-01           ... OK
Check sltiu-01          ... OK
Check sltu-01           ... OK
Check sra-01            ... OK
Check srai-01           ... OK
Check srl-01            ... OK
Check srli-01           ... OK
Check sub-01            ... OK
Check sw-align-01       ... OK
Check xor-01            ... OK
Check xori-01           ... OK
--------------------------------
OK: 38/38 RISCV_TARGET=neorv32 RISCV_DEVICE=I XLEN=32</pre>
</div>
</div>
<div class="literalblock">
<div class="title"><strong>RISC-V <code>rv32_m/M</code> Tests</strong></div>
<div class="content">
<pre>Check div-01            ... OK
Check divu-01           ... OK
Check mul-01            ... OK
Check mulh-01           ... OK
Check mulhsu-01         ... OK
Check mulhu-01          ... OK
Check rem-01            ... OK
Check remu-01           ... OK
--------------------------------
OK: 8/8 RISCV_TARGET=neorv32 RISCV_DEVICE=M XLEN=32</pre>
</div>
</div>
<div class="literalblock">
<div class="title"><strong>RISC-V <code>rv32_m/privilege</code> Tests</strong></div>
<div class="content">
<pre>Check ebreak            ... OK
Check ecall             ... OK
Check misalign-beq-01   ... OK
Check misalign-bge-01   ... OK
Check misalign-bgeu-01  ... OK
Check misalign-blt-01   ... OK
Check misalign-bltu-01  ... OK
Check misalign-bne-01   ... OK
Check misalign-jal-01   ... OK
Check misalign-lh-01    ... OK
Check misalign-lhu-01   ... OK
Check misalign-lw-01    ... OK
Check misalign-sh-01    ... OK
Check misalign-sw-01    ... OK
Check misalign1-jalr-01 ... OK
Check misalign2-jalr-01 ... OK
--------------------------------
OK: 16/16 RISCV_TARGET=neorv32 RISCV_DEVICE=privilege XLEN=32</pre>
</div>
</div>
<div class="literalblock">
<div class="title"><strong>RISC-V <code>rv32_m/Zifencei</code> Tests</strong></div>
<div class="content">
<pre>Check Fencei            ... OK
--------------------------------
OK: 1/1 RISCV_TARGET=neorv32 RISCV_DEVICE=Zifencei XLEN=32</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_risc_v_incompatibility_issues_and_limitations">3.3.1. RISC-V Incompatibility Issues and Limitations</h4>
<div class="paragraph">
<p>This list shows the currently identified issues regarding full RISC-V-compatibility. More specific information
can be found in section <a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Hardwired R/W CSRs</div>
The <code>misa</code>, <code>mip</code> and <code>mtval</code> CSRs in the NEORV32 are <em>read-only</em>.
Any write access to it (in machine mode) to them are ignored and will <em>not</em> cause any exceptions or side-effects.
Pending interrupt can only be cleared by acknowledging the interrupt-causing device. However, pending interrupts
can still be ignored by clearing the according <code>mie</code> register bits.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Physical memory protection</div>
The physical memory protection (see section <a href="#_machine_physical_memory_protection">[_machine_physical_memory_protection]</a>)
only supports the modes <em>OFF</em> and <em>NAPOT</em> yet and a minimal granularity of 8 bytes per region.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Atomic memory operations</div>
The <code>A</code> CPU extension only implements the <code>lr.w</code> and <code>sc.w</code> instructions yet.
However, these instructions are sufficient to emulate all further atomic memory operations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Bit-manipulation operations</div>
The NEORV32 <code>B</code> extension only implements the <em>basic bit-manipulation instructions</em> (<code>Zbb</code>) subset
and the <em>address generation instructions</em> (<code>Zba</code>) subset yet.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction Misalignment</div>
This is not a real RISC-V incompatibility, but something that might not be clear when studying the RISC-V privileged
architecture specifications: for 32-bit only instructions (no <code>C</code> extension) the misaligned instruction exception
is raised if bit 1 of the access address is set (i.e. not on 32-bit boundary). If the <code>C</code> extension is implemented
there will be no misaligned instruction exceptions <em>at all</em>.
In both cases bit 0 of the program counter and all related registers is hardwired to zero.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_cpu_top_entity_signals">3.4. CPU Top Entity - Signals</h3>
<div class="paragraph">
<p>The following table shows all interface signals of the CPU top entity <code>rtl/core/neorv32_cpu.vhd</code>. The
type of all signals is <em>std_ulogic</em> or <em>std_ulogic_vector</em>, respectively. The "Dir." column shows the signal
direction seen from the CPU.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 34. NEORV32 CPU top entity signals</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Dir.</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Global Signals</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global clock line, all registers triggering on rising edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global reset, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sleep_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU is in sleep mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Instruction Bus Interface (<a href="#_bus_interface">Bus Interface</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_addr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_rdata_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_wdata_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write data (always zero)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_ben_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write transaction (always zero)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_re_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_lock_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclusive access request (always zero)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus transfer acknowledge from accessed peripheral</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus transfer terminate from accessed peripheral</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_fence_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates an executed <em>fence.i</em> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_priv_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current CPU privilege level</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Data Bus Interface (<a href="#_bus_interface">Bus Interface</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_addr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_rdata_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_wdata_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_ben_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_re_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_lock_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclusive access request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus transfer acknowledge from accessed peripheral</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus transfer terminate from accessed peripheral</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_fence_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates an executed <em>fence</em> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_priv_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current CPU privilege level</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>System Time (see <a href="#_timeh"><strong><code>time[h]</code></strong></a> CSR)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system time input (from MTIME)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Interrupts, RISC-V-compatible (<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msw_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine software interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mext_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine external interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine timer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Fast Interrupts, NEORV32-specific (<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request signals</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Enter Debug Mode Request (<a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db_halt_req_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request CPU to halt and enter debug mode</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_cpu_top_entity_generics">3.5. CPU Top Entity - Generics</h3>
<div class="paragraph">
<p>Most of the CPU configuration generics are a subset of the actual Processor configuration generics (see section <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).
and are not listed here. However, the CPU provides some <em>specific</em> generics that are used to configure the CPU for the
NEORV32 processor setup. These generics are assigned by the processor setup only and are not available for user defined configuration.
The <em>specific</em> generics are listed below.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_BOOT_ADDR</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00000000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This address defines the reset address at which the CPU starts fetching instructions after reset. In terms of the NEORV32 processor, this
generic is configured with the base address of the bootloader ROM (default) or with the base address of the processor-internal instruction
memory (IMEM) if the bootloader is disabled (<em>INT_BOOTLOADER_EN</em> = <em>false</em>). See section <a href="#_address_space">Address Space</a> for more information.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_DEBUG_ADDR</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00000000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This address defines the entry address for the "execution based" on-chip debugger. By default, this generic is configured with the base address
of the debugger memory. See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> for more information.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_DEBUG</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement RISC-V-compatible "debug" CPU operation mode. See section <a href="#_cpu_debug_mode">CPU Debug Mode</a> for more information.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_instruction_sets_and_extensions">3.6. Instruction Sets and Extensions</h3>
<div class="paragraph">
<p>The basic NEORV32 is a RISC-V <code>rv32i</code> architecture that provides several <em>optional</em> RISC-V CPU and ISA
(instruction set architecture) extensions. For more information regarding the RISC-V ISA extensions please
see the the <em>RISC-V Instruction Set Manual - Volume I: Unprivileged ISA</em> and <em>The RISC-V Instruction Set Manual
Volume II: Privileged Architecture</em>, which are available in the projects <code>docs/references</code> folder.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The CPU can discover available ISA extensions via the <a href="#_misa"><strong><code>misa</code></strong></a> CSR and the
<code>CPU</code> <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> register
or by executing an instruction and checking for an <em>illegal instruction exception</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Executing an instruction from an extension that is not supported yet or that is currently not enabled
(via the according top entity generic) will raise an <em>illegal instruction</em> exception.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_a_atomic_memory_access">3.6.1. <strong><code>A</code></strong> - Atomic Memory Access</h4>
<div class="paragraph">
<p>Atomic memory access instructions allow more sophisticated memory operations like implementing semaphores and mutexes.
The RICS-C specs. defines a specific <em>atomic</em> extension that provides instructions for atomic memory accesses. The <code>A</code>
ISA extension is enabled if the <code>CPU_EXTENSION_RISCV_A</code> configuration generic is <em>true</em>.
In this case the following additional instructions are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>lr.w</code>: load-reservate</p>
</li>
<li>
<p><code>sc.w</code>: store-conditional</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even though only <code>lr.w</code> and <code>sc.w</code> instructions are implemented yet, all further atomic operations
(load-modify-write instruction) can be emulated using these two instruction. Furthermore, the
instruction&#8217;s ordering flags (<code>aq</code> and <code>lr</code>) are ignored by the CPU hardware. Using any other (not yet
implemented) AMO (atomic memory operation) will raise an illegal instruction exception.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>load-reservate</strong> instruction behaves as a "normal" load-word instruction (<code>lw</code>) but will also set a CPU-internal
<em>data memory access lock</em>. Executing a <strong>store-conditional</strong> behaves as "normal" store-word instruction (<code>sw</code>) that will
only conduct an actual memory write operations if the lock is still intact. Additionally, the store-conditional instruction
will also return the lock state (returns zero if the lock is still intact or non-zero if the lock has been broken).
After the execution of the <code>sc</code> instruction, the lock is automatically removed.</p>
</div>
<div class="paragraph">
<p>The lock is broken if at least one of the following conditions occur:
. executing any data memory access instruction other than <code>lr.w</code>
. raising <em>any</em> t (for example an interrupt or a memory access exception)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The atomic instructions have special requirements for memory system / bus interconnect. More
information can be found in sections <a href="#_bus_interface">Bus Interface</a> and <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a>, respectively.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_b_bit_manipulation_operations">3.6.2. <strong><code>B</code></strong> - Bit-Manipulation Operations</h4>
<div class="paragraph">
<p>The <code>B</code> ISA extension adds instructions for bit-manipulation operations. This extension is enabled if the
<code>CPU_EXTENSION_RISCV_B</code> configuration generic is <em>true</em>.
The official RISC-V specifications can be found here: <a href="https://github.com/riscv/riscv-bitmanip" class="bare">https://github.com/riscv/riscv-bitmanip</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The NEORV32 <code>B</code> extension only implements the <em>basic bit-manipulation instructions</em> (<code>Zbb</code>) subset
and the <em>address generation instructions</em> (<code>Zba</code>) subset yet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Zbb</code> sub-extension adds the following instruction:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>andn</code>, <code>orn</code>, <code>xnor</code></p>
</li>
<li>
<p><code>clz</code>, <code>ctz</code>, <code>cpop</code></p>
</li>
<li>
<p><code>max</code>, <code>maxu</code>, <code>min</code>, <code>minu</code></p>
</li>
<li>
<p><code>sext.b</code>, <code>sext.h</code>, <code>zext.h</code></p>
</li>
<li>
<p><code>rol</code>, <code>ror</code>, <code>rori</code></p>
</li>
<li>
<p><code>orc.b</code>, <code>rev8</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Zba</code> sub-extension adds the following instruction:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sh1add</code>, <code>sh2add</code>, <code>sh3add</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default, the bit-manipulation unit uses an <em>iterative</em> approach to compute shift-related operations
like <code>clz</code> and <code>rol</code>. To increase performance (at the cost of additional hardware resources) the
<a href="#_fast_shift_en"><em>FAST_SHIFT_EN</em></a> generic can be enabled to implement full-parallel logic (like barrel shifters) for all
shift-related <code>B</code> instructions.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>B</code> extension is frozen but not officially ratified yet. There is no
software support for this extension in the upstream GCC RISC-V port yet. However, an
intrinsic library is provided to utilize the provided <code>B</code> extension features from C-language
code (see <code>sw/example/bitmanip_test</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_c_compressed_instructions">3.6.3. <strong><code>C</code></strong> - Compressed Instructions</h4>
<div class="paragraph">
<p>The <em>compressed</em> ISA extension provides 16-bit encodings of commonly used instructions to reduce code space size.
The <code>C</code> extension is available when the <code>CPU_EXTENSION_RISCV_C</code> configuration generic is <em>true</em>.
In this case the following instructions are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c.addi4spn</code>, <code>c.lw</code>, <code>c.sw</code>, <code>c.nop</code>, <code>c.addi</code>, <code>c.jal</code>, <code>c.li</code>, <code>c.addi16sp</code>, <code>c.lui</code>, <code>c.srli</code>, <code>c.srai</code> <code>c.andi</code>, <code>c.sub</code>,
<code>c.xor</code>, <code>c.or</code>, <code>c.and</code>, <code>c.j</code>, <code>c.beqz</code>, <code>c.bnez</code>, <code>c.slli</code>, <code>c.lwsp</code>, <code>c.jr</code>, <code>c.mv</code>, <code>c.ebreak</code>, <code>c.jalr</code>, <code>c.add</code>, <code>c.swsp</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the compressed instructions extension is enabled, branches to an <em>unaligned</em> and <em>uncompressed</em> instruction require
an additional instruction fetch to load the according second half-word of that instruction. The performance can be increased
again by forcing a 32-bit alignment of branch target addresses. By default, this is enforced via the GCC <code>-falign-functions=4</code>,
<code>-falign-labels=4</code>, <code>-falign-loops=4</code> and <code>-falign-jumps=4</code> compile flags (via the makefile).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_e_embedded_cpu">3.6.4. <strong><code>E</code></strong> - Embedded CPU</h4>
<div class="paragraph">
<p>The embedded CPU extensions reduces the size of the general purpose register file from 32 entries to 16 entries to
decrease physical hardware requirements (for example block RAM). This extensions is enabled when the <code>CPU_EXTENSION_RISCV_E</code>
configuration generic is <em>true</em>. Accesses to registers beyond <code>x15</code> will raise and <em>illegal instruction exception</em>.
This extension does not add any additional instructions or features.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Due to the reduced register file size an alternate toolchain ABI (<strong><code>ilp32e</code></strong>) is required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_i_base_integer_isa">3.6.5. <strong><code>I</code></strong> - Base Integer ISA</h4>
<div class="paragraph">
<p>The CPU always supports the complete <code>rv32i</code> base integer instruction set. This base set is always enabled
regardless of the setting of the remaining exceptions. The base instruction set includes the following
instructions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>immediate: <code>lui</code>, <code>auipc</code></p>
</li>
<li>
<p>jumps: <code>jal</code>, <code>jalr</code></p>
</li>
<li>
<p>branches: <code>beq</code>, <code>bne</code>, <code>blt</code>, <code>bge</code>, <code>bltu</code>, <code>bgeu</code></p>
</li>
<li>
<p>memory: <code>lb</code>, <code>lh</code>, <code>lw</code>, <code>lbu</code>, <code>lhu</code>, <code>sb</code>, <code>sh</code>, <code>sw</code></p>
</li>
<li>
<p>alu: <code>addi</code>, <code>slti</code>, <code>sltiu</code>, <code>xori</code>, <code>ori</code>, <code>andi</code>, <code>slli</code>, <code>srli</code>, <code>srai</code>, <code>add</code>, <code>sub</code>, <code>sll</code>, <code>slt</code>, <code>sltu</code>, <code>xor</code>, <code>srl</code>, <code>sra</code>, <code>or</code>, <code>and</code></p>
</li>
<li>
<p>environment: <code>ecall</code>, <code>ebreak</code>, <code>fence</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to keep the hardware footprint low, the CPU&#8217;s shift unit uses a bit-serial serial approach. Hence, shift operations
take up to 32 cycles (plus overhead) depending on the actual shift amount. Alternatively, the shift operations can be processed
completely in parallels by a fast (but large) barrel shifter when the <code>FAST_SHIFT_EN</code> generic is <em>true</em>. In that case, shift operations
complete within 2 cycles (plus overhead) regardless of the actual shift amount.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Internally, the <code>fence</code> instruction does not perform any operation inside the CPU. It only sets the
top’s <code>d_bus_fence_o</code> signal high for one cycle to inform the memory system a <code>fence</code> instruction has been
executed. Any flags within the <code>fence</code> instruction word are ignore by the hardware.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_m_integer_multiplication_and_division">3.6.6. <strong><code>M</code></strong> - Integer Multiplication and Division</h4>
<div class="paragraph">
<p>Hardware-accelerated integer multiplication and division operations are available when the
<code>CPU_EXTENSION_RISCV_M</code> configuration generic is <em>true</em>. In this case the following instructions are
available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>multiplication: <code>mul</code>, <code>mulh</code>, <code>mulhsu</code>, <code>mulhu</code></p>
</li>
<li>
<p>division: <code>div</code>, <code>divu</code>, <code>rem</code>, <code>remu</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, multiplication and division operations are executed in a bit-serial approach.
Alternatively, the multiplier core can be implemented using DSP blocks if the <code>FAST_MUL_EN</code>
generic is <em>true</em> allowing faster execution. Multiplications and divisions
always require a fixed amount of cycles to complete - regardless of the input operands.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmul_integer_multiplication">3.6.7. <strong><code>Zmmul</code></strong> - Integer Multiplication</h4>
<div class="paragraph">
<p>This is a <em>sub-extension</em> of the <code>M</code> ISA extension. It implements the multiplication-only operations
of the <code>M</code> extensions and is intended for size-constrained setups that require hardware-based
integer multiplications but not hardware-based divisions, which will be computed entirely in software.
This extension requires only ~50% of the hardware utilization of the "full" <code>M</code> extension.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>multiplication: <code>mul</code>, <code>mulh</code>, <code>mulhsu</code>, <code>mulhu</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>Zmmul</code> is enabled, executing any division instruction from the <code>M</code> ISA extension (<code>div</code>, <code>divu</code>, <code>rem</code>, <code>remu</code>)
will raise an <em>illegal instruction exception</em>.</p>
</div>
<div class="paragraph">
<p>Note that <code>M</code> and <code>Zmmul</code> extensions <em>cannot</em> be enabled at the same time.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If your RISC-V GCC toolchain does not (yet) support the <code>_Zmmul</code> ISA extensions, it can be "emulated"
using a <code>rv32im</code> machine architecture and setting the <code>-mno-div</code> compiler flag
(example <code>$ make MARCH=rv32im USER_FLAGS+=-mno-div clean_all exe</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_u_less_privileged_user_mode">3.6.8. <strong><code>U</code></strong> - Less-Privileged User Mode</h4>
<div class="paragraph">
<p>In addition to the basic (and highest-privileged) machine-mode, the <em>user-mode</em> ISA extensions adds a second less-privileged
operation mode. It is implemented if the <code>CPU_EXTENSION_RISCV_U</code> configuration generic is <em>true</em>.
Code executed in user-mode cannot access machine-mode CSRs. Furthermore, user-mode access to the address space (like
peripheral/IO devices) can be constrained via the physical memory protection (<em>PMP</em>).
Any kind of privilege rights violation will raise an exception to allow full virtualization.</p>
</div>
</div>
<div class="sect3">
<h4 id="_x_neorv32_specific_custom_extensions">3.6.9. <strong><code>X</code></strong> - NEORV32-Specific (Custom) Extensions</h4>
<div class="paragraph">
<p>The NEORV32-specific extensions are always enabled and are indicated by the set <code>X</code> bit in the <code>misa</code> CSR.</p>
</div>
<div class="paragraph">
<p>The most important points of the NEORV32-specific extensions are:
* The CPU provides 16 <em>fast interrupt</em> interrupts (<code>FIRQ)</code>, which are controlled via custom bits in the <code>mie</code>
and <code>mip</code> CSR. This extension is mapped to <em>reserved</em> CSR bits, that are available for custom use (according to the
RISC-V specs). Also, custom trap codes for <code>mcause</code> are implemented.
* All undefined/unimplemented/malformed/illegal instructions do raise an illegal instruction exception (see <a href="#_full_virtualization">Full Virtualization</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_zfinx_single_precision_floating_point_operations">3.6.10. <strong><code>Zfinx</code></strong> Single-Precision Floating-Point Operations</h4>
<div class="paragraph">
<p>The <code>Zfinx</code> floating-point extension is an <em>alternative</em> of the standard <code>F</code> floating-point ISA extension.
The <code>Zfinx</code> extensions also uses the integer register file <code>x</code> to store and operate on floating-point data
instead of a dedicated floating-point register file (hence, <code>F-in-x</code>). Thus, the <code>Zfinx</code> extension requires
less hardware resources and features faster context changes. This also implies that there are NO dedicated <code>f</code>
register file-related load/store or move instructions.
The official RISC-V specifications can be found here: <a href="https://github.com/riscv/riscv-zfinx" class="bare">https://github.com/riscv/riscv-zfinx</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The NEORV32 floating-point unit used by the <code>Zfinx</code> extension is compatible to the <em>IEEE-754</em> specifications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Zfinx</code> extensions only supports single-precision (<code>.s</code> instruction suffix), so it is a direct alternative
to the <code>F</code> extension. The <code>Zfinx</code> extension is implemented when the <code>CPU_EXTENSION_RISCV_Zfinx</code> configuration
generic is <em>true</em>. In this case the following instructions and CSRs are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>conversion: <code>fcvt.s.w</code>, <code>fcvt.s.wu</code>, <code>fcvt.w.s</code>, <code>fcvt.wu.s</code></p>
</li>
<li>
<p>comparison: <code>fmin.s</code>, <code>fmax.s</code>, <code>feq.s</code>, <code>flt.s</code>, <code>fle.s</code></p>
</li>
<li>
<p>computational: <code>fadd.s</code>, <code>fsub.s</code>, <code>fmul.s</code></p>
</li>
<li>
<p>sign-injection: <code>fsgnj.s</code>, <code>fsgnjn.s</code>, <code>fsgnjx.s</code></p>
</li>
<li>
<p>number classification: <code>fclass.s</code></p>
</li>
<li>
<p>additional CSRs: <code>fcsr</code>, <code>frm</code>, <code>fflags</code></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Fused multiply-add instructions <code>f[n]m[add/sub].s</code> are not supported!
Division <code>fdiv.s</code> and square root <code>fsqrt.s</code> instructions are not supported yet!
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Subnormal numbers ("de-normalized" numbers) are not supported by the NEORV32 FPU.
Subnormal numbers (exponent = 0) are <em>flushed to zero</em> setting them to +/- 0 before entering the
FPU&#8217;s processing core. If a computational instruction (like <code>fmul.s</code>) generates a subnormal result, the
result is also flushed to zero during normalization.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>Zfinx</code> extension is not yet officially ratified, but is expected to stay unchanged. There is no
software support for the <code>Zfinx</code> extension in the upstream GCC RISC-V port yet. However, an
intrinsic library is provided to utilize the provided <code>Zfinx</code> floating-point extension from C-language
code (see <code>sw/example/floating_point_test</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zicsr_control_and_status_register_access_privileged_architecture">3.6.11. <strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</h4>
<div class="paragraph">
<p>The CSR access instructions as well as the exception and interrupt system (= the privileged architecture)
is implemented when the <code>CPU_EXTENSION_RISCV_Zicsr</code> configuration generic is <em>true</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If the <code>Zicsr</code> extension is disabled the CPU does not provide any <em>privileged architecture</em> features at all!
In order to provide the full set of privileged functions that are required to run more complex tasks like
operating system and to allow a secure execution environment the <code>Zicsr</code> extension should always be enabled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case the following instructions are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CSR access: <code>csrrw</code>, <code>csrrs</code>, <code>csrrc</code>, <code>csrrwi</code>, <code>csrrsi</code>, <code>csrrci</code></p>
</li>
<li>
<p>environment: <code>mret</code>, <code>wfi</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>rd=x0</code> for the <code>csrrw[i]</code> instructions there will be no actual read access to the according CSR.
However, access privileges are still enforced so these instruction variants <em>do</em> cause side-effects
(the RISC-V spec. state that these combinations "<em>shall</em> not cause any side-effects").
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The "wait for interrupt instruction" <code>wfi</code> acts like a sleep command. When executed, the CPU is
halted until a valid interrupt request occurs. To wake up again, the according interrupt source has to
be enabled via the <code>mie</code> CSR and the global interrupt enable flag in <code>mstatus</code> has to be set.
The <code>wfi</code> instruction may also be executed in user-mode without causing an exception as <a href="#_mstatus"><strong><code>mstatus</code></strong></a> bit
<code>TW</code> (timeout wait) is <em>hardwired</em> to zero.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zicntr_cpu_base_counters">3.6.12. <strong><code>Zicntr</code></strong> CPU Base Counters</h4>
<div class="paragraph">
<p>The <code>Zicntr</code> ISA extension adds the basic cycle <code>[m]cycle[h]</code>), instruction-retired (<code>[m]instret[h]</code>) and time (<code>time[h]</code>)
counters. This extensions is stated is <em>mandatory</em> by the RISC-V spec. However, size-constrained setups may remove support for
these counters. Section <a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a> shows a list of all <code>Zicntr</code>-related CSRs.
These are available if the <code>Zicntr</code> ISA extensions is enabled via the <a href="#_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></a> generic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Disabling the <code>Zicntr</code> extension does not remove the <code>time[h]</code>-driving MTIME unit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>Zicntr</code> is disabled, all accesses to the according counter CSRs will raise an illegal instruction exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zihpm_hardware_performance_monitors">3.6.13. <strong><code>Zihpm</code></strong> Hardware Performance Monitors</h4>
<div class="paragraph">
<p>In additions to the base cycle, instructions-retired and time counters the NEORV32 CPU provides
up to 29 hardware performance monitors (HPM 3..31), which can be used to benchmark applications. Each HPM consists of an
N-bit wide counter (split in a high-word 32-bit CSR and a low-word 32-bit CSR), where N is defined via the top&#8217;s
<code>HPM_CNT_WIDTH</code> generic (0..64-bit) and a corresponding event configuration CSR. The event configuration
CSR defines the architectural events that lead to an increment of the associated HPM counter.</p>
</div>
<div class="paragraph">
<p>The HPM counters are available if the <code>Zihpm</code> ISA extensions is enabled via the <a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a> generic.</p>
</div>
<div class="paragraph">
<p>Depending on the configuration the following additional CSR are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>counters: <code>mhpmcounter*[h]</code> (3..31, depending on <code>HPM_NUM_CNTS</code>)</p>
</li>
<li>
<p>event configuration: <code>mhpmevent*</code> (3..31, depending on <code>HPM_NUM_CNTS</code>)</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The HPM counter CSR can only be accessed in machine-mode. Hence, the according <code>mcounteren</code> CSR bits
are always zero and read-only. Any access from less-privileged modes will raise an illegal instruction
exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Auto-increment of the HPMs can be individually deactivated via the <code>mcountinhibit</code> CSR.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For a list of all HPM-related CSRs and all provided event configurations
see section <a href="#_hardware_performance_monitors_hpm">Hardware Performance Monitors (HPM)</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zifencei_instruction_stream_synchronization">3.6.14. <strong><code>Zifencei</code></strong> Instruction Stream Synchronization</h4>
<div class="paragraph">
<p>The <code>Zifencei</code> CPU extension is implemented if the <code>CPU_EXTENSION_RISCV_Zifencei</code> configuration
generic is <em>true</em>. It allows manual synchronization of the instruction stream via the following instruction:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fence.i</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>fence.i</code> instruction resets the CPU&#8217;s front-end (instruction fetch) and flushes the prefetch buffer.
This allows a clean re-fetch of modified instructions from memory. Also, the top&#8217;s <code>i_bus_fencei_o</code> signal is set
high for one cycle to inform the memory system (like the i-cache to perform a flush/reload.
Any additional flags within the <code>fence.i</code> instruction word are ignore by the hardware.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pmp_physical_memory_protection">3.6.15. <strong><code>PMP</code></strong> Physical Memory Protection</h4>
<div class="paragraph">
<p>The NEORV32 physical memory protection (PMP) is compatible to the RISC-V PMP specifications. It can be used
to constrain memory read/write/execute rights for each available privilege level.</p>
</div>
<div class="paragraph">
<p>The NEORV32 PMP only supports <em>NAPOT</em> mode yet and a minimal region size (granularity) of 8 bytes. Larger
minimal sizes can be configured via the top <code>PMP_MIN_GRANULARITY</code> generic to reduce hardware requirements.
The physical memory protection system is implemented when the <code>PMP_NUM_REGIONS</code> configuration generic is &gt;0.
In this case the following additional CSRs are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pmpcfg*</code> (0..15, depending on configuration): PMP configuration registers</p>
</li>
<li>
<p><code>pmpaddr*</code> (0..63, depending on configuration): PMP address registers</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See section <a href="#_machine_physical_memory_protection">[_machine_physical_memory_protection]</a> for more information regarding the PMP CSRs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The actual number of regions and the minimal region granularity are defined via the top entity
<code>PMP_MIN_GRANULARITY</code> and <code>PMP_NUM_REGIONS</code> generics. <code>PMP_MIN_GRANULARITY</code> defines the minimal available
granularity of each region in bytes. <code>PMP_NUM_REGIONS</code> defines the total number of implemented regions and thus, the
number of available <code>pmpcfg*</code> and <code>pmpaddr*</code> CSRs.</p>
</div>
<div class="paragraph">
<p>When implementing more PMP regions that a <em>certain critical limit</em> <strong>an additional register stage
is automatically inserted</strong> into the CPU&#8217;s memory interfaces to reduce critical path length. Unfortunately, this will also
increase the latency of instruction fetches and data access by +1 cycle.</p>
</div>
<div class="paragraph">
<p>The critical limit can be adapted for custom use by a constant from the main VHDL package file
(<code>rtl/core/neorv32_package.vhd</code>). The default value is 8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">-- "critical" number of PMP regions --
constant pmp_num_regions_critical_c : natural := 8;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Operation</strong></p>
</div>
<div class="paragraph">
<p>Any CPU memory access address (from the instruction fetch or data access interface) is tested if it is accessing <em>any</em>
of the specified  PMP regions(configured via <code>pmpaddr*</code> and enabled via <code>pmpcfg*</code>). If an
address matches one of these regions, the configured access rights (attributes in <code>pmpcfg*</code>) are enforced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a write access (store) will fail if no write attribute is set</p>
</li>
<li>
<p>a read access (load) will fail if no read attribute is set</p>
</li>
<li>
<p>an instruction fetch access will fail if no execute attribute is set</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If an access to a protected region does not have the according access rights it will raise the according
instruction/load/store <em>access fault</em> exception.</p>
</div>
<div class="paragraph">
<p>By default, all PMP checks are enforced for user-level programs only. If you wish to enforce the physical
memory protection also for machine-level programs you need to set the <em>locked bit</em> in the according
<code>pmpcfg*</code> configuration CSR.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
After updating the address configuration registers <code>pmpaddr*</code> the system requires up to 33 cycles for
internal (iterative) computations before the configuration becomes valid.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information regarding RISC-V physical memory protection see the official <em>The RISC-V
Instruction Set Manual - Volume II: Privileged Architecture</em> specifications.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_instruction_timing">3.7. Instruction Timing</h3>
<div class="paragraph">
<p>The instruction timing listed in the table below shows the required clock cycles for executing a certain
instruction. These instruction cycles assume a bus access without additional wait states and a filled
pipeline.</p>
</div>
<div class="paragraph">
<p>Average CPI (cycles per instructions) values for "real applications" like for executing the CoreMark benchmark for different CPU
configurations are presented in <a href="#_cpu_performance">CPU Performance</a>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 35. Clock cycles per instruction</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-center valign-top">ISA</th>
<th class="tableblock halign-center valign-top">Instruction(s)</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>addi</code> <code>slti</code> <code>sltiu</code> <code>xori</code> <code>ori</code> <code>andi</code> <code>add</code> <code>sub</code> <code>slt</code> <code>sltu</code> <code>xor</code> <code>or</code> <code>and</code> <code>lui</code> <code>auipc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.addi4spn</code> <code>c.nop</code> <code>c.addi</code> <code>c.li</code> <code>c.addi16sp</code> <code>c.lui</code> <code>c.andi</code> <code>c.sub</code> <code>c.xor</code> <code>c.or</code> <code>c.and</code> <code>c.add</code> <code>c.mv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>slli</code> <code>srli</code> <code>srai</code> <code>sll</code> <code>srl</code> <code>sra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + SA<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>/4 + SA%4; FAST_SHIFT<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup>: 4; TINY_SHIFT<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup>: 2..32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.srli</code> <code>c.srai</code> <code>c.slli</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + SA<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup>; FAST_SHIFT<sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup>:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branches</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>beq</code> <code>bne</code> <code>blt</code> <code>bge</code> <code>bltu</code> <code>bgeu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taken: 5 + ML<sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup>; Not taken: 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branches</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.beqz</code> <code>c.bnez</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taken: 5 + ML<sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnotedef_13" title="View footnote.">13</a>]</sup>; Not taken: 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jumps / Calls</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jal</code> <code>jalr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + ML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jumps / Calls</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.jal</code> <code>c.j</code> <code>c.jr</code> <code>c.jalr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + ML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>lb</code> <code>lh</code> <code>lw</code> <code>lbu</code> <code>lhu</code> <code>sb</code> <code>sh</code> <code>sw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + ML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.lw</code> <code>c.sw</code> <code>c.lwsp</code> <code>c.swsp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + ML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>A</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>lr.w</code> <code>sc.w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + ML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>M</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mul</code> <code>mulh</code> <code>mulhsu</code> <code>mulhu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2+31+3; FAST_MUL<sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnotedef_14" title="View footnote.">14</a>]</sup>: 5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Division</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>M</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>div</code> <code>divu</code> <code>rem</code> <code>remu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22+32+4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSR access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>csrrw</code> <code>csrrs</code> <code>csrrc</code> <code>csrrwi</code> <code>csrrsi</code> <code>csrrci</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code>+<code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ecall</code> <code>ebreak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code>+<code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.break</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mret</code> <code>wfi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zifencei</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fence.i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + ML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - artihmetic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fadd.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - artihmetic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fsub.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - artihmetic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fmul.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - compare</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fmin.s</code> <code>fmax.s</code> <code>feq.s</code> <code>flt.s</code> <code>fle.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - misc</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fsgnj.s</code> <code>fsgnjn.s</code> <code>fsgnjx.s</code> <code>fclass.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - conversion</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fcvt.w.s</code> <code>fcvt.wu.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - conversion</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fcvt.s.w</code> <code>fcvt.s.wu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - arithmetic/logic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbb)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sext.b</code> <code>sext.h</code> <code>min</code> <code>minu</code> <code>max</code> <code>maxu</code> <code>andn</code> <code>orn</code> <code>xnor</code> <code>zext</code>(pack) <code>rev8</code>(grevi) <code>orc.b</code>(gorci)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - arithmetic/logic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zba)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sh1add</code> <code>sh2add</code> <code>sh3add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - shifts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbb)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>clz</code> <code>ctz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + 0..32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - shifts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbb)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cpop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + 32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - shifts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbb)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rol</code> <code>ror</code> <code>rori</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + SA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - single-bit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbs)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sbset[i]</code> <code>sbclr[i]</code> <code>sbinv[i]</code> <code>sbext[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - shifted-add</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zba)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sh1add</code> <code>sh2add</code> <code>sh3add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The presented values of the <strong>floating-point execution cycles</strong> are average values - obtained from
4096 instruction executions using pseudo-random input values. The execution time for emulating the
instructions (using pure-software libraries) is ~17..140 times higher.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_control_and_status_registers_csrs">3.8. Control and Status Registers (CSRs)</h3>
<div class="paragraph">
<p>The following table shows a summary of all available CSRs. The address field defines the CSR address for
the CSR access instructions. The <strong>[ASM]</strong> name can be used for (inline) assembly code and is directly
understood by the assembler/compiler. The <strong>[C]</strong> names are defined by the NEORV32 core library and can be
used as immediate in plain C code. The <strong>R/W</strong> column shows whether the CSR can be read and/or written.
The NEORV32-specific CSRs are mapped to the official "custom CSRs" CSR address space.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The CSRs, the CSR-related instructions as well as the complete exception/interrupt processing
system are only available when the <code>CPU_EXTENSION_RISCV_Zicsr</code> generic is <em>true</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When trying to write to a read-only CSR (like the <code>time</code> CSR) or when trying to access a nonexistent
CSR or when trying to access a machine-mode CSR from less-privileged user-mode an
illegal instruction exception is raised.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
CSR reset value: Please note that most of the CSRs do <strong>NOT</strong> provide a dedicated reset. Hence,
these CSRs are not initialized by a hardware reset and keep an <strong>UNDEFINED</strong> value until they are
explicitly initialized by the software (normally, this is already done by the NEORV32-specific
<code>crt0.S</code> start-up code). For more information see section <a href="#_cpu_hardware_reset">CPU Hardware Reset</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>CSR Listing</strong></p>
</div>
<div class="paragraph">
<p>The description of each single CSR provides the following summary:</p>
</div>
<table class="tableblock frame-ends grid-none stretch">
<caption class="title">Table 36. CSR description</caption>
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Address</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Description</em></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><em>ASM alias</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>CSR content after hardware reset</em> (also see <a href="#_cpu_hardware_reset">CPU Hardware Reset</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><em>Detailed description</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Not Implemented CSRs / CSR Bits</div>
All CSR bits that are unused / not implemented / not shown are <em>hardwired to zero</em>. All CSRs that are not
implemented at all (and are not "disabled" using certain configuration generics) will trigger an exception on
access. The CSR that are implemented within the NEORV32 might cause an exception if they are disabled.
See the according CSR description for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Debug Mode CSRs</div>
The <em>debug mode</em> CSRs are not listed here since they are only accessible in debug mode and not during normal CPU operation.
See section <a href="#_cpu_debug_mode_csrs">CPU Debug Mode CSRs</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p><strong>CSR Listing Notes</strong></p>
</div>
<div class="paragraph">
<p>CSRs with the following notes &#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>X</code>: <em>custom</em> - have or are a custom CPU-specific extension (that is allowed by the RISC-V specs)</p>
</li>
<li>
<p><code>R</code>: <em>read-only</em> - are read-only (in contrast to the originally specified r/w capability)</p>
</li>
<li>
<p><code>C</code>: <em>constrained</em> - have a constrained compatibility, not all specified bits are implemented</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. NEORV32 Control and Status Registers (CSRs)</caption>
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 18.421%;">
<col style="width: 26.3157%;">
<col style="width: 7.8947%;">
<col style="width: 28.9473%;">
<col style="width: 7.895%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [ASM]</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-center valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_floating_point_csrs">Floating-Point CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_fflags"><strong><code>fflags</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_FFLAGS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point accrued exceptions</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_frm"><strong><code>frm</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_FRM</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point dynamic rounding mode</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_fcsr"><strong><code>fcsr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_FCSR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point control and status (<code>frm</code> + <code>fflags</code>)</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_machine_configuration_csrs">Machine Configuration CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_menvcfg"><strong><code>menvcfg</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MENVCFG</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - low word</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>R</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x31a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_menvcfgh"><strong><code>menvcfgh</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MENVCFGH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - low word</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>R</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_machine_trap_setup_csrs">Machine Trap Setup CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mstatus"><strong><code>mstatus</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSTATUS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - low word</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_misa"><strong><code>misa</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine CPU ISA and extensions</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>R</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mie"><strong><code>mie</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt enable register</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>X</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtvec"><strong><code>mtvec</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MTVEC</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap-handler base address (for ALL traps)</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcounteren"><strong><code>mcounteren</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTEREN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-enable register</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mstatush"><strong><code>mstatush</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSTATUSH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - high word</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_machine_trap_handling_csrs">Machine Trap Handling CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x340</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mscratch"><strong><code>mscratch</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSCRATCH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine scratch register</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x341</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mepc"><strong><code>mepc</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MEPC</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine exception program counter</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x342</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcause"><strong><code>mcause</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCAUSE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap cause</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>X</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x343</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtval"><strong><code>mtval</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MTVAL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine bad address or instruction</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>XR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x344</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mip"><strong><code>mip</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt pending register</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>XR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_machine_physical_memory_protection_csrs">Machine Physical Memory Protection CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3a0 .. 0x3af</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmpcfg"><code>pmpcfg0</code></a> .. <a href="#_pmpcfg"><code>pmpcfg15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_PMPCFG0</em> .. <em>CSR_PMPCFG15</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection config. for region 0..63</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3b0 .. 0x3ef</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmpaddr"><code>pmpaddr0</code></a> .. <a href="#_pmpaddr"><code>pmpaddr63</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_PMPADDR0</em> .. <em>CSR_PMPADDR63</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection addr. register region 0..63</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcycleh"><code>mcycle</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCYCLE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter low word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstreth"><code>minstret</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MINSTRET</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instruction-retired counter low word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCYCLE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter high word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstreth"><strong><code>minstret[h]</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MINSTRET</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instruction-retired counter high word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cycleh"><code>cycle</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_CYCLE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter low word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_timeh"><code>time</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TIME</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System time (from MTIME) low word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_instreth"><code>instret</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_INSTRET</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction-retired counter low word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cycleh"><strong><code>cycle[h]</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_CYCLEH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter high word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_timeh"><strong><code>time[h]</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TIMEH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System time (from MTIME) high word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_instreth"><strong><code>instret[h]</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_INSTRETH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction-retired counter high word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x323 .. 0x33f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmevent"><code>mhpmevent3</code></a> .. <a href="#_mhpmevent"><code>mhpmevent31</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MHPMEVENT3</em> .. <em>CSR_MHPMEVENT31</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring event selector 3..31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>X</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb03 .. 0xb1f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmcounterh"><code>mhpmcounter3</code></a> .. <a href="#_mhpmcounterh"><code>mhpmcounter31</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MHPMCOUNTER3</em> .. <em>CSR_MHPMCOUNTER31</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring counter 3..31 low word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb83 .. 0xb9f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmcounterh"><code>mhpmcounter3h</code></a> .. <a href="#_mhpmcounterh"><code>mhpmcounter31h</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MHPMCOUNTER3H</em> .. <em>CSR_MHPMCOUNTER31H</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring counter 3..31 high word</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_machine_counter_setup_csrs">Machine Counter Setup CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x320</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTINHIBIT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-enable register</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong><a href="#_machine_information_csrs">Machine Information CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mvendorid"><strong><code>mvendorid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MVENDORID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vendor ID</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_marchid"><strong><code>marchid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MARCHID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture ID</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mimpid"><strong><code>mimpid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIMPID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine implementation ID / version</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhartid"><strong><code>mhartid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MHARTID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine thread ID</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mconfigptr"><strong><code>mconfigptr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCONFIGPTR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine configuration pointer register</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_floating_point_csrs">3.8.1. Floating-Point CSRs</h4>
<div class="paragraph">
<p>These CSRs are available if the <code>Zfinx</code> extensions is enabled (<code>CPU_EXTENSION_RISCV_Zfinx</code> is <em>true</em>).
Otherwise any access to the floating-point CSRs will raise an illegal instruction exception.</p>
</div>
<div class="sect4">
<h5 id="_fflags"><strong><code>fflags</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Floating-point accrued exceptions</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>fflags</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>fflags</code> CSR is compatible to the RISC-V specifications. It shows the accrued ("accumulated")
exception flags in the lowest 5 bits. This CSR is only available if a floating-point CPU extension is enabled.
See the RISC-V ISA spec for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_frm"><strong><code>frm</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Floating-point dynamic rounding mode</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>frm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>frm</code> CSR is compatible to the RISC-V specifications and is used to configure the rounding modes using
the lowest 3 bits. This CSR is only available if a floating-point CPU extension is enabled. See the RISC-V
ISA spec for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_fcsr"><strong><code>fcsr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Floating-point control and status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>fcsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>fcsr</code> CSR is compatible to the RISC-V specifications. It provides combined read/write access to the
<code>fflags</code> and <code>frm</code> CSRs. This CSR is only available if a floating-point CPU extension is enabled. See the
RISC-V ISA spec for more information.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_configuration_csrs">3.8.2. Machine Configuration CSRs</h4>
<div class="sect4">
<h5 id="_menvcfg"><strong><code>menvcfg</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine environment configuration register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>menvcfg</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>0x00000000</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The features of this CSR are not implemented yet. The register is read-only. NOTE: This register
only exists if the <code>U</code> ISA extensions is enabled.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_menvcfgh"><strong><code>menvcfgh</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x31a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine environment configuration register - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>menvcfgh</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>0x00000000</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The features of this CSR are not implemented yet. The register is read-only. NOTE: This register
only exists if the <code>U</code> ISA extensions is enabled.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_trap_setup_csrs">3.8.3. Machine Trap Setup CSRs</h4>
<div class="sect4">
<h5 id="_mstatus"><strong><code>mstatus</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mstatus</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>0x00000000</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mstatus</code> CSR is compatible to the RISC-V specifications. It shows the CPU&#8217;s current execution state.
The following bits are implemented (all remaining bits are always zero and are read-only).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 38. Machine status register</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12:11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSTATUS_MPP_H</em> : <em>CSR_MSTATUS_MPP_L</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Previous machine privilege level, 11 = machine (M) level, 00 = user (U) level</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSTATUS_MPIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Previous machine global interrupt enable flag state</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSTATUS_MIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine global interrupt enable flag</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When entering an exception/interrupt, the <code>MIE</code> flag is copied to <code>MPIE</code> and cleared afterwards. When leaving
the exception/interrupt (via the <code>mret</code> instruction), <code>MPIE</code> is copied back to <code>MIE</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_misa"><strong><code>misa</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ISA and extensions</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>misa</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>configuration dependant</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>misa</code> CSR gives information about the actual CPU features. The lowest 26 bits show the implemented
CPU extensions. The following bits are implemented (all remaining bits are always zero and are read-only).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>misa</code> CSR is not fully RISC-V-compatible as it is read-only. Hence, implemented CPU
extensions cannot be switch on/off during runtime. For compatibility reasons any write access to this
CSR is simply ignored and will <em>NOT</em> cause an illegal instruction exception.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 39. Machine ISA and extension register</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA_MXL_HI_EXT</em> : <em>CSR_MISA_MXL_LO_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit architecture indicator (always <em>01</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA_X_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>X</code> extension bit is always set to indicate custom non-standard extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA_U_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>U</code> CPU extension (user mode) available, set when <em>CPU_EXTENSION_RISCV_U</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA_M_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>M</code> CPU extension (mul/div) available, set when <em>CPU_EXTENSION_RISCV_M</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA_I_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>I</code> CPU base ISA, cleared when <em>CPU_EXTENSION_RISCV_E</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA_E_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>E</code> CPU extension (embedded) available, set when <em>CPU_EXTENSION_RISCV_E</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA_C_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>C</code> CPU extension (compressed instruction) available, set when <em>CPU_EXTENSION_RISCV_C</em> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA_A_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>A</code> CPU extension (atomic memory access) available, set when <em>CPU_EXTENSION_RISCV_A</em> enabled</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Information regarding the implemented RISC-V <code>Z*</code> <em>sub-extensions</em> (like <code>Zicsr</code> or <code>Zfinx</code>) can be found
in the <code>CPU</code> <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> register.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mie"><strong><code>mie</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine interrupt-enable register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mie</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mie</code> CSR is compatible to the RISC-V specifications and features custom extensions for the fast
interrupt channels. It is used to enabled specific interrupts sources. Please note that interrupts also have to be
globally enabled via the <code>CSR_MSTATUS_MIE</code> flag of the <code>mstatus</code> CSR. The following bits are implemented
(all remaining bits are always zero and are read-only):</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 40. Machine ISA and extension register</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIE_FIRQ15E</em> : <em>CSR_MIE_FIRQ0E</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast interrupt channel 15..0 enable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIE_MEIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine <em>external</em> interrupt enable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIE_MTIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine <em>timer</em> interrupt enable (from <em>MTIME</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIE_MSIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine <em>software</em> interrupt enable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mtvec"><strong><code>mtvec</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine trap-handler base address</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mtvec</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mtvec</code> CSR is compatible to the RISC-V specifications. It stores the base address for ALL machine
traps. Thus, it defines the main entry point for exception/interrupt handling regardless of the actual trap
source. The lowest two bits of this register are always zero and cannot be modified (= address mode only).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 41. Machine trap-handler base address</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-byte aligned base address of trap base handler</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always zero</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mcounteren"><strong><code>mcounteren</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine counter enable</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mcounteren</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mcounteren</code> CSR is compatible to the RISC-V specifications. The bits of this CSR define which
counter/timer CSR can be accessed (read) from code running in a less-privileged modes. For example,
if user-level code tries to read from a counter/timer CSR without enabled access, an illegal instruction
exception is raised. NOTE: If the <code>U</code> ISA extension is not enabled this CSR does not exist.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 42. Machine counter enable register</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always zero: user-level code is <strong>not</strong> allowed to read HPM counters</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTEREN_IR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-level code is allowed to read <code>cycle[h]</code> CSRs when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTEREN_TM</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-level code is allowed to read <code>time[h]</code> CSRs when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTEREN_CY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-level code is allowed to read <code>instret[h]</code> CSRs when set</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mstatush"><strong><code>mstatush</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine status register - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mstatush</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>0x00000000</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mstatush</code> CSR is compatible to the RISC-V specifications. In combination with <a href="#_mstatus"><strong><code>mstatus</code></strong></a> it shows additional
execution state information. The NEORV32 <code>mstatush</code> CSR is read-only and all bits are hardwired to zero.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 <code>mstatush</code> CSR is not a physical register. All write access are ignored and all read accesses will always
return zero. However, any access will not raise an illegal instruction exception. The CSR address is implemented
in order to comply with the RISC-V privilege architecture specs.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_trap_handling_csrs">3.8.4. Machine Trap Handling CSRs</h4>
<div class="sect4">
<h5 id="_mscratch"><strong><code>mscratch</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x340</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Scratch register for machine trap handlers</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mscratch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mscratch</code> CSR is compatible to the RISC-V specifications. It is a general purpose scratch register that
can be used by the exception/interrupt handler. The content pf this register after reset is undefined.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mepc"><strong><code>mepc</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x341</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine exception program counter</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mepc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mepc</code> CSR is compatible to the RISC-V specifications. For exceptions (like an illegal instruction) this
register provides the address of the exception-causing instruction. For Interrupt (like a machine timer
interrupt) this register provides the address of the next not-yet-executed instruction.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mcause"><strong><code>mcause</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x342</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine trap cause</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mcause</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mcause</code> CSR is compatible to the RISC-V specifications. It show the cause ID for a taken exception.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 43. Machine trap cause register</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> if the trap is caused by an interrupt (<code>0</code> if the trap is caused by an exception)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30:5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trap ID, see <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mtval"><strong><code>mtval</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x343</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine bad address or instruction</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mtval</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mtval</code> CSR is compatible to the RISC-V specifications. When a trap is triggered, the CSR shows either
the faulting address (for misaligned/faulting load/stores/fetch) or the faulting instruction itself (for illegal
instructions). For interrupts the CSR is set to zero.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 44. Machine bad address or instruction register</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Trap cause</th>
<th class="tableblock halign-center valign-top"><code>mtval</code> content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">misaligned instruction fetch address or instruction fetch access fault</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">address of faulting instruction fetch</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">breakpoint</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">program counter (= address) of faulting instruction itself</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">misaligned load address, load access fault, misaligned store address or store access fault</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">program counter (= address) of faulting instruction itself</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">illegal instruction</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">actual instruction word of faulting instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">anything else including interrupts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>0x00000000</em> (always zero)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The NEORV32 <code>mtval</code> CSR is read-only. However, a write access will <em>NOT</em> raise an illegal instruction exception.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mip"><strong><code>mip</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x344</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine interrupt Pending</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mip</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>0x00000000</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mip</code> CSR is compatible to the RISC-V specifications and also provides custom extensions. It shows currently <em>pending</em> interrupts.
Since this register is read-only, pending interrupts of processor-internal modules can only be cleared by acknowledging the interrupt-causing
device. However, pending interrupts can be ignored by clearing the according <a href="#_mie"><strong><code>mie</code></strong></a> register bits.
The following CSR bits are implemented (all remaining bits are always zero and are read-only).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 45. Machine interrupt pending register</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIP_FIRQ15P</em> : <em>CSR_MIP_FIRQ0P</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 15..0 pending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIP_MEIP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine <em>external</em> interrupt pending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIP_MTIP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine <em>timer</em> interrupt pending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIP_MSIP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine <em>software</em> interrupt pending</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The NEORV32 <code>mip</code> CSR is read-only. However, a write access will <em>NOT</em> raise an illegal instruction exception.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_physical_memory_protection_csrs">3.8.5. Machine Physical Memory Protection CSRs</h4>
<div class="paragraph">
<p>The available physical memory protection logic is configured via the <em>PMP_NUM_REGIONS</em> and
<em>PMP_MIN_GRANULARITY</em> top entity generics. <em>PMP_NUM_REGIONS</em> defines the number of implemented
protection regions and thus, the availability of the according <code>pmpcfg*</code> and <code>pmpaddr*</code> CSRs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If trying to access an PMP-related CSR beyond <em>PMP_NUM_REGIONS</em> <strong>no illegal instruction
exception</strong> is triggered. The according CSRs are read-only (writes are ignored) and always return zero.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The RISC-V-compatible NEORV32 physical memory protection only implements the <em>NAPOT</em>
(naturally aligned power-of-two region) mode with a minimal region granularity of 8 bytes.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_pmpcfg"><strong><code>pmpcfg</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3a0 - 0x3af</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Physical memory protection configuration registers</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>pmpcfg0</code> - <code>pmpcfg15</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>0x00000000</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>pmpcfg*</code> CSRs are compatible to the RISC-V specifications. They are used to configure the protected
regions, where each <code>pmpcfg*</code> CSR provides configuration bits for four regions. The following bits (for the
first PMP configuration entry) are implemented (all remaining bits are always zero and are read-only):</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 46. Physical memory protection configuration register entry</caption>
<colgroup>
<col style="width: 6.25%;">
<col style="width: 18.75%;">
<col style="width: 6.25%;">
<col style="width: 68.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">RISC-V name</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>L</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lock bit, can be set - but not be cleared again (only via CPU reset)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6:5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>A</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode configuration; only OFF (<code>00</code>) and NAPOT (<code>11</code>) are supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>X</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">execute permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>W</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>R</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read permission</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_pmpaddr"><strong><code>pmpaddr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3b0 - 0x3ef</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Physical memory protection configuration registers</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>pmpaddr0</code> - <code>pmpaddr63</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>pmpaddr*</code> CSRs are compatible to the RISC-V specifications. They are used to configure the base
address and the region size.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When configuring PMP make sure to set <code>pmpaddr*</code> before activating the according region via
<code>pmpcfg*</code>. When changing the PMP configuration, deactivate the according region via <code>pmpcfg*</code>
before modifying <code>pmpaddr*</code>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_counter_and_timer_csrs">3.8.6. (Machine) Counter and Timer CSRs</h4>
<div class="paragraph">
<p>The (machine) counters and timers are implemented when the <code>Zicntr</code> ISA extensions is enabled (default)
via the <a href="#_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></a> generic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <a href="#_cpu_cnt_width"><em>CPU_CNT_WIDTH</em></a> generic defines the total size of the CPU&#8217;s <a href="#_cycleh"><strong><code>cycle[h]</code></strong></a> and <a href="#_instreth"><strong><code>instret[h]</code></strong></a>
/ <a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a> and <a href="#_minstreth"><strong><code>minstret[h]</code></strong></a>
counter CSRs (low and high words combined); the time CSRs are not affected by this generic. Note that any
configuration with <a href="#_cpu_cnt_width"><em>CPU_CNT_WIDTH</em></a> less than 64 is not RISC-V compliant.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Effective CPU counter width (<code>[m]cycle</code> &amp; <code>[m]instret</code>)</div>
If <em>CPU_CNT_WIDTH</em> is less than 64 (the default value) and greater than or equal 32, the according
MSBs of <code>[m]cycleh</code> and <code>[m]instreth</code> are read-only and always read as zero. This configuration
will also set the <em>SYSINFO_CPU_ZXSCNT</em> flag ("small counters") in the <code>CPU</code>
<a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> register.<br>
<br>
If <em>CPU_CNT_WIDTH</em> is less than 32 and greater than 0, the <code>[m]cycleh</code> and <code>[m]instreth</code> CSRs are hardwired to zero
and any write access to them is ignored. Furthermore, the according MSBs of <code>[m]cycle</code> and <code>[m]instret</code> are read-only
and always read as zero. This configuration will also set the <em>SYSINFO_CPU_ZXSCNT</em> flag ("small counters") in
the <code>CPU</code> <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> register.<br>
<br>
If <em>CPU_CNT_WIDTH</em> is 0, the <a href="#_cycleh"><strong><code>cycle[h]</code></strong></a> and <a href="#_instreth"><strong><code>instret[h]</code></strong></a> / <a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a> and <a href="#_minstreth"><strong><code>minstret[h]</code></strong></a> CSRs are hardwired to zero
and any write access to them is ignored.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_cycleh"><strong><code>cycle[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cycle counter - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>cycle</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cycle counter - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>cycleh</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>cycle[h]</code> CSR is compatible to the RISC-V specifications. It shows the lower/upper 32-bit of the 64-bit cycle
counter. The <code>cycle[h]</code> CSR is a read-only shadowed copy of the <code>mcycle[h]</code> CSR.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_timeh"><strong><code>time[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>System time - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>time</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>System time - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>timeh</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>time[h]</code> CSR is compatible to the RISC-V specifications. It shows the lower/upper 32-bit of the 64-bit system
time. The system time is either generated by the processor-internal <em>MTIME</em> system timer unit (if <em>IO_MTIME_EN</em> = <em>true</em>) or can be provided by an
external timer unit via the processor&#8217;s <code>mtime_i</code> signal (if <em>IO_MTIME_EN</em> = <em>false</em>).
CSR is read-only. Change the system time via the <em>MTIME</em> unit.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_instreth"><strong><code>instret[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Instructions-retired counter - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>instret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Instructions-retired counter - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>instreth</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>instret[h]</code> CSR is compatible to the RISC-V specifications. It shows the lower/upper 32-bit of the 64-bit retired
instructions counter. The <code>instret[h]</code> CSR is a read-only shadowed copy of the <code>minstret[h]</code> CSR.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mcycleh"><strong><code>mcycle[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine cycle counter - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mcycle</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine cycle counter - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mcycleh</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mcycle[h]</code> CSR is compatible to the RISC-V specifications. It shows the lower/upper 32-bit of the 64-bit cycle
counter. The <code>mcycle[h]</code> CSR can also be written when in machine mode and is copied to the <code>cycle[h]</code> CSR.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_minstreth"><strong><code>minstret[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine instructions-retired counter - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>minstret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine instructions-retired counter - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>minstreth</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>minstret[h]</code> CSR is compatible to the RISC-V specifications. It shows the lower/upper 32-bit of the 64-bit retired
instructions counter. The <code>minstret[h]</code> CSR also be written when in machine mode and is copied to the <code>instret[h]</code> CSR.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_hardware_performance_monitors_hpm_csrs">3.8.7. Hardware Performance Monitors (HPM) CSRs</h4>
<div class="paragraph">
<p>The hardware performance monitor CSRs are implemented when the <code>Zihpm</code> ISA extension is enabled via the
<a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a> generic.</p>
</div>
<div class="paragraph">
<p>The actually implemented hardware performance logic is configured via the <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> top entity generic,
which defines the number of implemented performance monitors. Note that always all 28 HPM counter and configuration registers
(<code>mhpmcounter*[h]</code> and <code>mhpmevent*</code>) are implemented, but only the actually configured ones are real registers and
not hardwired to zero.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If trying to access an HPM-related CSR beyond <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> <strong>no illegal instruction exception is
triggered</strong>. The according CSRs are read-only (writes are ignored) and always return zero.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The HPM system only allows machine-mode access. Hence, <code>hpmcounter*[h]</code> CSR are not implemented
and any access (even) from machine mode will raise an exception. Furthermore, the according bits of <a href="#_mcounteren"><strong><code>mcounteren</code></strong></a>
used to configure user-mode access to <code>hpmcounter*[h]</code> are hard-wired to zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The total counter width of the HPMs can be configured before synthesis via the <a href="#_hpm_cnt_width"><em>HPM_CNT_WIDTH</em></a> generic (0..64-bit).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The total LSB-aligned HPM counter size (low word CSR + high word CSR) is defined via the
<a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> generic (0..64-bit). If <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> is less than 64, all unused MSB-aligned
bits are hardwired to zero.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_mhpmevent"><strong><code>mhpmevent</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x232 -0x33f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine hardware performance monitor event selector</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mhpmevent3</code> - <code>mhpmevent31</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mhpmevent*</code> CSRs are compatible to the RISC-V specifications. The configuration of these CSR define
the architectural events that cause the according <code>mhpmcounter*[h]</code> counters to increment. All available events are
listed in the table below. If more than one event is selected, the according counter will increment if any of
the enabled events is observed (logical OR). Note that the counter will only increment by 1 step per clock
cycle even if more than one event is observed. If the CPU is in sleep mode, no HPM counter will increment
at all.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The available hardware performance logic is configured via the <em>HPM_NUM_CNTS</em> top entity generic.
<em>HPM_NUM_CNTS</em> defines the number of implemented performance monitors and thus, the availability of the
according <code>mhpmcounter*[h]</code> and <code>mhpmevent*</code> CSRs.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 47. HPM event selector</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Event</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_CY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">active clock cycle (not in sleep)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>not implemented, always read as zero</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_IR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retired instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_CIR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retired compressed instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_WAIT_IF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction fetch memory wait cycle (if more than 1 cycle memory latency)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_WAIT_II</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction issue pipeline wait cycle (if more than 1 cycle latency), caused by pipelines flushes (like taken branches)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_WAIT_MC</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multi-cycle ALU operation wait cycle</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_LOAD</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_STORE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_WAIT_LS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load/store memory wait cycle (if more than 1 cycle memory latency)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_JUMP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unconditional jump</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_BRANCH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditional branch (taken or not taken)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_TBRANCH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">taken conditional branch</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_TRAP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entered trap</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>HPMCNT_EVENT_ILLEGAL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">illegal instruction exception</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mhpmcounterh"><strong><code>mhpmcounter[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb03 - 0xb1f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine hardware performance monitor - counter low</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mhpmcounter3</code> - <code>mhpmcounter31</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb83 - 0xb9f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine hardware performance monitor - counter high</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mhpmcounter3h</code> - <code>mhpmcounter31h</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mhpmcounter*[h]</code> CSRs are compatible to the RISC-V specifications. These CSRs provide the lower/upper 32-
bit of arbitrary event counters. The event(s) that trigger an increment of theses counters are selected via the according
<code>mhpmevent*</code> CSRs bits.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_counter_setup_csrs">3.8.8. Machine Counter Setup CSRs</h4>
<div class="sect4">
<h5 id="_mcountinhibit"><strong><code>mcountinhibit</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x320</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine counter-inhibit register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mcountinhibit</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mcountinhibit</code> CSR is compatible to the RISC-V specifications. The bits in this register define which
counter/timer CSR are allowed to perform an automatic increment. Automatic update is enabled if the
according bit in <code>mcountinhibit</code> is cleared. The following bits are implemented (all remaining bits are
always zero and are read-only).</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 48. Machine counter-inhibit register</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 30%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Event</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTINHIBIT_IR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the <code>[m]instret[h]</code> CSRs will auto-increment with each committed instruction when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTINHIBIT_IR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the <code>[m]cycle[h]</code> CSRs will auto-increment with each clock cycle (if CPU is not in sleep state) when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTINHIBIT_HPM3</em> <em>: _CSR_MCOUNTINHIBIT_HPM31</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the <code>mhpmcount*[h]</code> CSRs will auto-increment according to the configured <code>mhpmevent*</code> selector</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_information_csrs">3.8.9. Machine Information CSRs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All machine information registers can only be accessed in machine mode and are read-only.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_mvendorid"><strong><code>mvendorid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine vendor ID</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mvendorid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>0x00000000</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mvendorid</code> CSR is compatible to the RISC-V specifications. It is read-only and always reads zero.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_marchid"><strong><code>marchid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine architecture ID</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>marchid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>0x00000013</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>marchid</code> CSR is compatible to the RISC-V specifications. It is read-only and shows the NEORV32
official <em>RISC-V open-source architecture ID</em> (decimal: 19, 32-bit hexadecimal: 0x00000013).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mimpid"><strong><code>mimpid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine implementation ID</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mimpid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>HW version number</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mimpid</code> CSR is compatible to the RISC-V specifications. It is read-only and shows the version of the
NEORV32 as BCD-coded number (example: <code>mimpid</code> = <em>0x01020312</em> → 01.02.03.12 → version 1.2.3.12).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mhartid"><strong><code>mhartid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine hardware thread ID</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mhartid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>HW_THREAD_ID</em> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>mhartid</code> CSR is compatible to the RISC-V specifications. It is read-only and shows the core&#8217;s hart ID,
which is assigned via the CPU&#8217;s <em>HW_THREAD_ID</em> generic.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mconfigptr"><strong><code>mconfigptr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine configuration pointer register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mconfigptr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This register holds a physical address (if not zero) that points to the base address of an architecture configuration structure.
Software can traverse this data structure to discover information about the harts, the platform, and their configuration.
<strong>NOTE: Not assigned yet.</strong></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_traps_exceptions_and_interrupts">3.8.10. Traps, Exceptions and Interrupts</h4>
<div class="paragraph">
<p>In this document the following nomenclature regarding traps is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>interrupts</em> = asynchronous exceptions</p>
</li>
<li>
<p><em>exceptions</em> = synchronous exceptions</p>
</li>
<li>
<p><em>traps</em> = exceptions + interrupts (synchronous or asynchronous exceptions)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whenever an exception or interrupt is triggered, the CPU transfers control to the address stored in <code>mtvec</code>
CSR. The cause of the according interrupt or exception can be determined via the content of <code>mcause</code>
CSR. The address that reflects the current program counter when a trap was taken is stored to <code>mepc</code> CSR.
Additional information regarding the cause of the trap can be retrieved from <code>mtval</code> CSR.</p>
</div>
<div class="paragraph">
<p>The traps are prioritized. If several <em>exceptions</em> occur at once only the one with highest priority is triggered
while all remaining exceptions are ignored. If several <em>interrupts</em> trigger at once, the one with highest priority
is serviced first while the remaining ones stay <em>pending</em>. After completing the interrupt handler the interrupt with
the second highest priority will get serviced and so on until no further interrupt are pending.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupt Signal Requirements</div>
All interrupts request signals (including FIRQs) are <strong>high-active</strong>. A request has to stay at high-level (=asserted)
until it is explicitly acknowledged by the CPU software (for example by writing to a specific memory-mapped register).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction Atomicity</div>
All instructions execute as atomic operations - interrupts can only trigger between two instructions.
So if there is a permanent interrupt request, exactly one instruction from the interrupt program will be executed before
a new interrupt handler can start.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_memory_access_exceptions">3.8.11. Memory Access Exceptions**</h4>
<div class="paragraph">
<p>If a load operation causes any exception, the instruction&#8217;s destination register is
<em>not written</em> at all. Load exceptions caused by a misalignment or a physical memory protection fault do not
trigger a bus read-operation at all. Exceptions caused by a store address misalignment or a store physical
memory protection fault do not trigger a bus write-operation at all.</p>
</div>
</div>
<div class="sect3">
<h4 id="_custom_fast_interrupt_request_lines">3.8.12. Custom Fast Interrupt Request Lines</h4>
<div class="paragraph">
<p>As a custom extension, the NEORV32 CPU features 16 fast interrupt request (FIRQ) lines via the <code>firq_i</code> CPU top
entity signals. These interrupts have custom configuration and status flags in the <code>mie</code> and <code>mip</code> CSRs and also
provide custom trap codes in <code>mcause</code>. These FIRQs are reserved for NEORV32 processor-internal usage only.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect4">
<h5 id="_neorv32_trap_listing">NEORV32 Trap Listing</h5>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 49. NEORV32 trap listing</caption>
<colgroup>
<col style="width: 6.3829%;">
<col style="width: 12.7659%;">
<col style="width: 10.6382%;">
<col style="width: 29.7872%;">
<col style="width: 23.4042%;">
<col style="width: 8.5106%;">
<col style="width: 8.511%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prio.</th>
<th class="tableblock halign-left valign-top"><code>mcause</code></th>
<th class="tableblock halign-left valign-top">[RISC-V]</th>
<th class="tableblock halign-left valign-top">ID [C]</th>
<th class="tableblock halign-left valign-top">Cause</th>
<th class="tableblock halign-left valign-top"><code>mepc</code></th>
<th class="tableblock halign-left valign-top"><code>mtval</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction access fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000002</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_ILLEGAL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">illegal instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Inst</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0000000B</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MENV_CALL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from M-mode (<code>ecall</code> in machine-mode)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_UENV_CALL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from U-mode (<code>ecall</code> in user-mode)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000003</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_BREAKPOINT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">breakpoint (EBREAK)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>PC</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000006</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_S_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_L_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000007</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_S_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store access fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000005</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_L_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load access fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>B-ADR</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000011</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_1</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000012</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_2</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000013</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_3</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000014</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_4</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000015</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_5</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000016</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_6</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000017</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_7</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000018</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_8</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000019</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_9</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_10</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_11</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_12</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_13</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_14</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_15</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000000B</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MEI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000003</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MSI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000007</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MTI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>I-PC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes</strong></p>
</div>
<div class="paragraph">
<p>The "Prio." column shows the priority of each trap. The highest priority is 1. The &#8220;mcause&#8221; column shows the
cause ID of the according trap that is written to <code>mcause</code> CSR. The "[RISC-V]" columns show the interrupt/exception code value from the
official RISC-V privileged architecture manual. The "[C]" names are defined by the NEORV32 core library (<code>sw/lib/include/neorv32.h</code>) and can
be used in plain C code. The &#8220;mepc&#8221; and &#8220;mtval&#8221; columns show the value written to
<code>mepc</code> and <code>mtval</code> CSRs when a trap is triggered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>I-PC</em> - address of interrupted instruction (instruction has not been execute/completed yet)</p>
</li>
<li>
<p><em>B-ADR</em>- bad memory access address that cause the trap</p>
</li>
<li>
<p><em>PC</em> - address of instruction that caused the trap</p>
</li>
<li>
<p><em>0</em> - zero</p>
</li>
<li>
<p><em>Inst</em> - the faulting instruction itself</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_bus_interface">3.8.13. Bus Interface</h4>
<div class="paragraph">
<p>The CPU provides two independent bus interfaces: One for fetching instructions (<code>i_bus_*</code>) and one for
accessing data (<code>d_bus_*</code>) via load and store operations. Both interfaces use the same interface protocol.</p>
</div>
<div class="sect4">
<h5 id="_address_space_2">Address Space</h5>
<div class="paragraph">
<p>The CPU is a 32-bit architecture with separated instruction and data interfaces making it a Harvard
Architecture. Each of this interfaces can access an address space of up to 2<sup>32</sup> bytes (4GB). The memory
system is based on 32-bit words with a minimal granularity of 1 byte. Please note, that the NEORV32 CPU
does not support unaligned memory accesses <em>in hardware</em> - however, a software-based handling can be
implemented as any unaligned memory access will trigger an according exception.</p>
</div>
</div>
<div class="sect4">
<h5 id="_interface_signals">Interface Signals</h5>
<div class="paragraph">
<p>The following table shows the signals of the data and instruction interfaces seen from the CPU
(<code>*_o</code> signals are driven by the CPU / outputs, <code>*_i</code> signals are read by the CPU / inputs).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 50. CPU bus interface</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Size</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_addr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_rdata_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data input for read operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_wdata_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data output for write operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_ben_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable signal for write operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus write access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_re_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus read access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_lock_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclusive access request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessed peripheral indicates a successful completion of the bus transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessed peripheral indicates an error during the bus transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_fence_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">this signal is set for one cycle when the CPU executes a data/instruction fence operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bus_priv_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current CPU privilege level</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, there a no pipelined or overlapping operations implemented within the same bus interface.
So only a single transfer request can be "on the fly".
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_protocol">Protocol</h5>
<div class="paragraph">
<p>A bus request is triggered either by the <code>bus_re_o</code> signal (for reading data) or by the <code>bus_we_o</code> signal (for
writing data). These signals are active for exactly one cycle and initiate either a read or a write transaction. The transaction is
completed when the accessed peripheral either sets the <code>bus_ack_i</code> signal (&#8594; successful completion) or the
<code>bus_err_i</code> signal is set (&#8594; failed completion). All these control signals are only active (= high) for one
single cycle. An error indicated via the <code>bus_err_i</code> signal during a transfer will trigger the according instruction bus
access fault or load/store bus access fault exception.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The transfer can be completed directly in the same cycle as it was initiated (via the <code>bus_re_o</code> or <code>bus_we_o</code>
signal) if the peripheral sets <code>bus_ack_i</code> or <code>bus_err_i</code> high for one cycle. However, in order to shorten the critical path such "asynchronous"
completion should be avoided. The default processor-internal module provide exactly <strong>one cycle delay</strong> between initiation and completion of transfers.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Bus Keeper: Processor-internal memories and memory-mapped devices with variable / high latency</div>
Processor-internal peripherals or memories do not have to respond within one cycle after the transfer initiation (= latency &gt; 1 cycle).
However, the bus transaction has to be completed (= acknowledged) within a certain <strong>response time window</strong>. This time window is defined
by the global <code>max_proc_int_response_time_c</code> constant (default = 15 cycles) from the processor&#8217;s VHDL package file (<code>rtl/neorv32_package.vhd</code>).
It defines the maximum number of cycles after which an <em>unacknowledged</em> processor-internal bus transfer will timeout and raise a <strong>bus fault exception</strong>.
The <em>BUSKEEPER</em> hardware module (see section <a href="#_internal_bus_monitor_buskeeper">Internal Bus Monitor (BUSKEEPER)</a>) keeps track of all <em>internal</em> bus transactions. If any bus operations times out
(for example when accessing "address space holes") this unit will issue a bus error to the CPU that will raise the according instruction fetch or data access bus exception.
Note that <strong>the bus keeper does not track external accesses via the external memory bus interface</strong>. However, the external memory bus interface also provides
an <em>optional</em> bus timeout (see section <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Exemplary Bus Accesses</strong></p>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 51. Example bus accesses: see read/write access description below</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/cpu_interface_read_long.png" alt="read" width="300" height="150">
</div>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/cpu_interface_write_long.png" alt="write" width="300" height="150">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Read access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Write access</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Write Access</strong></p>
</div>
<div class="paragraph">
<p>For a write access, the accessed address (<code>bus_addr_o</code>), the data to be written (<code>bus_wdata_o</code>) and the byte
enable signals (<code>bus_ben_o</code>) are set when bus_we_o goes high. These three signals are kept stable until the
transaction is completed. In the example the accessed peripheral cannot answer directly in the next
cycle after issuing. Here, the transaction is successful and the peripheral sets the <code>bus_ack_i</code> signal several
cycles after issuing.</p>
</div>
<div class="paragraph">
<p><strong>Read Access</strong></p>
</div>
<div class="paragraph">
<p>For a read access, the accessed address (<code>bus_addr_o</code>) is set when <code>bus_re_o</code> goes high. The address is kept
stable until the transaction is completed. In the example the accessed peripheral cannot answer
directly in the next cycle after issuing. The peripheral hast to apply the read data right in the same cycle as
the bus transaction is completed (here, the transaction is successful and the peripheral sets the <code>bus_ack_i</code>
signal).</p>
</div>
<div class="paragraph">
<p><strong>Access Boundaries</strong></p>
</div>
<div class="paragraph">
<p>The instruction interface will always access memory on word (= 32-bit) boundaries even if fetching
compressed (16-bit) instructions. The data interface can access memory on byte (= 8-bit), half-word (= 16-
bit) and word (= 32-bit) boundaries.</p>
</div>
<div class="paragraph">
<p><strong>Exclusive (Atomic) Access</strong></p>
</div>
<div class="paragraph">
<p>The CPU can access memory in an exclusive manner by generating a load-reservate and store-conditional
combination. Normally, these combinations should target the same memory address.</p>
</div>
<div class="paragraph">
<p>The CPU starts an exclusive access to memory via the <em>load-reservate instruction</em> (<code>lr.w</code>). This instruction
will set the CPU-internal <em>exclusive access lock</em>, which directly drives the <code>d_bus_lock_o</code>. It is the task of
the memory system to manage this exclusive access reservation by storing the according access address and
the source of the access itself (for example via the CPU ID in a multi-core system).</p>
</div>
<div class="paragraph">
<p>When the CPU executes a <em>store-conditional instruction</em> (<code>sc.w</code>) the <em>CPU-internal exclusive access lock</em> is
evaluated to check if the exclusive access was successful. If the lock is still OK, the instruction will write-back
zero and will allow the according store operation to the memory system. If the lock is broken, the
instruction will write-back non-zero and will not generate an actual memory store operation.</p>
</div>
<div class="paragraph">
<p>The CPU-internal exclusive access lock is broken if at least one of the situations appear.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when executing any other memory-access operation than <code>lr.w</code></p>
</li>
<li>
<p>when any trap (sync. or async.) is triggered (for example to force a context switch)</p>
</li>
<li>
<p>when the memory system signals a bus error (via the <code>bus_err_i</code> signal)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more information regarding the SoC-level behavior and requirements of atomic operations see
section <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Memory Barriers</strong></p>
</div>
<div class="paragraph">
<p>Whenever the CPU executes a fence instruction, the according interface signal is set high for one cycle
(<code>d_bus_fence_o</code> for a <em>fence</em> instruction; <code>i_bus_fence_o</code> for a <em>fencei</em> instruction). It is the task of the
memory system to perform the necessary operations (like a cache flush and refill).</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_hardware_reset">3.8.14. CPU Hardware Reset</h4>
<div class="paragraph">
<p>In order to reduce routing constraints (and by this the actual hardware requirements), most uncritical
registers of the NEORV32 CPU as well as most register of the whole NEORV32 Processor do not use <strong>a
dedicated hardware reset</strong>. "Uncritical registers" in this context means that the initial value of these registers
after power-up is not relevant for a defined CPU boot process.</p>
</div>
<div class="paragraph">
<p><strong>Rational</strong></p>
</div>
<div class="paragraph">
<p>A good example to illustrate the concept of uncritical registers is a pipelined processing engine. Each stage
of the engine features an N-bit <em>data register</em> and a 1-bit <em>status register</em>. The status register is set when the
data in the according data register is valid. At the end of the pipeline the status register might trigger a write-back
of the processing result to some kind of memory. The initial status of the data registers after power-up is
irrelevant as long as the status registers are all reset to a defined value that indicates there is no valid data in
the pipeline’s data register. Therefore, the pipeline data register do no require a dedicated reset as they do not
control the actual operation (in contrast to the status register). This makes the pipeline data registers from
this example "uncritical registers".</p>
</div>
<div class="paragraph">
<p><strong>NEORV32 CPU Reset</strong></p>
</div>
<div class="paragraph">
<p>In terms of the NEORV32 CPU, there are several pipeline registers, state machine registers and even status
and control registers (CSRs) that do not require a defined initial state to ensure a correct boot process. The
pipeline register will get initialized by the CPU’s internal state machines, which are initialized from the main
control engine that actually features a defined reset. The initialization of most of the CPU&#8217;s core CSRs (like
interrupt control) is done by the software (to be more specific, this is done by the <code>crt0.S</code> start-up code).</p>
</div>
<div class="paragraph">
<p>During the very early boot process (where <code>crt0.S</code> is running) there is no chance for undefined behavior due to
the lack of dedicated hardware resets of certain CSRs. For example the machine interrupt-enable CSR (<code>mie</code>)
does not provide a dedicated reset. The value after reset of this register is uncritical as interrupts cannot fire
because the global interrupt enabled flag in the status register (<code>mstatsus(mie)</code>) provides a dedicated
hardware reset setting it to low (globally disabling interrupts).</p>
</div>
<div class="paragraph">
<p><strong>Reset Configuration</strong></p>
</div>
<div class="paragraph">
<p>Most CPU-internal register do feature an asynchronous reset in the VHDL code, but the "don&#8217;t care" value
(VHDL <code>'-'</code>) is used for initialization of the uncritical register, effectively generating a flip-flop without a
reset. However, certain applications or situations (like advanced gate-level / timing simulations) might
require a more deterministic reset state. For this case, a defined reset level (reset-to-low) of all registers can
be enabled via a constant in the main VHDL package file (<code>rtl/core/neorv32_package.vhd</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">-- "critical" number of PMP regions --
constant dedicated_reset_c : boolean := false; -- use dedicated hardware reset value
for UNCRITICAL registers (FALSE=reset value is irrelevant (might simplify HW),
default; TRUE=defined LOW reset value)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_framework">4. Software Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To make actual use of the NEORV32 processor, the project comes with a complete software eco-system. This
ecosystem is based on the RISC-V port of the GCC GNU Compiler Collection and consists of the following elementary parts:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application/bootloader start-up code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/crt0.S</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application/bootloader linker script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/neorv32.ld</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core hardware driver libraries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/lib/include/</code> &amp; <code>sw/lib/source/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Central makefile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/common.mk</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auxiliary tool for generating NEORV32 executables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/image_gen/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default bootloader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/bootloader/bootloader.c</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Last but not least, the NEORV32 ecosystem provides some example programs for testing the hardware, for
illustrating the usage of peripherals and for general getting in touch with the project (<code>sw/example</code>).</p>
</div>
<div class="sect2">
<h3 id="_compiler_toolchain">4.1. Compiler Toolchain</h3>
<div class="paragraph">
<p>The toolchain for this project is based on the free RISC-V GCC-port. You can find the compiler sources and
build instructions on the official RISC-V GNU toolchain GitHub page: <a href="https://github.com/riscv/riscv-gnutoolchain" class="bare">https://github.com/riscv/riscv-gnutoolchain</a>.</p>
</div>
<div class="paragraph">
<p>The NEORV32 implements a 32-bit base integer architecture (<code>rv32i</code>) and a 32-bit integer and soft-float ABI
(ilp32), so make sure you build an according toolchain.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can download my prebuilt <code>rv32i/e</code> toolchains for 64-bit x86 Linux from: <a href="https://github.com/stnolting/riscv-gcc-prebuilt" class="bare">https://github.com/stnolting/riscv-gcc-prebuilt</a></p>
</div>
<div class="paragraph">
<p>The default toolchain prefix used by the project&#8217;s makefiles is (can be changed in the makefiles): <strong><code>riscv32-unknown-elf</code></strong></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information regarding the toolchain (building from scratch or downloading the prebuilt ones)
can be found in the user guides' section <a href="https://stnolting.github.io/neorv32/ug/#_software_toolchain_setup">Software Toolchain Setup</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_core_libraries">4.2. Core Libraries</h3>
<div class="paragraph">
<p>The NEORV32 project provides a set of C libraries that allows an easy usage of the processor/CPU features.
Just include the main NEORV32 library file in your application&#8217;s source file(s):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;neorv32.h&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Together with the makefile, this will automatically include all the processor&#8217;s header files located in
<code>sw/lib/include</code> into your application. The actual source files of the core libraries are located in
<code>sw/lib/source</code> and are automatically included into the source list of your software project. The following
files are currently part of the NEORV32 core library:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 26.6666%;">
<col style="width: 53.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">C source file</th>
<th class="tableblock halign-left valign-top">C header file</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">main NEORV32 definitions and library file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfs.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfs.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver (stub)<sup class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnotedef_15" title="View footnote.">15</a>]</sup> functions for the custom functions subsystem</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the NEORV32 <strong>CPU</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gpio.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gpio.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>GPIO</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gptmr.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gptmr.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>GPTRM</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_intrinsics.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">macros for custom intrinsics/instructions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_legacy.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">legacy back-compatibility layer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_mtime.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_mtime.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>MTIME</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_neoled.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_neoled.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>NEOLED</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_pwm.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_pwm.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>PWM</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_rte.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_rte.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEORV32 <strong>runtime environment</strong> and helpers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_slink.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_slink.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>SLINK</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_spi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_spi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>SPI</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_trng.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_trng.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>TRNG</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>TWI</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_uart.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_uart.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>UART0</strong> and <strong>UART1</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_wdt.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_wdt.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>WDT</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xirq.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xirq.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>XIRQ</strong></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Documentation</div>
All core library software sources are highly documented using <em>doxygen</em>. See section <a href="#Building the Software Framework Documentation">[Building the Software Framework Documentation]</a>.
The documentation is automatically built and deployed to GitHub pages by the CI workflow (:https://stnolting.github.io/neorv32/sw/files.html).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_application_makefile">4.3. Application Makefile</h3>
<div class="paragraph">
<p>Application compilation is based on a single, centralized <strong>GNU makefiles</strong> <code>sw/common/common.mk</code>. Each project in the
<code>sw/example</code> folder features a makefile that just includes this central makefile. When creating a new project, copy an existing project folder or
at least the makefile to your new project folder. I suggest to create new projects also in <code>sw/example</code> to keep
the file dependencies. Of course, these dependencies can be manually configured via makefiles variables
when your project is located somewhere else.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Before you can use the makefiles, you need to install the RISC-V GCC toolchain. Also, you have to add the
installation folder of the compiler to your system&#8217;s <code>PATH</code> variable. More information can be found in
<a href="https://stnolting.github.io/neorv32/ug/#_software_toolchain_setup">User Guide: Software Toolchain Setup</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The makefile is invoked by simply executing make in your console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_targets">4.3.1. Targets</h4>
<div class="paragraph">
<p>Just executing <code>make</code> (or executing <code>make help</code>) will show the help menu listing all available targets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile">$ make
&lt;&lt;&lt; NEORV32 Application Makefile &gt;&gt;&gt;
Make sure to add the bin folder of RISC-V GCC to your PATH variable.
Targets:
 help       - show this text
 check      - check toolchain
 info       - show makefile/toolchain configuration
 exe        - compile and generate &lt;neorv32_exe.bin&gt; executable for upload via bootloader
 hex        - compile and generate &lt;neorv32_exe.hex&gt; executable raw file
 image      - compile and generate VHDL IMEM boot image (for application) in local folder
 install    - compile, generate and install VHDL IMEM boot image (for application)
 sim        - in-console simulation using default/simple testbench and GHDL
 all        - exe + hex + install
 elf_info   - show ELF layout info
 clean      - clean up project
 clean_all  - clean up project, core libraries and image generator
 bl_image   - compile and generate VHDL BOOTROM boot image (for bootloader only!) in local folder
 bootloader - compile, generate and install VHDL BOOTROM boot image (for bootloader only!)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">4.3.2. Configuration</h4>
<div class="paragraph">
<p>The compilation flow is configured via variables right at the beginning of the <strong>central</strong>
makefile (<code>sw/common/common.mk</code>):</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The makefile configuration variables can be (re-)defined directly when invoking the makefile. For
example via <code>$ make MARCH=rv32ic clean_all exe</code>. You can also make project-specific definitions
of all variables inside the project&#8217;s actual makefile (e.g., <code>sw/example/blink_led/makefile</code>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># *****************************************************************************
# USER CONFIGURATION
# *****************************************************************************
# User's application sources (*.c, *.cpp, *.s, *.S); add additional files here
APP_SRC ?= $(wildcard ./*.c) $(wildcard ./*.s) $(wildcard ./*.cpp) $(wildcard ./*.S)
# User's application include folders (don't forget the '-I' before each entry)
APP_INC ?= -I .
# User's application include folders - for assembly files only (don't forget the '-I' before each
entry)
ASM_INC ?= -I .
# Optimization
EFFORT ?= -Os
# Compiler toolchain
RISCV_PREFIX ?= riscv32-unknown-elf-
# CPU architecture and ABI
MARCH ?= rv32i
MABI  ?= ilp32
# User flags for additional configuration (will be added to compiler flags)
USER_FLAGS ?=
# Relative or absolute path to the NEORV32 home folder
NEORV32_HOME ?= ../../..
# *****************************************************************************</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 23.0769%;">
<col style="width: 76.9231%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>APP_SRC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source files of the application (<code><strong>.c</code>, <code></strong>.cpp</code>, <code><strong>.S</code> and <code></strong>.s</code> files are allowed; file of these types in the project folder are automatically added via wildcards). Additional files can be added; separated by white spaces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>APP_INC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include file folders; separated by white spaces; must be defined with <code>-I</code> prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ASM_INC</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include file folders that are used only for the assembly source files (<code><strong>.S</code>/<code></strong>.s</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>EFFORT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optimization level, optimize for size (<code>-Os</code>) is default; legal values: <code>-O0</code>, <code>-O1</code>, <code>-O2</code>, <code>-O3</code>, <code>-Os</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RISCV_PREFIX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The toolchain prefix to be used; follows the naming convention "architecture-vendor-output-"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MARCH</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The targeted RISC-V architecture/ISA. Only <code>rv32</code> is supported by the NEORV32. Enable compiler support of optional CPU extension by adding the according extension letter (e.g. <code>rv32im</code> for <em>M</em> CPU extension). See <a href="https://stnolting.github.io/neorv32/ug/#_enabling_risc_v_cpu_extensions">User Guide: Enabling RISC-V CPU Extensions</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MABI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default 32-bit integer ABI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>USER_FLAGS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional flags that will be forwarded to the compiler tools</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>NEORV32_HOME</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative or absolute path to the NEORV32 project home folder. Adapt this if the makefile/project is not in the project&#8217;s <code>sw/example folder</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>COM_PORT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default serial port for executable upload to bootloader.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_default_compiler_flags">4.3.3. Default Compiler Flags</h4>
<div class="paragraph">
<p>The following default compiler flags are used for compiling an application. These flags are defined via the
<code>CC_OPTS</code> variable. Custom flags can be appended via the <code>USER_FLAGS</code> variable to the <code>CC_OPTS</code> variable.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Wall</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable all compiler warnings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ffunction-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put functions and data segment in independent sections. This allows a code optimization as dead code and unused data can be easily removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-nostartfiles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use the default start code. The makefiles use the NEORV32-specific start-up code instead (<code>sw/common/crt0.S</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Wl,--gc-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make the linker perform dead code elimination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include/link with <code>math.h</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for the standard C library when linking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lgcc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make sure we have no unresolved references to internal GCC library subroutines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mno-fdiv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use built-in software functions for floating-point divisions and square roots (since the according instructions are not supported yet).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-falign-functions=4</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">Force a 32-bit alignment of functions and labels (branch/jump/call targets). This increases performance as it simplifies instruction fetch when using the C extension. As a drawback this will also slightly increase the program code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-falign-labels=4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-falign-loops=4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-falign-jumps=4</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_executable_image_format">4.4. Executable Image Format</h3>
<div class="paragraph">
<p>In order to generate a file, which can be executed by the processor, all source files have to be compiler, linked
and packed into a final <em>executable</em>.</p>
</div>
<div class="sect3">
<h4 id="_linker_script">4.4.1. Linker Script</h4>
<div class="paragraph">
<p>When all the application sources have been compiled, they need to be <em>linked</em> in order to generate a unified
program file. For this purpose the makefile uses the NEORV32-specific linker script <code>sw/common/neorv32.ld</code> for
linking all object files that were generated during compilation.</p>
</div>
<div class="paragraph">
<p>The linker script defines three memory <em>sections</em>: <code>rom</code>, <code>ram</code> and <code>iodev</code>. Each section provides specific
access <em>attributes</em>: read access (<code>r</code>), write access (<code>w</code>) and executable (<code>x</code>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 52. Linker memory sections - general</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Memory section</th>
<th class="tableblock halign-center valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ram</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rwx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data memory address space (processor-internal/external DMEM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rom</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction memory address space (processor-internal/external IMEM) <em>or</em> internal bootloader ROM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iodev</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal memory-mapped IO/peripheral devices address space</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These sections are defined right at the beginning of the linker script:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Linker memory sections - cut-out from linker script <code>neorv32.ld</code></div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">MEMORY
{
  ram  (rwx) : ORIGIN = 0x80000000, LENGTH = DEFINED(make_bootloader) ? 512 : 8*1024
  rom   (rx) : ORIGIN = DEFINED(make_bootloader) ? 0xFFFF0000 : 0x00000000, LENGTH = DEFINED(make_bootloader) ? 32K : 2048M
  iodev (rw) : ORIGIN = 0xFFFFFE00, LENGTH = 512
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each memory section provides a <em>base address</em> <code>ORIGIN</code> and a <em>size</em> <code>LENGTH</code>. The base address and size of the <code>iodev</code> section is
fixed and must not be altered. The base addresses and sizes of the <code>ram</code> and <code>rom</code> regions correspond to the total available instruction
and data memory address space (see section <a href="#_address_space_layout">Address Space Layout</a>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>ORIGIN</code> of the <code>ram</code> section has to be always identical to the processor&#8217;s <code>dspace_base_c</code> hardware configuration. Additionally,
<code>ORIGIN</code> of the <code>rom</code> section has to be always identical to the processor&#8217;s <code>ispace_base_c</code> hardware configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The sizes of <code>ram</code> section has to be equal to the size of the <strong>physical available data instruction memory</strong>. For example, if the processor
setup only uses processor-internal DMEM (<a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> = <em>true</em> and no external data memory attached) the <code>LENGTH</code> parameter of
this memory section has to be equal to the size configured by the <a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a> generic.</p>
</div>
<div class="paragraph">
<p>The sizes of <code>rom</code> section is a little bit more complicated. The default linker script configuration assumes a <em>maximum</em> of 2GB <em>logical</em>
memory space, which is also the default configuration of the processor&#8217;s hardware instruction memory address space. This size <em>does not</em> have
to reflect the <em>actual</em> physical size of the instruction memory (internal IMEM and/or processor-external memory). It just provides a maximum
limit. When uploading new executable via the bootloader, the bootloader itself checks if sufficient <em>physical</em> instruction memory is available.
If a new executable is embedded right into the internal-IMEM the synthesis tool will check, if the configured instruction memory size
is sufficient (e.g., via the <a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a> generic).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>rom</code> region uses a conditional assignment (via the <code>make_bootloader</code> symbol) for <code>ORIGIN</code> and <code>LENGTH</code> that is used to place
"normal executable" (i.e. for the IMEM) or "the bootloader image" to their according memories.<br>
<br>
The <code>ram</code> region also uses a conditional assignment (via the <code>make_bootloader</code> symbol) for <code>LENGTH</code>. When compiling the bootloader
(<code>make_bootloader</code> symbol is set) the generated bootloader will only use the <em>first</em> 512 bytes of the data address space. This is
a fall-back to ensure the bootloader can operate independently of the actual <em>physical</em> data memory size.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The linker maps all the regions from the compiled object files into four final sections: <code>.text</code>, <code>.rodata</code>, <code>.data</code> and <code>.bss</code>.
These four regions contain everything required for the application to run:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 53. Linker memory regions</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Region</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executable instructions generated from the start-up code and all application sources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.rodata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constants (like strings) from the application; also the initial data for initialized variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section is required for the address generation of fixed (= global) variables only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.bss</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section is required for the address generation of dynamic memory constructs only.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>.text</code> and <code>.rodata</code> sections are mapped to processor&#8217;s instruction memory space and the <code>.data</code> and
<code>.bss</code> sections are mapped to the processor&#8217;s data memory space. Finally, the <code>.text</code>, <code>.rodata</code> and <code>.data</code>
sections are extracted and concatenated into a single file <code>main.bin</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_executable_image_generator">4.4.2. Executable Image Generator</h4>
<div class="paragraph">
<p>The <code>main.bin</code> file is packed by the NEORV32 image generator (<code>sw/image_gen</code>) to generate the final executable file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The sources of the image generator are automatically compiled when invoking the makefile.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The image generator can generate three types of executables, selected by a flag when calling the generator:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-app_bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable binary file <code>neorv32_exe.bin</code> (for UART uploading via the bootloader).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-app_hex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a plain ASCII hex-char file <code>neorv32_exe.hex</code> that can be used to initialize custom (instruction-) memories (in synthesis/simulation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-app_img</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable VHDL memory initialization image for the processor-internal IMEM. This option generates the <code>rtl/core/neorv32_application_image.vhd</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-bld_img</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable VHDL memory initialization image for the processor-internal BOOT ROM. This option generates the <code>rtl/core/neorv32_bootloader_image.vhd</code> file.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All these options are managed by the makefile. The <em>normal application</em> compilation flow will generate the <code>neorv32_exe.bin</code>
executable to be upload via UART to the NEORV32 bootloader.</p>
</div>
<div class="paragraph">
<p>The image generator add a small header to the <code>neorv32_exe.bin</code> executable, which consists of three 32-bit words located right at the
beginning of the file. The first word of the executable is the signature word and is always <code>0x4788cafe</code>. Based on this word the bootloader
can identify a valid image file. The next word represents the size in bytes of the actual program
image in bytes. A simple "complement" checksum of the actual program image is given by the third word. This
provides a simple protection against data transmission or storage errors.</p>
</div>
</div>
<div class="sect3">
<h4 id="_start_up_code_crt0">4.4.3. Start-Up Code (crt0)</h4>
<div class="paragraph">
<p>The CPU and also the processor require a minimal start-up and initialization code to bring the CPU (and the SoC)
into a stable and initialized state and to initialize the C runtime environment before the actual application can be executed.
This start-up code is located in <code>sw/common/crt0.S</code> and is automatically linked <em>every</em> application program
and placed right before the actual application code so it gets executed right after reset.</p>
</div>
<div class="paragraph">
<p>The <code>crt0.S</code> start-up performs the following operations:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Initialize all integer registers <code>x1 - x31</code> (or jsut <code>x1 - x15</code> when using the <code>E</code> CPU extension) to a defined value.</p>
</li>
<li>
<p>Initialize the global pointer <code>gp</code> and the stack pointer <code>sp</code> according to the <code>.data</code> segment layout provided by the linker script.</p>
</li>
<li>
<p>Initialize all CPU core CSRs and also install a default "dummy" trap handler for <em>all</em> traps. This handler catches all traps during the early boot phase.</p>
</li>
<li>
<p>Clear IO area: Write zero to all memory-mapped registers within the IO region (<code>iodev</code> section). If certain devices have not been implemented, a bus access fault exception will occur. This exception is captured by the dummy trap handler.</p>
</li>
<li>
<p>Clear the <code>.bss</code> section defined by the linker script.</p>
</li>
<li>
<p>Copy read-only data from the <code>.text</code> section to the <code>.data</code> section to set initialized variables.</p>
</li>
<li>
<p>Call the application&#8217;s <code>main</code> function (with <em>no</em> arguments: <code>argc</code> = <code>argv</code> = 0).</p>
</li>
<li>
<p>If the <code>main</code> function returns <code>crt0</code> can call an "after-main handler" (see below)</p>
</li>
<li>
<p>If there is no after-main handler or after returning from the after-main handler the processor goes to an endless sleep mode (using a simple loop or via the <code>wfi</code> instruction if available).</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_after_main_handler">After-Main Handler</h5>
<div class="paragraph">
<p>If the application&#8217;s <code>main()</code> function actually returns, an <em>after main handler</em> can be executed. This handler can be a normal function
since the C runtime is still available when executed. If this handler uses any kind of peripheral/IO modules make sure these are
already initialized within the application or you have to initialize them <em>inside</em> the handler.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. After-main handler - function prototype</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int __neorv32_crt0_after_main(int32_t return_code);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function has exactly one argument (<code>return_code</code>) that provides the <em>return value</em> of the application&#8217;s main function.
For instance, this variable contains <em>-1</em> if the main function returned with <code>return -1;</code>. The return value of the
<code>__neorv32_crt0_after_main</code> function is irrelevant as there is no further "software instance" executed afterwards that can check this.
However, the on-chip debugger could still evaluate the return value of the after-main handler.</p>
</div>
<div class="paragraph">
<p>A simple <code>printf</code> can be used to inform the user when the application main function return
(this example assumes that UART0 has been already properly configured in the actual application):</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. After-main handler - example</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int __neorv32_crt0_after_main(int32_t return_code) {

  neorv32_uart0_printf("Main returned with code: %i\n", return_code);
  return 0;
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bootloader">4.5. Bootloader</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section illustrated the <strong>default</strong> bootloader from the repository. The bootloader can be customized
to target application-specific scenarios. See User Guide section
<a href="https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader">Customizing the Internal Bootloader</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default NEORV32 bootloader (source code <code>sw/bootloader/bootloader.c</code>) provides a build-in firmware that
allows to upload new application executables via UART at every time and to optionally store/boot them to/from
an external SPI flash. It features a simple "automatic boot" feature that will try to fetch an executable
from SPI flash if there is <em>no</em> UART user interaction. This allows to build processor setup with
non-volatile application storage, which can be updated at any time.</p>
</div>
<div class="paragraph">
<p>The bootloader is only implemented if the <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic is <em>true</em>. This will
select the <a href="#_indirect_boot">Indirect Boot</a> boot configuration.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Hardware requirements of the <em>default</em> NEORV32 bootloader</div>
<strong>REQUIRED</strong>: The bootloader requires the CSR access CPU extension (<a href="#_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></a> generic is <em>true</em>)
and at least 512 bytes of data memory (processor-internal DMEM or external DMEM).<br>
<br>
<em>RECOMMENDED</em>: For user interaction via UART (like uploading executables) the primary UART (UART0) has to be
implemented (<a href="#_io_uart0_en"><em>IO_UART0_EN</em></a> generic is <em>true</em>). Without UART the bootloader does not make much sense. However, auto-boot
via SPI is still supported but the bootloader should be customized (see User Guide) for this purpose.<br>
<br>
<em>OPTIONAL</em>: The default bootloader uses bit 0 of the GPIO output port as "heart beat" and status LED if the
GPIO controller is implemented (<a href="#_io_gpio_en"><em>IO_GPIO_EN</em></a> generic is <em>true</em>).<br>
<br>
<em>OPTIONAL</em>: The MTIME machine timer (<a href="#_io_mtime_en"><em>IO_MTIME_EN</em></a> generic is <em>true</em>) and the SPI controller
(<a href="#_io_spi_en"><em>IO_SPI_EN</em></a> generic is <em>true</em>) are required in order to use the bootloader&#8217;s auto-boot feature
(automatic boot from external SPI flash if there is no user interaction via UART).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To interact with the bootloader, connect the primary UART (UART0) signals (<code>uart0_txd_o</code> and
<code>uart0_rxd_o</code>) of the processor&#8217;s top entity via a serial port (-adapter) to your computer (hardware flow control is
not used so the according interface signals can be ignored.), configure your
terminal program using the following settings and perform a reset of the processor.</p>
</div>
<div class="paragraph">
<p>Terminal console settings (<code>19200-8-N-1</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>19200 Baud</p>
</li>
<li>
<p>8 data bits</p>
</li>
<li>
<p>no parity bit</p>
</li>
<li>
<p>1 stop bit</p>
</li>
<li>
<p>newline on <code>\r\n</code> (carriage return, newline)</p>
</li>
<li>
<p>no transfer protocol / control flow protocol - just the raw byte stuff</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The bootloader uses the LSB of the top entity&#8217;s <code>gpio_o</code> output port as high-active status LED (all other
output pin are set to low level by the bootloader). After reset, this LED will start blinking at ~2Hz and the
following intro screen should show up in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;&lt; NEORV32 Bootloader &gt;&gt;

BLDV: Mar 23 2021
HWV:  0x01050208
CLK:  0x05F5E100
MISA: 0x40901105
CPU:  0x00000023
SOC:  0x0EFF0037
IMEM: 0x00004000 bytes @ 0x00000000
DMEM: 0x00002000 bytes @ 0x80000000

Autoboot in 8s. Press key to abort.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This start-up screen also gives some brief information about the bootloader and several system configuration parameters:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.7647%;">
<col style="width: 88.2353%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLDV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootloader version (built date).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HWV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor hardware version (from the <code>mimpid</code> CSR) in BCD format (example: <code>0x01040606</code> = v1.4.6.6).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor clock speed in Hz (via the SYSINFO module, from the <em>CLOCK_FREQUENCY</em> generic).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MISA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU extensions (from the <code>misa</code> CSR).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CPU</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU sub-extensions (via the <code>CPU</code> register in the SYSINFO module)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SOC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor configuration (via the <code>SOC</code> register in the SYSINFO module / from the IO_* and MEM_* configuration generics).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM memory base address and size in byte (from the <em>MEM_INT_IMEM_SIZE</em> generic).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM memory base address and size in byte (from the <em>MEM_INT_DMEM_SIZE</em> generic).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now you have 8 seconds to press any key. Otherwise, the bootloader starts the auto boot sequence. When
you press any key within the 8 seconds, the actual bootloader user console starts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;&lt; NEORV32 Bootloader &gt;&gt;

BLDV: Mar 23 2021
HWV:  0x01050208
CLK:  0x05F5E100
USER: 0x10000DE0
MISA: 0x40901105
CPU:  0x00000023
SOC:  0x0EFF0037
IMEM: 0x00004000 bytes @ 0x00000000
DMEM: 0x00002000 bytes @ 0x80000000

Autoboot in 8s. Press key to abort.
Aborted.

Available commands:
h: Help
r: Restart
u: Upload
s: Store to flash
l: Load from flash
e: Execute
CMD:&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The auto-boot countdown is stopped and now you can enter a command from the list to perform the
corresponding operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>h</code>: Show the help text (again)</p>
</li>
<li>
<p><code>r</code>: Restart the bootloader and the auto-boot sequence</p>
</li>
<li>
<p><code>u</code>: Upload new program executable (<code>neorv32_exe.bin</code>) via UART into the instruction memory</p>
</li>
<li>
<p><code>s</code>: Store executable to SPI flash at <code>spi_csn_o(0)</code></p>
</li>
<li>
<p><code>l</code>: Load executable from SPI flash at <code>spi_csn_o(0)</code></p>
</li>
<li>
<p><code>e</code>: Start the application, which is currently stored in the instruction memory (IMEM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A new executable can be uploaded via UART by executing the <code>u</code> command. After that, the executable can be directly
executed via the <code>e</code> command. To store the recently uploaded executable to an attached SPI flash press <code>s</code>. To
directly load an executable from the SPI flash press <code>l</code>. The bootloader and the auto-boot sequence can be
manually restarted via the <code>r</code> command.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The CPU is in machine level privilege mode after reset. When the bootloader boots an application,
this application is also started in machine level privilege mode.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For detailed information on using an SPI flash for application storage see User Guide section
<a href="https://stnolting.github.io/neorv32/ug/#_programming_an_external_spi_flash_via_the_bootloader">Programming an External SPI Flash via the Bootloader</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_auto_boot_sequence">4.5.1. Auto Boot Sequence</h4>
<div class="paragraph">
<p>When you reset the NEORV32 processor, the bootloader waits 8 seconds for a UART console input before it
starts the automatic boot sequence. This sequence tries to fetch a valid boot image from the external SPI
flash, connected to SPI chip select <code>spi_csn_o(0)</code>. If a valid boot image is found that can be successfully
transferred into the instruction memory, it is automatically started. If no SPI flash is detected or if there
is no valid boot image found, and error code will be shown.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bootloader_error_codes">4.5.2. Bootloader Error Codes</h4>
<div class="paragraph">
<p>If something goes wrong during bootloader operation, an error code is shown. In this case the processor
stalls, a bell command and one of the following error codes are send to the terminal, the bootloader status
LED is permanently activated and the system must be manually reset.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 86.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERROR_0</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you try to transfer an invalid executable (via UART or from the external SPI flash), this error message shows up. There might be a transfer protocol configuration error in the terminal program. Also, if no SPI flash was found during an auto-boot attempt, this message will be displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERROR_1</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your program is way too big for the internal processor’s instructions memory. Increase the memory size or reduce your application code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERROR_2</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This indicates a checksum error. Something went wrong during the transfer of the program image (upload via UART or loading from the external SPI flash). If the error was caused by a UART upload, just try it again. When the error was generated during a flash access, the stored image might be corrupted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERROR_3</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This error occurs if the attached SPI flash cannot be accessed. Make sure you have the right type of flash and that it is properly connected to the NEORV32 SPI port using chip select #0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR 0x???????? 0x???????? 0x????????</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bootloader encountered an exception during operation. This might be caused when it tries to access peripherals that were not implemented during synthesis. Example: executing <code>l</code> or <code>s</code> (SPI flash operations) without the SPI module beeing implemented.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_neorv32_runtime_environment">4.6. NEORV32 Runtime Environment</h3>
<div class="paragraph">
<p>The NEORV32 provides a minimal runtime environment (RTE) that takes care of a stable
and <em>safe</em> execution environment by handling <em>all</em> traps (including interrupts).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using the RTE is <strong>optional</strong>. The RTE provides a simple and comfortable way of delegating traps while making sure that all traps (even though they are not
explicitly used by the application) are handled correctly. Performance-optimized applications or embedded operating systems should not use the RTE for delegating traps.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When execution enters the application&#8217;s <code>main</code> function, the actual runtime environment is responsible for catching all implemented exceptions
and interrupts. To activate the NEORV32 RTE execute the following function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">void neorv32_rte_setup(void);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This setup initializes the <code>mtvec</code> CSR, which provides the base entry point for all trap
handlers. The address stored to this register reflects the first-level exception handler provided by the
NEORV32 RTE. Whenever an exception or interrupt is triggered, this first-level handler is called.</p>
</div>
<div class="paragraph">
<p>The first-level handler performs a complete context save, analyzes the source of the exception/interrupt and
calls the according second-level exception handler, which actually takes care of the exception/interrupt
handling. For this, the RTE manages a private look-up table to store the addresses of the according trap
handlers.</p>
</div>
<div class="paragraph">
<p>After the initial setup of the RTE, each entry in the trap handler&#8217;s look-up table is initialized with a debug
handler, that outputs detailed hardware information via the <strong>primary UART (UART0)</strong> when triggered. This
is intended as a fall-back for debugging or for accidentally-triggered exceptions/interrupts.
For instance, an illegal instruction exception caught by the RTE debug handler might look like this in the UART0 output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;RTE&gt; Illegal instruction @ PC=0x000002d6, MTVAL=0x00001537 &lt;/RTE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For bus access faults the RTE also outputs the error code from the <a href="#_internal_bus_monitor_buskeeper">Internal Bus Monitor (BUSKEEPER)</a>
to show the cause of the access fault. Two example are shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;RTE&gt; Load access fault [TIMEOUT_ERR] @ PC=0x00000150, MTVAL=0xFFFFFF70 &lt;/RTE&gt;
&lt;RTE&gt; Store access fault [DEVICE_ERR] @ PC=0x00000162, MTVAL=0xF0000000 &lt;/RTE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To install the <strong>actual application&#8217;s trap handlers</strong> the NEORV32 RTE provides functions for installing and
un-installing trap handler for each implemented exception/interrupt source.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int neorv32_rte_exception_install(uint8_t id, void (*handler)(void));</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 29.4117%;">
<col style="width: 70.5883%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID name [C]</th>
<th class="tableblock halign-left valign-top">Description / trap causing entry</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_I_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction address misaligned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_I_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction (bus) access fault</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_I_ILLEGAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">illegal instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_BREAKPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">breakpoint (<code>ebreak</code> instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_L_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load address misaligned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_L_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load (bus) access fault</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_S_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store address misaligned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_S_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store (bus) access fault</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_MENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from machine mode (<code>ecall</code> instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_UENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from user mode (<code>ecall</code> instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_MEI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_MSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_0</code> : <code>RTE_TRAP_FIRQ_15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 0..15</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When installing a custom handler function for any of these exception/interrupts, make sure the function uses
<strong>no attributes</strong> (especially no interrupt attribute!), has no arguments and no return value like in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">void handler_xyz(void) {

  // handle exception/interrupt...
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do NOT use the <code>interrupt</code> attribute for the application exception handler functions! This
will place an <code>mret</code> instruction to the end of it making it impossible to return to the first-level
exception handler of the RTE, which will cause stack corruption.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example: Installation of the MTIME interrupt handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_rte_exception_install(EXC_MTI, handler_xyz);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove a previously installed exception handler call the according un-install function from the NEORV32
runtime environment. This will replace the previously installed handler by the initial debug handler, so even
un-installed exceptions and interrupts are further captured.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int neorv32_rte_exception_uninstall(uint8_t id);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example: Removing the MTIME interrupt handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_rte_exception_uninstall(EXC_MTI);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information regarding the NEORV32 runtime environment can be found in the doxygen
software documentation (also available online at <a href="https://stnolting.github.io/neorv32/sw/files.html">GitHub pages</a>).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_on_chip_debugger_ocd">5. On-Chip Debugger (OCD)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor features an <em>on-chip debugger</em> (OCD) implementing <strong>execution-based debugging</strong> that is compatible
to the <strong>Minimal RISC-V Debug Specification Version 0.13.2</strong>.
Please refer to this spec for in-deep information.
A copy of the specification is available in <code>docs/references/riscv-debug-release.pdf</code>.
The NEORV32 OCD provides the following key features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JTAG test access port</p>
</li>
<li>
<p>run-control of the CPU: halting, single-stepping and resuming</p>
</li>
<li>
<p>executing arbitrary programs during debugging</p>
</li>
<li>
<p>accessing core registers (direct access to GPRs, indirect access to CSRs via program buffer)</p>
</li>
<li>
<p>indirect access to the whole processor address space (via program buffer))</p>
</li>
<li>
<p>compatible to the <a href="https://github.com/riscv/riscv-openocd">RISC-V port of OpenOCD</a>;
pre-built binaries can be obtained for example from <a href="https://www.sifive.com/software">SiFive</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">OCD Security Note</div>
Access via the OCD is <em>always authenticated</em> (<code>dmstatus.authenticated</code> == <code>1</code>). Hence, the
<em>whole system</em> can always be accessed via the on-chip debugger. Currently, there is no option
to disable the OCD via software. The OCD can only be disabled by disabling implementation
(setting <em>ON_CHIP_DEBUGGER_EN</em> generic to <em>false</em>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The OCD requires additional resources for implementation and <em>might</em> also increase the critical path resulting in less
performance. If the OCD is not really required for the <em>final</em> implementation, it can be disabled and thus,
discarded from implementation. In this case all circuitry of the debugger is completely removed (no impact
on area, energy or timing at all).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A simple example on how to use NEORV32 on-chip debugger in combination with <code>OpenOCD</code> and <code>gdb</code>
is shown in section <a href="https://stnolting.github.io/neorv32/ug/#_debugging_using_the_on_chip_debugger">Debugging using the On-Chip Debugger</a>
of the User Guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 on-chip debugger complex is based on three hardware modules:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_ocd_complex.png" alt="neorv32 ocd complex">
</div>
<div class="title">Figure 9. NEORV32 on-chip debugger complex</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><a href="#_debug_transport_module_dtm">Debug Transport Module (DTM)</a> (<code>rtl/core/neorv32_debug_dtm.vhd</code>): External JTAG access tap to allow an external
adapter to interface with the <em>debug module(DM)</em> using the <em>debug module interface (dmi)</em>.</p>
</li>
<li>
<p><a href="#_debug_module_dm">Debug Module (DM)</a> (<code>rtl/core/neorv32_debug_tm.vhd</code>): Debugger control unit that is configured by the DTM via the
the <em>dmi</em>. Form the CPU&#8217;s "point of view" this module behaves as a memory-mapped "peripheral" that can be accessed
via the processor-internal bus. The memory-mapped registers provide an internal <em>data buffer</em> for data transfer
from/to the DM, a <em>code ROM</em> containing the "park loop" code,   a <em>program buffer</em> to allow the debugger to
execute small programs defined by the DM and a <em>status register</em> that is used to communicate
<em>halt</em>, <em>resume</em> and <em>execute</em> requests/acknowledges from/to the DM.</p>
</li>
<li>
<p>CPU <a href="#_cpu_debug_mode">CPU Debug Mode</a> extension (part of`rtl/core/neorv32_cpu_control.vhd`):
This extension provides the "debug execution mode" which executes the "park loop" code from the DM.
The mode also provides additional CSRs.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>When debugging the system using the OCD, the debugger issues a halt request to the CPU (via the CPU&#8217;s
<code>db_halt_req_i</code> signal) to make the CPU enter <em>debug mode</em>. In this state, the application-defined architectural
state of the system/CPU is "frozen" so the debugger can monitor and even modify it.
While in debug mode, the CPU executes the "park loop" code from the <em>code ROM</em> of the DM.
This park loop implements an endless loop, in which the CPU polls the memory-mapped <em>status register</em> that is
controlled by the <em>debug module (DM)</em>. The flags of these register are used to communicate <em>requests</em> from
the DM and to <em>acknowledge</em> them by the CPU: trigger execution of the program buffer or resume the halted
application.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_debug_transport_module_dtm">5.1. Debug Transport Module (DTM)</h3>
<div class="paragraph">
<p>The debug transport module (VHDL module: <code>rtl/core/neorv32_debug_dtm.vhd</code>) provides a JTAG test access port (TAP).
The DTM is the first entity in the debug system, which connects and external debugger via JTAG to the next debugging
entity: the debug module (DM).
External JTAG access is provided by the following top-level ports.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 54. JTAG top level signals</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Direction</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_trst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TAP reset (low-active); this signal is optional, make sure to pull it <em>high</em> if it is not used</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode select</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">JTAG Clock</div>
The actual JTAG clock signal is <strong>not</strong> used as primary clock. Instead it is used to synchronize
JTGA accesses, while all internal operations trigger on the system clock. Hence, no additional clock domain is required
for integration of this module.
However, this constraints the maximal JTAG clock (<code>jtag_tck_i</code>) frequency to be less than or equal to
1/4 of the system clock (<code>clk_i</code>) frequency.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the on-chip debugger is disabled (<em>ON_CHIP_DEBUGGER_EN</em> = false) the JTAG serial input <code>jtag_tdi_i</code> is directly
connected to the JTAG serial output <code>jtag_tdo_o</code> to maintain the JTAG chain.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The NEORV32 JTAG TAP does not provide a <em>boundary check</em> function (yet?). Hence, physical device pins cannot be accessed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The DTM uses the "debug module interface (dmi)" to access the actual debug module (DM).
These accesses are controlled by TAP-internal registers.
Each registers is selected by the JTAG instruction register (<code>IR</code>) and accessed through the JTAG data register (<code>DR</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The DTM&#8217;s instruction and data registers can be accessed using OpenOCDs <code>irscan</code> and <code>drscan</code> commands.
The RISC-V port of OpenOCD also provides low-level command (<code>riscv dmi_read</code> &amp; <code>riscv dmi_write</code>) to access the <em>dmi</em>
debug module interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>JTAG access is conducted via the <strong>instruction register</strong> <code>IR</code>, which is 5 bit wide, and several <strong>data registers</strong> <code>DR</code>
with different sizes.
The data registers are accessed by writing the according address to the instruction register.
The following table shows the available data registers:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 55. JTAG TAP registers</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address (via <code>IR</code>)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size [bits]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>00001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>IDCODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identifier, default: <code>0x0CAFE001</code> (configurable via package&#8217;s <code>jtag_tap_idcode_*</code> constants)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DTMCS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug transport module control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DMI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">41</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug module interface (<em>dmi</em>); 7-bit address, 32-bit read/write data, 2-bit operation (<code>00</code> = NOP; <code>10</code> = write; <code>01</code> = read)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">others</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BYPASS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default JTAG bypass register</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <a href="https://github.com/riscv/riscv-debug-spec">RISC-V debug specification</a> for more information regarding the data
registers and operations.
A local copy can be found in <code>docs/references</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_debug_module_dm">5.2. Debug Module (DM)</h3>
<div class="paragraph">
<p>According to the RISC-V debug specification, the DM (VHDL module: <code>rtl/core/neorv32_debug_dm.vhd</code>)
acts as a translation interface between abstract operations issued by the debugger and the platform-specific
debugger implementation. It supports the following features (excerpt from the debug spec):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gives the debugger necessary information about the implementation.</p>
</li>
<li>
<p>Allows the hart to be halted and resumed and provides status of the current state.</p>
</li>
<li>
<p>Provides abstract read and write access to the halted hart&#8217;s GPRs.</p>
</li>
<li>
<p>Provides access to a reset signal that allows debugging from the very first instruction after reset.</p>
</li>
<li>
<p>Provides a mechanism to allow debugging the hart immediately out of reset. (<em>still experimental</em>)</p>
</li>
<li>
<p>Provides a Program Buffer to force the hart to execute arbitrary instructions.</p>
</li>
<li>
<p>Allows memory access from a hart&#8217;s point of view.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NEORV32 DM follows the "Minimal RISC-V External Debug Specification" to provide full debugging
capabilities while keeping resource (area) requirements at a minimum level.
It implements the <strong>execution based debugging scheme</strong> for a single hart and provides the following
hardware features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>program buffer with 2 entries and implicit <code>ebreak</code> instruction afterwards</p>
</li>
<li>
<p>no <em>direct</em> bus access (indirect bus access via the CPU)</p>
</li>
<li>
<p>abstract commands: "access register" plus auto-execution</p>
</li>
<li>
<p>no <em>dedicated</em> halt-on-reset capabilities yet (but can be emulated)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DM provides two "sides of access": access from the DTM via the <em>debug module interface (dmi)</em> and access from the
CPU via the processor-internal bus. From the DTM&#8217;s point of view, the DM implements a set of <a href="#_dm_registers">DM Registers</a> that
are used to control and monitor the actual debugging. From the CPU&#8217;s point of view, the DM implements several
memory-mapped registers (within the <em>normal</em> address space) that are used for communicating debugging control
and status (<a href="#_dm_cpu_access">DM CPU Access</a>).</p>
</div>
<div class="sect3">
<h4 id="_dm_registers">5.2.1. DM Registers</h4>
<div class="paragraph">
<p>The DM is controlled via a set of registers that are accessed via the DTM&#8217;s <em>dmi</em>.
The "Minimal RISC-V Debug Specification" requires only a subset of the registers specified in the spec.
The following registers are implemented.
Write accesses to any other registers are ignored and read accesses will always return zero.
Register names that are encapsulated in "( )" are not actually implemented; however, they are listed to explicitly show
their functionality.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 56. Available DM registers</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 25%;">
<col style="width: 58.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x04</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>data0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract data 0, used for data transfer between debugger and processor</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x10</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmcontrol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module control</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x11</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmstatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x12</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hartinfo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hart information</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>abstracts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract control and status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x17</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>command</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x18</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>abstractauto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract command auto-execution</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x1d</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(<code>nextdm</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base address of <em>next</em> DM; read as zero to indicate there is only <em>one</em> DM</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x20</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>progbuf0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x21</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>progbuf1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x38</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(<code>sbcs</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System bus access control and status; read as zero to indicate there is no <em>direct</em> system bus access</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x40</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>haltsum0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Halt summary 0</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_data"><strong><code>data</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract data 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>data0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Basic read/write registers to be used with abstract command (for example to read/write data from/to CPU GPRs).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dmcontrol"><strong><code>dmcontrol</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug module control register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmcontrol</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: 0x00000000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Control of the overall debug module and the hart. The following table shows all implemented bits. All remaining bits/bit-fields are configures as "zero" and are
read-only. Writing '1' to these bits/fields will be ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 57. <code>dmcontrol</code> - debug module control register bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>haltreq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set/clear hart halt request</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>resumereq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request hart to resume</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ackhavereset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write <code>1</code> to clear <code>*havereset</code> flags</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ndmreset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">put whole processor into reset when <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmactive</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM enable; writing <code>0</code>-<code>1</code> will reset the DM</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dmstatus"><strong><code>dmstatus</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug module status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmstatus</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: 0x00000000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Current status of the overall debug module and the hart. The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 58. <code>dmstatus</code> - debug module status register bits</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 15.3846%;">
<col style="width: 76.9231%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>impebreak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>1</code>; indicates an implicit <code>ebreak</code> instruction after the last program buffer entry</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allhavereset</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is in reset</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyhavereset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allresumeack</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart has acknowledged a resume request</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyresumeack</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allnonexistent</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">always zero to indicate the hart is always existent</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anynonexistent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allunavail</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the DM is disabled to indicate the hart is unavailable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyunavail</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allrunning</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is running</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyrunning</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allhalted</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is halted</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyhalted</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>authenticated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>1</code>; there is no authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>authbusy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; there is no authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hasresethaltreq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; halt-on-reset is not supported (directly)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>confstrptrvalid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; no configuration string available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0010</code> - DM is compatible to version 0.13</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_hartinfo"><strong><code>hartinfo</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hart information</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>hartinfo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: see below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This register gives information about the hart. The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 59. <code>hartinfo</code> - hart information register bits</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nscratch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>, number of <code>dscratch*</code> CPU registers = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19:17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dataccess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>, the <code>data</code> registers are shadowed in the hart&#8217;s address space</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>datasize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>, number of 32-bit words in the address space dedicated to shadowing the <code>data</code> registers = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dataaddr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">= <code>dm_data_base_c(11:0)</code>, signed base address of <code>data</code> words (see address map in <a href="#_dm_cpu_access">DM CPU Access</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_abstracts"><strong><code>abstracts</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract control and status</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>abstracts</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: see below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Command execution info and status.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 60. <code>abstracts</code> - abstract control and status register bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:29</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>progbufsize</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0010</code>; size of the program buffer (<code>progbuf</code>) = 2 entries</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> when a command is being executed</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10:8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cmerr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">error during command execution (see below); has to be cleared by writing <code>111</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>datacount</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>; number of implemented <code>data</code> registers for abstract commands = 1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Error codes in <code>cmderr</code> (highest priority first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>000</code> - no error</p>
</li>
<li>
<p><code>100</code> - command cannot be executed since hart is not in expected state</p>
</li>
<li>
<p><code>011</code> - exception during command execution</p>
</li>
<li>
<p><code>010</code> - unsupported command</p>
</li>
<li>
<p><code>001</code> - invalid DM register read/write while command is/was executing</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_command"><strong><code>command</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract command</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>command</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: 0x00000000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Writing this register will trigger the execution of an abstract command. New command can only be executed if
<code>cmderr</code> is zero. The entire register in write-only (reads will return zero).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 DM only supports <strong>Access Register</strong> abstract commands. These commands can only access the
hart&#8217;s GPRs (abstract command register index <code>0x1000</code> - <code>0x101f</code>).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 61. <code>command</code> - abstract command register - "access register" commands only</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">R/W</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Description / required value</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cmdtype</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>00000000</code> to indicate "access register" command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, has to be <code>0</code> when writing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>aarsize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-/w</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>010</code> to indicate 32-bit accesses</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aarpostincrement</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code>, post-increment is not supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>postexec</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set the program buffer is executed <em>after</em> the command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>transfer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-/w</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">if set the operation in <code>write</code> is conducted</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>write</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code>: copy <code>data0</code> to <code>[regno]</code>; <code>0</code> copy <code>[regno]</code> to <code>data0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15:0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>regno</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPR-access only; has to be <code>0x1000</code> - <code>0x101f</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_abstractauto"><strong><code>abstractauto</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract command auto-execution</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>abstractauto</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: 0x00000000s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Register to configure when a read/write access to a DM repeats execution of the last abstract command.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 62. <code>abstractauto</code> - Abstract command auto-execution register bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecprogbuf[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>progbuf1</code> will execute <code>command again</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecprogbuf[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>progbuf0</code> will execute <code>command again</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecdata[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>data0</code> will execute <code>command again</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_progbuf"><strong><code>progbuf</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Program buffer 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>progbuf0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Program buffer 1</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>progbuf1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>NOP</code>-instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">General purpose program buffer for the DM.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_haltsum0"><strong><code>haltsum0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Halt summary 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>haltsum0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Bit 0 of this register is set if the hart is halted (all remaining bits are always zero). The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dm_cpu_access">5.2.2. DM CPU Access</h4>
<div class="paragraph">
<p>From the CPU&#8217;s point of view, the DM behaves as a memory-mapped peripheral that includes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a small ROM that contains the code for the "park loop", which is executed when the CPU is <em>in</em> debug mode.</p>
</li>
<li>
<p>a program buffer populated by the debugger host to execute small programs</p>
</li>
<li>
<p>a data buffer to transfer data between the processor and the debugger host</p>
</li>
<li>
<p>a status register to communicate debugging requests</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Park Loop Code Sources</div>
The assembly sources of the <strong>park loop code</strong> are available in <code>sw/ocd-firmware/park_loop.S</code>. Please note, that these
sources are not intended to be changed by the used. Hence, the makefile does not provide an automatic option
to compile and "install" the debugger ROM code into the HDL sources and require a manual copy
(see <code>sw/ocd-firmware/README.md</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The DM uses a total address space of 128 words of the CPU&#8217;s address space (= 512 bytes) divided into four sections
of 32 words (= 128 bytes) each.
Please note, that the program buffer, the data buffer and the status register only uses a few effective words in this
address space. However, these effective addresses are mirrored to fill up the whole 128 bytes of the section.
Hence, any CPU access within this address space will succeed.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 63. DM CPU access - address map (divided into four sections)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 26.6666%;">
<col style="width: 13.3333%;">
<col style="width: 46.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Base address</th>
<th class="tableblock halign-center valign-top">Name [VHDL package]</th>
<th class="tableblock halign-center valign-top">Actual size</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff800</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_code_base_c</code> (= <code>dm_base_c</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code ROM for the "park loop" code</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff880</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_pbuf_base_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer, provided by DM</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff900</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_data_base_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data buffer (<code>dm.data0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff980</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_sreg_base_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control and status register</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
From the CPU&#8217;s point of view, the DM is mapped to an <em>"unused"</em> address range within the processor&#8217;s
<a href="#_address_space">Address Space</a> right between the bootloader ROM (BOOTROM) and the actual processor-internal IO
space at addresses <code>0xfffff800</code> - <code>0xfffff9ff</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the CPU enters or re-enters (for example via <code>ebreak</code> in the DM&#8217;s program buffer) debug mode, it jumps to
the beginning of the DM&#8217;s "park loop" code ROM at <code>dm_code_base_c</code>. This is the <em>normal entry point</em> for the
park loop code. If an exception is encountered during debug mode, the CPU jumps to <code>dm_code_base_c + 4</code>,
which is the <em>exception entry point</em>.</p>
</div>
<div class="paragraph">
<p><strong>Status Register</strong></p>
</div>
<div class="paragraph">
<p>The status register provides a direct communication channel between the CPU executing the park loop and the
host-controlled controller of the DM. Note that all bits that can be written by the CPU (acknowledge flags)
cause a single-shot (1-cycle) signal to the DM controller and auto-clear (always read as zero).
The bits that are driven by the DM controller and are read-only to the CPU and keep their state until the CPU
acknowledges the according request.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 64. DM CPU access - status register</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">CPU access</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>halt_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU to indicate that the CPU is halted and keeps iterating in the park loop</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>resume_req</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the DM to tell the CPU to resume normal operation (leave parking loop and leave debug mode via <code>dret</code> instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>resume_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU to acknowledge that the CPU is now going to leave parking loop &amp; debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>execute_req</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the DM to tell the CPU to leave debug mode and execute the instructions from the program buffer; CPU will re-enter parking loop afterwards</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>execute_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU to acknowledge that the CPU is now going to execute the program buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>exception_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU to inform the DM that an exception occurred during execution of the park loop or during execution of the program buffer</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_cpu_debug_mode">5.3. CPU Debug Mode</h3>
<div class="paragraph">
<p>The NEORV32 CPU Debug Mode <code>DB</code> (part of <code>rtl/core/neorv32_cpu_control.vhd</code>) is compatible to the "Minimal RISC-V Debug Specification 0.13.2".
It is enabled/implemented by setting the CPU generic <em>CPU_EXTENSION_RISCV_DEBUG</em> to "true" (done by setting processor
generic <em>ON_CHIP_DEBUGGER_EN</em>).
It provides a new operation mode called "debug mode".
When enabled, three additional CSRs are available (section <a href="#_cpu_debug_mode_csrs">CPU Debug Mode CSRs</a>) and also the "return from debug mode"
instruction <code>dret</code> is available when the CPU is "in" debug mode.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The CPU <em>debug mode</em> requires the <code>Zicsr</code> and <code>Zifencei</code> CPU extension to be implemented (top generics <em>CPU_EXTENSION_RISCV_Zicsr</em>
and <em>CPU_EXTENSION_RISCV_Zifencei</em> = true).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Hardware Watchpoints and Breakpoints</div>
The NEORV32 CPU <em>debug mode</em> does not provide a hardware "trigger module" (which is optional in the RISC-V debug spec). However, gdb
provides a native <em>emulation</em> for code (breakpoints using <code>break</code> instruction) and data (polling data watchpoints in automated
single-stepping) triggers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The CPU debug-mode is entered when one of the following events appear:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>executing <code>ebreak</code> instruction (when <code>dcsr.ebreakm</code> is set and in machine mode OR when <code>dcsr.ebreaku</code> is set and in user mode)</p>
</li>
<li>
<p>debug halt request from external DM (via CPU signal <code>db_halt_req_i</code>, high-active, triggering on rising-edge)</p>
</li>
<li>
<p>finished executing of a single instruction while in single-step debugging mode (enabled via <code>dcsr.step</code>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>From a hardware point of view, these "entry conditions" are special synchronous (<code>ebreak</code> instruction) or asynchronous
(single-stepping "interrupt"; halt request "interrupt") traps, that are handled invisibly by the control logic.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">WFI instruction</div>
The wait-for-interrupt instruction <code>wfi</code> puts the CPU into sleep mode. The CPU will resume normale operation
when at least one interrupt source becomes pending (= at least one bit in <code>mip</code> CSR is set).
However, the CPU will <em>also resume</em> from sleep mode if there is a halt request from the debug module (DM).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whenever the CPU <strong>enters debug-mode</strong> it performs the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>move <code>pc</code> to <code>dpcs</code></p>
</li>
<li>
<p>copy the hart&#8217;s current privilege level to <code>dcsr.prv</code></p>
</li>
<li>
<p>set <code>dcrs.cause</code> according to the cause why debug mode is entered</p>
</li>
<li>
<p><strong>no update</strong> of <code>mtval</code>, <code>mcause</code>, <code>mtval</code> and <code>mstatus</code> CSRs</p>
</li>
<li>
<p>load the address configured via the CPU <em>CPU_DEBUG_ADDR</em> generic to the <code>pc</code> to jump to "debugger park loop" code in the debug module (DM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the CPU <strong>is in debug-mode</strong> the following things are important:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>while in debug mode, the CPU executes the parking loop and the program buffer provided by the DM if requested</p>
</li>
<li>
<p>effective CPU privilege level is <code>machine</code> mode, any PMP configuration is bypassed</p>
</li>
<li>
<p>the <code>wfi</code> instruction acts as a <code>nop</code> (also during single-stepping)</p>
</li>
<li>
<p>if an exception occurs:</p>
<div class="ulist">
<ul>
<li>
<p>if the exception was caused by any debug-mode entry action the CPU jumps to the <em>normal entry point</em>
(= <em>CPU_DEBUG_ADDR</em>) of the park loop again (for example when executing <code>ebreak</code> <em>in</em> debug-mode)</p>
</li>
<li>
<p>for all other exception sources the CPU jumps to the <em>exception entry point</em> ( = <em>CPU_DEBUG_ADDR</em> + 4)
to signal an exception to the DM and restarts the park loop again afterwards</p>
</li>
</ul>
</div>
</li>
<li>
<p>interrupts are disabled; however, they will remain pending and will get executed after the CPU has left debug mode</p>
</li>
<li>
<p>if the DM makes a resume request, the park loop exits and the CPU leaves debug mode (executing <code>dret</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debug mode is left either by executing the <code>dret</code> instruction <sup class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnotedef_16" title="View footnote.">16</a>]</sup> (<em>in</em> debug mode) or by performing
a hardware reset of the CPU. Executing <code>dret</code> outside of debug mode will raise an illegal instruction exception.
Whenever the CPU <strong>leaves debug mode</strong> the following things happen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the hart&#8217;s current privilege level according to <code>dcsr.prv</code></p>
</li>
<li>
<p>restore <code>pc</code> from <code>dpcs</code></p>
</li>
<li>
<p>resume normal operation at <code>pc</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_cpu_debug_mode_csrs">5.3.1. CPU Debug Mode CSRs</h4>
<div class="paragraph">
<p>Two additional CSRs are required by the <em>Minimal RISC-V Debug Specification</em>: The debug mode control and status register
<code>dcsr</code> and the program counter <code>dpc</code>. Providing a general purpose scratch register for debug mode (<code>dscratch0</code>) allows
faster execution of program provided by the debugger, since <em>one</em> general purpose register can be backup-ed and
directly used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The debug-mode control and status registers (CSRs) are only accessible when the CPU is <em>in</em> debug mode.
If these CSRs are accessed outside of debug mode (for example when in <code>machine</code> mode) an illegal instruction exception
is raised.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_dcsr"><strong><code>dcsr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug control and status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dcsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: 0x00000000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>dcsr</code> CSR is compatible to the RISC-V debug spec. It is used to configure debug mode and provides additional status information.
The following bits are implemented. The reaming bits are read-only and always read as zero.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 65. Debug control and status register bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Event</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>xdebugver</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0100</code> - indicates external debug support exists</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereakm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebreak</code> instructions in <code>machine</code> mode will <em>enter</em> debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="line-through"><code>ebereakh</code></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - hypervisor mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="line-through"><code>ebereaks</code></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - supervisor mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereaku</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebreak</code> instructions in <code>user</code> mode will <em>enter</em> debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="line-through"><code>stepie</code></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - IRQs are disabled during single-stepping</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="line-through"><code>stopcount</code></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - counters increment as usual</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="line-through"><code>stoptime</code></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - timers increment as usual</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cause</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cause identifier - why debug mode was entered</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="line-through"><code>mprven</code></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - <code>mstatus.mprv</code> is ignored when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="line-through"><code>nmip</code></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - non-maskable interrupt is pending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>step</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable single-stepping when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>prv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU privilege level before/after debug mode</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dpc"><strong><code>dpc</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug program counter</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dpc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>dcsr</code> CSR is compatible to the RISC-V debug spec. It is used to store the current program counter when
debug mode is entered. The <code>dret</code> instruction will return to <code>dpc</code> by moving <code>dpc</code> to <code>pc</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dscratch0"><strong><code>dscratch0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug scratch register 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dscratch0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>UNDEFINED</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>dscratch0</code> CSR is compatible to the RISC-V debug spec. It provides a general purpose debug mode-only scratch register.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal">6. Legal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph">
<p><strong>BSD 3-Clause License</strong></p>
</div>
<div class="paragraph">
<p>Copyright (c) 2021, Stephan Nolting. All rights reserved.</p>
</div>
<div class="paragraph">
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that
the following conditions are met:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the
following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or
promote products derived from this software without specific prior written permission.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>The NEORV32 RISC-V Processor</strong><br>
Copyright (c) 2021, by Dipl.-Ing. Stephan Nolting. All rights reserved.<br>
HQ: <a href="https://github.com/stnolting/neorv32" class="bare">https://github.com/stnolting/neorv32</a><br>
Contact: <a href="mailto:stnolting@gmail.com">stnolting@gmail.com</a><br>
<em>made in Hanover, Germany</em></p>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_proprietary_notice">Proprietary Notice</h3>
<div class="ulist">
<ul>
<li>
<p>"GitHub" is a Subsidiary of Microsoft Corporation.</p>
</li>
<li>
<p>"Vivado" and "Artix" are trademarks of Xilinx Inc.</p>
</li>
<li>
<p>"AXI", "AXI4-Lite" and "AXI4-Stream" are trademarks of Arm Holdings plc.</p>
</li>
<li>
<p>"ModelSim" is a trademark of Mentor Graphics – A Siemens Business.</p>
</li>
<li>
<p>"Quartus Prime" and "Cyclone" are trademarks of Intel Corporation.</p>
</li>
<li>
<p>"iCE40", "UltraPlus" and "Radiant" are trademarks of Lattice Semiconductor Corporation.</p>
</li>
<li>
<p>"Windows" is a trademark of Microsoft Corporation.</p>
</li>
<li>
<p>"Tera Term" copyright by T. Teranishi.</p>
</li>
<li>
<p>Timing diagrams made with WaveDrom Editor.</p>
</li>
<li>
<p>"NeoPixel" is a trademark of Adafruit Industries.</p>
</li>
<li>
<p>Documentation made with <code>asciidoctor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PDF icons from <a href="https://www.flaticon.com" class="bare">https://www.flaticon.com</a> and made by
<a href="https://www.freepik.com">Freepik</a>, <a href="https://www.flaticon.com/authors/good-ware">Good Ware</a>,
<a href="https://www.flaticon.com/authors/pixel-perfect">Pixel perfect</a>, <a href="https://www.flaticon.com/authors/vectors-market">Vectors Market</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_disclaimer">Disclaimer</h3>
<div class="paragraph">
<p>This project is released under the BSD 3-Clause license. No copyright infringement
intended. Other implied or used projects might have different licensing – see their documentation to get more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limitation_of_liability_for_external_links">Limitation of Liability for External Links</h3>
<div class="paragraph">
<p>This document contains links to the websites of third parties ("external links"). As the content of these websites
is not under our control, we cannot assume any liability for such external content. In all cases, the provider of
information of the linked websites is liable for the content and accuracy of the information provided. At the
point in time when the links were placed, no infringements of the law were recognizable to us. As soon as an
infringement of the law becomes known to us, we will immediately remove the link in question.</p>
</div>
</div>
<div class="sect2">
<h3 id="_citing">Citing</h3>
<div class="paragraph">
<p>If you are using the NEORV32 or parts of the project in some kind of publication, please cite it as follows:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Contributors ❤️</div>
Please add as many <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a> as possible to the <code>authors</code> field 😉.<br>
This project would not be where it is without them.<br>
Full names can be found in the repository&#8217;s <a href="https://github.com/stnolting/neorv32/blob/master/.mailmap"><code>.mailmap</code></a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 6. BibTeX</div>
<div class="content">
<pre class="highlight"><code>@misc{nolting20,
  author       = {Nolting, S.},
  title        = {The NEORV32 RISC-V Processor},
  year         = {2020},
  publisher    = {GitHub},
  journal      = {GitHub repository},
  howpublished = {\url{https://github.com/stnolting/neorv32}}
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DOI</div>
This project also provides a <em>digital object identifier</em> provided by <a href="https://zenodo.org">zenodo</a>:
<a href="https://doi.org/10.5281/zenodo.5018888"><span class="image"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5018888.svg" alt="zenodo.5018888" title="zenodo"></span></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgments">Acknowledgments</h3>
<div class="paragraph">
<p><strong>A big shoutout to all <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a>,
who helped improving this project! ❤️</strong></p>
</div>
<div class="paragraph">
<p><a href="https://riscv.org">RISC-V</a> - instruction sets want to be free!</p>
</div>
</div>
<div class="sect2">
<h3 id="_impressum_imprint">Impressum (Imprint)</h3>
<div class="paragraph">
<p>See <a href="https://github.com/stnolting/neorv32/blob/master/docs/impressum.md"><code>docs/impressum.md</code></a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Pronounced "neo-R-V-thirty-two" or "neo-risc-five-thirty-two" in its long form.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Resource utilization depends on actually implemented custom functionality.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. Pull high if not used.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. If the on-chip debugger is not implemented (<em>ON_CHIP_DEBUGGER_EN</em> = false) <code>jtag_tdi_i</code> is directly forwarded to <code>jtag_tdo_o</code> to maintain the JTAG chain.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. Intellectual IP; proprietary circuit blocks.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. If the <code>Zicsr</code> CPU extension is enabled (implementing the full set of the privileged architecture).
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. Shift amount.
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. Barrel shift when <code>FAST_SHIFT_EN</code> is enabled.
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. Serial shift when <code>TINY_SHIFT_EN</code> is enabled.
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. Shift amount (0..31).
</div>
<div class="footnote" id="_footnotedef_11">
<a href="#_footnoteref_11">11</a>. Barrel shifter when <code>FAST_SHIFT_EN</code> is enabled.
</div>
<div class="footnote" id="_footnotedef_12">
<a href="#_footnoteref_12">12</a>. Memory latency.
</div>
<div class="footnote" id="_footnotedef_13">
<a href="#_footnoteref_13">13</a>. Memory latency.
</div>
<div class="footnote" id="_footnotedef_14">
<a href="#_footnoteref_14">14</a>. DSP-based multiplication; enabled via <code>FAST_MUL_EN</code>.
</div>
<div class="footnote" id="_footnotedef_15">
<a href="#_footnoteref_15">15</a>. This driver file only represents a stub, since the real CFS drivers are defined by the actual CFS implementation.
</div>
<div class="footnote" id="_footnotedef_16">
<a href="#_footnoteref_16">16</a>. <code>dret</code> should only be executed <em>inside</em> the debugger "park loop" code (&#8594; code ROM in the debug module (DM).)
</div>
</div>
<div id="footer">
<div id="footer-text">
Version v1.6.3-r74-g2aed6dcb<br>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>