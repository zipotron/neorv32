<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="description" content="A size-optimized, customizable and open-source full-scale 32-bit RISC-V soft-core CPU and SoC written in platform-independent VHDL.">
<meta name="keywords" content="neorv32, risc-v, riscv, fpga, soft-core, vhdl, microcontroller, cpu, soc, processor, gcc, openocd, gdb">
<meta name="author" content="Dipl.-Ing. Stephan Nolting">
<link rel="icon" type="image/png" href="../img/icon.png">
<title>[User Guide] The NEORV32 RISC-V Processor</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The NEORV32 RISC-V Processor: User Guide</h1>
<div class="details">
<span id="author" class="author">Dipl.-Ing. Stephan Nolting</span><br>
<span id="email" class="email"><a href="mailto:stnolting@gmail.com">stnolting@gmail.com</a></span><br>
<span id="revnumber">version v1.6.3-r74-g2aed6dcb</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_software_toolchain_setup">1. Software Toolchain Setup</a>
<ul class="sectlevel2">
<li><a href="#_building_the_toolchain_from_scratch">1.1. Building the Toolchain from Scratch</a></li>
<li><a href="#_downloading_and_installing_a_prebuilt_toolchain">1.2. Downloading and Installing a Prebuilt Toolchain</a>
<ul class="sectlevel3">
<li><a href="#_use_the_toolchain_i_have_build">1.2.1. Use The Toolchain I have Build</a></li>
<li><a href="#_use_a_third_party_toolchain">1.2.2. Use a Third Party Toolchain</a></li>
</ul>
</li>
<li><a href="#_installation">1.3. Installation</a></li>
<li><a href="#_testing_the_installation">1.4. Testing the Installation</a></li>
</ul>
</li>
<li><a href="#_general_hardware_setup">2. General Hardware Setup</a></li>
<li><a href="#_general_software_framework_setup">3. General Software Framework Setup</a></li>
<li><a href="#_application_program_compilation">4. Application Program Compilation</a></li>
<li><a href="#_uploading_and_starting_of_a_binary_executable_image_via_uart">5. Uploading and Starting of a Binary Executable Image via UART</a></li>
<li><a href="#_installing_an_executable_directly_into_memory">6. Installing an Executable Directly Into Memory</a></li>
<li><a href="#_setup_of_a_new_application_program_project">7. Setup of a New Application Program Project</a></li>
<li><a href="#_enabling_risc_v_cpu_extensions">8. Enabling RISC-V CPU Extensions</a></li>
<li><a href="#_application_specific_processor_configuration">9. Application-Specific Processor Configuration</a>
<ul class="sectlevel2">
<li><a href="#_optimize_for_performance">9.1. Optimize for Performance</a></li>
<li><a href="#_optimize_for_size">9.2. Optimize for Size</a></li>
<li><a href="#_optimize_for_clock_speed">9.3. Optimize for Clock Speed</a></li>
<li><a href="#_optimize_for_energy">9.4. Optimize for Energy</a></li>
</ul>
</li>
<li><a href="#_adding_custom_hardware_modules">10. Adding Custom Hardware Modules</a>
<ul class="sectlevel2">
<li><a href="#_standard_external_interfaces">10.1. Standard (<em>External</em>) Interfaces</a></li>
<li><a href="#_external_bus_interface">10.2. External Bus Interface</a></li>
<li><a href="#_stream_link_interface">10.3. Stream Link Interface</a></li>
<li><a href="#_custom_functions_subsystem">10.4. Custom Functions Subsystem</a></li>
</ul>
</li>
<li><a href="#_customizing_the_internal_bootloader">11. Customizing the Internal Bootloader</a>
<ul class="sectlevel2">
<li><a href="#_bootloader_boot_configuration">11.1. Bootloader Boot Configuration</a>
<ul class="sectlevel3">
<li><a href="#_default_boot_configuration">Default Boot Configuration</a></li>
<li><a href="#_auto_boot_spi_en"><code>AUTO_BOOT_SPI_EN</code></a></li>
<li><a href="#_auto_boot_ocd_en"><code>AUTO_BOOT_OCD_EN</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_programming_an_external_spi_flash_via_the_bootloader">12. Programming an External SPI Flash via the Bootloader</a>
<ul class="sectlevel2">
<li><a href="#_spi_flash">12.1. SPI Flash</a></li>
<li><a href="#_programming_an_executable">12.2. Programming an Executable</a></li>
</ul>
</li>
<li><a href="#_packaging_the_processor_as_ip_block_for_xilinx_vivado_block_designer">13. Packaging the Processor as IP block for Xilinx Vivado Block Designer</a></li>
<li><a href="#_simulating_the_processor">14. Simulating the Processor</a>
<ul class="sectlevel2">
<li><a href="#_testbench">14.1. Testbench</a></li>
<li><a href="#_faster_simulation_console_output">14.2. Faster Simulation Console Output</a></li>
<li><a href="#_simulation_using_a_shell_script_with_ghdl">14.3. Simulation using a shell script (with GHDL)</a></li>
<li><a href="#_simulation_using_application_makefiles_in_console_with_ghdl">14.4. Simulation using Application Makefiles (In-Console with GHDL)</a>
<ul class="sectlevel3">
<li><a href="#_hello_world">14.4.1. Hello World!</a></li>
</ul>
</li>
<li><a href="#_advanced_simulation_using_vunit">14.5. Advanced Simulation using VUnit</a></li>
</ul>
</li>
<li><a href="#_building_the_documentation">15. Building the Documentation</a></li>
<li><a href="#_zephyr_rtos_support">16. Zephyr RTOS Support ü™Å</a></li>
<li><a href="#_freertos_support">17. FreeRTOS Support</a></li>
<li><a href="#_risc_v_architecture_test_framework">18. RISC-V Architecture Test Framework</a></li>
<li><a href="#_debugging_using_the_on_chip_debugger">19. Debugging using the On-Chip Debugger</a>
<ul class="sectlevel2">
<li><a href="#_hardware_requirements">19.1. Hardware Requirements</a></li>
<li><a href="#_openocd">19.2. OpenOCD</a></li>
<li><a href="#_debugging_with_gdb">19.3. Debugging with GDB</a>
<ul class="sectlevel3">
<li><a href="#_breakpoint_example">19.3.1. Breakpoint Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_legal">20. Legal</a>
<ul class="sectlevel2">
<li><a href="#_license">License</a></li>
<li><a href="#_proprietary_notice">Proprietary Notice</a></li>
<li><a href="#_disclaimer">Disclaimer</a></li>
<li><a href="#_limitation_of_liability_for_external_links">Limitation of Liability for External Links</a></li>
<li><a href="#_citing">Citing</a></li>
<li><a href="#_acknowledgments">Acknowledgments</a></li>
<li><a href="#_impressum_imprint">Impressum (Imprint)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="../img/neorv32_logo_transparent.png" alt="neorv32 logo transparent">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../img/riscv_logo.png" alt="riscv logo" width="350">
</div>
</div>
<div class="paragraph text-center">
<p><a href="https://github.com/stnolting/neorv32"><span class="image"><img src="https://img.shields.io/badge/GitHub-stnolting%2Fneorv32-ffbd00?style=flat-square&amp;logo=github&amp;" alt="GitHub stnolting%2Fneorv32 ffbd00?style=flat square&amp;logo=github&amp;" title="homepage"></span></a>
<a href="https://github.com/stnolting/neorv32/blob/master/LICENSE"><span class="image"><img src="https://img.shields.io/github/license/stnolting/neorv32?longCache=true&amp;style=flat-square" alt="neorv32?longCache=true&amp;style=flat square" title="license"></span></a>
<a href="https://gitter.im/neorv32/community"><span class="image"><img src="https://img.shields.io/badge/Chat-on%20gitter-4db797.svg?longCache=true&amp;style=flat-square&amp;logo=gitter&amp;logoColor=e8ecef" alt="Chat on%20gitter 4db797" title="chat on gitter"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/data%20sheet-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="data%20sheet PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="datasheet (pdf)"></span></a>
<a href="https://stnolting.github.io/neorv32"><span class="image"><img src="https://img.shields.io/badge/-HTML-ffbd00?longCache=true&amp;style=flat-square" alt=" HTML ffbd00?longCache=true&amp;style=flat square" title="datasheet (html)"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/user%20guide-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="user%20guide PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="userguide (pdf)"></span></a>
<a href="https://stnolting.github.io/neorv32/sw/files.html"><span class="image"><img src="https://img.shields.io/badge/doxygen-HTML-ffbd00?longCache=true&amp;style=flat-square&amp;logo=Doxygen" alt="doxygen HTML ffbd00?longCache=true&amp;style=flat square&amp;logo=Doxygen" title="doxygen"></span></a></p>
</div>
<div class="paragraph">
<p>Let&#8217;s Get It Started!</p>
</div>
<div class="paragraph">
<p>This user guide uses the NEORV32 project <em>as is</em> from the official <code>neorv32</code> repository.
To make your first NEORV32 project run, follow the guides from the upcoming sections. It is recommended to
follow these guides step by step and eventually in the presented order.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This guide uses the minimalistic and platform/toolchain agnostic SoC test setups from
<code>rtl/test_setups</code> for illustration. You can use one of the provided test setups for
your first FPGA tests. Alternatively, have a look at the <code>setups</code> folder,
which provides more sophisticated example setups for various FPGAs/FPGA boards and toolchains.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_toolchain_setup">1. Software Toolchain Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To compile (and debug) executables for the NEORV32 a RISC-V toolchain is required.
There are two possibilities to get this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and <em>build</em> the official RISC-V GNU toolchain yourself.</p>
</li>
<li>
<p>Download and install a prebuilt version of the toolchain; this might also done via the package manager / app store of your OS</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default toolchain prefix (<code>RISCV_PREFIX</code> variable) for this project is <strong><code>riscv32-unknown-elf-</code></strong>. Of course you can use any other RISC-V
toolchain (like <code>riscv64-unknown-elf-</code>) that is capable to emit code for a <code>rv32</code> architecture. Just change <code>RISCV_PREFIX</code>
according to your needs.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_building_the_toolchain_from_scratch">1.1. Building the Toolchain from Scratch</h3>
<div class="paragraph">
<p>To build the toolchain by yourself you can follow the guide from the official <a href="https://github.com/riscv-collab/riscv-gnu-toolchain" class="bare">https://github.com/riscv-collab/riscv-gnu-toolchain</a> GitHub page.
You need to make sure the generated toolchain fits the architecture of the NEORV32 core. To get a toolchain that even supports minimal
ISA extension configurations, it is recommend to compile for <code>rv32i</code> only. Please note that this minimal ISA also provides further ISA
extensions like <code>m</code> or <code>c</code>. Of course you can use a <em>multilib</em> approach to generate toolchains for several target ISAs at once.</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. Configuring GCC build for <code>rv32i</code> (minimal ISA)</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">riscv-gnu-toolchain$ ./configure --prefix=/opt/riscv --with-arch=rv32i --with-abi=ilp32
riscv-gnu-toolchain$ make</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Keep in mind that - for instance - a toolchain build with <code>--with-arch=rv32imc</code> only provides library code compiled with
compressed (<code>C</code>) and <code>mul</code>/<code>div</code> instructions (<code>M</code>)! Hence, this code cannot be executed (without
emulation) on an architecture without these extensions!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_downloading_and_installing_a_prebuilt_toolchain">1.2. Downloading and Installing a Prebuilt Toolchain</h3>
<div class="paragraph">
<p>Alternatively, you can download a prebuilt toolchain.</p>
</div>
<div class="sect3">
<h4 id="_use_the_toolchain_i_have_build">1.2.1. Use The Toolchain I have Build</h4>
<div class="paragraph">
<p>I have compiled a GCC toolchain on a 64-bit x86 Ubuntu (Ubuntu on Windows, actually) and uploaded it to
GitHub. You can directly download the according toolchain archive as single <em>zip-file</em> within a packed
release from <a href="https://github.com/stnolting/riscv-gcc-prebuilt" class="bare">https://github.com/stnolting/riscv-gcc-prebuilt</a>.</p>
</div>
<div class="paragraph">
<p>Unpack the downloaded toolchain archive and copy the content to a location in your file system (e.g.
<code>/opt/riscv</code>). More information about downloading and installing my prebuilt toolchains can be found in
the repository&#8217;s README.</p>
</div>
</div>
<div class="sect3">
<h4 id="_use_a_third_party_toolchain">1.2.2. Use a Third Party Toolchain</h4>
<div class="paragraph">
<p>Of course you can also use any other prebuilt version of the toolchain. There are a lot  RISC-V GCC packages out there -
even for Windows. On Linux system you might even be able to fetch a toolchain via your distribution&#8217;s package manager.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure the toolchain can (also) emit code for a <code>rv32i</code> architecture, uses the <code>ilp32</code> or <code>ilp32e</code> ABI and <strong>was not build</strong> using
CPU extensions that are not supported by the NEORV32 (like <code>D</code>).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation">1.3. Installation</h3>
<div class="paragraph">
<p>Now you have the toolchain binaries. The last step is to add them to your <code>PATH</code> environment variable (if you have not
already done so): make sure to add the <em>binaries</em> folder (<code>bin</code>) of your toolchain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ export PATH:$PATH:/opt/riscv/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should add this command to your <code>.bashrc</code> (if you are using bash) to automatically add the RISC-V
toolchain at every console start.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_installation">1.4. Testing the Installation</h3>
<div class="paragraph">
<p>To make sure everything works fine, navigate to an example project in the NEORV32 example folder and
execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make check</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will test all the tools required for generating NEORV32 executables.
Everything is working fine if <code>Toolchain check OK</code> appears at the end.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general_hardware_setup">2. General Hardware Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide shows the basics of setting up a NEORV32 project for FPGA implementation (or simulation only)
<em>from scratch</em>. It uses a <em>simplified</em> test "SoC" setup of the processor to keeps things simple at the beginning.
This simple setup is intended for evaluation or as "hello world" project to check out the NEORV32
on <em>your</em> FPGA board.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to use a more sophisticated pre-defined setup to start with, check out the
<code>setups</code> folder, which provides example setups for various FPGA, boards and toolchains.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 project features two minimalistic pre-configured test setups in
<a href="https://github.com/stnolting/neorv32/blob/master/rtl/test_setups"><code>rtl/test_setups</code></a>.
Both test setups only implement very basic processor and CPU features.
The main difference between the two setups is the processor boot concept - so how to get a software executable
<em>into</em> the processor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>rtl/test_setups/neorv32_testsetup_approm.vhd</code></strong>: this setup does not require a connection via UART. The
software executable is "installed" into the bitstream to initialize a read-only memory. Use this setup
if your FPGA board does <em>not</em> provide a UART interface.</p>
</li>
<li>
<p><strong><code>rtl/test_setups/neorv32_testsetup_bootloader.vhd</code></strong>: this setups uses the UART and the default NEORV32
bootloader to upload new software executables. Use this setup if your board <em>does</em> provide a UART interface.</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../img/neorv32_test_setup.png" alt="neorv32 test setup">
</div>
<div class="title">Figure 1. NEORV32 "hello world" test setup (<code>rtl/test_setups/neorv32_testsetup_bootloader.vhd</code>)</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">External Clock Source</div>
These test setups are intended to be directly used as <strong>design top entity</strong>. Of course you can also instantiate them
into another design unit. If your FPGA board only provides <em>very fast</em> external clock sources (like on the FOMU board)
you might need to add clock management components (PLLs, DCMs, MMCMs, &#8230;&#8203;) to the test setup or to the according top entity
if you instantiate one of the test setups.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Create a new project with your FPGA EDA tool of choice.</p>
</li>
<li>
<p>Add all VHDL files from the project&#8217;s <code>rtl/core</code> folder to your project.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Internal Memories</div>
For a <em>general</em> first setup (technology-independent) use the <code>*.default.vhd</code> memory architectures for the internal memories
(IMEM and DMEM). These are located in <code>rtl/core/mem</code> so make sure to add the files to your project, too.<br>
<br>
If synthesis cannot efficiently map those default memory descriptions to the available memory resources, you can later replace the
default memory architectures by optimized platform-specific memory architectures. <strong>Example:</strong> The <code>setups/radiant/UPduino_v3</code>
example setup uses optimized memory primitives. Hence, it does not include the default memory architectures from
<code>rtl/core/mem</code> as these are replaced by device-specific implementations. However, it still has to include the entity
definitions from <code>rtl/core</code>.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Make sure to add all the rtl files to a new library called <code>neorv32</code>. If your FPGA tools does not
provide a field to enter the library name, check out the "properties" menu of the added rtl files.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Compile order</div>
Some tools (like Lattice Radiant) might require a <em>manual compile order</em> of the VHDL source files to identify the dependencies.
The package file <code>neorv32_package.vhd</code> should be analyzed first followed by the memory image files (<code>neorv32_application_imagevhd</code>
and <code>neorv32_bootloader_image.vhd</code>) and the entity-only files (<code>neorv32_*mem.entity.vhd</code>).
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>The <code>rtl/core/neorv32_top.vhd</code> VHDL file is the top entity of the NEORV32 processor, which can be
instantiated into the "real" project. However, in this tutorial we will use one of the pre-defined
test setups from <code>rtl/test_setups</code> (see above).</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure to include the <code>neorv32</code> package into your design when instantiating the processor: add
<code>library neorv32;</code> and <code>use neorv32.neorv32_package.all;</code> to your design unit.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Add the pre-defined test setup of choice to the project, too, and select it as <em>top entity</em>.</p>
</li>
<li>
<p>The entity of both test setups
provide a minimal set of configuration generics, that might have to be adapted to match your FPGA and board:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 2. Test setup entity - configuration generics</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">  generic (
    -- adapt these for your setup --
    CLOCK_FREQUENCY   : natural := 100000000; <i class="conum" data-value="1"></i><b>(1)</b>
    MEM_INT_IMEM_SIZE : natural := 16*1024;   <i class="conum" data-value="2"></i><b>(2)</b>
    MEM_INT_DMEM_SIZE : natural := 8*1024     <i class="conum" data-value="3"></i><b>(3)</b>
  );</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Clock frequency of <code>clk_i</code> signal in Hertz</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Default size of internal instruction memory: 16kB</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default size of internal data memory: 8kB</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>If you feel like it - or if your FPGA does not provide sufficient resources - you can modify the
<em>memory sizes</em> (<code>MEM_INT_IMEM_SIZE</code> and <code>MEM_INT_DMEM_SIZE</code> - marked with notes "2" and "3"). But as mentioned
above, let&#8217;s keep things simple at first and use the standard configuration for now.</p>
</li>
<li>
<p>There is one generic that <em>has to be set according to your FPGA board</em> setup: the actual clock frequency
of the top&#8217;s clock input signal (<code>clk_i</code>). Use the <code>CLOCK_FREQUENCY</code> generic to specify your clock source&#8217;s
frequency in Hertz (Hz).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have changed the default memory configuration (<code>MEM_INT_IMEM_SIZE</code> and <code>MEM_INT_DMEM_SIZE</code> generics)
keep those new sizes in mind - these values are required for setting
up the software framework in the next section <a href="#_general_software_framework_setup">General Software Framework Setup</a>.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Depending on your FPGA tool of choice, it is time to assign the signals of the test setup top entity to
the according pins of your FPGA board. All the signals can be found in the entity declaration of the
corresponding test setup:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 3. Entity signals of <code>neorv32_testsetup_approm.vhd</code></div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">  port (
    -- Global control --
    clk_i       : in  std_ulogic; -- global clock, rising edge
    rstn_i      : in  std_ulogic; -- global reset, low-active, async
    -- GPIO --
    gpio_o      : out std_ulogic_vector(7 downto 0) -- parallel output
  );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 4. Entity signals of <code>neorv32_testsetup_bootloader.vhd</code></div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">  port (
    -- Global control --
    clk_i       : in  std_ulogic; -- global clock, rising edge
    rstn_i      : in  std_ulogic; -- global reset, low-active, async
    -- GPIO --
    gpio_o      : out std_ulogic_vector(7 downto 0); -- parallel output
    -- UART0 --
    uart0_txd_o : out std_ulogic; -- UART0 send data
    uart0_rxd_i : in  std_ulogic  -- UART0 receive data
  );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Signal Polarity</div>
If your FPGA board has inverse polarity for certain input/output you can add <code>not</code> gates. Example: The reset signal
<code>rstn_i</code> is low-active by default; the LEDs connected to <code>gpio_o</code> high-active by default.
You can do this in your board top if you instantiate the test setup,
or <em>inside</em> the test setup if this is your top entity (low-active LEDs example: <code>gpio_o &#8656; NOT con_gpio_o(7 downto 0);</code>).
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>Attach the clock input <code>clk_i</code> to your clock source and connect the reset line <code>rstn_i</code> to a button of
your FPGA board. Check whether it is low-active or high-active - the reset signal of the processor is
<strong>low-active</strong>, so maybe you need to invert the input signal.</p>
</li>
<li>
<p>If possible, connected <em>at least</em> bit <code>0</code> of the GPIO output port <code>gpio_o</code> to a LED (see "Signal Polarity" note above).</p>
</li>
<li>
<p>Finally, if your are using the UART-based test setup (<code>neorv32_testsetup_bootloader.vhd</code>)
connect the UART communication signals <code>uart0_txd_o</code> and <code>uart0_rxd_i</code> to the host interface (e.g. USB-UART converter).</p>
</li>
<li>
<p>Perform the project HDL compilation (synthesis, mapping, bitstream generation).</p>
</li>
<li>
<p>Program the generated bitstream into your FPGA and press the button connected to the reset signal.</p>
</li>
<li>
<p>Done! The LED at <code>gpio_o(0)</code> should be flashing now.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
After the GCC toolchain for compiling RISC-V source code is ready (chapter <a href="#_general_software_framework_setup">General Software Framework Setup</a>),
you can advance to one of these chapters to learn how to get a software executable into your processor setup:
* If you are using the <code>neorv32_testsetup_approm.vhd</code> setup: See section <a href="#_installing_an_executable_directly_into_memory">Installing an Executable Directly Into Memory</a>.
* If you are using the <code>neorv32_testsetup_bootloader.vhd</code> setup: See section <a href="#_uploading_and_starting_of_a_binary_executable_image_via_uart">Uploading and Starting of a Binary Executable Image via UART</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_general_software_framework_setup">3. General Software Framework Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To allow executables to be <em>actually executed</em> on the NEORV32 Processor the configuration of the software framework
has to be aware to the hardware configuration. This guide focuses on the memory configuration. To enabled
certain CPU ISA features refer to the <a href="#_enabling_risc_v_cpu_extensions">Enabling RISC-V CPU Extensions</a> section.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you have <strong>not</strong> changed the <em>default</em> memory configuration in section <a href="#_general_hardware_setup">General Hardware Setup</a>
you are already done and you can skip the rest of this guide.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Open the NEORV32 linker script <code>sw/common/neorv32.ld</code> with a text editor. Right at the
beginning of this script you will find the <code>MEMORY</code> configuration listing the different memory section:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 5. Cut-out of the linker script <code>neorv32.ld</code>: <code>ram</code> memory section configuration</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">MEMORY
{
  ram  (rwx) : ORIGIN = 0x80000000, LENGTH = DEFINED(make_bootloader) ? 512 : 8*1024 <i class="conum" data-value="1"></i><b>(1)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Size of the data memory address space (right-most value) (internal/external DMEM); here 8kB</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>We only need to change the <code>ram</code> section, which presents the available data address space.
If you have changed the DMEM (<em>MEM_INT_DMEM_SIZE</em> generic) size adapt the <code>LENGTH</code> parameter of the <code>ram</code>
section (here: <code>8*1024</code>) so it is equal to your DMEM hardware configuration.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure you only modify the <em>right-most</em> value (here: 8*1024)!<br>
The &#8220;512&#8221; are not relevant for the application.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Done! Save your changes and close the linker script.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Advanced: Section base address and size</div>
More information can be found in the datasheet section <a href="https://stnolting.github.io/neorv32/#_address_space">Address Space</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_application_program_compilation">4. Application Program Compilation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide shows how to compile an example C-code application into a NEORV32 executable that
can be uploaded via the bootloader or the on-chip debugger.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your FPGA board does not provide such an interface - don&#8217;t worry!
Section <a href="#_installing_an_executable_directly_into_memory">Installing an Executable Directly Into Memory</a> shows how to
run custom programs on your FPGA setup without having a UART.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Open a terminal console and navigate to one of the project&#8217;s example programs. For instance, navigate to the
simple <code>sw/example_blink_led</code> example program. This program uses the NEORV32 GPIO module to display
an 8-bit counter on the lowest eight bit of the <code>gpio_o</code> output port.</p>
</li>
<li>
<p>To compile the project and generate an executable simply execute:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make clean_all exe</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>We are using the <code>clean_all</code> target to make sure everything is re-build.</p>
</li>
<li>
<p>This will compile and link the application sources together with all the included libraries. At the end,
your application is transformed into an ELF file (<code>main.elf</code>). The <em>NEORV32 image generator</em> (in <code>sw/image_gen</code>)
takes this file and creates a final executable. The makefile will show the resulting memory utilization and
the executable size:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make clean_all exe
Memory utilization:
   text    data     bss     dec     hex filename
   3176       0     120    3296     ce0 main.elf
Compiling ../../../sw/image_gen/image_gen
Executable (neorv32_exe.bin) size in bytes:
3188</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>That&#8217;s it. The <code>exe</code> target has created the actual executable <code>neorv32_exe.bin</code> in the current folder
that is ready to be uploaded to the processor.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The compilation process will also create a <code>main.asm</code> assembly listing file in the current folder, which
shows the actual assembly code of the application.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_uploading_and_starting_of_a_binary_executable_image_via_uart">5. Uploading and Starting of a Binary Executable Image via UART</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Follow this guide to use the bootloader to upload an executable via UART.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This concept uses the default "Indirect Boot" scenario that uses the bootloader to upload new executables.
See datasheet section <a href="https://stnolting.github.io/neorv32/#_indirect_boot">Indirect Boot</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your FPGA board does not provide such an interface - don&#8217;t worry!
Section <a href="#_installing_an_executable_directly_into_memory">Installing an Executable Directly Into Memory</a> shows how to
run custom programs on your FPGA setup without having a UART.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Connect the primary UART (UART0) interface of your FPGA board to a serial port of your host computer.</p>
</li>
<li>
<p>Start a terminal program. In this tutorial, I am using TeraTerm for Windows. You can download it fore free
from <a href="https://ttssh2.osdn.jp/index.html.en" class="bare">https://ttssh2.osdn.jp/index.html.en</a></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Any</em> terminal program that can connect to a serial port should work. However, make sure the program
can transfer data in <em>raw</em> byte mode without any protocol overhead around it.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Open a connection to the the serial port your UART is connected to. Configure the terminal setting according to the
following parameters:</p>
<div class="ulist">
<ul>
<li>
<p>19200 Baud</p>
</li>
<li>
<p>8 data bits</p>
</li>
<li>
<p>1 stop bit</p>
</li>
<li>
<p>no parity bits</p>
</li>
<li>
<p><em>no</em> transmission/flow control protocol</p>
</li>
<li>
<p>receiver (host computer) newline on <code>\r\n</code> (carriage return &amp; newline)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Also make sure that single chars are send from your computer <em>without</em> any consecutive "new line" or "carriage
return" commands (this is highly dependent on your terminal application of choice, TeraTerm only
sends the raw chars by default).</p>
</li>
<li>
<p>Press the NEORV32 reset button to restart the bootloader. The status LED starts blinking and the
bootloader intro screen appears in your console. Hurry up and press any key (hit space!) to abort the
automatic boot sequence and to start the actual bootloader user interface console.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 6. Bootloader console; aborted auto-boot sequence</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">&lt;&lt; NEORV32 Bootloader &gt;&gt;

BLDV: Mar 23 2021
HWV:  0x01050208
CLK:  0x05F5E100
MISA: 0x40901105
ZEXT: 0x00000023
PROC: 0x0EFF0037
IMEM: 0x00004000 bytes @ 0x00000000
DMEM: 0x00002000 bytes @ 0x80000000

Autoboot in 8s. Press key to abort.
Aborted.

Available commands:
h: Help
r: Restart
u: Upload
s: Store to flash
l: Load from flash
e: Execute
CMD:&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Execute the "Upload" command by typing <code>u</code>. Now the bootloader is waiting for a binary executable to be send.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CMD:&gt; u
Awaiting neorv32_exe.bin...</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Use the "send file" option of your terminal program to send a NEORV32 executable (<code>neorv32_exe.bin</code>).</p>
</li>
<li>
<p>Again, make sure to transmit the executable in raw binary mode (no transfer protocol).
When using TeraTerm, select the "binary" option in the send file dialog.</p>
</li>
<li>
<p>If everything went fine, OK will appear in your terminal:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CMD:&gt; u
Awaiting neorv32_exe.bin... OK</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="10">
<li>
<p>The executable is now in the instruction memory of the processor. To execute the program right
now run the "Execute" command by typing <code>e</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CMD:&gt; u
Awaiting neorv32_exe.bin... OK
CMD:&gt; e
Booting...
Blinking LED demo program</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="11">
<li>
<p>If everything went fine, you should see the LEDs blinking.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The bootloader will print error codes if something went wrong.
See section <a href="https://stnolting.github.io/neorv32/#_bootloader">Bootloader</a> of the NEORV32 datasheet for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See section <a href="#_programming_an_external_spi_flash_via_the_bootloader">Programming an External SPI Flash via the Bootloader</a> to learn how to use an external SPI
flash for nonvolatile program storage.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Executables can also be uploaded via the <strong>on-chip debugger</strong>.
See section <a href="#_debugging_with_gdb">Debugging with GDB</a> for more information.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_an_executable_directly_into_memory">6. Installing an Executable Directly Into Memory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you do not want to use the bootloader (or the on-chip debugger) for executable upload or if your setup does not provide
a serial interface for that, you can also directly install an application into embedded memory.</p>
</div>
<div class="paragraph">
<p>This concept uses the "Direct Boot" scenario that implements the processor-internal IMEM as ROM, which is
pre-initialized with the application&#8217;s executable during synthesis. Hence, it provides <em>non-volatile</em> storage of the
executable inside the processor. This storage cannot be altered during runtime and any source code modification of
the application requires to re-program the FPGA via the bitstream.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See datasheet section <a href="https://stnolting.github.io/neorv32/#_direct_boot">Direct Boot</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the IMEM as ROM:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for this boot concept the bootloader is no longer required</p>
</li>
<li>
<p>this concept only works for the internal IMEM (but can be extended to work with external memories coupled via the processor&#8217;s bus interface)</p>
</li>
<li>
<p>make sure that the memory components (like block RAM) the IMEM is mapped to support an initialization via the bitstream</p>
</li>
</ul>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>At first, make sure your processor setup actually implements the internal IMEM: the <code>MEM_INT_IMEM_EN</code> generics has to be set to <code>true</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 7. Processor top entity configuration - enable internal IMEM</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">  -- Internal Instruction memory --
  MEM_INT_IMEM_EN =&gt; true, -- implement processor-internal instruction memory</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>For this setup we do not want the bootloader to be implemented at all. Disable implementation of the bootloader by setting the
<code>INT_BOOTLOADER_EN</code> generic to <code>false</code>. This will also modify the processor-internal IMEM so it is initialized with the executable during synthesis.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Listing 8. Processor top entity configuration - disable internal bootloader</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">  -- General --
  INT_BOOTLOADER_EN =&gt; false, -- boot configuration: false = boot from int/ext (I)MEM</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>To generate an "initialization image" for the IMEM that contains the actual application, run the <code>install</code> target when compiling your application:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/blink_led$ make clean_all install
Memory utilization:
   text    data     bss     dec     hex filename
   3176       0     120    3296     ce0 main.elf
Compiling ../../../sw/image_gen/image_gen
Installing application image to ../../../rtl/core/neorv32_application_image.vhd</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>The <code>install</code> target has compiled all the application sources but instead of creating an executable (<code>neorv32_exe.bit</code>) that can be uploaded via the
bootloader, it has created a VHDL memory initialization image <code>core/neorv32_application_image.vhd</code>.</p>
</li>
<li>
<p>This VHDL file is automatically copied to the core&#8217;s rtl folder (<code>rtl/core</code>) so it will be included for the next synthesis.</p>
</li>
<li>
<p>Perform a new synthesis. The IMEM will be build as pre-initialized ROM (inferring embedded memories if possible).</p>
</li>
<li>
<p>Upload your bitstream. Your application code now resides unchangeable in the processor&#8217;s IMEM and is directly executed after reset.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The synthesis tool / simulator will print asserts to inform about the (IMEM) memory / boot configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>NEORV32 PROCESSOR CONFIG NOTE: Boot configuration: Direct boot from memory (processor-internal IMEM).
NEORV32 PROCESSOR CONFIG NOTE: Implementing processor-internal IMEM as ROM (3176 bytes), pre-initialized with application.</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_of_a_new_application_program_project">7. Setup of a New Application Program Project</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>The easiest way of creating a <em>new</em> software application project is to copy an <em>existing</em> one. This will keep all
file dependencies. For example you can copy <code>sw/example/blink_led</code> to <code>sw/example/flux_capacitor</code>.</p>
</li>
<li>
<p>If you want to place you application somewhere outside <code>sw/example</code> you need to adapt the application&#8217;s makefile.
In the makefile you will find a variable that keeps the relative or absolute path to the NEORV32 repository home
folder. Just modify this variable according to your new project&#8217;s home location:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># Relative or absolute path to the NEORV32 home folder (use default if not set by user)
NEORV32_HOME ?= ../../..</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>If your project contains additional source files outside of the project folder, you can add them to
the <code>APP_SRC</code> variable:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># User's application sources (add additional files here)
APP_SRC = $(wildcard *.c) ../somewhere/some_file.c</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>You also can add a folder containing your application&#8217;s include files to the
<code>APP_INC</code> variable (do not forget the <code>-I</code> prefix):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># User's application include folders (don't forget the '-I' before each entry)
APP_INC = -I . -I ../somewhere/include_stuff_folder</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_risc_v_cpu_extensions">8. Enabling RISC-V CPU Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whenever you enable/disable a RISC-V CPU extensions via the according <code>CPU_EXTENSION_RISCV_x</code> generic, you need to
adapt the toolchain configuration so the compiler can actually generate according code for it.</p>
</div>
<div class="paragraph">
<p>To do so, open the makefile of your project (for example <code>sw/example/blink_led/makefile</code>) and scroll to the
"USER CONFIGURATION" section right at the beginning of the file. You need to modify the <code>MARCH</code> variable and eventually
the <code>MABI</code> variable according to your CPU hardware configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># CPU architecture and ABI
MARCH ?= rv32i <i class="conum" data-value="1"></i><b>(1)</b>
MABI  ?= ilp32 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>MARCH = Machine architecture ("ISA string")</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>MABI = Machine binary interface</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if you enable the RISC-V <code>C</code> extension (16-bit compressed instructions) via the <code>CPU_EXTENSION_RISCV_C</code>
generic (set <code>true</code>) you need to add the <code>c</code> extension also to the <code>MARCH</code> ISA string in order to make the compiler
emit compressed instructions.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Privileged Architecture Extensions</div>
Privileged architecture extensions like <code>Zicsr</code> or <code>Zifencei</code> are "used" <em>implicitly</em> by the compiler. Hence, according
instruction will only be generated when "encoded" via inline assembly or when linking according libraries. In this case,
these instruction will <em>always</em> be emitted (even if the according extension is not specified in <code>MARCH</code>).<br>
<strong>I recommend to <em>not</em> specify any privileged architecture extensions in <code>MARCH</code>.</strong>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
ISA extension enabled in hardware can be a superset of the extensions enabled in software, but not the other way
around. For example generating compressed instructions for a CPU configuration that has the <code>c</code> extension disabled
will cause <em>illegal instruction exceptions</em> at runtime.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also override the default <code>MARCH</code> and <code>MABI</code> configurations from the makefile when invoking the makefile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ make MARCH=rv32ic clean_all all</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The RISC-V ISA string for <code>MARCH</code> follows a certain <em>canonical</em> structure:
<code>rev32[i/e][m][a][f][d][g][q][c][b][v][n]&#8230;&#8203;</code> For example <code>rv32imac</code> is valid while <code>rv32icma</code> is not.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_application_specific_processor_configuration">9. Application-Specific Processor Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Due to the processor&#8217;s configuration options, which are mainly defined via the top entity VHDL generics, the SoC
can be tailored to the application-specific requirements. Note that this chapter does not focus on optional
<em>SoC features</em> like IO/peripheral modules. It rather gives ideas on how to optimize for <em>overall goals</em>
like performance and area.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please keep in mind that optimizing the design in one direction (like performance) will also effect other potential
optimization goals (like area and energy).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_optimize_for_performance">9.1. Optimize for Performance</h3>
<div class="paragraph">
<p>The following points show some concepts to optimize the processor for performance regardless of the costs
(i.e. increasing area and energy requirements):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable all performance-related RISC-V CPU extensions that implement dedicated hardware accelerators instead
of emulating operations entirely in software:  <code>M</code>, <code>C</code>, <code>Zfinx</code></p>
</li>
<li>
<p>Enable mapping of compleX CPU operations to dedicated hardware: <code>FAST_MUL_EN &#8658; true</code> to use DSP slices for
multiplications, <code>FAST_SHIFT_EN &#8658; true</code> use a fast barrel shifter for shift operations.</p>
</li>
<li>
<p>Implement the instruction cache: <code>ICACHE_EN &#8658; true</code></p>
</li>
<li>
<p>Use as many <em>internal</em> memory as possible to reduce memory access latency: <code>MEM_INT_IMEM_EN &#8658; true</code> and
<code>MEM_INT_DMEM_EN &#8658; true</code>, maximize <code>MEM_INT_IMEM_SIZE</code> and <code>MEM_INT_DMEM_SIZE</code></p>
</li>
<li>
<p>Increase the CPU&#8217;s instruction prefetch buffer size: <code>CPU_IPB_ENTRIES</code></p>
</li>
<li>
<p><em>To be continued&#8230;&#8203;</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_optimize_for_size">9.2. Optimize for Size</h3>
<div class="paragraph">
<p>The NEORV32 is a size-optimized processor system that is intended to fit into tiny niches within large SoC
designs or to be used a customized microcontroller in really tiny / low-power FPGAs (like Lattice iCE40).
Here are some ideas how to make the processor even smaller while maintaining it&#8217;s <em>general purpose system</em>
concept and maximum RISC-V compatibility.</p>
</div>
<div class="paragraph">
<p><strong>SoC</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is obvious, but exclude all unused optional IO/peripheral modules from synthesis via the processor
configuration generics.</p>
</li>
<li>
<p>If an IO module provides an option to configure the number of "channels", constrain this number to the
actually required value (e.g. the PWM module <code>IO_PWM_NUM_CH</code> or the external interrupt controller <code>XIRQ_NUM_CH</code>).</p>
</li>
<li>
<p>Reduce the FIFO sizes of implemented modules (e.g. <code>SLINK_TX_FIFO</code>).</p>
</li>
<li>
<p>Disable the instruction cache (<code>ICACHE_EN &#8658; false</code>) if the design only uses processor-internal IMEM
and DMEM memories.</p>
</li>
<li>
<p><em>To be continued&#8230;&#8203;</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>CPU</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <em>embedded</em> RISC-V CPU architecture extension (<code>CPU_EXTENSION_RISCV_E</code>) to reduce block RAM utilization.</p>
</li>
<li>
<p>The compressed instructions extension (<code>CPU_EXTENSION_RISCV_C</code>) requires additional logic for the decoder but
also reduces program code size by approximately 30%.</p>
</li>
<li>
<p>If not explicitly used/required, constrain the CPU&#8217;s counter sizes: <code>CPU_CNT_WIDTH</code> for <code>[m]instret[h]</code>
(number of instruction) and <code>[m]cycle[h]</code> (number of cycles) counters. You can even remove these counters
by setting <code>CPU_CNT_WIDTH &#8658; 0</code> if they are not used at all (note, this is not RISC-V compliant).</p>
</li>
<li>
<p>Reduce the CPU&#8217;s prefetch buffer size (<code>CPU_IPB_ENTRIES</code>).</p>
</li>
<li>
<p>Map CPU shift operations to a small and iterative shifter unit (<code>FAST_SHIFT_EN &#8658; false</code>).</p>
</li>
<li>
<p>If you have unused DSP block available, you can map multiplication operations to those slices instead of
using LUTs to implement the multiplier (<code>FAST_MUL_EN &#8658; true</code>).</p>
</li>
<li>
<p>If there is no need to execute division in hardware, use the <code>Zmmul</code> extension instead of the full-scale
<code>M</code> extension.</p>
</li>
<li>
<p>Disable CPU extension that are not explicitly used (<code>A</code>, <code>U</code>, <code>Zfinx</code>).</p>
</li>
<li>
<p><em>To be continued&#8230;&#8203;</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_optimize_for_clock_speed">9.3. Optimize for Clock Speed</h3>
<div class="paragraph">
<p>The NEORV32 Processor and CPU are designed to provide minimal logic between register stages to keep the
critical path as short as possible. When enabling additional extension or modules the impact on the existing
logic is also kept at a minimum to prevent timing degrading. If there is a major impact on existing
logic (example: many physical memory protection address configuration registers) the VHDL code automatically
adds additional register stages to maintain critical path length. Obviously, this increases operation latency.</p>
</div>
<div class="paragraph">
<p>In order to optimize for a minimal critical path (= maximum clock speed) the following points should be considered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Complex CPU extensions (in terms of hardware requirements) should be avoided (examples: floating-point unit, physical memory protection).</p>
</li>
<li>
<p>Large carry chains (&gt;32-bit) should be avoided (constrain CPU counter sizes: e.g. <code>CPU_CNT_WIDTH &#8658; 32</code> and <code>HPM_NUM_CNTS &#8658; 32</code>).</p>
</li>
<li>
<p>If the target FPGA provides sufficient DSP resources, CPU multiplication operations can be mapped to DSP slices (<code>FAST_MUL_EN &#8658; true</code>)
reducing LUT usage and critical path impact while also increasing overall performance.</p>
</li>
<li>
<p>Use the synchronous (registered) RX path configuration of the external memory interface (<code>MEM_EXT_ASYNC_RX &#8658; false</code>).</p>
</li>
<li>
<p><em>To be continued&#8230;&#8203;</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The short and fixed-length critical path allows to integrate the core into existing clock domains.
So no clock domain-crossing and no sub-clock generation is required. However, for very high clock
frequencies (this is technology / platform dependent) clock domain crossing becomes crucial for chip-internal
connections.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_optimize_for_energy">9.4. Optimize for Energy</h3>
<div class="paragraph">
<p>There are no <em>dedicated</em> configuration options to optimize the processor for energy (minimal consumption;
energy/instruction ratio) yet. However, a reduced processor area (<a href="#_optimize_for_size">Optimize for Size</a>) will also reduce
static energy consumption.</p>
</div>
<div class="paragraph">
<p>To optimize your setup for low-power applications, you can make use of the CPU sleep mode (<code>wfi</code> instruction).
Put the CPU to sleep mode whenever possible. Disable all processor modules that are not actually used (exclude them
from synthesis if the will be <em>never</em> used; disable the module via it&#8217;s control register if the module is not
<em>currently</em> used). When is sleep mode, you can keep a timer module running (MTIME or the watch dog) to wake up
the CPU again. Since the wake up is triggered by <em>any</em> interrupt, the external interrupt controller can also
be used to wake up the CPU again. By this, all timers (and all other modules) can be deactivated as well.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Processor-internal clock generator shutdown</div>
If <em>no</em> IO/peripheral module is currently enabled, the processor&#8217;s internal clock generator circuit will be
shut down reducing switching activity and thus, dynamic energy consumption.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_custom_hardware_modules">10. Adding Custom Hardware Modules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In resemblance to the RISC-V ISA, the NEORV32 processor was designed to ease customization and <em>extensibility</em>.
The processor provides several predefined options to add application-specific custom hardware modules and accelerators.</p>
</div>
<div class="sect2">
<h3 id="_standard_external_interfaces">10.1. Standard (<em>External</em>) Interfaces</h3>
<div class="paragraph">
<p>The processor already provides a set of standard interfaces that are intended to connect <em>chip-external</em> devices.
However, these interfaces can also be used chip-internally. The most suitable interfaces are
<a href="https://stnolting.github.io/neorv32/#_general_purpose_input_and_output_port_gpio">GPIO</a>,
<a href="https://stnolting.github.io/neorv32/#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART</a>,
<a href="https://stnolting.github.io/neorv32/#_serial_peripheral_interface_controller_spi">SPI</a> and
<a href="https://stnolting.github.io/neorv32/#_two_wire_serial_interface_controller_twi">TWI</a>.</p>
</div>
<div class="paragraph">
<p>The SPI and (especially) the GPIO interfaces might be the most straightforward approaches since they
have a minimal  protocol overhead. Device-specific interrupt capabilities can be added using the
<a href="https://stnolting.github.io/neorv32/#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a>.
Beyond simplicity, these interface only provide a very limited bandwidth and require more sophisticated
software handling ("bit-banging" for the GPIO).</p>
</div>
</div>
<div class="sect2">
<h3 id="_external_bus_interface">10.2. External Bus Interface</h3>
<div class="paragraph">
<p>The <a href="https://stnolting.github.io/neorv32/#_processor_external_memory_interface_wishbone_axi4_lite">External Bus Interface</a>
provides the classic approach to connect to custom IP. By default, the bus interface implements the widely adopted
Wishbone interface standard. However, this project also includes wrappers to bridge to other protocol standards like ARM&#8217;s
AXI4-Lite or Intel&#8217;s Avalon. By using a full-featured bus protocol, complex SoC structures can be implemented (including
several modules and even multi-core architectures). Many FPGA EDA tools provide graphical editors to build and customize
whole SoC architectures and even include pre-defined IP libraries.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/neorv32_axi_soc.png" alt="neorv32 axi soc">
</div>
<div class="title">Figure 2. Example AXI SoC using Xilinx Vivado</div>
</div>
<div class="paragraph">
<p>The bus interface uses a memory-mapped approach. All data transfers are handled by simple load/store operations since the
external bus interface is mapped into the processor&#8217;s <a href="https://stnolting.github.io/neorv32/#_address_space">address space</a>.
This allows a very simple still high-bandwidth communications.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stream_link_interface">10.3. Stream Link Interface</h3>
<div class="paragraph">
<p>The NEORV32 <a href="https://stnolting.github.io/neorv32/#_stream_link_interface_slink">Stream Link Interface</a> provides
point-to-point, unidirectional and parallel data channels that can be used to transfer streaming data. In
contrast to the external bus interface, the streaming data does not provide any kind of "direction" control,
so it can be seen as "constant address bursts". The stream link interface provides less protocol overhead
and less latency than the bus interface. Furthermore, FIFOs can be be configured to each direction (RX/TX) to
allow more CPU-independent operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_functions_subsystem">10.4. Custom Functions Subsystem</h3>
<div class="paragraph">
<p>The NEORV32 <a href="https://stnolting.github.io/neorv32/#_custom_functions_subsystem_cfs">Custom Functions Subsystem</a> is
an "empty" template for a processor-internal module. It provides 32 32-bit memory-mapped interface
registers that can be used to communicate with any arbitrary custom design logic. The intentions of this
subsystem is to provide a simple base, where the user can concentrate on implementing the actual design logic
rather than taking care of the communication between the CPU/software and the design logic. The interface
registers are already allocated within the processor&#8217;s address space and are supported by the software framework
via low-level hardware access mechanisms. Additionally, the CFS provides a direct pre-defined interrupt channel to
the CPU, which is also supported by the NEORV32 runtime environment.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizing_the_internal_bootloader">11. Customizing the Internal Bootloader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 bootloader provides several options to configure and customize it for a certain application setup.
This configuration is done by passing <em>defines</em> when compiling the bootloader. Of course you can also
modify to bootloader source code to provide a setup that perfectly fits your needs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Each time the bootloader sources are modified, the bootloader has to be re-compiled (and re-installed to the
bootloader ROM) and the processor has to be re-synthesized.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keep in mind that the maximum size for the bootloader is limited to 32kB and should be compiled using the
base ISA <code>rv32i</code> only to ensure it can work independently of the actual CPU configuration.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 1. Bootloader configuration parameters</caption>
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-center valign-top">Default</th>
<th class="tableblock halign-center valign-top">Legal values</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">Serial console interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code>, <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>0</code> to disable UART0 (no serial console at all)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART_BAUD</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>19200</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>any</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baud rate of UART0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">Status LED</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STATUS_LED_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code>, <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable bootloader status led ("heart beat") at <code>GPIO</code> output port pin #<code>STATUS_LED_PIN</code> when <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STATUS_LED_PIN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code> &#8230;&#8203; <code>31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GPIO</code> output pin used for the high-active status LED</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">Boot configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTO_BOOT_SPI_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code>, <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>1</code> to enable immediate boot from external SPI flash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTO_BOOT_OCD_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code>, <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>1</code> to enable boot via on-chip debugger (OCD)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AUTO_BOOT_TIMEOUT</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>any</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in seconds after the auto-boot sequence starts (if there is no UART input by user); set to 0 to disabled auto-boot sequence</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">SPI configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_EN</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code>, <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set <code>1</code> to enable the usage of the SPI module (including load/store executables from/to SPI flash options)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_CS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code> &#8230;&#8203; <code>7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI chip select output (<code>spi_csn_o</code>) for selecting flash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_SECTOR_SIZE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>65536</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>any</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI flash sector size in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_FLASH_CLK_PRSC</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CLK_PRSC_8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>CLK_PRSC_2</code> <code>CLK_PRSC_4</code> <code>CLK_PRSC_8</code> <code>CLK_PRSC_64</code> <code>CLK_PRSC_128</code> <code>CLK_PRSC_1024</code> <code>CLK_PRSC_2024</code> <code>CLK_PRSC_4096</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock pre-scaler (dividing main processor clock)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPI_BOOT_BASE_ADDR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x08000000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>any</em> 32-bit value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the <em>base</em> address of the executable in external flash</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each configuration parameter is implemented as C-language <code>define</code> that can be manually overridden (<em>redefined</em>) when
invoking the bootloader&#8217;s makefile. The according parameter and its new value has to be <em>appended</em>
(using <code>+=</code>) to the makefile <code>USER_FLAGS</code> variable. Make sure to use the <code>-D</code> prefix here.</p>
</div>
<div class="paragraph">
<p>For example, to configure a UART Baud rate of 57600 and redirecting the status LED to output pin 20
use the following command (<em>in</em> the bootloader&#8217;s source folder <code>sw/bootloader</code>):</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. Example: customizing, re-compiling and re-installing the bootloader</div>
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ make USER_FLAGS+=-DUART_BAUD=57600 USER_FLAGS+=-DSTATUS_LED_PIN=20 clean_all bootloader</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>clean_all</code> target ensure that all libraries are re-compiled. The <code>bootloader</code> target will automatically
compile and install the bootloader to the HDL boot ROM (updating <code>rtl/core/neorv32_bootloader_image.vhd</code>).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_bootloader_boot_configuration">11.1. Bootloader Boot Configuration</h3>
<div class="paragraph">
<p>The bootloader provides several <em>boot configurations</em> that define where the actual application&#8217;s executable
shall be fetched from. Note that the non-default boot configurations provide a smaller memory footprint
reducing boot ROM implementation costs.</p>
</div>
<div class="sect3">
<h4 id="_default_boot_configuration">Default Boot Configuration</h4>
<div class="paragraph">
<p>The <em>default</em> bootloader configuration provides a UART-based user interface that allows to upload new executables
at any time. Optionally, the executable can also be programmed to an external SPI flash by the bootloader (see
section <a href="#_programming_an_external_spi_flash_via_the_bootloader">Programming an External SPI Flash via the Bootloader</a>).</p>
</div>
<div class="paragraph">
<p>This configuration also provides an <em>automatic boot sequence</em> (auto-boot) which will start fetching an executable
from external SPI flash using the default SPI configuration. By this, the default bootloader configuration
provides a "non volatile program storage" mechanism that automatically boot from external SPI flash
(after <code>AUTO_BOOT_TIMEOUT</code>) while still providing the option to re-program SPI flash at any time
via the UART interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="_auto_boot_spi_en"><code>AUTO_BOOT_SPI_EN</code></h4>
<div class="paragraph">
<p>The automatic boot from SPI flash (enabled when <code>AUTO_BOOT_SPI_EN</code> is <code>1</code>) will fetch an executable from an external
SPI flash (using the according <em>SPI configuration</em>) right after reset. The bootloader will start fetching
the image at SPI flash base address <code>SPI_BOOT_BASE_ADDR</code>.</p>
</div>
<div class="paragraph">
<p>Note that there is <em>no</em> UART console to interact with the bootloader. However, this boot configuration will
output minimal status messages via UART (if <code>UART_EN</code> is <code>1</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_auto_boot_ocd_en"><code>AUTO_BOOT_OCD_EN</code></h4>
<div class="paragraph">
<p>If <code>AUTO_BOOT_OCD_EN</code> is <code>1</code> the bootloader is implemented as minimal "halt loop" to be used with the on-chip debugger.
After initializing the hardware, the CPU waits in this endless loop until the on-chip debugger takes control over
the core (to upload and run the actual executable). See section <a href="#_debugging_using_the_on_chip_debugger">Debugging using the On-Chip Debugger</a>
for more information on how to use the on-chip debugger to upload and run executables.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All bootloader boot configuration support uploading new executables via the on-chip debugger.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Note that this boot configuration does not load any executable at all! Hence,
this boot configuration is intended to be used with the on-chip debugger only.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_programming_an_external_spi_flash_via_the_bootloader">12. Programming an External SPI Flash via the Bootloader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default processor-internal NEORV32 bootloader supports automatic booting from an external SPI flash.
This guide shows how to write an executable to the SPI flash via the bootloader so it can be automatically
fetched and executed after processor reset. For example, you can use a section of the FPGA bitstream configuration
memory to store an application executable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section assumes the <em>default</em> configuration of the NEORV32 bootloader.
See section <a href="#_customizing_the_internal_bootloader">Customizing the Internal Bootloader</a> on how to customize the bootloader and its setting
(for example the SPI chip-select port, the SPI clock speed or the flash base address for storing the executable).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_spi_flash">12.1. SPI Flash</h3>
<div class="paragraph">
<p>The bootloader can access an SPI compatible flash via the processor top entity&#8217;s SPI port. By default, the flash
chip-select line is to <code>spi_csn_o(0)</code> and uses 1/8 of the processor&#8217;s main clock as clock frequency.
The SPI flash has to support single-byte read and write, 24-bit addresses and at least the following standard commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>READ <code>0x03</code></p>
</li>
<li>
<p>READ STATUS <code>0x05</code></p>
</li>
<li>
<p>WRITE ENABLE <code>0x06</code></p>
</li>
<li>
<p>PAGE PROGRAM <code>0x02</code></p>
</li>
<li>
<p>SECTOR ERASE <code>0xD8</code></p>
</li>
<li>
<p>READ ID <code>0x9E</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Compatible (FGPA configuration) SPI flash memories are for example the "Winbond W25Q64FV2 or the "Micron N25Q032A".</p>
</div>
</div>
<div class="sect2">
<h3 id="_programming_an_executable">12.2. Programming an Executable</h3>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>At first, reset the NEORV32 processor and wait until the bootloader start screen appears in your terminal program.</p>
</li>
<li>
<p>Abort the auto boot sequence and start the user console by pressing any key.</p>
</li>
<li>
<p>Press u to upload the executable that you want to store to the external flash:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CMD:&gt; u
Awaiting neorv32_exe.bin...</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Send the binary in raw binary via your terminal program. When the upload is completed and "OK"
appears, press <code>p</code> to trigger the programming of the flash (do not execute the image via the <code>e</code>
command as this might corrupt the image):</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CMD:&gt; u
Awaiting neorv32_exe.bin... OK
CMD:&gt; p
Write 0x000013FC bytes to SPI flash @ 0x00800000? (y/n)</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>The bootloader shows the size of the executable and the base address inside the SPI flash where the
executable is going to be stored. A prompt appears: Type <code>y</code> to start the programming or type <code>n</code> to
abort.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Section <a href="#_customizing_the_internal_bootloader">Customizing the Internal Bootloader</a> show the according C-language <code>define</code> that can be modified
to specify the base address of the executable inside the SPI flash.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CMD:&gt; u
Awaiting neorv32_exe.bin... OK
CMD:&gt; p
Write 0x000013FC bytes to SPI flash @ 0x08000000? (y/n) y
Flashing... OK
CMD:&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>If "OK" appears in the terminal line, the programming process was successful. Now you can use the
auto boot sequence to automatically boot your application from the flash at system start-up without
any user interaction.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_packaging_the_processor_as_ip_block_for_xilinx_vivado_block_designer">13. Packaging the Processor as IP block for Xilinx Vivado Block Designer</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Import all the core files from <code>rtl/core</code> (including default internal memory architectures from <code>rtl/core/mem</code>)
and assign them to a <em>new</em> design library <code>neorv32</code>.</p>
</li>
<li>
<p>Instantiate the <code>rtl/wrappers/neorv32_top_axi4lite.vhd</code> module.</p>
</li>
<li>
<p>Then either directly use that module in a new block-design ("Create Block Design", right-click &#8594; "Add Module",
thats easier for a first try) or package it ("Tools", "Create and Package new IP") for the use in other projects.</p>
</li>
<li>
<p>Connect your AXI-peripheral directly to the core&#8217;s AXI4-Interface if you only have one, or to an AXI-Interconnect
(from the IP-catalog) if you have multiple peripherals.</p>
</li>
<li>
<p>Connect ALL the <code>ACLK</code> and <code>ARESETN</code> pins of all peripherals and interconnects to the processor&#8217;s clock and reset
signals to have a <em>unified</em> clock and reset domain (easier for a first setup).</p>
</li>
<li>
<p>Open the "Address Editor" tab and let Vivado assign the base-addresses for the AXI-peripherals (you can modify them
according to your needs).</p>
</li>
<li>
<p>For all FPGA-external signals (like UART signals) make all the connections you need "external"
(right-click on the signal/pin &#8594; "Make External").</p>
</li>
<li>
<p>Save everything, let VIVADO create a HDL-Wrapper for the block-design and choose this as your <em>Top Level Design</em>.</p>
</li>
<li>
<p>Define your constraints and generate your bitstream.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">TWI Tri-State Drivers</div>
Set the synthesis option "global" when generating the block design to maintain the internal TWI tri-state drivers.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Guide provided by GitHub user <a href="https://github.com/AWenzel83"><code>AWenzel83</code></a> (see
<a href="https://github.com/stnolting/neorv32/discussions/52#discussioncomment-819013" class="bare">https://github.com/stnolting/neorv32/discussions/52#discussioncomment-819013</a>). ‚ù§Ô∏è
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_simulating_the_processor">14. Simulating the Processor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 project includes a core CPU, built-in peripherals in the Processor Subsystem, and additional peripherals in
the templates and examples.
Therefore, there is a wide range of possible testing and verification strategies.</p>
</div>
<div class="paragraph">
<p>On the one hand, a simple smoke testbench allows ensuring that functionality is correct from a software point of view.
That is used for running the RISC-V architecture tests, in order to guarantee compliance with the ISA specification(s).</p>
</div>
<div class="paragraph">
<p>On the other hand, <a href="http://vunit.github.io/">VUnit</a> and <a href="http://vunit.github.io/verification_components/user_guide.html">Verification Components</a> are used for verifying the functionality of the various peripherals from a hardware point of view.</p>
</div>
<div class="sect2">
<h3 id="_testbench">14.1. Testbench</h3>
<div class="paragraph">
<p>A plain-VHDL (no third-party libraries) testbench (<code>sim/simple/neorv32_tb.simple.vhd</code>) can be used for simulating and
testing the processor.
This testbench features a 100MHz clock and enables all optional peripheral and CPU extensions except for the <code>E</code>
extension and the TRNG IO module (that CANNOT be simulated due to its combinatorial (looped) architecture).</p>
</div>
<div class="paragraph">
<p>The simulation setup is configured via the "User Configuration" section located right at the beginning of
the testbench&#8217;s architecture. Each configuration constant provides comments to explain the functionality.</p>
</div>
<div class="paragraph">
<p>Besides the actual NEORV32 Processor, the testbench also simulates "external" components that are connected
to the processor&#8217;s external bus/memory interface. These components are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an external instruction memory (that also allows booting from it)</p>
</li>
<li>
<p>an external data memory</p>
</li>
<li>
<p>an external memory to simulate "external IO devices"</p>
</li>
<li>
<p>a memory-mapped registers to trigger the processor&#8217;s interrupt signals</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table shows the base addresses of these four components and their default configuration and
properties:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>r</code> = read</p>
</li>
<li>
<p><code>w</code> = write</p>
</li>
<li>
<p><code>e</code> = execute</p>
</li>
<li>
<p><code>a</code> = atomic accesses possible</p>
</li>
<li>
<p><code>8</code> = byte-accessible</p>
</li>
<li>
<p><code>16</code> = half-word-accessible</p>
</li>
<li>
<p><code>32</code> = word-accessible</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 2. Testbench: processor-external memories</caption>
<colgroup>
<col style="width: 17.3913%;">
<col style="width: 13.0434%;">
<col style="width: 21.7391%;">
<col style="width: 47.8262%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Base address</th>
<th class="tableblock halign-right valign-top">Size</th>
<th class="tableblock halign-center valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>imem_size_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/e,  a, 8/16/32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external IMEM (initialized with application image)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmem_size_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/e,  a, 8/16/32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external DMEM</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xf0000000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">64 bytes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r/w/e, !a, 8/16/32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external "IO" memory, atomic accesses will fail</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xff000000</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>-/w/-,  a,  -/-/32</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory-mapped register to trigger "machine external", "machine software" and "SoC Fast Interrupt" interrupts</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The simulated NEORV32 does not use the bootloader and <em>directly boots</em> the current application image (from
the <code>rtl/core/neorv32_application_image.vhd</code> image file).
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">UART output during simulation</div>
Data written to the NEORV32 UART0 / UART1 transmitter is send to a virtual UART receiver implemented
as part of the testbench. Received chars are send to the simulator console and are also stored to a log file
(<code>neorv32.testbench_uart0.out</code> for UART0, <code>neorv32.testbench_uart1.out</code> for UART1) inside the simulation&#8217;s home folder.
<strong>Please note that printing via the native UART receiver takes a lot of time.</strong> For faster simulation console output
see section <a href="#_faster_simulation_console_output">Faster Simulation Console Output</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_faster_simulation_console_output">14.2. Faster Simulation Console Output</h3>
<div class="paragraph">
<p>When printing data via the UART the communication speed will always be based on the configured BAUD
rate. For a simulation this might take some time. To have faster output you can enable the <strong>simulation mode</strong>
for UART0/UART1 (see section <a href="https://stnolting.github.io/neorv32/#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Documentation: Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>).</p>
</div>
<div class="paragraph">
<p>ASCII data sent to UART0|UART1 will be immediately printed to the simulator console and logged to files in the simulator
execution directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>neorv32.uart?.sim_mode.text.out</code>: ASCII data.</p>
</li>
<li>
<p><code>neorv32.uart?.sim_mode.data.out</code>: all written 32-bit dumped as 8-char hexadecimal values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can "automatically" enable the simulation mode of UART0/UART1 when compiling an application.
In this case, the "real" UART0/UART1 transmitter unit is permanently disabled.
To enable the simulation mode just compile and install your application and add <em>UART?_SIM_MODE</em> to the compiler&#8217;s
<em>USER_FLAGS</em> variable (do not forget the <code>-D</code> suffix flag):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sw/example/blink_led$ make USER_FLAGS+=-DUART0_SIM_MODE clean_all all</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provided define will change the default UART0/UART1 setup function in order to set the simulation
mode flag in the according UART&#8217;s control register.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The UART simulation output (to file and to screen) outputs "complete lines" at once. A line is
completed with a line feed (newline, ASCII <code>\n</code> = 10).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_simulation_using_a_shell_script_with_ghdl">14.3. Simulation using a shell script (with GHDL)</h3>
<div class="paragraph">
<p>To simulate the processor using <em>GHDL</em> navigate to the <code>sim/simple/</code> folder and run the provided shell script.
Any arguments that are provided while executing this script are passed to GHDL.
For example the simulation time can be set to 20ms using <code>--stop-time=20ms</code> as argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sim/simple$ sh ghdl_sim.sh --stop-time=20ms</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simulation_using_application_makefiles_in_console_with_ghdl">14.4. Simulation using Application Makefiles (In-Console with GHDL)</h3>
<div class="paragraph">
<p>To directly compile and run a program in the console (using the default testbench and GHDL
as simulator) you can use the <code>sim</code> makefile target. Make sure to use the UART simulation mode
(<code>USER_FLAGS+=-DUART0_SIM_MODE</code> and/or <code>USER_FLAGS+=-DUART1_SIM_MODE</code>) to get
faster / direct-to-console UART output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sw/example/blink_led$ make USER_FLAGS+=-DUART0_SIM_MODE clean_all sim
[...]
Blinking LED demo program</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_hello_world">14.4.1. Hello World!</h4>
<div class="paragraph">
<p>To do a quick test of the NEORV32 make sure to have <a href="https://github.com/ghdl/ghdl">GHDL</a> and a
[RISC-V gcc toolchain](<a href="https://github.com/stnolting/riscv-gcc-prebuilt" class="bare">https://github.com/stnolting/riscv-gcc-prebuilt</a>) installed.
Navigate to the project&#8217;s <code>sw/example/hello_world</code> folder and run <code>make USER_FLAGS+=-DUART0_SIM_MODE MARCH=rv32imac clean_all sim</code>:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The simulator will output some <em>sanity check</em> notes (and warnings or even errors if something is ill-configured)
right at the beginning of the simulation to give a brief overview of the actual NEORV32 SoC and CPU configurations.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">stnolting@Einstein:/mnt/n/Projects/neorv32/sw/example/hello_world$ make USER_FLAGS+=-DUART0_SIM_MODE MARCH=rv32imac clean_all sim
../../../sw/lib/source/neorv32_uart.c: In function 'neorv32_uart0_setup':
../../../sw/lib/source/neorv32_uart.c:301:4: warning: #warning UART0_SIM_MODE (primary UART) enabled! Sending all UART0.TX data to text.io simulation output instead of real UART0 transmitter. Use this for simulations only! [-Wcpp]
  301 |   #warning UART0_SIM_MODE (primary UART) enabled! Sending all UART0.TX data to text.io simulation output instead of real UART0 transmitter. Use this for simulations only! <i class="conum" data-value="1"></i><b>(1)</b>
      |    ^~~~~~~
Memory utilization:
   text    data     bss     dec     hex filename
   4612       0     120    4732    127c main.elf <i class="conum" data-value="2"></i><b>(2)</b>
Compiling ../../../sw/image_gen/image_gen
Installing application image to ../../../rtl/core/neorv32_application_image.vhd <i class="conum" data-value="3"></i><b>(3)</b>
Simulating neorv32_application_image.vhd...
Tip: Compile application with USER_FLAGS+=-DUART[0/1]_SIM_MODE to auto-enable UART[0/1]'s simulation mode (redirect UART output to simulator console). <i class="conum" data-value="4"></i><b>(4)</b>
Using simulation runtime args: --stop-time=10ms <i class="conum" data-value="5"></i><b>(5)</b>
../rtl/core/neorv32_top.vhd:347:3:@0ms:(assertion note): NEORV32 PROCESSOR IO Configuration: GPIO MTIME UART0 UART1 SPI TWI PWM WDT CFS SLINK NEOLED XIRQ <i class="conum" data-value="6"></i><b>(6)</b>
../rtl/core/neorv32_top.vhd:370:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: Boot configuration: Direct boot from memory (processor-internal IMEM).
../rtl/core/neorv32_top.vhd:394:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: Implementing on-chip debugger (OCD).
../rtl/core/neorv32_cpu.vhd:169:3:@0ms:(assertion note): NEORV32 CPU ISA Configuration (MARCH): RV32IMACU_Zbb_Zicsr_Zifencei_Zfinx_Debug
../rtl/core/neorv32_cpu.vhd:189:3:@0ms:(assertion note): NEORV32 CPU CONFIG NOTE: Implementing NO dedicated hardware reset for uncritical registers (default, might reduce area). Set package constant &lt;dedicated_reset_c&gt; = TRUE to configure a DEFINED reset value for all CPU registers.
../rtl/core/neorv32_imem.vhd:107:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: Implementing processor-internal IMEM as ROM (16384 bytes), pre-initialized with application (4612 bytes).
../rtl/core/neorv32_dmem.vhd:89:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: Implementing processor-internal DMEM (RAM, 8192 bytes).
../rtl/core/neorv32_wishbone.vhd:136:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: External Bus Interface - Implementing STANDARD Wishbone protocol.
../rtl/core/neorv32_wishbone.vhd:140:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: External Bus Interface - Implementing auto-timeout (255 cycles).
../rtl/core/neorv32_wishbone.vhd:144:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: External Bus Interface - Implementing LITTLE-endian byte order.
../rtl/core/neorv32_wishbone.vhd:148:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: External Bus Interface - Implementing registered RX path.
../rtl/core/neorv32_slink.vhd:161:3:@0ms:(assertion note): NEORV32 PROCESSOR CONFIG NOTE: Implementing 8 RX and 8 TX stream links.
<i class="conum" data-value="7"></i><b>(7)</b>
                                                                                       ##
                                                                                       ##         ##   ##   ##
 ##     ##   #########   ########    ########   ##      ##   ########    ########      ##       ################
####    ##  ##          ##      ##  ##      ##  ##      ##  ##      ##  ##      ##     ##     ####            ####
## ##   ##  ##          ##      ##  ##      ##  ##      ##          ##         ##      ##       ##   ######   ##
##  ##  ##  #########   ##      ##  #########   ##      ##      #####        ##        ##     ####   ######   ####
##   ## ##  ##          ##      ##  ##    ##     ##    ##           ##     ##          ##       ##   ######   ##
##    ####  ##          ##      ##  ##     ##     ##  ##    ##      ##   ##            ##     ####            ####
##     ##    #########   ########   ##      ##      ##       ########   ##########     ##       ################
                                                                                       ##         ##   ##   ##
                                                                                       ##
Hello world! :)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Notifier that "simulation mode" of UART0 is enabled (by the <code>USER_FLAGS+=-DUART0_SIM_MODE</code> makefile flag). All UART0 output is send to the simulator console.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Final executable size (<code>text</code>) and <em>static</em> data memory requirements (<code>data</code>, <code>bss</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The application code is <em>installed</em> as pre-initialized IMEM. This is the default approach for simulation.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A note regarding UART "simulation mode", but we have already enabled that.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>List of (default) arguments that were send to the simulator. Here: maximum simulation time (10ms).</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>"Sanity checks" from the core&#8217;s VHDL files. These reports give some brief information about the SoC/CPU configuration (&#8594; generics). If there are problems with the current configuration, an ERROR will appear.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Execution of the actual program starts.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_simulation_using_vunit">14.5. Advanced Simulation using VUnit</h3>
<div class="paragraph">
<p><a href="https://vunit.github.io/">VUnit</a> is an open source unit testing framework for VHDL/SystemVerilog.
It allows continuous and automated testing of HDL code by complementing traditional testing methodologies.
The motto of VUnit is <em>"testing early and often"</em> through automation.</p>
</div>
<div class="paragraph">
<p>VUnit is composed by a <a href="http://vunit.github.io/py/ui.html">Python interface</a> and multiple optional
<a href="http://vunit.github.io/vhdl_libraries.html">VHDL libraries</a>.
The Python interface allows declaring sources and simulation options, and it handles the compilation, execution and
gathering of the results regardless of the simulator used.
That allows having a single <code>run.py</code> script to be used with GHDL, ModelSim/QuestaSim, Riviera PRO, etc.
On the other hand, the VUnit&#8217;s VHDL libraries provide utilities for assertions, logging, having virtual queues, handling CSV files, etc.
The <a href="http://vunit.github.io/verification_components/user_guide.html">Verification Component Library</a> uses those features
for abstracting away bit-toggling when verifying standard interfaces such as Wishbone, AXI, Avalon, UARTs, etc.</p>
</div>
<div class="paragraph">
<p>Testbench sources in <code>sim</code> (such as <code>sim/neorv32_tb.vhd</code> and <code>sim/uart_rx*.vhd</code>) use VUnit&#8217;s VHDL libraries for testing
NEORV32 and peripherals.
The entry-point for executing the tests is <code>sim/run.py</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># ./sim/run.py -l
neorv32.neorv32_tb.all
Listed 1 tests

# ./sim/run.py -v
Compiling into neorv32:   rtl/core/neorv32_uart.vhd                                                                                            passed
Compiling into neorv32:   rtl/core/neorv32_twi.vhd                                                                                             passed
Compiling into neorv32:   rtl/core/neorv32_trng.vhd                                                                                            passed
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="http://vunit.github.io/user_guide.html">VUnit: User Guide</a> and <a href="http://vunit.github.io/cli.html">VUnit: Command Line Interface</a> for further info about VUnit&#8217;s features.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_the_documentation">15. Building the Documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The documentation (datasheet + user guide) is written using <code>asciidoc</code>. The according source files
can be found in <code>docs/&#8230;&#8203;</code>. The documentation of the software framework is written <em>in-code</em> using <code>doxygen</code>.</p>
</div>
<div class="paragraph">
<p>A makefiles in the project&#8217;s <code>docs</code> directory is provided to build all of the documentation as HTML pages
or as PDF documents.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Pre-rendered PDFs are available online as <em>nightly pre-releases</em>: <a href="https://github.com/stnolting/neorv32/releases" class="bare">https://github.com/stnolting/neorv32/releases</a>.
The HTML-based documentation is also available online at the project&#8217;s <a href="https://stnolting.github.io/neorv32/">GitHub Pages</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The makefile provides a help target to show all available build options and their according outputs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/docs$ make help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 10. Example: Generate HTML documentation (data sheet) using <code>asciidoctor</code></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/docs$ make html</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you don&#8217;t have <code>asciidoctor</code> / <code>asciidoctor-pdf</code> installed, you can still generate all the documentation using
a <em>docker container</em> via <code>make container</code>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_zephyr_rtos_support">16. Zephyr RTOS Support ü™Å</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 processor is supported by upstream Zephyr RTOS: <a href="https://docs.zephyrproject.org/latest/boards/riscv/neorv32/doc/index.html" class="bare">https://docs.zephyrproject.org/latest/boards/riscv/neorv32/doc/index.html</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The absolute path to the NEORV32 executable image generator binary (<code>&#8230;&#8203;/neorv32/sw/image_gen</code>) has to be added to the <code>PATH</code> variable
so the Zephyr build system can generate executables and memory-initialization images.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zephyr OS port provided by GitHub user <a href="https://github.com/henrikbrixandersen">henrikbrixandersen</a>
(see <a href="https://github.com/stnolting/neorv32/discussions/172" class="bare">https://github.com/stnolting/neorv32/discussions/172</a>). ‚ù§Ô∏è
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_freertos_support">17. FreeRTOS Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A NEORV32-specific port and a simple demo for FreeRTOS (<a href="https://github.com/FreeRTOS/FreeRTOS" class="bare">https://github.com/FreeRTOS/FreeRTOS</a>) are
available in the <code>sw/example/demo_freeRTOS</code> folder. See the according documentation (<code>sw/example/demo_freeRTOS/README.md</code>)
for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_risc_v_architecture_test_framework">18. RISC-V Architecture Test Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor passes the according tests provided by the official RISC-V Architecture Test Suite
(V2.0+), which is available online at GitHub: <a href="https://github.com/riscv/riscv-arch-test" class="bare">https://github.com/riscv/riscv-arch-test</a></p>
</div>
<div class="paragraph">
<p>All files required for executing the test framework on a simulated instance of the processor (including port
files) are located in the <code>sw/isa-test</code> folder of the NEORV32 repository. The test framework is executed via the
<code>sim/run_riscv_arch_test.sh</code> script. Take a look at the provided <code>sim/README.md</code>
(<a href="https://github.com/stnolting/neorv32/tree/master/sim">online at GitHub</a>)
file for more information on how to run the tests and how testing is conducted in detail.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging_using_the_on_chip_debugger">19. Debugging using the On-Chip Debugger</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 on-chip debugger allows <em>online</em> in-system debugging via an external JTAG access port from a
host machine. The general flow is independent of the host machine&#8217;s operating system. However, this tutorial uses
Windows and Linux (Ubuntu on Windows) in parallel.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See datasheet section <a href="https://stnolting.github.io/neorv32/#_on_chip_debugger_ocd">On Chip Debugger (OCD)</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This tutorial uses <code>gdb</code> to <strong>directly upload an executable</strong> to the processor. If you are using the default
processor setup <em>with</em> internal instruction memory (IMEM) make sure it is implemented as RAM
(<em>INT_BOOTLOADER_EN</em> generic = true).
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The on-chip debugger is only implemented if the <em>ON_CHIP_DEBUGGER_EN</em> generic is set <em>true</em>. Furthermore, it requires
the <code>Zicsr</code> and <code>Zifencei</code> CPU extension to be implemented (top generics <em>CPU_EXTENSION_RISCV_Zicsr</em>
and <em>CPU_EXTENSION_RISCV_Zifencei</em> = true).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_hardware_requirements">19.1. Hardware Requirements</h3>
<div class="paragraph">
<p>Make sure the on-chip debugger of your NEORV32 setups is implemented (<em>ON_CHIP_DEBUGGER_EN</em> generic = true).
Connect a JTAG adapter to the NEORV32 <code>jtag_*</code> interface signals. If you do not have a full-scale JTAG adapter, you can
also use a FTDI-based adapter like the "FT2232H-56Q Mini Module", which is a simple and inexpensive FTDI breakout board.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 3. JTAG pin mapping</caption>
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 28.5714%;">
<col style="width: 28.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">NEORV32 top signal</th>
<th class="tableblock halign-center valign-top">JTAG signal</th>
<th class="tableblock halign-center valign-top">FTDI port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TCK</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TDI</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TDO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D2</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TMS</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D3</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_trst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">TRST</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">D4</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The low-active JTAG <em>test reset</em> (TRST) signals is <em>optional</em> as a reset can also be triggered via the TAP controller.
If TRST is not used make sure to pull the signal <em>high</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_openocd">19.2. OpenOCD</h3>
<div class="paragraph">
<p>The NEORV32 on-chip debugger can be accessed using the <a href="https://github.com/riscv/riscv-openocd">RISC-V port of OpenOCD</a>.
Prebuilt binaries can be obtained - for example - from <a href="https://www.sifive.com/software">SiFive</a>. A pre-configured
OpenOCD configuration file (<code>sw/openocd/openocd_neorv32.cfg</code>) is available that allows easy access to the NEORV32 CPU.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You might need to adapt <code>ftdi_vid_pid</code>, <code>ftdi_channel</code> and <code>ftdi_layout_init</code> in <code>sw/openocd/openocd_neorv32.cfg</code>
according to your interface chip and your operating system.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to modify the JTAG clock speed (via <code>adapter speed</code> in <code>sw/openocd/openocd_neorv32.cfg</code>) make sure to meet
the clock requirements noted in <a href="https://stnolting.github.io/neorv32/#_debug_module_dm">Documentation: Debug Transport Module (DTM)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To access the processor using OpenOCD, open a terminal and start OpenOCD with the pre-configured configuration file.</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Connecting via OpenOCD (on Windows)</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">N:\Projects\neorv32\sw\openocd&gt;openocd -f openocd_neorv32.cfg
Open On-Chip Debugger 0.11.0-rc1+dev (SiFive OpenOCD 0.10.0-2020.12.1)
Licensed under GNU GPL v2
For bug reports:
        https://github.com/sifive/freedom-tools/issues
1
Info : Listening on port 6666 for tcl connections
Info : Listening on port 4444 for telnet connections
Info : clock speed 1000 kHz
Info : JTAG tap: neorv32.cpu tap/device found: 0x0cafe001 (mfg: 0x000 (&lt;invalid&gt;), part: 0xcafe, ver: 0x0)
Info : datacount=1 progbufsize=2
Info : Disabling abstract command reads from CSRs.
Info : Examined RISC-V core; found 1 harts
Info :  hart 0: XLEN=32, misa=0x40801105
Info : starting gdb server for neorv32.cpu.0 on 3333
Info : Listening on port 3333 for gdb connections</code></pre>
</div>
</div>
<div class="paragraph">
<p>OpenOCD has successfully connected to the NEORV32 on-chip debugger and has examined the CPU (showing the content of
the <code>misa</code> CSRs). Now you can use <code>gdb</code> to connect via port 3333.</p>
</div>
</div>
<div class="sect2">
<h3 id="_debugging_with_gdb">19.3. Debugging with GDB</h3>
<div class="paragraph">
<p>This guide uses the simple "blink example" from <code>sw/example/blink_led</code> as simplified test application to
show the basics of in-system debugging.</p>
</div>
<div class="paragraph">
<p>At first, the application needs to be compiled. We will use the minimal machine architecture configuration
(<code>rv32i</code>) here to be independent of the actual processor/CPU configuration.
Navigate to <code>sw/example/blink_led</code> and compile the application:</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. Compile the test application</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">.../neorv32/sw/example/blink_led$ make MARCH=rv32i USER_FLAGS+=-g clean_all all</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Adding debug symbols to the executable</div>
<code>USER_FLAGS+=-g</code> passes the <code>-g</code> flag to the compiler so it adds debug information/symbols
to the generated ELF file. This is optional but will provide more sophisticated information for debugging
(like source file line numbers).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will generate an ELF file <code>main.elf</code> that contains all the symbols required for debugging.
Furthermore, an assembly listing file <code>main.asm</code> is generated that we will use to define breakpoints.</p>
</div>
<div class="paragraph">
<p>Open another terminal in <code>sw/example/blink_led</code> and start <code>gdb</code>.
The GNU debugger is part of the toolchain (see <a href="#_software_toolchain_setup">Software Toolchain Setup</a>).</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. Starting GDB (on Linux (Ubuntu on Windows))</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">.../neorv32/sw/example/blink_led$ riscv32-unknown-elf-gdb
GNU gdb (GDB) 10.1
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "--host=x86_64-pc-linux-gnu --target=riscv32-unknown-elf".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
&lt;https://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.

For help, type "help".
Type "apropos word" to search for commands related to "word".
(gdb)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now connect to OpenOCD using the default port 3333 on your machine.
We will use the previously generated ELF file <code>main.elf</code> from the <code>blink_led</code> example.
Finally, upload the program to the processor and start debugging.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The executable that is uploaded to the processor is <strong>not</strong> the default NEORV32 executable (<code>neorv32_exe.bin</code>) that
is used for uploading via the bootloader. Instead, all the required sections (like <code>.text</code>) are extracted from <code>mail.elf</code>
by GDB and uploaded via the debugger&#8217;s indirect memory access.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 14. Running GDB</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">(gdb) target extended-remote localhost:3333 <i class="conum" data-value="1"></i><b>(1)</b>
Remote debugging using localhost:3333
warning: No executable has been specified and target does not support
determining executable automatically.  Try using the "file" command.
0xffff0c94 in ?? () <i class="conum" data-value="2"></i><b>(2)</b>
(gdb) file main.elf <i class="conum" data-value="3"></i><b>(3)</b>
A program is being debugged already.
Are you sure you want to change the file? (y or n) y
Reading symbols from main.elf...
(gdb) load <i class="conum" data-value="4"></i><b>(4)</b>
Loading section .text, size 0xd0c lma 0x0
Loading section .rodata, size 0x39c lma 0xd0c
Start address 0x00000000, load size 4264
Transfer rate: 43 KB/sec, 2132 bytes/write.
(gdb)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Connect to OpenOCD</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The CPU was still executing code from the bootloader ROM - but that does not matter here</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Select <code>mail.elf</code> from the <code>blink_led</code> example</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Upload the executable</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the upload, GDB will make the processor jump to the beginning of the uploaded executable
(by default, this is the beginning of the instruction memory at <code>0x00000000</code>) skipping the bootloader
and halting the CPU right before executing the <code>blink_led</code> application.</p>
</div>
<div class="sect3">
<h4 id="_breakpoint_example">19.3.1. Breakpoint Example</h4>
<div class="paragraph">
<p>The following steps are just a small showcase that illustrate a simple debugging scheme.</p>
</div>
<div class="paragraph">
<p>While compiling <code>blink_led</code>, an assembly listing file <code>main.asm</code> was generated.
Open this file with a text editor to check out what the CPU is going to do when resumed.</p>
</div>
<div class="paragraph">
<p>The <code>blink_led</code> example implements a simple counter on the 8 lowest GPIO output ports. The program uses
"busy wait" to have a visible delay between increments. This waiting is done by calling the <code>neorv32_cpu_delay_ms</code>
function. We will add a <em>breakpoint</em> right at the end of this wait function so we can step through the iterations
of the counter.</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Cut-out from <code>main.asm</code> generated from the <code>blink_led</code> example</div>
<div class="content">
<pre class="highlight"><code class="language-assembly" data-lang="assembly">00000688 &lt;__neorv32_cpu_delay_ms_end&gt;:
 688:	01c12083          	lw	ra,28(sp)
 68c:	02010113          	addi	sp,sp,32
 690:	00008067          	ret</code></pre>
</div>
</div>
<div class="paragraph">
<p>The very last instruction of the <code>neorv32_cpu_delay_ms</code> function is <code>ret</code> (= return)
at hexadecimal <code>690</code> in this example. Add this address as <em>breakpoint</em> to GDB.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The address might be different if you use a different version of the software framework or
if different ISA options are configured.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 16. Adding a GDB breakpoint</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">(gdb) b * 0x690
Breakpoint 1 at 0x690</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">How do breakpoints work?</div>
The NEORV32 on-chip debugger does not provide any hardware breakpoints (RISC-V "trigger modules") that compare an address like the PC
with a predefined value. Instead, gdb will modify the actual executable in IMEM: the actual instruction at the address
of the specified breakpoint is replaced by a <code>break</code> / <code>c.break</code> instruction. Whenever execution reaches this instruction, debug mode is
re-entered and the debugger restores the original instruction at this address to maintain original program behavior.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now execute <code>c</code> (= continue). The CPU will resume operation until it hits the break-point.
By this we can "step" from increment to increment.</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. Iterating from breakpoint to breakpoint</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Breakpoint 1 at 0x690
(gdb) c
Continuing.

Breakpoint 1, 0x00000690 in neorv32_cpu_delay_ms ()
(gdb) c
Continuing.

Breakpoint 1, 0x00000690 in neorv32_cpu_delay_ms ()
(gdb) c
Continuing.</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal">20. Legal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph">
<p><strong>BSD 3-Clause License</strong></p>
</div>
<div class="paragraph">
<p>Copyright (c) 2021, Stephan Nolting. All rights reserved.</p>
</div>
<div class="paragraph">
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that
the following conditions are met:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the
following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or
promote products derived from this software without specific prior written permission.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>The NEORV32 RISC-V Processor</strong><br>
Copyright (c) 2021, by Dipl.-Ing. Stephan Nolting. All rights reserved.<br>
HQ: <a href="https://github.com/stnolting/neorv32" class="bare">https://github.com/stnolting/neorv32</a><br>
Contact: <a href="mailto:stnolting@gmail.com">stnolting@gmail.com</a><br>
<em>made in Hanover, Germany</em></p>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_proprietary_notice">Proprietary Notice</h3>
<div class="ulist">
<ul>
<li>
<p>"GitHub" is a Subsidiary of Microsoft Corporation.</p>
</li>
<li>
<p>"Vivado" and "Artix" are trademarks of Xilinx Inc.</p>
</li>
<li>
<p>"AXI", "AXI4-Lite" and "AXI4-Stream" are trademarks of Arm Holdings plc.</p>
</li>
<li>
<p>"ModelSim" is a trademark of Mentor Graphics ‚Äì A Siemens Business.</p>
</li>
<li>
<p>"Quartus Prime" and "Cyclone" are trademarks of Intel Corporation.</p>
</li>
<li>
<p>"iCE40", "UltraPlus" and "Radiant" are trademarks of Lattice Semiconductor Corporation.</p>
</li>
<li>
<p>"Windows" is a trademark of Microsoft Corporation.</p>
</li>
<li>
<p>"Tera Term" copyright by T. Teranishi.</p>
</li>
<li>
<p>Timing diagrams made with WaveDrom Editor.</p>
</li>
<li>
<p>"NeoPixel" is a trademark of Adafruit Industries.</p>
</li>
<li>
<p>Documentation made with <code>asciidoctor</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PDF icons from <a href="https://www.flaticon.com" class="bare">https://www.flaticon.com</a> and made by
<a href="https://www.freepik.com">Freepik</a>, <a href="https://www.flaticon.com/authors/good-ware">Good Ware</a>,
<a href="https://www.flaticon.com/authors/pixel-perfect">Pixel perfect</a>, <a href="https://www.flaticon.com/authors/vectors-market">Vectors Market</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_disclaimer">Disclaimer</h3>
<div class="paragraph">
<p>This project is released under the BSD 3-Clause license. No copyright infringement
intended. Other implied or used projects might have different licensing ‚Äì see their documentation to get more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limitation_of_liability_for_external_links">Limitation of Liability for External Links</h3>
<div class="paragraph">
<p>This document contains links to the websites of third parties ("external links"). As the content of these websites
is not under our control, we cannot assume any liability for such external content. In all cases, the provider of
information of the linked websites is liable for the content and accuracy of the information provided. At the
point in time when the links were placed, no infringements of the law were recognizable to us. As soon as an
infringement of the law becomes known to us, we will immediately remove the link in question.</p>
</div>
</div>
<div class="sect2">
<h3 id="_citing">Citing</h3>
<div class="paragraph">
<p>If you are using the NEORV32 or parts of the project in some kind of publication, please cite it as follows:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Contributors ‚ù§Ô∏è</div>
Please add as many <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a> as possible to the <code>authors</code> field üòâ.<br>
This project would not be where it is without them.<br>
Full names can be found in the repository&#8217;s <a href="https://github.com/stnolting/neorv32/blob/master/.mailmap"><code>.mailmap</code></a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 18. BibTeX</div>
<div class="content">
<pre class="highlight"><code>@misc{nolting20,
  author       = {Nolting, S.},
  title        = {The NEORV32 RISC-V Processor},
  year         = {2020},
  publisher    = {GitHub},
  journal      = {GitHub repository},
  howpublished = {\url{https://github.com/stnolting/neorv32}}
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DOI</div>
This project also provides a <em>digital object identifier</em> provided by <a href="https://zenodo.org">zenodo</a>:
<a href="https://doi.org/10.5281/zenodo.5018888"><span class="image"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5018888.svg" alt="zenodo.5018888" title="zenodo"></span></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgments">Acknowledgments</h3>
<div class="paragraph">
<p><strong>A big shoutout to all <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a>,
who helped improving this project! ‚ù§Ô∏è</strong></p>
</div>
<div class="paragraph">
<p><a href="https://riscv.org">RISC-V</a> - instruction sets want to be free!</p>
</div>
</div>
<div class="sect2">
<h3 id="_impressum_imprint">Impressum (Imprint)</h3>
<div class="paragraph">
<p>See <a href="https://github.com/stnolting/neorv32/blob/master/docs/impressum.md"><code>docs/impressum.md</code></a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version v1.6.3-r74-g2aed6dcb<br>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>